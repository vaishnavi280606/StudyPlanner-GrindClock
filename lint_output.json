[{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Play' is defined but never used.","line":2,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Pause' is defined but never used.","line":2,"column":72,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Lightbulb' is defined but never used.","line":2,"column":97,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":106},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Volume2' is defined but never used.","line":2,"column":159,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":166},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'VolumeX' is defined but never used.","line":2,"column":168,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":175},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MessageCircle' is defined but never used.","line":2,"column":209,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":222},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UserProfile' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ErrorBoundary' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'timerPosition' is assigned a value but never used.","line":62,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setTimerPosition' is assigned a value but never used.","line":62,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDragging' is assigned a value but never used.","line":66,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsDragging' is assigned a value but never used.","line":66,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'dragOffset' is assigned a value but never used.","line":67,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setDragOffset' is assigned a value but never used.","line":67,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4378,4381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4378,4381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ringtoneRef' is assigned a value but never used.","line":104,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":104,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":131,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":131,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":131,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6693,6694],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":133,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":133,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":133,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6723,6724],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":166,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":166,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":166,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8283,8284],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":168,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":168,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":168,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":168,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8313,8314],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'stopRingtone'. Either include it or remove the dependency array.","line":169,"column":6,"nodeType":"ArrayExpression","endLine":169,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [soundEnabled, incomingCallSoundEnabled, stopRingtone, soundVolume]","fix":{"range":[8321,8374],"text":"[soundEnabled, incomingCallSoundEnabled, stopRingtone, soundVolume]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadGlobalUnreadCount'. Either include it or remove the dependency array.","line":248,"column":6,"nodeType":"ArrayExpression","endLine":248,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [user, playNotificationSound, playRingtone, loadGlobalUnreadCount]","fix":{"range":[11273,11316],"text":"[user, playNotificationSound, playRingtone, loadGlobalUnreadCount]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserProfile'. Either include it or remove the dependency array.","line":289,"column":6,"nodeType":"ArrayExpression","endLine":289,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserProfile, user]","fix":{"range":[12505,12511],"text":"[loadUserProfile, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12557,12560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12557,12560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":946,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":946,"endColumn":27},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":946,"column":29,"nodeType":"BlockStatement","messageId":"unexpected","endLine":946,"endColumn":32,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[37042,37043],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'user' is defined but never used.","line":981,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":981,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":982,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":982,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38140,38143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38140,38143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":982,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":982,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38172,38175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38172,38175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":30,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\nimport { BookOpen, LayoutDashboard, Clock, Target, History, Zap, Play, Pause, BarChart3, Brain, Lightbulb, X, Users, GraduationCap, Settings as SettingsIcon, Volume2, VolumeX, Phone, PhoneOff, CalendarCheck, MessageCircle, Tag } from 'lucide-react';\nimport { Subject, StudySession, StudyGoal } from './types';\nimport { storage } from './utils/storage';\nimport { Dashboard } from './components/Dashboard';\nimport { SubjectManager } from './components/SubjectManager';\nimport { StudyTimer } from './components/StudyTimer';\nimport { SessionHistory } from './components/SessionHistory';\nimport { GoalsManager } from './components/GoalsManager';\nimport { AdvancedAnalytics } from './components/AdvancedAnalytics';\nimport { AIRecommendations } from './components/AIRecommendations';\nimport { StudyTechniques } from './components/StudyTechniques';\nimport { Reminder } from './components/Reminder';\nimport { ProtectedRoute } from './components/ProtectedRoute';\nimport { UserProfile } from './components/UserProfile';\nimport { useAuth } from './contexts/AuthContext';\nimport { GoalReminderPopup } from './components/GoalReminderPopup';\nimport { AIChatbot } from './components/AIChatbot';\nimport { ExamCountdown } from './components/ExamCountdown';\nimport { MentorConnect } from './components/MentorConnect';\nimport { FriendsCircle } from './components/FriendsCircle';\nimport { VideoCall } from './components/VideoCall';\nimport { createNotification, subscribeToNotifications, fetchUnreadCounts } from './utils/supabase-queries';\nimport { supabase } from './utils/supabase';\nimport { Header } from './components/Header';\nimport { Settings } from './components/Settings';\nimport { ErrorBoundary } from './components/ErrorBoundary';\nimport { ToastNotification } from './components/ToastNotification';\nimport MentorDashboard from './components/MentorDashboard';\nimport { MentorSessionsPage } from './components/MentorSessionsPage';\nimport { MentorStudentsPage } from './components/MentorStudentsPage';\nimport { MentorOfferingsPage } from './components/MentorOfferingsPage';\n\ntype View = 'dashboard' | 'subjects' | 'timer' | 'history' | 'goals' | 'analytics' | 'recommendations' | 'techniques' | 'mentors' | 'friends' | 'settings' | 'mentor-sessions' | 'mentor-students' | 'mentor-offerings';\n\n// Timer state interface\ninterface TimerState {\n  isRunning: boolean;\n  isPaused: boolean;\n  selectedSubjectId: string;\n  startTime: Date | null;\n  elapsedSeconds: number;\n  notes: string;\n  focusRating: number;\n}\n\nfunction AppContent() {\n  const [currentView, setCurrentView] = useState<View>('dashboard');\n  const [subjects, setSubjects] = useState<Subject[]>([]);\n  const [sessions, setSessions] = useState<StudySession[]>([]);\n  const [goals, setGoals] = useState<StudyGoal[]>([]);\n  const [isDarkMode, setIsDarkMode] = useState(() => {\n    const saved = localStorage.getItem('darkMode');\n    return saved ? JSON.parse(saved) : false;\n  });\n  const [showSuccessPopper, setShowSuccessPopper] = useState(false);\n  const [showGoalReminder, setShowGoalReminder] = useState(false);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\n  const [goalsInitialTab, setGoalsInitialTab] = useState<'goals' | 'exams' | 'tracker'>('goals');\n\n  // Draggable timer position state\n  const [timerPosition, setTimerPosition] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_timer_position');\n    return saved ? JSON.parse(saved) : { x: window.innerWidth - 300, y: 80 }; // Default top-right position\n  });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n\n  // Persistent timer state\n  const [timerState, setTimerState] = useState<TimerState>({\n    isRunning: false,\n    isPaused: false,\n    selectedSubjectId: '',\n    startTime: null,\n    elapsedSeconds: 0,\n    notes: '',\n    focusRating: 3,\n  });\n\n  const [activeVideoCall, setActiveVideoCall] = useState<{ name: string; avatar?: string; friendId?: string; isInitiator?: boolean } | null>(null);\n  const [totalUnreadMessages, setTotalUnreadMessages] = useState(0);\n  const [soundEnabled, setSoundEnabled] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_sound_enabled');\n    return saved ? JSON.parse(saved) : true;\n  });\n  const [incomingCall, setIncomingCall] = useState<any | null>(null);\n  const [soundVolume, setSoundVolume] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_sound_volume');\n    return saved ? JSON.parse(saved) : 0.7;\n  });\n  const [incomingCallSoundEnabled, setIncomingCallSoundEnabled] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_incoming_call_sound');\n    return saved ? JSON.parse(saved) : true;\n  });\n  const [receiveMsgSoundEnabled, setReceiveMsgSoundEnabled] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_receive_msg_sound');\n    return saved ? JSON.parse(saved) : true;\n  });\n  const [sendMsgSoundEnabled, setSendMsgSoundEnabled] = useState(() => {\n    const saved = localStorage.getItem('grind_clock_send_msg_sound');\n    return saved ? JSON.parse(saved) : true;\n  });\n\n  const ringtoneRef = useRef<HTMLAudioElement | null>(null);\n  const [toasts, setToasts] = useState<Array<{ id: string; message: string; senderName?: string; senderAvatar?: string; type: 'message' | 'info' | 'success'; senderId?: string }>>([]);\n  const removeToast = useCallback((id: string) => setToasts(prev => prev.filter(t => t.id !== id)), []);\n\n  const [userRole, setUserRole] = useState<'student' | 'mentor'>('student');\n\n  const { user } = useAuth();\n\n  // Notification sound â€” plays a real audio file, falls back to Web Audio API\n  const playNotificationSound = useCallback(() => {\n    if (!soundEnabled || !receiveMsgSoundEnabled) return;\n    try {\n      const a = new Audio('https://cdn.pixabay.com/audio/2024/11/04/audio_4956b4edd2.mp3');\n      a.volume = soundVolume;\n      a.play().catch(() => {\n        // Web Audio API fallback\n        try {\n          const ctx = new AudioContext();\n          const o1 = ctx.createOscillator(); const o2 = ctx.createOscillator();\n          const g = ctx.createGain();\n          o1.connect(g); o2.connect(g); g.connect(ctx.destination);\n          o1.frequency.setValueAtTime(587, ctx.currentTime);\n          o2.frequency.setValueAtTime(784, ctx.currentTime + 0.08);\n          g.gain.setValueAtTime(soundVolume * 0.3, ctx.currentTime);\n          g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);\n          o1.start(); o1.stop(ctx.currentTime + 0.12);\n          o2.start(ctx.currentTime + 0.08); o2.stop(ctx.currentTime + 0.3);\n        } catch (_) { }\n      });\n    } catch (_) { }\n  }, [soundEnabled, receiveMsgSoundEnabled, soundVolume]);\n\n  // Ringtone â€” plays a real audio file on loop, falls back to Web Audio API\n  const ringtoneCtxRef = useRef<{ ctx: AudioContext; interval: ReturnType<typeof setInterval> } | null>(null);\n  const ringtoneAudioRef = useRef<HTMLAudioElement | null>(null);\n\n  const playRingtone = useCallback(() => {\n    if (!soundEnabled || !incomingCallSoundEnabled) return;\n    stopRingtone(); // clean up any existing\n    try {\n      const a = new Audio('https://cdn.pixabay.com/audio/2022/10/30/audio_f3f8e5a830.mp3');\n      a.loop = true;\n      a.volume = soundVolume;\n      ringtoneAudioRef.current = a;\n      a.play().catch(() => {\n        // Web Audio API fallback ringtone\n        try {\n          const ctx = new AudioContext();\n          const playPulse = () => {\n            const osc = ctx.createOscillator();\n            const gain = ctx.createGain();\n            osc.connect(gain); gain.connect(ctx.destination);\n            osc.frequency.setValueAtTime(440, ctx.currentTime);\n            osc.frequency.setValueAtTime(520, ctx.currentTime + 0.15);\n            osc.frequency.setValueAtTime(440, ctx.currentTime + 0.30);\n            gain.gain.setValueAtTime(soundVolume * 0.4, ctx.currentTime);\n            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);\n            osc.start(); osc.stop(ctx.currentTime + 0.5);\n          };\n          playPulse();\n          const interval = setInterval(playPulse, 1200);\n          ringtoneCtxRef.current = { ctx, interval };\n        } catch (_) { }\n      });\n    } catch (_) { }\n  }, [soundEnabled, incomingCallSoundEnabled, soundVolume]);\n\n  const stopRingtone = useCallback(() => {\n    // Stop audio element ringtone\n    if (ringtoneAudioRef.current) {\n      ringtoneAudioRef.current.pause();\n      ringtoneAudioRef.current.src = '';\n      ringtoneAudioRef.current = null;\n    }\n    // Stop Web Audio API fallback ringtone\n    if (ringtoneCtxRef.current) {\n      clearInterval(ringtoneCtxRef.current.interval);\n      ringtoneCtxRef.current.ctx.close().catch(() => { });\n      ringtoneCtxRef.current = null;\n    }\n  }, []);\n\n\n\n  const handleStartVideoCall = async (name: string, avatar?: string, friendId?: string) => {\n    setActiveVideoCall({ name, avatar, friendId, isInitiator: true });\n    if (friendId && user) {\n      await createNotification(friendId, user.id, 'call', `Incoming call from friend ${user.user_metadata?.full_name || 'Someone'}`);\n    }\n  };\n\n  useEffect(() => {\n    if (user) {\n      const sub = subscribeToNotifications(user.id, async (notif) => {\n        if (!notif.is_read) {\n          if (notif.type === 'call') {\n            // Fetch sender profile for call popup\n            const { data: senderProfile } = await supabase\n              .from('user_profiles')\n              .select('full_name, avatar_url')\n              .eq('user_id', notif.sender_id)\n              .single();\n            setIncomingCall({\n              ...notif,\n              senderName: senderProfile?.full_name || 'Someone',\n              senderAvatar: senderProfile?.avatar_url || `https://ui-avatars.com/api/?name=U&background=random`,\n            });\n            playRingtone();\n          } else {\n            playNotificationSound();\n\n            // Show toast popup for all non-call notifications\n            const { data: senderProfile } = await supabase\n              .from('user_profiles')\n              .select('full_name, avatar_url')\n              .eq('user_id', notif.sender_id)\n              .single();\n            const sName = senderProfile?.full_name || 'Someone';\n            const sAvatar = senderProfile?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(sName)}&background=random`;\n            const toastMsg = notif.type === 'message'\n              ? (notif.content || 'Sent you a message')\n              : notif.type === 'friend_request'\n                ? `${sName} wants to be your friend`\n                : (notif.content || 'New notification');\n            setToasts(prev => [...prev, {\n              id: notif.id || `toast-${Date.now()}`,\n              message: toastMsg,\n              senderName: sName,\n              senderAvatar: sAvatar,\n              type: notif.type === 'message' ? 'message' : 'info',\n              senderId: notif.sender_id,\n            }]);\n          }\n\n          if (notif.type === 'message') {\n            loadGlobalUnreadCount();\n          }\n        }\n      });\n      loadGlobalUnreadCount();\n      return () => {\n        sub.unsubscribe();\n      };\n    }\n  }, [user, playNotificationSound, playRingtone]);\n\n  // Listen for notifications-read events to refresh global unread count\n  useEffect(() => {\n    const handler = async () => {\n      if (!user) return;\n      const counts = await fetchUnreadCounts(user.id);\n      const total = Object.values(counts).reduce((acc, curr) => acc + curr, 0);\n      setTotalUnreadMessages(total);\n    };\n    window.addEventListener('notifications-read', handler);\n    return () => window.removeEventListener('notifications-read', handler);\n  }, [user]);\n\n  const loadGlobalUnreadCount = async () => {\n    if (!user) return;\n    const counts = await fetchUnreadCounts(user.id);\n    const total = Object.values(counts).reduce((acc, curr) => acc + curr, 0);\n    setTotalUnreadMessages(total);\n  };\n\n  const loadUserProfile = async () => {\n    if (!user) return;\n    try {\n      const { data, error } = await supabase\n        .from('user_profiles')\n        .select('role')\n        .eq('user_id', user.id)\n        .single();\n      if (!error && data) {\n        setUserRole(data.role || 'student');\n      }\n    } catch (error) {\n      console.error('Error loading role:', error);\n    }\n  };\n\n  useEffect(() => {\n    if (user) {\n      loadUserProfile();\n    }\n  }, [user]);\n\n  const handleNotificationClick = (notif: any) => {\n    if (notif.type === 'message') {\n      setCurrentView('friends');\n    } else if (notif.type === 'friend_request') {\n      setCurrentView('friends');\n    } else if (notif.type === 'call') {\n      setIncomingCall(notif);\n      playRingtone();\n    } else if (notif.type === 'session_request') {\n      // Mentor got a new booking request â†’ go to mentor sessions\n      setCurrentView(userRole === 'mentor' ? 'mentor-sessions' : 'history');\n    } else if (notif.type === 'session_accepted' || notif.type === 'session_rejected' || notif.type === 'session_cancelled') {\n      // Student got session update â†’ go to session history; mentor â†’ mentor sessions\n      setCurrentView(userRole === 'mentor' ? 'mentor-sessions' : 'history');\n    } else if (notif.type === 'session_completed') {\n      // Handled by ReviewPopup in NotificationCenter, but if clicked normally navigate\n      setCurrentView(userRole === 'mentor' ? 'mentor-sessions' : 'history');\n    } else if (notif.type === 'new_review') {\n      // Mentor got a review â†’ go to mentor sessions\n      setCurrentView('mentor-sessions');\n    } else if (notif.type === 'group_added') {\n      setCurrentView('friends');\n    }\n  };\n\n  useEffect(() => {\n    localStorage.setItem('grind_clock_sound_enabled', JSON.stringify(soundEnabled));\n  }, [soundEnabled]);\n\n  useEffect(() => {\n    localStorage.setItem('grind_clock_sound_volume', JSON.stringify(soundVolume));\n  }, [soundVolume]);\n\n  useEffect(() => {\n    localStorage.setItem('grind_clock_incoming_call_sound', JSON.stringify(incomingCallSoundEnabled));\n  }, [incomingCallSoundEnabled]);\n\n  useEffect(() => {\n    localStorage.setItem('grind_clock_receive_msg_sound', JSON.stringify(receiveMsgSoundEnabled));\n  }, [receiveMsgSoundEnabled]);\n\n  useEffect(() => {\n    localStorage.setItem('grind_clock_send_msg_sound', JSON.stringify(sendMsgSoundEnabled));\n  }, [sendMsgSoundEnabled]);\n\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const [loadedSubjects, loadedSessions, loadedGoals] = await Promise.all([\n          storage.getSubjects(),\n          storage.getSessions(),\n          storage.getGoals()\n        ]);\n\n        setSubjects(loadedSubjects);\n        setSessions(loadedSessions);\n\n        // Auto-complete exams that have passed\n        const now = new Date();\n        let goalsUpdated = false;\n        const updatedGoals = loadedGoals.map(goal => {\n          if (goal.isExam && goal.examDate && !goal.completed) {\n            const examDateTime = new Date(goal.examDate);\n\n            // Set exam time if available\n            if (goal.examTime) {\n              const [hours, minutes] = goal.examTime.split(':').map(Number);\n              examDateTime.setHours(hours, minutes, 0, 0);\n            } else {\n              // If no time specified, consider exam done at end of day\n              examDateTime.setHours(23, 59, 59, 999);\n            }\n\n            // If exam has passed, mark as completed\n            if (examDateTime < now) {\n              goalsUpdated = true;\n              return {\n                ...goal,\n                completed: true,\n                completedAt: examDateTime\n              };\n            }\n          }\n          return goal;\n        });\n\n        // Save updated goals if any were auto-completed\n        if (goalsUpdated) {\n          await storage.saveGoals(updatedGoals);\n        }\n\n        setGoals(updatedGoals);\n\n        // Show goal reminder on app load if there are active goals\n        const activeGoals = updatedGoals.filter(g => !g.completed);\n        if (activeGoals.length > 0) {\n          // Delay to allow UI to render first\n          setTimeout(() => setShowGoalReminder(true), 1000);\n        }\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    loadData();\n\n    // Auto-hide sidebar after 5 seconds\n    const sidebarTimer = setTimeout(() => {\n      setIsSidebarOpen(false);\n    }, 5000);\n\n    return () => clearTimeout(sidebarTimer);\n  }, []);\n\n  // Show goal reminder when switching to dashboard\n  useEffect(() => {\n    if (currentView === 'dashboard' && goals.length > 0) {\n      const activeGoals = goals.filter(g => !g.completed);\n      if (activeGoals.length > 0) {\n        // Check if we should show reminder (not too frequently)\n        const lastReminderTime = localStorage.getItem('lastGoalReminderTime');\n        const now = Date.now();\n        const oneHour = 60 * 60 * 1000; // 1 hour in milliseconds\n\n        if (!lastReminderTime || now - parseInt(lastReminderTime) > oneHour) {\n          setTimeout(() => setShowGoalReminder(true), 500);\n          localStorage.setItem('lastGoalReminderTime', now.toString());\n        }\n      }\n    }\n  }, [currentView, goals]);\n\n  // Timer effect - runs continuously when timer is active\n  useEffect(() => {\n    let interval: number | undefined;\n    if (timerState.isRunning && !timerState.isPaused && timerState.startTime) {\n      interval = window.setInterval(() => {\n        const now = new Date();\n        setTimerState(prev => ({\n          ...prev,\n          elapsedSeconds: Math.floor((now.getTime() - prev.startTime!.getTime()) / 1000)\n        }));\n      }, 1000);\n    }\n    return () => {\n      if (interval) clearInterval(interval);\n    };\n  }, [timerState.isRunning, timerState.isPaused, timerState.startTime]);\n\n  const handleAddSubject = async (subject: Omit<Subject, 'id'>) => {\n    const newSubject: Subject = {\n      ...subject,\n      id: crypto.randomUUID(),\n    };\n    const updated = [...subjects, newSubject];\n    setSubjects(updated);\n    await storage.saveSubjects(updated);\n  };\n\n  const handleUpdateSubject = async (id: string, updates: Partial<Subject>) => {\n    const updated = subjects.map((s) => (s.id === id ? { ...s, ...updates } : s));\n    setSubjects(updated);\n    await storage.saveSubjects(updated);\n  };\n\n  const handleDeleteSubject = async (id: string) => {\n    if (confirm('Delete this subject? All related sessions will remain but show as \"Unknown Subject\".')) {\n      const updated = subjects.filter((s) => s.id !== id);\n      setSubjects(updated);\n      await storage.saveSubjects(updated);\n    }\n  };\n\n  const handleSessionComplete = async (session: Omit<StudySession, 'id'>) => {\n    const newSession: StudySession = {\n      ...session,\n      id: crypto.randomUUID(),\n    };\n    const updated = [newSession, ...sessions];\n    setSessions(updated);\n    await storage.saveSessions(updated);\n    setShowSuccessPopper(true);\n    setTimeout(() => setShowSuccessPopper(false), 4000);\n  };\n\n  const handleAddGoal = async (goal: Omit<StudyGoal, 'id'>) => {\n    const newGoal: StudyGoal = {\n      ...goal,\n      id: crypto.randomUUID(),\n    };\n    const updated = [...goals, newGoal];\n    setGoals(updated);\n    await storage.saveGoals(updated);\n  };\n\n  const handleUpdateGoal = async (id: string, goalData: Omit<StudyGoal, 'id'>) => {\n    const updated = goals.map((g) =>\n      g.id === id\n        ? {\n          ...goalData,\n          id,\n          completed: g.completed, // Preserve completion status\n          completedAt: g.completedAt, // Preserve completion date\n        }\n        : g\n    );\n    setGoals(updated);\n    await storage.saveGoals(updated);\n  };\n\n  const handleToggleGoal = async (id: string) => {\n    const updated = goals.map((g) =>\n      g.id === id\n        ? {\n          ...g,\n          completed: !g.completed,\n          completedAt: !g.completed ? new Date() : undefined,\n        }\n        : g\n    );\n    setGoals(updated);\n    await storage.saveGoals(updated);\n  };\n\n  const handleDeleteGoal = async (id: string) => {\n    if (confirm('Delete this goal?')) {\n      const updated = goals.filter((g) => g.id !== id);\n      setGoals(updated);\n      await storage.saveGoals(updated);\n    }\n  };\n\n  // Timer handlers\n  const handleTimerStart = (subjectId: string) => {\n    setTimerState({\n      isRunning: true,\n      isPaused: false,\n      selectedSubjectId: subjectId,\n      startTime: new Date(),\n      elapsedSeconds: 0,\n      notes: '',\n      focusRating: 3,\n    });\n  };\n\n  const handleTimerPause = () => {\n    setTimerState(prev => ({\n      ...prev,\n      isPaused: true,\n      isRunning: true // Keep running state true, just paused\n    }));\n  };\n\n  const handleTimerResume = () => {\n    if (!timerState.startTime) return;\n\n    // Calculate the time that was paused and adjust start time\n    const now = new Date();\n    const pausedDuration = Math.floor((now.getTime() - timerState.startTime.getTime()) / 1000) - timerState.elapsedSeconds;\n    const adjustedStartTime = new Date(timerState.startTime.getTime() + (pausedDuration * 1000));\n\n    setTimerState(prev => ({\n      ...prev,\n      isPaused: false,\n      isRunning: true,\n      startTime: adjustedStartTime\n    }));\n  };\n\n  const handleTimerStop = () => {\n    if (!timerState.startTime || !timerState.selectedSubjectId) return;\n\n    const endTime = new Date();\n    const durationMinutes = Math.floor(timerState.elapsedSeconds / 60);\n\n    if (durationMinutes < 1) {\n      alert('Session must be at least 1 minute long');\n      return;\n    }\n\n    const session: Omit<StudySession, 'id'> = {\n      subjectId: timerState.selectedSubjectId,\n      startTime: timerState.startTime,\n      endTime,\n      durationMinutes,\n      focusRating: timerState.focusRating,\n      notes: timerState.notes,\n      completed: true,\n    };\n\n    handleSessionComplete(session);\n\n    // Reset timer state\n    setTimerState({\n      isRunning: false,\n      isPaused: false,\n      selectedSubjectId: '',\n      startTime: null,\n      elapsedSeconds: 0,\n      notes: '',\n      focusRating: 3,\n    });\n  };\n\n  const handleTimerUpdate = (updates: Partial<TimerState>) => {\n    setTimerState(prev => ({ ...prev, ...updates }));\n  };\n\n\n\n  // Save dark mode preference to localStorage when it changes\n  useEffect(() => {\n    localStorage.setItem('darkMode', JSON.stringify(isDarkMode));\n  }, [isDarkMode]);\n\n  const formatTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n\n  // All navigation items (shown in hamburger menu)\n  const allNavigation = userRole === 'mentor' ? [\n    { id: 'dashboard' as View, label: 'Dashboard', icon: LayoutDashboard },\n    { id: 'mentor-sessions' as View, label: 'Sessions', icon: CalendarCheck },\n    { id: 'mentor-students' as View, label: 'Students', icon: GraduationCap },\n    { id: 'friends' as View, label: 'Friends', icon: Users },\n    { id: 'mentor-offerings' as View, label: 'Offerings', icon: Tag },\n  ] : [\n    { id: 'dashboard' as View, label: 'Dashboard', icon: LayoutDashboard },\n    { id: 'timer' as View, label: 'Study Timer', icon: Clock },\n    { id: 'goals' as View, label: 'Goals', icon: Target },\n    { id: 'history' as View, label: 'History', icon: History },\n    { id: 'subjects' as View, label: 'Subjects', icon: BookOpen },\n    { id: 'mentors' as View, label: 'Mentors', icon: GraduationCap },\n    { id: 'friends' as View, label: 'Friends', icon: Users },\n    { id: 'analytics' as View, label: 'Analytics', icon: BarChart3 },\n    { id: 'recommendations' as View, label: 'AI Insights', icon: Brain },\n  ];\n\n\n  return (\n    <div className={`min-h-screen flex transition-colors ${isDarkMode ? 'bg-gradient-to-br from-slate-900 to-slate-800' : 'bg-gradient-to-br from-slate-50 to-slate-100'}`}>\n      {/* Persistent Left Sidebar - Grind Menu */}\n      <div className={`w-80 h-screen fixed left-0 top-0 shadow-lg z-30 transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-80'\n        } ${isDarkMode ? 'bg-slate-800 border-r border-slate-700' : 'bg-white border-r border-slate-200'}`}>\n        <div className=\"flex items-center justify-between px-6 py-6 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"bg-gradient-to-br from-amber-500 to-orange-600 p-2 rounded-xl shadow-lg\">\n              <Zap className=\"text-white\" size={28} />\n            </div>\n            <div>\n              <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Grind Clock</h2>\n              <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>Push Your Limits</p>\n            </div>\n          </div>\n          <button\n            onClick={() => setIsSidebarOpen(false)}\n            className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-700 text-slate-300' : 'hover:bg-slate-100 text-slate-600'}`}\n            title=\"Hide menu\"\n          >\n            <X size={24} />\n          </button>\n        </div>\n\n\n        <div className=\"flex-1 p-4 space-y-2 overflow-y-auto\">\n          {allNavigation.map((item) => {\n            const Icon = item.icon;\n            return (\n              <button\n                key={item.id}\n                onClick={() => {\n                  setCurrentView(item.id);\n                }}\n                className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all text-left ${currentView === item.id\n                  ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md'\n                  : isDarkMode\n                    ? 'text-slate-300 hover:bg-slate-700'\n                    : 'text-slate-600 hover:bg-slate-100'\n                  }`}\n              >\n                <Icon size={20} />\n                <span className=\"flex-1\">{item.label}</span>\n                {item.id === 'friends' && totalUnreadMessages > 0 && (\n                  <span className={`min-w-[20px] h-5 flex items-center justify-center px-1 rounded-full text-[10px] font-bold leading-none ${currentView === item.id\n                    ? 'bg-white/20 text-white'\n                    : 'bg-amber-500 text-white'\n                    }`}>\n                    {totalUnreadMessages > 99 ? '99+' : totalUnreadMessages}\n                  </span>\n                )}\n                {item.id === 'dashboard' && timerState.isRunning && (\n                  <span className={`text-xs font-mono font-bold px-2 py-1 rounded-md ${currentView === item.id\n                    ? 'bg-white/20 text-white'\n                    : 'bg-amber-500/10 text-amber-500'\n                    }`}>\n                    {formatTime(timerState.elapsedSeconds)}\n                  </span>\n                )}\n              </button>\n            );\n          })}\n\n          {/* Settings Button */}\n          <button\n            onClick={() => setCurrentView('settings')}\n            className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all text-left ${currentView === 'settings' ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md' : isDarkMode ? 'text-slate-300 hover:bg-slate-700' : 'text-slate-600 hover:bg-slate-100'}`}\n          >\n            <SettingsIcon size={20} />\n            <span className=\"flex-1\">Settings</span>\n          </button>\n        </div>\n\n      </div>\n\n      {/* Main Content Area */}\n      {/* Main Content Area */}\n      <div className={`flex-1 transition-all duration-300 relative h-screen flex flex-col ${isSidebarOpen ? 'ml-80' : 'ml-0'}`}>\n        <Header\n          isDarkMode={isDarkMode}\n          setIsDarkMode={setIsDarkMode}\n          isSidebarOpen={isSidebarOpen}\n          setIsSidebarOpen={setIsSidebarOpen}\n          currentView={currentView}\n          setCurrentView={setCurrentView}\n          totalUnreadMessages={totalUnreadMessages}\n          onNotificationClick={handleNotificationClick}\n          timerState={timerState}\n          formatTime={formatTime}\n          onTimerPause={handleTimerPause}\n          onTimerResume={handleTimerResume}\n          subjects={subjects}\n          onSettingsClick={() => setCurrentView('settings')}\n          userRole={userRole}\n        />\n\n        {/* Exam Countdown Banner - Only on Dashboard for students */}\n        {\n          currentView === 'dashboard' && userRole !== 'mentor' && (\n            <ExamCountdown\n              goals={goals}\n              isDarkMode={isDarkMode}\n              onExamClick={() => {\n                setGoalsInitialTab('exams');\n                setCurrentView('goals');\n              }}\n            />\n          )\n        }\n\n        <div className=\"flex-1 relative overflow-hidden flex flex-col\">\n          <main className={`flex-1 overflow-y-auto px-6 py-8 pb-24 ${currentView === 'friends' ? 'scrollbar-hide' : ''}`}>\n            {currentView === 'dashboard' && userRole === 'mentor' && (\n              <MentorDashboard isDarkMode={isDarkMode} onStartVideoCall={handleStartVideoCall} />\n            )}\n            {currentView === 'dashboard' && userRole !== 'mentor' && (\n              <Dashboard subjects={subjects} sessions={sessions} goals={goals} isDarkMode={isDarkMode} />\n            )}\n            {currentView === 'subjects' && (\n              <SubjectManager\n                subjects={subjects}\n                sessions={sessions}\n                onAddSubject={handleAddSubject}\n                onUpdateSubject={handleUpdateSubject}\n                onDeleteSubject={handleDeleteSubject}\n                isDarkMode={isDarkMode}\n              />\n            )}\n            {currentView === 'timer' && (\n              <div className=\"max-w-2xl mx-auto\">\n                <StudyTimer\n                  subjects={subjects}\n                  timerState={timerState}\n                  onTimerStart={handleTimerStart}\n                  onTimerPause={handleTimerPause}\n                  onTimerResume={handleTimerResume}\n                  onTimerStop={handleTimerStop}\n                  onTimerUpdate={handleTimerUpdate}\n                  formatTime={formatTime}\n                  isDarkMode={isDarkMode}\n                />\n              </div>\n            )}\n            {currentView === 'history' && (\n              <SessionHistory sessions={sessions} subjects={subjects} isDarkMode={isDarkMode} />\n            )}\n            {currentView === 'goals' && (\n              <GoalsManager\n                goals={goals}\n                subjects={subjects}\n                sessions={sessions}\n                onAddGoal={handleAddGoal}\n                onUpdateGoal={handleUpdateGoal}\n                onToggleGoal={handleToggleGoal}\n                onDeleteGoal={handleDeleteGoal}\n                isDarkMode={isDarkMode}\n                initialTab={goalsInitialTab}\n              />\n            )}\n            {currentView === 'analytics' && (\n              <AdvancedAnalytics\n                sessions={sessions}\n                subjects={subjects}\n                isDarkMode={isDarkMode}\n              />\n            )}\n            {currentView === 'recommendations' && (\n              <AIRecommendations\n                sessions={sessions}\n                subjects={subjects}\n                isDarkMode={isDarkMode}\n              />\n            )}\n            {currentView === 'techniques' && (\n              <StudyTechniques\n                subjects={subjects}\n                sessions={sessions}\n                isDarkMode={isDarkMode}\n              />\n            )}\n            {currentView === 'mentors' && (\n              <MentorConnect isDarkMode={isDarkMode} onStartVideoCall={handleStartVideoCall} onStartChat={() => { }} />\n            )}\n            {currentView === 'friends' && (\n              <FriendsCircle\n                isDarkMode={isDarkMode}\n                onStartVideoCall={handleStartVideoCall}\n                userRole={userRole}\n              />\n            )}\n            {currentView === 'mentor-sessions' && (\n              <MentorSessionsPage isDarkMode={isDarkMode} onStartVideoCall={handleStartVideoCall} />\n            )}\n            {currentView === 'mentor-students' && (\n              <MentorStudentsPage isDarkMode={isDarkMode} onStartVideoCall={handleStartVideoCall} />\n            )}\n            {currentView === 'mentor-offerings' && (\n              <MentorOfferingsPage isDarkMode={isDarkMode} />\n            )}\n            {currentView === 'settings' && (\n              <Settings\n                isDarkMode={isDarkMode}\n                onClose={() => setCurrentView('dashboard')}\n                soundEnabled={soundEnabled}\n                setSoundEnabled={setSoundEnabled}\n                soundVolume={soundVolume}\n                setSoundVolume={setSoundVolume}\n                incomingCallSoundEnabled={incomingCallSoundEnabled}\n                setIncomingCallSoundEnabled={setIncomingCallSoundEnabled}\n                receiveMsgSoundEnabled={receiveMsgSoundEnabled}\n                setReceiveMsgSoundEnabled={setReceiveMsgSoundEnabled}\n                sendMsgSoundEnabled={sendMsgSoundEnabled}\n                setSendMsgSoundEnabled={setSendMsgSoundEnabled}\n              />\n            )}\n          </main>\n\n          {\n            showSuccessPopper && (\n              <div className=\"fixed top-20 right-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-xl shadow-2xl animate-bounce z-50 max-w-sm\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"bg-white/20 p-2 rounded-lg\">\n                    <Zap className=\"text-white\" size={24} />\n                  </div>\n                  <div>\n                    <h3 className=\"font-bold text-lg\">Session Complete!</h3>\n                    <p className=\"text-sm text-green-50\">Great work! Keep grinding!</p>\n                  </div>\n                </div>\n              </div>\n            )\n          }\n\n          <Reminder goals={goals} isDarkMode={isDarkMode} />\n\n          {/* Goal Reminder Popup */}\n          {\n            showGoalReminder && (\n              <GoalReminderPopup\n                goals={goals}\n                subjects={subjects}\n                isDarkMode={isDarkMode}\n                onClose={() => setShowGoalReminder(false)}\n              />\n            )\n          }\n\n        </div >\n\n        <footer className={`fixed bottom-0 right-0 border-t transition-all duration-300 z-20 ${isSidebarOpen ? 'left-80' : 'left-0'\n          } ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"w-full px-6 py-3\">\n            <div className=\"flex flex-col md:flex-row items-center justify-between gap-2\">\n              <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                Â© 2025 Grind Clock. Push your limits every day.\n              </p>\n              <div className={`flex items-center gap-2 text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                <Zap size={14} />\n                <span>Powered by dedication</span>\n              </div>\n            </div>\n          </div>\n        </footer>\n\n\n        {/* Video Call Overlay */}\n        {\n          activeVideoCall && (\n            <VideoCall\n              participantName={activeVideoCall.name}\n              participantAvatar={activeVideoCall.avatar}\n              isDarkMode={isDarkMode}\n              onClose={() => setActiveVideoCall(null)}\n              currentUserId={user?.id || ''}\n              callId={activeVideoCall.friendId && user ? [user.id, activeVideoCall.friendId].sort().join('-') : ''}\n              participantId={activeVideoCall.friendId || ''}\n              isInitiator={!!activeVideoCall.isInitiator}\n            />\n          )\n        }\n\n        {/* AI Chatbot */}\n        <AIChatbot isDarkMode={isDarkMode} />\n      </div >\n\n      {/* Incoming Call Modal */}\n      {\n        incomingCall && (\n          <IncomingCallModal\n            incomingCall={incomingCall}\n            isDarkMode={isDarkMode}\n            user={user}\n            onAccept={() => {\n              stopRingtone();\n              setActiveVideoCall({\n                name: incomingCall.senderName,\n                avatar: incomingCall.senderAvatar,\n                friendId: incomingCall.sender_id\n              });\n              setIncomingCall(null);\n            }}\n            onReject={async () => {\n              stopRingtone();\n              // Send missed call notification to caller\n              if (user && incomingCall.sender_id) {\n                try {\n                  await createNotification(\n                    incomingCall.sender_id,\n                    user.id,\n                    'call_ended',\n                    `ðŸ“ž Missed call from ${user.user_metadata?.full_name || 'User'}`\n                  );\n                } catch (_) { }\n              }\n              setIncomingCall(null);\n            }}\n          />\n        )\n      }\n\n      {/* Toast Notifications */}\n      <div className=\"fixed top-4 right-4 z-[200] flex flex-col gap-2 max-w-sm w-full pointer-events-none\">\n        {toasts.map(toast => (\n          <div key={toast.id} className=\"pointer-events-auto\">\n            <ToastNotification\n              message={toast.message}\n              type={toast.type}\n              duration={4000}\n              onClose={() => removeToast(toast.id)}\n              senderName={toast.senderName}\n              avatarUrl={toast.senderAvatar}\n              action={toast.type === 'message' ? {\n                label: 'Open Chat',\n                onClick: () => {\n                  setCurrentView('friends');\n                  removeToast(toast.id);\n                }\n              } : undefined}\n            />\n          </div>\n        ))}\n      </div>\n    </div >\n  );\n}\n\n/* â”€â”€â”€ Incoming Call Modal with 30s auto-timeout â”€â”€â”€ */\nfunction IncomingCallModal({ incomingCall, isDarkMode, user, onAccept, onReject }: {\n  incomingCall: any; isDarkMode: boolean; user: any;\n  onAccept: () => void; onReject: () => void;\n}) {\n  const [countdown, setCountdown] = useState(30);\n  const timerRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  useEffect(() => {\n    timerRef.current = setInterval(() => {\n      setCountdown(prev => {\n        if (prev <= 1) {\n          clearInterval(timerRef.current!);\n          onReject(); // auto-reject & send missed call\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n    return () => { if (timerRef.current) clearInterval(timerRef.current); };\n  }, [onReject]);\n\n  return (\n    <div className=\"fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in\">\n      <div className={`w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n        <div className=\"p-8 text-center\">\n          <div className=\"relative inline-block mb-6\">\n            <div className=\"absolute inset-0 bg-amber-500 rounded-full animate-ping opacity-20\"></div>\n            <img\n              src={incomingCall.senderAvatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'}\n              alt=\"\"\n              className=\"w-24 h-24 rounded-full border-4 border-amber-500 relative z-10\"\n            />\n            <div className=\"absolute -bottom-2 -right-2 bg-amber-500 p-2 rounded-full border-4 border-slate-900 z-20\">\n              <Phone size={20} className=\"text-white animate-pulse\" />\n            </div>\n          </div>\n\n          <h2 className={`text-2xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            {incomingCall.senderName}\n          </h2>\n          <p className=\"text-amber-500 font-medium animate-pulse mb-2\">\n            Incoming Video Call...\n          </p>\n          {/* Countdown ring timer */}\n          <div className=\"flex items-center justify-center gap-2 mb-6\">\n            <div className=\"relative w-10 h-10\">\n              <svg className=\"w-10 h-10 -rotate-90\" viewBox=\"0 0 36 36\">\n                <circle cx=\"18\" cy=\"18\" r=\"16\" fill=\"none\" stroke={isDarkMode ? '#334155' : '#e2e8f0'} strokeWidth=\"2\" />\n                <circle cx=\"18\" cy=\"18\" r=\"16\" fill=\"none\" stroke=\"#f59e0b\" strokeWidth=\"2\" strokeDasharray={`${(countdown / 30) * 100.53} 100.53`} strokeLinecap=\"round\" className=\"transition-all duration-1000\" />\n              </svg>\n              <span className={`absolute inset-0 flex items-center justify-center text-xs font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{countdown}</span>\n            </div>\n            <span className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>seconds remaining</span>\n          </div>\n\n          <div className=\"flex gap-4\">\n            <button\n              onClick={onAccept}\n              className=\"flex-1 flex items-center justify-center gap-2 py-4 bg-green-500 hover:bg-green-600 text-white rounded-2xl font-bold transition-all shadow-lg shadow-green-500/20\"\n            >\n              <Phone size={20} />\n              Pickup\n            </button>\n            <button\n              onClick={onReject}\n              className=\"flex-1 flex items-center justify-center gap-2 py-4 bg-red-500 hover:bg-red-600 text-white rounded-2xl font-bold transition-all shadow-lg shadow-red-500/20\"\n            >\n              <PhoneOff size={20} />\n              Decline\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <ProtectedRoute>\n      <AppContent />\n    </ProtectedRoute>\n  );\n}\n\nexport default App;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\AIChatbot.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\AIRecommendations.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[565,568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[565,568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Brain, Lightbulb, TrendingUp, Clock, Target, AlertCircle, CheckCircle, Zap } from 'lucide-react';\nimport { StudySession, Subject } from '../types';\n\ninterface AIRecommendationsProps {\n  sessions: StudySession[];\n  subjects: Subject[];\n  isDarkMode: boolean;\n}\n\ninterface Recommendation {\n  id: string;\n  type: 'schedule' | 'technique' | 'focus' | 'balance' | 'performance';\n  priority: 'high' | 'medium' | 'low';\n  title: string;\n  description: string;\n  actionable: string;\n  reasoning: string;\n  impact: string;\n  icon: any;\n  color: string;\n}\n\nexport function AIRecommendations({ sessions, subjects, isDarkMode }: AIRecommendationsProps) {\n  const [selectedType, setSelectedType] = useState<string>('all');\n\n  const generateRecommendations = (): Recommendation[] => {\n    const recommendations: Recommendation[] = [];\n    const now = new Date();\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const recentSessions = sessions.filter(s => s.startTime >= weekAgo);\n\n    // Analyze study patterns\n    const hourCounts = new Array(24).fill(0);\n    const focusRatings: number[] = [];\n    const sessionLengths: number[] = [];\n    \n    recentSessions.forEach(session => {\n      const hour = new Date(session.startTime).getHours();\n      hourCounts[hour]++;\n      if (session.focusRating) focusRatings.push(session.focusRating);\n      if (session.durationMinutes) sessionLengths.push(session.durationMinutes);\n    });\n\n    const avgFocus = focusRatings.length > 0 ? focusRatings.reduce((a, b) => a + b, 0) / focusRatings.length : 0;\n    const avgSessionLength = sessionLengths.length > 0 ? sessionLengths.reduce((a, b) => a + b, 0) / sessionLengths.length : 0;\n    const peakHour = hourCounts.indexOf(Math.max(...hourCounts));\n\n    // Schedule Optimization Recommendations\n    if (recentSessions.length >= 5) {\n      const morningHours = [6, 7, 8, 9, 10];\n      const afternoonHours = [14, 15, 16, 17];\n      const eveningHours = [18, 19, 20, 21];\n\n      const morningStudy = morningHours.reduce((sum, hour) => sum + hourCounts[hour], 0);\n      const afternoonStudy = afternoonHours.reduce((sum, hour) => sum + hourCounts[hour], 0);\n      const eveningStudy = eveningHours.reduce((sum, hour) => sum + hourCounts[hour], 0);\n\n      if (morningStudy < afternoonStudy && morningStudy < eveningStudy) {\n        recommendations.push({\n          id: 'morning-study',\n          type: 'schedule',\n          priority: 'high',\n          title: 'Try Morning Study Sessions',\n          description: 'Research shows peak cognitive performance occurs in the morning hours.',\n          actionable: 'Schedule your most challenging subjects between 8-10 AM',\n          reasoning: 'You currently study less in the morning, but this is when most people have peak focus',\n          impact: 'Could improve focus ratings by 15-25%',\n          icon: Clock,\n          color: 'text-orange-500'\n        });\n      }\n\n      if (peakHour >= 0 && hourCounts[peakHour] >= 3) {\n        recommendations.push({\n          id: 'peak-hour-optimization',\n          type: 'schedule',\n          priority: 'medium',\n          title: 'Optimize Your Peak Hour',\n          description: `You're most productive at ${peakHour}:00. Use this time strategically.`,\n          actionable: `Schedule your most difficult subjects at ${peakHour}:00`,\n          reasoning: 'Data shows this is your most consistent study time',\n          impact: 'Maximize productivity during your natural peak',\n          icon: TrendingUp,\n          color: 'text-green-500'\n        });\n      }\n    }\n\n    // Focus Improvement Recommendations\n    if (avgFocus > 0 && avgFocus < 3.5) {\n      recommendations.push({\n        id: 'focus-improvement',\n        type: 'focus',\n        priority: 'high',\n        title: 'Improve Focus with Shorter Sessions',\n        description: 'Your average focus rating is below optimal levels.',\n        actionable: 'Try 25-minute Pomodoro sessions with 5-minute breaks',\n        reasoning: `Current average focus: ${avgFocus.toFixed(1)}/5. Shorter sessions often improve concentration`,\n        impact: 'Could increase focus ratings by 0.5-1.0 points',\n        icon: Brain,\n        color: 'text-purple-500'\n      });\n    }\n\n    if (avgSessionLength > 90) {\n      recommendations.push({\n        id: 'session-length',\n        type: 'technique',\n        priority: 'medium',\n        title: 'Break Up Long Study Sessions',\n        description: 'Your sessions average over 90 minutes, which can lead to diminishing returns.',\n        actionable: 'Split long sessions into 45-60 minute blocks with breaks',\n        reasoning: `Average session: ${Math.round(avgSessionLength)} minutes. Research shows focus declines after 45-60 minutes`,\n        impact: 'Better retention and reduced mental fatigue',\n        icon: Zap,\n        color: 'text-yellow-500'\n      });\n    }\n\n    // Subject Balance Recommendations\n    const subjectHours = subjects.map(subject => {\n      const subjectSessions = recentSessions.filter(s => s.subjectId === subject.id);\n      const hours = subjectSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0) / 60;\n      return { subject, hours, target: subject.targetHoursPerWeek };\n    });\n\n    const imbalancedSubjects = subjectHours.filter(s => \n      s.target > 0 && s.hours < s.target * 0.6\n    );\n\n    if (imbalancedSubjects.length > 0) {\n      const mostNeglected = imbalancedSubjects.sort((a, b) => \n        (a.hours / a.target) - (b.hours / b.target)\n      )[0];\n\n      recommendations.push({\n        id: 'subject-balance',\n        type: 'balance',\n        priority: 'high',\n        title: `Increase ${mostNeglected.subject.name} Study Time`,\n        description: 'You\\'re significantly behind on your weekly target for this subject.',\n        actionable: `Add 2-3 more sessions of ${mostNeglected.subject.name} this week`,\n        reasoning: `Current: ${mostNeglected.hours.toFixed(1)}h, Target: ${mostNeglected.target}h per week`,\n        impact: 'Stay on track with your study goals',\n        icon: Target,\n        color: 'text-red-500'\n      });\n    }\n\n    // Performance-based Recommendations\n    const subjectPerformance = subjects.map(subject => {\n      const subjectSessions = recentSessions.filter(s => s.subjectId === subject.id);\n      const avgFocus = subjectSessions.filter(s => s.focusRating).length > 0\n        ? subjectSessions.reduce((sum, s) => sum + (s.focusRating || 0), 0) / subjectSessions.filter(s => s.focusRating).length\n        : 0;\n      return { subject, avgFocus, sessionCount: subjectSessions.length };\n    });\n\n    const weakSubject = subjectPerformance\n      .filter(s => s.sessionCount >= 2 && s.avgFocus > 0)\n      .sort((a, b) => a.avgFocus - b.avgFocus)[0];\n\n    if (weakSubject && weakSubject.avgFocus < 3) {\n      recommendations.push({\n        id: 'weak-subject-technique',\n        type: 'technique',\n        priority: 'medium',\n        title: `Try Different Techniques for ${weakSubject.subject.name}`,\n        description: 'This subject has your lowest focus ratings.',\n        actionable: 'Experiment with active recall, spaced repetition, or mind mapping',\n        reasoning: `Average focus for ${weakSubject.subject.name}: ${weakSubject.avgFocus.toFixed(1)}/5`,\n        impact: 'Improve engagement and retention for challenging subjects',\n        icon: Lightbulb,\n        color: 'text-blue-500'\n      });\n    }\n\n    // Consistency Recommendations\n    const studyDays = new Set(recentSessions.map(s => \n      new Date(s.startTime).toDateString()\n    )).size;\n\n    if (studyDays < 5) {\n      recommendations.push({\n        id: 'consistency',\n        type: 'schedule',\n        priority: 'medium',\n        title: 'Improve Study Consistency',\n        description: 'Regular study habits lead to better long-term retention.',\n        actionable: 'Aim to study at least 5 days per week, even if for shorter periods',\n        reasoning: `You studied on ${studyDays} days this week. Consistency beats intensity`,\n        impact: 'Better knowledge retention and reduced cramming',\n        icon: CheckCircle,\n        color: 'text-green-500'\n      });\n    }\n\n    return recommendations.sort((a, b) => {\n      const priorityOrder = { high: 3, medium: 2, low: 1 };\n      return priorityOrder[b.priority] - priorityOrder[a.priority];\n    });\n  };\n\n  const recommendations = generateRecommendations();\n  const filteredRecommendations = selectedType === 'all' \n    ? recommendations \n    : recommendations.filter(r => r.type === selectedType);\n\n  const recommendationTypes = [\n    { key: 'all', label: 'All Recommendations', count: recommendations.length },\n    { key: 'schedule', label: 'Schedule', count: recommendations.filter(r => r.type === 'schedule').length },\n    { key: 'technique', label: 'Techniques', count: recommendations.filter(r => r.type === 'technique').length },\n    { key: 'focus', label: 'Focus', count: recommendations.filter(r => r.type === 'focus').length },\n    { key: 'balance', label: 'Balance', count: recommendations.filter(r => r.type === 'balance').length },\n    { key: 'performance', label: 'Performance', count: recommendations.filter(r => r.type === 'performance').length },\n  ].filter(type => type.count > 0);\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'high': return 'border-red-500 bg-red-50 dark:bg-red-900/20';\n      case 'medium': return 'border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20';\n      case 'low': return 'border-green-500 bg-green-50 dark:bg-green-900/20';\n      default: return 'border-gray-500 bg-gray-50 dark:bg-gray-900/20';\n    }\n  };\n\n  const getPriorityIcon = (priority: string) => {\n    switch (priority) {\n      case 'high': return <AlertCircle className=\"w-4 h-4 text-red-500\" />;\n      case 'medium': return <Clock className=\"w-4 h-4 text-yellow-500\" />;\n      case 'low': return <CheckCircle className=\"w-4 h-4 text-green-500\" />;\n      default: return null;\n    }\n  };\n\n  if (sessions.length < 3) {\n    return (\n      <div className={`p-8 rounded-lg text-center ${isDarkMode ? 'bg-gray-800' : 'bg-white'} border ${isDarkMode ? 'border-gray-700' : 'border-gray-200'}`}>\n        <Brain className={`w-16 h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`} />\n        <h3 className={`text-xl font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n          AI Recommendations Coming Soon\n        </h3>\n        <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n          Complete a few more study sessions to get personalized AI-powered recommendations for improving your study habits.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center space-x-3\">\n        <Brain className=\"w-8 h-8 text-purple-500\" />\n        <div>\n          <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n            AI Study Recommendations\n          </h2>\n          <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n            Personalized insights based on your study patterns\n          </p>\n        </div>\n      </div>\n\n      {/* Filter Tabs */}\n      <div className=\"flex flex-wrap gap-2\">\n        {recommendationTypes.map(type => (\n          <button\n            key={type.key}\n            onClick={() => setSelectedType(type.key)}\n            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n              selectedType === type.key\n                ? 'bg-purple-500 text-white'\n                : isDarkMode\n                ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n            }`}\n          >\n            {type.label} ({type.count})\n          </button>\n        ))}\n      </div>\n\n      {/* Recommendations List */}\n      <div className=\"space-y-4\">\n        {filteredRecommendations.map((rec) => {\n          const IconComponent = rec.icon;\n          return (\n            <div\n              key={rec.id}\n              className={`p-6 rounded-lg border-l-4 ${getPriorityColor(rec.priority)} ${\n                isDarkMode ? 'bg-gray-800' : 'bg-white'\n              } border ${isDarkMode ? 'border-gray-700' : 'border-gray-200'}`}\n            >\n              <div className=\"flex items-start justify-between mb-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <IconComponent className={`w-6 h-6 ${rec.color}`} />\n                  <div>\n                    <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n                      {rec.title}\n                    </h3>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      {getPriorityIcon(rec.priority)}\n                      <span className={`text-sm font-medium capitalize ${\n                        rec.priority === 'high' ? 'text-red-500' :\n                        rec.priority === 'medium' ? 'text-yellow-500' : 'text-green-500'\n                      }`}>\n                        {rec.priority} Priority\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <p className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  {rec.description}\n                </p>\n\n                <div className={`p-4 rounded-lg ${isDarkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>\n                  <h4 className={`font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n                    ðŸ’¡ Action to Take:\n                  </h4>\n                  <p className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                    {rec.actionable}\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <h4 className={`font-medium text-sm mb-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                      Why this matters:\n                    </h4>\n                    <p className={`text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      {rec.reasoning}\n                    </p>\n                  </div>\n                  <div>\n                    <h4 className={`font-medium text-sm mb-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                      Expected impact:\n                    </h4>\n                    <p className={`text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                      {rec.impact}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {filteredRecommendations.length === 0 && (\n        <div className={`p-8 rounded-lg text-center ${isDarkMode ? 'bg-gray-800' : 'bg-white'} border ${isDarkMode ? 'border-gray-700' : 'border-gray-200'}`}>\n          <CheckCircle className={`w-16 h-16 mx-auto mb-4 text-green-500`} />\n          <h3 className={`text-xl font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n            Great Job!\n          </h3>\n          <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n            No recommendations in this category. Your study habits are looking good!\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\AdvancedAnalytics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ChatBox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":36,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":36,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2076,2077],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":38,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":13},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":38,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":38,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2104,2105],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":63,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":63,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":63,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3295,3296],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":65,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":13},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":65,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":65,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3323,3324],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":93,"column":5,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":93,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7269,7272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7269,7272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9538,9541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9538,9541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9809,9812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9809,9812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10196,10199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10196,10199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11486,11489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11486,11489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12570,12573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12570,12573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13618,13621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13618,13621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":317,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13906,13909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13906,13909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14651,14654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14651,14654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":354,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15177,15180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15177,15180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'friend.isGroup' and 'scrollToBottom'. Either include them or remove the dependency array.","line":373,"column":6,"nodeType":"ArrayExpression","endLine":373,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [user.id, friend.id, friend.isGroup, scrollToBottom]","fix":{"range":[15912,15934],"text":"[user.id, friend.id, friend.isGroup, scrollToBottom]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'scrollToBottom'. Either include it or remove the dependency array.","line":375,"column":42,"nodeType":"ArrayExpression","endLine":375,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [messages, scrollToBottom]","fix":{"range":[15981,15991],"text":"[messages, scrollToBottom]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16437,16440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16437,16440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":427,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17606,17609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17606,17609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":428,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17674,17677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17674,17677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":456,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":456,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18664,18667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18664,18667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":458,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18814,18817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18814,18817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":460,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18963,18966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18963,18966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":498,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":498,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20392,20395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20392,20395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":500,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":500,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20518,20521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20518,20521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":638,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":638,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":638,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":638,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[26523,26524],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":684,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":684,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":807,"column":116,"nodeType":null,"messageId":"unusedVar","endLine":807,"endColumn":117},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":807,"column":119,"nodeType":"BlockStatement","messageId":"unexpected","endLine":807,"endColumn":122,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[34006,34007],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":890,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":890,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38860,38863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38860,38863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":893,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":893,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39044,39047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39044,39047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":894,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":894,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39176,39179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39176,39179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":896,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":896,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39345,39348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39345,39348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":896,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":896,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39375,39378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39375,39378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":901,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":901,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39652,39655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39652,39655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":910,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":910,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40521,40524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40521,40524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1002,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1002,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45544,45547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45544,45547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":40,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useEffect, useState, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { Send, X, Smile, Image, Mic, Square, Loader2, Video, History, PanelLeftClose, PanelLeft, Palette, Search, Play, Pause, CheckCheck, Download, Crown, UserPlus, UserMinus, Users, Trash2, Flame, Clock, BookOpen, Calendar, MessageCircle, GraduationCap, Brain, MapPin, Target } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\nimport { fetchGroupMembers, addGroupMember, removeGroupMember, searchUsers } from '../utils/supabase-queries';\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€ Sound helpers (reads settings from localStorage) â”€â”€â”€â”€â”€â”€â”€ */\r\n// Audio file URLs for notification sounds\r\nconst SOUND_URLS = {\r\n  send: 'https://cdn.pixabay.com/audio/2022/03/24/audio_4193bac9f8.mp3',     // short pop\r\n  receive: 'https://cdn.pixabay.com/audio/2022/11/17/audio_fe6bde tried.mp3', // message ding â€“ fallback below\r\n  ringtone: 'https://cdn.pixabay.com/audio/2022/10/30/audio_f3f8e5a830.mp3',  // ringtone\r\n};\r\n\r\nfunction playSendSound() {\r\n  try {\r\n    const masterOff = localStorage.getItem('grind_clock_sound_enabled') === 'false';\r\n    const sendOff = localStorage.getItem('grind_clock_send_msg_sound') === 'false';\r\n    if (masterOff || sendOff) return;\r\n    const vol = parseFloat(localStorage.getItem('grind_clock_sound_volume') || '0.7');\r\n    const a = new Audio(SOUND_URLS.send);\r\n    a.volume = vol;\r\n    a.play().catch(() => {\r\n      // Fallback to Web Audio API beep\r\n      try {\r\n        const ctx = new AudioContext();\r\n        const osc = ctx.createOscillator();\r\n        const g = ctx.createGain();\r\n        osc.connect(g); g.connect(ctx.destination);\r\n        osc.frequency.setValueAtTime(880, ctx.currentTime);\r\n        osc.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.08);\r\n        g.gain.setValueAtTime(vol * 0.3, ctx.currentTime);\r\n        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);\r\n        osc.start(); osc.stop(ctx.currentTime + 0.15);\r\n      } catch (_) { }\r\n    });\r\n  } catch (_) { }\r\n}\r\n\r\nfunction playReceiveSound() {\r\n  try {\r\n    const masterOff = localStorage.getItem('grind_clock_sound_enabled') === 'false';\r\n    const recvOff = localStorage.getItem('grind_clock_receive_msg_sound') === 'false';\r\n    if (masterOff || recvOff) return;\r\n    const vol = parseFloat(localStorage.getItem('grind_clock_sound_volume') || '0.7');\r\n    const a = new Audio('https://cdn.pixabay.com/audio/2024/11/04/audio_4956b4edd2.mp3');\r\n    a.volume = vol;\r\n    a.play().catch(() => {\r\n      // Fallback to Web Audio API ding\r\n      try {\r\n        const ctx = new AudioContext();\r\n        const o1 = ctx.createOscillator();\r\n        const o2 = ctx.createOscillator();\r\n        const g = ctx.createGain();\r\n        o1.connect(g); o2.connect(g); g.connect(ctx.destination);\r\n        o1.frequency.setValueAtTime(587, ctx.currentTime);\r\n        o2.frequency.setValueAtTime(784, ctx.currentTime + 0.08);\r\n        g.gain.setValueAtTime(vol * 0.25, ctx.currentTime);\r\n        g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);\r\n        o1.start(); o1.stop(ctx.currentTime + 0.12);\r\n        o2.start(ctx.currentTime + 0.08); o2.stop(ctx.currentTime + 0.25);\r\n      } catch (_) { }\r\n    });\r\n  } catch (_) { }\r\n}\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€ WhatsApp-style Voice Player â”€â”€â”€â”€â”€â”€â”€ */\r\nfunction VoiceMessagePlayer({ src, isMe, dark }: { src: string; isMe: boolean; dark: boolean }) {\r\n  const [playing, setPlaying] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [loaded, setLoaded] = useState(false);\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n  const barsRef = useRef(Array.from({ length: 40 }, () => 0.12 + Math.random() * 0.88));\r\n\r\n  useEffect(() => {\r\n    const a = audioRef.current;\r\n    if (!a) return;\r\n    const onTime = () => { setCurrentTime(a.currentTime); setProgress(a.duration ? (a.currentTime / a.duration) * 100 : 0); };\r\n    const onMeta = () => { setDuration(a.duration || 0); setLoaded(true); };\r\n    const onEnd = () => { setPlaying(false); setProgress(0); setCurrentTime(0); };\r\n    a.addEventListener('timeupdate', onTime);\r\n    a.addEventListener('loadedmetadata', onMeta);\r\n    a.addEventListener('ended', onEnd);\r\n    return () => { a.removeEventListener('timeupdate', onTime); a.removeEventListener('loadedmetadata', onMeta); a.removeEventListener('ended', onEnd); };\r\n  }, []);\r\n\r\n  const toggle = () => {\r\n    const a = audioRef.current;\r\n    if (!a) return;\r\n    playing ? a.pause() : a.play();\r\n    setPlaying(!playing);\r\n  };\r\n\r\n  const seek = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    const a = audioRef.current;\r\n    if (!a || !duration) return;\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    a.currentTime = ((e.clientX - rect.left) / rect.width) * duration;\r\n  };\r\n\r\n  const fmt = (t: number) => {\r\n    if (!t || !isFinite(t)) return '0:00';\r\n    return `${Math.floor(t / 60)}:${Math.floor(t % 60).toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-3 px-3 py-2.5 min-w-[220px] max-w-[300px]\">\r\n      <audio ref={audioRef} src={src} preload=\"metadata\" />\r\n      <button onClick={toggle} className={`w-11 h-11 rounded-full flex items-center justify-center shrink-0 transition-all shadow-md active:scale-95 ${isMe ? 'bg-white/25 hover:bg-white/35' : 'bg-gradient-to-br from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 shadow-amber-500/20'}`}>\r\n        {playing ? <Pause size={18} className=\"text-white\" /> : <Play size={18} className=\"text-white ml-0.5\" />}\r\n      </button>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-end gap-[2px] h-7 cursor-pointer\" onClick={seek}>\r\n          {barsRef.current.map((h, i) => {\r\n            const pos = (i / barsRef.current.length) * 100;\r\n            const active = pos <= progress;\r\n            const nearHead = playing && Math.abs(pos - progress) < 4;\r\n            return (\r\n              <div\r\n                key={i}\r\n                className={`w-[3px] rounded-full transition-all ${nearHead ? 'duration-0' : 'duration-100'} ${active ? (isMe ? 'bg-white' : 'bg-amber-500') : (isMe ? 'bg-white/20' : dark ? 'bg-slate-500' : 'bg-slate-300')} ${nearHead ? 'scale-y-110' : ''}`}\r\n                style={{ height: `${h * 100}%` }}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n        <div className=\"flex justify-between mt-0.5\">\r\n          <span className={`text-[9px] ${isMe ? 'text-white/50' : dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n            {fmt(playing ? currentTime : 0)}\r\n          </span>\r\n          <span className={`text-[9px] ${isMe ? 'text-white/50' : dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n            {loaded ? fmt(duration) : '...'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      {!loaded && <Loader2 size={14} className=\"animate-spin text-amber-500 shrink-0\" />}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€ types â”€â”€â”€â”€â”€â”€â”€ */\r\ninterface FriendLike {\r\n  id: string;\r\n  name: string;\r\n  avatarUrl?: string;\r\n  status?: string;\r\n  isGroup?: boolean;\r\n  username?: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ChatBoxProps {\r\n  friend: FriendLike;\r\n  friends: FriendLike[];\r\n  groups: FriendLike[];\r\n  onClose: () => void;\r\n  onSelectFriend: (f: FriendLike) => void;\r\n  onStartVideoCall: (name: string, avatar?: string, friendId?: string) => void;\r\n  isDarkMode: boolean;\r\n  unreadCounts?: Record<string, number>;\r\n}\r\n\r\ninterface ChatMessage {\r\n  id: string;\r\n  sender_id: string;\r\n  content: string;\r\n  content_type?: 'text' | 'image' | 'voice' | 'video';\r\n  created_at: string;\r\n  senderUsername?: string;\r\n  senderName?: string;\r\n}\r\n\r\nconst BG_THEMES = [\r\n  { name: 'Default', value: '' },\r\n  { name: 'Night Sky', value: 'bg-gradient-to-b from-slate-950 via-indigo-950 to-slate-900' },\r\n  { name: 'Forest', value: 'bg-gradient-to-b from-emerald-950 via-green-900 to-slate-900' },\r\n  { name: 'Sunset', value: 'bg-gradient-to-b from-orange-950 via-rose-900 to-slate-900' },\r\n  { name: 'Ocean', value: 'bg-gradient-to-b from-cyan-950 via-blue-900 to-slate-900' },\r\n  { name: 'Berry', value: 'bg-gradient-to-b from-purple-950 via-fuchsia-900 to-slate-900' },\r\n  { name: 'Profile Pic', value: '__profile__' },\r\n];\r\n\r\n/* â”€â”€â”€â”€â”€â”€â”€ component â”€â”€â”€â”€â”€â”€â”€ */\r\nexport function ChatBox({ friend, friends, groups, onClose, onSelectFriend, onStartVideoCall, isDarkMode, unreadCounts = {} }: ChatBoxProps) {\r\n  const { user } = useAuth();\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [sending, setSending] = useState(false);\r\n  const [showEmoji, setShowEmoji] = useState(false);\r\n  const [recording, setRecording] = useState(false);\r\n  const [recordingDuration, setRecordingDuration] = useState(0);\r\n  const [audioLevel, setAudioLevel] = useState(0);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [sidebarOpen, setSidebarOpen] = useState(true);\r\n  const [chatBg, setChatBg] = useState('');\r\n  const [showBgPicker, setShowBgPicker] = useState(false);\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const [sidebarSearch, setSidebarSearch] = useState('');\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n\r\n  // Group member sidebar state\r\n  const [groupMembers, setGroupMembers] = useState<any[]>([]);\r\n  const [loadingMembers, setLoadingMembers] = useState(false);\r\n  const [showAddMember, setShowAddMember] = useState(false);\r\n  const [memberSearchQuery, setMemberSearchQuery] = useState('');\r\n  const [memberSearchResults, setMemberSearchResults] = useState<any[]>([]);\r\n  const [searchingMembers, setSearchingMembers] = useState(false);\r\n  const [addingMember, setAddingMember] = useState<string | null>(null);\r\n  const [removingMember, setRemovingMember] = useState<string | null>(null);\r\n  const [currentUserIsAdmin, setCurrentUserIsAdmin] = useState(false);\r\n\r\n  // Profile card popup state\r\n  const [profileCard, setProfileCard] = useState<any>(null);\r\n  const [profileCardLoading, setProfileCardLoading] = useState(false);\r\n\r\n  const bottomRef = useRef<HTMLDivElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n  const recordingTimerRef = useRef<ReturnType<typeof setInterval> | null>(null);\r\n  const analyserRef = useRef<AnalyserNode | null>(null);\r\n  const recordingCancelledRef = useRef(false);\r\n  const uploadCancelledRef = useRef(false);\r\n  const animFrameRef = useRef<number | null>(null);\r\n  const dark = isDarkMode;\r\n\r\n  const EMOJIS = [\r\n    '\\u{1F60A}', '\\u{1F602}', '\\u{2764}\\u{FE0F}', '\\u{1F44D}', '\\u{1F389}',\r\n    '\\u{1F525}', '\\u{2728}', '\\u{1F4AF}', '\\u{1F680}', '\\u{1F44F}',\r\n    '\\u{1F60D}', '\\u{1F914}', '\\u{1F60E}', '\\u{1F64C}', '\\u{1F4AA}',\r\n    '\\u{1F3AF}', '\\u{1F4DA}', '\\u{2705}', '\\u{26A1}', '\\u{1F31F}',\r\n  ];\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    setTimeout(() => bottomRef.current?.scrollIntoView({ behavior: 'smooth' }), 50);\r\n  }, []);\r\n\r\n  /* â”€â”€â”€ load messages â”€â”€â”€ */\r\n  useEffect(() => {\r\n    if (!user?.id || !friend?.id) return;\r\n    let cancelled = false;\r\n\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        let data: any[] = [];\r\n        if (friend.isGroup) {\r\n          const res = await supabase\r\n            .from('group_messages')\r\n            .select('*')\r\n            .eq('group_id', friend.id)\r\n            .order('created_at', { ascending: true });\r\n          data = res.data || [];\r\n        } else {\r\n          const res = await supabase\r\n            .from('messages')\r\n            .select(`*, sender:user_profiles!messages_sender_id_fkey(full_name, username, avatar_url)`)\r\n            .or(`and(sender_id.eq.${user.id},receiver_id.eq.${friend.id}),and(sender_id.eq.${friend.id},receiver_id.eq.${user.id})`)\r\n            .order('created_at', { ascending: true });\r\n\r\n          if (res.error) {\r\n            const res2 = await supabase\r\n              .from('messages')\r\n              .select('*')\r\n              .or(`and(sender_id.eq.${user.id},receiver_id.eq.${friend.id}),and(sender_id.eq.${friend.id},receiver_id.eq.${user.id})`)\r\n              .order('created_at', { ascending: true });\r\n            data = res2.data || [];\r\n          } else {\r\n            data = (res.data || []).map((m: any) => ({\r\n              ...m,\r\n              senderUsername: m.sender?.username || null,\r\n              senderName: m.sender?.full_name || null,\r\n            }));\r\n          }\r\n        }\r\n        if (!cancelled) {\r\n          setMessages(data);\r\n          scrollToBottom();\r\n        }\r\n      } catch (err) {\r\n        console.error('Load messages error:', err);\r\n        if (!cancelled) setMessages([]);\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n\r\n    supabase\r\n      .from('notifications')\r\n      .update({ is_read: true })\r\n      .eq('user_id', user.id)\r\n      .eq('sender_id', friend.id)\r\n      .eq('type', 'message')\r\n      .then(() => {\r\n        window.dispatchEvent(new CustomEvent('notifications-read', { detail: { friendId: friend.id } }));\r\n      });\r\n\r\n    // For DMs: listen on BOTH directions (incoming AND outgoing) so messages sync across devices/tabs\r\n    // For Groups: listen on group_id\r\n    const channelName = `chat-${friend.id}-${user.id}-${Date.now()}`;\r\n    let channel: any;\r\n\r\n    if (friend.isGroup) {\r\n      channel = supabase\r\n        .channel(channelName)\r\n        .on('postgres_changes', {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'group_messages',\r\n          filter: `group_id=eq.${friend.id}`,\r\n        }, (payload: any) => {\r\n          const msg = payload.new;\r\n          // Skip messages we optimistically inserted (temp- prefix)\r\n          if (msg.sender_id === user.id) return;\r\n          setMessages(prev => {\r\n            if (prev.find(m => m.id === msg.id)) return prev;\r\n            return [...prev, msg];\r\n          });\r\n          playReceiveSound();\r\n          scrollToBottom();\r\n        })\r\n        .subscribe();\r\n    } else {\r\n      // Subscribe to messages where current user is receiver (incoming)\r\n      channel = supabase\r\n        .channel(channelName)\r\n        .on('postgres_changes', {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'messages',\r\n          filter: `receiver_id=eq.${user.id}`,\r\n        }, (payload: any) => {\r\n          const msg = payload.new;\r\n          if (msg.sender_id === friend.id) {\r\n            setMessages(prev => {\r\n              if (prev.find(m => m.id === msg.id)) return prev;\r\n              return [...prev, msg];\r\n            });\r\n            playReceiveSound();\r\n            scrollToBottom();\r\n          }\r\n        })\r\n        .on('postgres_changes', {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'messages',\r\n          filter: `sender_id=eq.${user.id}`,\r\n        }, (payload: any) => {\r\n          // Replace optimistic temp message with real DB message for sent messages\r\n          const msg = payload.new;\r\n          if (msg.receiver_id === friend.id) {\r\n            setMessages(prev => {\r\n              // Remove any temp message with same content to avoid duplicates\r\n              const withoutTemp = prev.filter(m => !(m.id.startsWith('temp-') && m.content === msg.content && m.sender_id === msg.sender_id));\r\n              if (withoutTemp.find(m => m.id === msg.id)) return withoutTemp;\r\n              return [...withoutTemp, msg];\r\n            });\r\n          }\r\n        })\r\n        .subscribe();\r\n    }\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [user?.id, friend?.id]);\r\n\r\n  useEffect(() => { scrollToBottom(); }, [messages]);\r\n\r\n  /* â”€â”€â”€ load group members when viewing a group â”€â”€â”€ */\r\n  useEffect(() => {\r\n    if (!friend?.isGroup || !friend?.id || !user?.id) {\r\n      setGroupMembers([]);\r\n      setCurrentUserIsAdmin(false);\r\n      return;\r\n    }\r\n\r\n    const loadMembers = async () => {\r\n      setLoadingMembers(true);\r\n      try {\r\n        const members = await fetchGroupMembers(friend.id);\r\n        setGroupMembers(members);\r\n        const me = members.find((m: any) => m.userId === user.id);\r\n        setCurrentUserIsAdmin(me?.role === 'admin');\r\n      } catch (err) {\r\n        console.error('Error loading group members:', err);\r\n      } finally {\r\n        setLoadingMembers(false);\r\n      }\r\n    };\r\n\r\n    loadMembers();\r\n\r\n    // Subscribe to group_members changes for real-time updates\r\n    const memberChannel = supabase\r\n      .channel(`group-members-${friend.id}-${Date.now()}`)\r\n      .on('postgres_changes', {\r\n        event: '*',\r\n        schema: 'public',\r\n        table: 'group_members',\r\n        filter: `group_id=eq.${friend.id}`,\r\n      }, () => {\r\n        // Reload members on any change\r\n        loadMembers();\r\n      })\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(memberChannel);\r\n    };\r\n  }, [friend?.id, friend?.isGroup, user?.id]);\r\n\r\n  /* â”€â”€â”€ group member management â”€â”€â”€ */\r\n  const handleMemberSearch = async () => {\r\n    if (!memberSearchQuery.trim() || !user) return;\r\n    setSearchingMembers(true);\r\n    try {\r\n      const results = await searchUsers(memberSearchQuery, user.id);\r\n      // Filter out users already in the group\r\n      const memberIds = groupMembers.map((m: any) => m.userId);\r\n      setMemberSearchResults(results.filter((r: any) => !memberIds.includes(r.userId)));\r\n    } catch (err) {\r\n      console.error('Search error:', err);\r\n    } finally {\r\n      setSearchingMembers(false);\r\n    }\r\n  };\r\n\r\n  const handleAddMember = async (userId: string) => {\r\n    if (!friend?.id) return;\r\n    setAddingMember(userId);\r\n    try {\r\n      const { error } = await addGroupMember(friend.id, userId);\r\n      if (!error) {\r\n        // Reload members\r\n        const members = await fetchGroupMembers(friend.id);\r\n        setGroupMembers(members);\r\n        setMemberSearchResults(prev => prev.filter(r => r.userId !== userId));\r\n\r\n        // Send notification to the added user\r\n        await supabase.from('notifications').insert({\r\n          user_id: userId,\r\n          sender_id: user!.id,\r\n          type: 'group_invite',\r\n          content: `You were added to group \"${friend.name}\"`,\r\n        }).then(() => { });\r\n\r\n        // Notify all other group members about the new member\r\n        const addedUser = members.find((m: any) => m.userId === userId);\r\n        const addedName = addedUser?.profile?.full_name || 'Someone';\r\n        const otherMembers = members.filter((m: any) => m.userId !== userId && m.userId !== user!.id);\r\n        if (otherMembers.length > 0) {\r\n          const notifications = otherMembers.map((m: any) => ({\r\n            user_id: m.userId,\r\n            sender_id: user!.id,\r\n            type: 'group_invite',\r\n            content: `${addedName} was added to \"${friend.name}\"`,\r\n          }));\r\n          await supabase.from('notifications').insert(notifications).then(() => { });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error adding member:', err);\r\n    } finally {\r\n      setAddingMember(null);\r\n    }\r\n  };\r\n\r\n  const handleRemoveMember = async (userId: string) => {\r\n    if (!friend?.id || userId === user?.id) return;\r\n    setRemovingMember(userId);\r\n    try {\r\n      // Get the removed member's name before removing\r\n      const removedMember = groupMembers.find(m => m.userId === userId);\r\n      const removedName = removedMember?.profile?.full_name || 'Someone';\r\n\r\n      const { error } = await removeGroupMember(friend.id, userId);\r\n      if (!error) {\r\n        const updatedMembers = groupMembers.filter(m => m.userId !== userId);\r\n        setGroupMembers(updatedMembers);\r\n\r\n        // Send notification to the removed user\r\n        await supabase.from('notifications').insert({\r\n          user_id: userId,\r\n          sender_id: user!.id,\r\n          type: 'group_remove',\r\n          content: `You were removed from group \"${friend.name}\"`,\r\n        }).then(() => { });\r\n\r\n        // Notify all remaining group members about the removal\r\n        const otherMembers = updatedMembers.filter((m: any) => m.userId !== user!.id);\r\n        if (otherMembers.length > 0) {\r\n          const notifications = otherMembers.map((m: any) => ({\r\n            user_id: m.userId,\r\n            sender_id: user!.id,\r\n            type: 'group_invite',\r\n            content: `${removedName} was removed from \"${friend.name}\"`,\r\n          }));\r\n          await supabase.from('notifications').insert(notifications).then(() => { });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error removing member:', err);\r\n    } finally {\r\n      setRemovingMember(null);\r\n    }\r\n  };\r\n\r\n  /* â”€â”€â”€ send text â”€â”€â”€ */\r\n  const handleSend = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user?.id || !friend?.id || !newMessage.trim() || sending) return;\r\n    const content = newMessage.trim();\r\n    setSending(true);\r\n    setNewMessage('');\r\n    setShowEmoji(false);\r\n\r\n    const tempId = 'temp-' + Date.now();\r\n    setMessages(prev => [...prev, { id: tempId, sender_id: user.id, content, content_type: 'text', created_at: new Date().toISOString() }]);\r\n    scrollToBottom();\r\n    playSendSound();\r\n\r\n    try {\r\n      if (friend.isGroup) {\r\n        await supabase.from('group_messages').insert({ group_id: friend.id, sender_id: user.id, content, content_type: 'text' });\r\n        // Notify all group members except the sender\r\n        if (groupMembers.length > 0) {\r\n          const otherMembers = groupMembers.filter(m => m.userId !== user.id);\r\n          const notifications = otherMembers.map(m => ({\r\n            user_id: m.userId,\r\n            sender_id: user.id,\r\n            type: 'group_message',\r\n            content: `[${friend.name}] ${content.length > 60 ? content.substring(0, 60) + '...' : content}`,\r\n          }));\r\n          if (notifications.length > 0) {\r\n            await supabase.from('notifications').insert(notifications).then(() => { });\r\n          }\r\n        }\r\n      } else {\r\n        await supabase.from('messages').insert({ sender_id: user.id, receiver_id: friend.id, content, content_type: 'text' });\r\n        await supabase.from('notifications').insert({\r\n          user_id: friend.id, sender_id: user.id, type: 'message',\r\n          content: content.length > 80 ? content.substring(0, 80) + '...' : content,\r\n        }).then(() => { });\r\n      }\r\n    } catch (err) {\r\n      console.error('Send error:', err);\r\n      setMessages(prev => prev.filter(m => m.id !== tempId));\r\n      setNewMessage(content);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  /* â”€â”€â”€ media upload (image + video) â€” shows instant preview â”€â”€â”€ */\r\n  const handleMediaUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file || !user?.id || !friend?.id) return;\r\n    const isImage = file.type.startsWith('image/');\r\n    const isVideo = file.type.startsWith('video/');\r\n    if (!isImage && !isVideo) { alert('Please select an image or video file'); return; }\r\n    if (isImage && file.size > 5 * 1024 * 1024) { alert('Image must be under 5MB'); return; }\r\n    if (isVideo && file.size > 25 * 1024 * 1024) { alert('Video must be under 25MB'); return; }\r\n\r\n    const mediaType: 'image' | 'video' = isVideo ? 'video' : 'image';\r\n    // Instant preview with local blob URL\r\n    const localUrl = URL.createObjectURL(file);\r\n    const tempId = 'temp-' + Date.now();\r\n    setMessages(prev => [...prev, { id: tempId, sender_id: user.id, content: localUrl, content_type: mediaType, created_at: new Date().toISOString() }]);\r\n    scrollToBottom();\r\n    playSendSound();\r\n    uploadCancelledRef.current = false;\r\n    setUploading(true);\r\n    try {\r\n      const folder = isVideo ? 'video' : 'chat';\r\n      const fileName = `${folder}/${user.id}/${Date.now()}-${file.name}`;\r\n      const { error: uploadErr } = await supabase.storage.from('chat-files').upload(fileName, file);\r\n      if (uploadCancelledRef.current) {\r\n        setMessages(prev => prev.filter(m => m.id !== tempId));\r\n        uploadCancelledRef.current = false;\r\n        return;\r\n      }\r\n      let finalUrl = localUrl;\r\n      if (!uploadErr) {\r\n        const { data: urlData } = supabase.storage.from('chat-files').getPublicUrl(fileName);\r\n        finalUrl = urlData.publicUrl;\r\n      }\r\n      // Replace preview with real URL and send to DB\r\n      setMessages(prev => prev.map(m => m.id === tempId ? { ...m, content: finalUrl } : m));\r\n      if (friend.isGroup) {\r\n        await supabase.from('group_messages').insert({ group_id: friend.id, sender_id: user.id, content: finalUrl, content_type: mediaType });\r\n      } else {\r\n        await supabase.from('messages').insert({ sender_id: user.id, receiver_id: friend.id, content: finalUrl, content_type: mediaType });\r\n        // Notify recipient\r\n        await supabase.from('notifications').insert({\r\n          user_id: friend.id, sender_id: user.id, type: 'message',\r\n          content: mediaType === 'image' ? 'ðŸ“· Sent a photo' : 'ðŸŽ¬ Sent a video',\r\n        }).then(() => { });\r\n      }\r\n    } catch (err) {\r\n      console.error('Media upload error:', err);\r\n      setMessages(prev => prev.filter(m => m.id !== tempId));\r\n    } finally {\r\n      setUploading(false);\r\n      if (fileInputRef.current) fileInputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  /* â”€â”€â”€ voice â”€â”€â”€ */\r\n  const startRecording = async () => {\r\n    try {\r\n      recordingCancelledRef.current = false;\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\r\n      // Audio level analyser for waveform visualization\r\n      try {\r\n        const actx = new AudioContext();\r\n        const src = actx.createMediaStreamSource(stream);\r\n        const analyser = actx.createAnalyser();\r\n        analyser.fftSize = 256;\r\n        src.connect(analyser);\r\n        analyserRef.current = analyser;\r\n        const dataArr = new Uint8Array(analyser.frequencyBinCount);\r\n        const tick = () => {\r\n          analyser.getByteFrequencyData(dataArr);\r\n          const avg = dataArr.reduce((a, b) => a + b, 0) / dataArr.length;\r\n          setAudioLevel(avg / 255);\r\n          animFrameRef.current = requestAnimationFrame(tick);\r\n        };\r\n        tick();\r\n      } catch (_) { }\r\n\r\n      // Recording duration timer\r\n      setRecordingDuration(0);\r\n      recordingTimerRef.current = setInterval(() => {\r\n        setRecordingDuration(prev => prev + 1);\r\n      }, 1000);\r\n\r\n      const mr = new MediaRecorder(stream);\r\n      audioChunksRef.current = [];\r\n      mr.ondataavailable = (e) => { if (e.data.size > 0) audioChunksRef.current.push(e.data); };\r\n      mr.onstop = async () => {\r\n        stream.getTracks().forEach(t => t.stop());\r\n        // If recording was cancelled, don't send\r\n        if (recordingCancelledRef.current) {\r\n          recordingCancelledRef.current = false;\r\n          return;\r\n        }\r\n        const blob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\r\n        if (blob.size < 1000) return;\r\n        // Instant preview with local blob\r\n        const localUrl = URL.createObjectURL(blob);\r\n        const tempId = 'temp-' + Date.now();\r\n        setMessages(prev => [...prev, { id: tempId, sender_id: user!.id, content: localUrl, content_type: 'voice', created_at: new Date().toISOString() }]);\r\n        scrollToBottom();\r\n        playSendSound();\r\n        setUploading(true);\r\n        try {\r\n          const fileName = `voice/${user!.id}/${Date.now()}.webm`;\r\n          const { error: uploadErr } = await supabase.storage.from('chat-files').upload(fileName, blob);\r\n          let finalUrl = localUrl;\r\n          if (!uploadErr) {\r\n            const { data: urlData } = supabase.storage.from('chat-files').getPublicUrl(fileName);\r\n            finalUrl = urlData.publicUrl;\r\n          }\r\n          setMessages(prev => prev.map(m => m.id === tempId ? { ...m, content: finalUrl } : m));\r\n          if (friend.isGroup) {\r\n            await supabase.from('group_messages').insert({ group_id: friend.id, sender_id: user!.id, content: finalUrl, content_type: 'voice' });\r\n          } else {\r\n            await supabase.from('messages').insert({ sender_id: user!.id, receiver_id: friend.id, content: finalUrl, content_type: 'voice' });\r\n            // Notify recipient\r\n            await supabase.from('notifications').insert({\r\n              user_id: friend.id, sender_id: user!.id, type: 'message',\r\n              content: 'ðŸŽ¤ Sent a voice message',\r\n            }).then(() => { });\r\n          }\r\n        } catch (err) {\r\n          setMessages(prev => prev.filter(m => m.id !== tempId));\r\n        }\r\n        finally { setUploading(false); }\r\n      };\r\n      mediaRecorderRef.current = mr;\r\n      mr.start();\r\n      setRecording(true);\r\n    } catch (err) {\r\n      console.error('Mic error:', err);\r\n      alert('Could not access microphone');\r\n    }\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorderRef.current?.state === 'recording') mediaRecorderRef.current.stop();\r\n    setRecording(false);\r\n    setRecordingDuration(0);\r\n    setAudioLevel(0);\r\n    if (recordingTimerRef.current) { clearInterval(recordingTimerRef.current); recordingTimerRef.current = null; }\r\n    if (animFrameRef.current) { cancelAnimationFrame(animFrameRef.current); animFrameRef.current = null; }\r\n    analyserRef.current = null;\r\n  };\r\n\r\n  const cancelRecording = () => {\r\n    recordingCancelledRef.current = true;\r\n    if (mediaRecorderRef.current?.state === 'recording') mediaRecorderRef.current.stop();\r\n    setRecording(false);\r\n    setRecordingDuration(0);\r\n    setAudioLevel(0);\r\n    if (recordingTimerRef.current) { clearInterval(recordingTimerRef.current); recordingTimerRef.current = null; }\r\n    if (animFrameRef.current) { cancelAnimationFrame(animFrameRef.current); animFrameRef.current = null; }\r\n    analyserRef.current = null;\r\n  };\r\n\r\n  const cancelUpload = () => {\r\n    uploadCancelledRef.current = true;\r\n    setUploading(false);\r\n  };\r\n\r\n  /* â”€â”€â”€ sidebar contacts â”€â”€â”€ */\r\n  const allContacts: FriendLike[] = [\r\n    ...friends.map(f => ({ ...f })),\r\n    ...groups.map(g => ({ ...g, isGroup: true })),\r\n  ];\r\n  const filteredContacts = sidebarSearch.trim()\r\n    ? allContacts.filter(c => c.name.toLowerCase().includes(sidebarSearch.toLowerCase()) || (c.username || '').toLowerCase().includes(sidebarSearch.toLowerCase()))\r\n    : allContacts;\r\n\r\n  /* â”€â”€â”€ history grouping â”€â”€â”€ */\r\n  const messagesByDate = messages.reduce<Record<string, ChatMessage[]>>((acc, msg) => {\r\n    const day = new Date(msg.created_at).toLocaleDateString();\r\n    if (!acc[day]) acc[day] = [];\r\n    acc[day].push(msg);\r\n    return acc;\r\n  }, {});\r\n\r\n  /* â”€â”€â”€ date label helper â”€â”€â”€ */\r\n  const getDateLabel = (dateStr: string) => {\r\n    const d = new Date(dateStr);\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    const msgDay = new Date(d.getFullYear(), d.getMonth(), d.getDate());\r\n    const diff = Math.round((today.getTime() - msgDay.getTime()) / 86400000);\r\n    if (diff === 0) return 'Today';\r\n    if (diff === 1) return 'Yesterday';\r\n    if (diff < 7) return d.toLocaleDateString(undefined, { weekday: 'long' });\r\n    return d.toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' });\r\n  };\r\n\r\n  /* â”€â”€â”€ infer content type from URL when column is missing â”€â”€â”€ */\r\n  const inferContentType = (content: string, explicit?: string): string => {\r\n    if (explicit && explicit !== 'text' && explicit !== 'null') return explicit;\r\n    if (!content) return 'text';\r\n    const lower = content.toLowerCase().trim();\r\n\r\n    // Not a URL â€” must be text\r\n    if (!lower.startsWith('http') && !lower.startsWith('blob:')) return 'text';\r\n\r\n    // blob: URLs are always voice (only the recorder creates blob: URLs)\r\n    if (lower.startsWith('blob:')) return 'voice';\r\n\r\n    // Supabase storage bucket folder-based detection (most reliable for our uploads)\r\n    if (lower.includes('chat-files')) {\r\n      if (lower.includes('/voice/')) return 'voice';\r\n      if (lower.includes('/video/')) return 'video';\r\n      if (lower.includes('/chat/')) return 'image';\r\n      // chat-files bucket but no folder hint â€” fall through to extension detection\r\n    }\r\n\r\n    // Voice messages stored under voice/ folder or named voice\r\n    if (lower.includes('/voice/')) return 'voice';\r\n    // Audio files\r\n    if (lower.match(/\\.(ogg|mp3|wav|m4a)($|\\?)/)) return 'voice';\r\n    // .webm is voice unless explicitly in /video/ path\r\n    if (lower.match(/\\.(webm)($|\\?)/)) {\r\n      return lower.includes('/video/') ? 'video' : 'voice';\r\n    }\r\n\r\n    // Video files\r\n    if (lower.includes('/video/') || lower.match(/\\.(mp4|mov|avi)($|\\?)/)) return 'video';\r\n\r\n    // Images\r\n    if (lower.match(/\\.(jpg|jpeg|png|gif|webp|bmp|svg)($|\\?)/)) return 'image';\r\n\r\n    // Generic Supabase storage URL without recognizable extension â€” check folder hints\r\n    if (lower.includes('supabase') && lower.includes('storage')) {\r\n      if (lower.match(/\\.(mp4|mov)($|\\?)/)) return 'video';\r\n      if (lower.match(/\\.(jpg|jpeg|png|gif|webp|bmp|svg)($|\\?)/)) return 'image';\r\n      if (lower.match(/\\.(ogg|mp3|wav|m4a)($|\\?)/)) return 'voice';\r\n    }\r\n\r\n    return 'text';\r\n  };\r\n\r\n  /* â”€â”€â”€ render bubble â”€â”€â”€ */\r\n  const renderMessage = (msg: ChatMessage, idx: number) => {\r\n    const isMe = msg.sender_id === user?.id;\r\n    const prev = idx > 0 ? messages[idx - 1] : null;\r\n    const showName = !isMe && (!prev || prev.sender_id !== msg.sender_id);\r\n    const contentType = inferContentType(msg.content || '', msg.content_type);\r\n    const content = msg.content || '';\r\n    let time = '';\r\n    try { time = new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); } catch (_) { }\r\n\r\n    // In groups, resolve sender name from group members list\r\n    let senderLabel = 'You';\r\n    if (!isMe) {\r\n      if (friend.isGroup && groupMembers.length > 0) {\r\n        const member = groupMembers.find(m => m.userId === msg.sender_id);\r\n        senderLabel = member?.profile?.full_name || msg.senderName || 'Unknown';\r\n      } else {\r\n        senderLabel = msg.senderName || friend.name;\r\n      }\r\n    }\r\n\r\n    const isMediaMsg = (contentType === 'image' || contentType === 'video') && (content.startsWith('http') || content.startsWith('blob:'));\r\n    const bubbleCls = `max-w-[75%] text-sm relative overflow-hidden ${isMe\r\n      ? 'bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-2xl rounded-br-sm'\r\n      : dark ? 'bg-slate-700 text-white rounded-2xl rounded-bl-sm border border-slate-600' : 'bg-white text-slate-800 rounded-2xl rounded-bl-sm border border-slate-200 shadow-sm'\r\n      }`;\r\n\r\n    const renderContent = () => {\r\n      /* Image with URL */\r\n      if (contentType === 'image' && (content.startsWith('http') || content.startsWith('blob:'))) {\r\n        return (\r\n          <div className=\"p-1 cursor-pointer group\" onClick={() => setImagePreview(content)}>\r\n            <img src={content} alt=\"Shared\" className=\"rounded-xl max-h-72 max-w-full object-cover transition-all duration-200 group-hover:brightness-90\" loading=\"lazy\" style={{ minWidth: 140, minHeight: 90 }} />\r\n          </div>\r\n        );\r\n      }\r\n      /* Video with URL */\r\n      if (contentType === 'video' && (content.startsWith('http') || content.startsWith('blob:'))) {\r\n        return (\r\n          <div className=\"p-1\">\r\n            <video src={content} controls className=\"rounded-xl max-h-72 max-w-full\" style={{ minWidth: 200 }} preload=\"metadata\" playsInline />\r\n          </div>\r\n        );\r\n      }\r\n      /* Voice with URL â€” WhatsApp style */\r\n      if (contentType === 'voice' && (content.startsWith('http') || content.startsWith('blob:'))) {\r\n        return <VoiceMessagePlayer src={content} isMe={isMe} dark={dark} />;\r\n      }\r\n      /* Fallback labels for non-URL media */\r\n      if (contentType === 'image') {\r\n        return <div className=\"px-3 py-2 flex items-center gap-2\"><Image size={14} className={isMe ? 'text-white/80' : 'text-amber-500'} /><span className=\"text-xs\">{content}</span></div>;\r\n      }\r\n      if (contentType === 'voice') {\r\n        return <div className=\"px-3 py-2 flex items-center gap-2\"><Mic size={14} className={isMe ? 'text-white/80' : 'text-amber-500'} /><span className=\"text-xs\">{content}</span></div>;\r\n      }\r\n      if (contentType === 'video') {\r\n        return <div className=\"px-3 py-2 flex items-center gap-2\"><Video size={14} className={isMe ? 'text-white/80' : 'text-amber-500'} /><span className=\"text-xs\">{content}</span></div>;\r\n      }\r\n      /* Text */\r\n      return <div className=\"px-3 py-2\"><p className=\"whitespace-pre-wrap break-words\">{content}</p></div>;\r\n    };\r\n\r\n    return (\r\n      <div key={msg.id || idx} className={`flex flex-col ${isMe ? 'items-end' : 'items-start'} ${prev && prev.sender_id === msg.sender_id ? 'mt-0.5' : 'mt-3'}`}>\r\n        {(showName || (isMe && (!prev || prev.sender_id !== msg.sender_id))) && (\r\n          <span className={`text-[10px] font-semibold mb-0.5 ${isMe ? 'mr-2' : 'ml-2'} ${isMe ? 'text-slate-400' : (dark ? 'text-amber-400' : 'text-amber-600')}`}>\r\n            {senderLabel}\r\n          </span>\r\n        )}\r\n        <div className={bubbleCls}>\r\n          {renderContent()}\r\n          {/* Time + read receipt */}\r\n          <div className={`flex items-center justify-end gap-1 px-3 pb-1.5 ${isMediaMsg ? 'absolute bottom-0 right-0 bg-gradient-to-t from-black/40 to-transparent rounded-b-xl pt-4 left-0' : ''}`}>\r\n            {time && <span className={`text-[9px] ${isMediaMsg ? 'text-white/80' : isMe ? 'text-white/50' : dark ? 'text-slate-500' : 'text-slate-400'}`}>{time}</span>}\r\n            {isMe && <CheckCheck size={12} className={isMediaMsg ? 'text-white/80' : 'text-white/50'} />}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* â•â•â•â•â•â•â• RENDER â•â•â•â•â•â•â• */\r\n\r\n  /* â”€â”€ Profile Card loader â”€â”€ */\r\n  const openProfileCard = async (contact: FriendLike) => {\r\n    if (contact.isGroup) return;\r\n    setProfileCardLoading(true);\r\n    setProfileCard({ id: contact.id, name: contact.name, avatarUrl: contact.avatarUrl, username: contact.username, role: contact.role, studyStreak: contact.studyStreak ?? 0 });\r\n    try {\r\n      const { data: profile } = await supabase.from('user_profiles').select('*').eq('user_id', contact.id).single();\r\n      const { data: sessions } = await supabase.from('study_sessions').select('duration_minutes, start_time, created_at, focus_rating, subject_id').eq('user_id', contact.id).order('start_time', { ascending: false });\r\n      const totalMinutes = sessions?.reduce((s: number, r: any) => s + (r.duration_minutes || 0), 0) || 0;\r\n      const totalSessions = sessions?.length || 0;\r\n      // compute avg focus rating\r\n      const focusRatings = sessions?.filter((s: any) => s.focus_rating > 0) || [];\r\n      const avgFocus = focusRatings.length > 0 ? Math.round((focusRatings.reduce((a: number, s: any) => a + s.focus_rating, 0) / focusRatings.length) * 10) / 10 : 0;\r\n      // compute unique subjects studied\r\n      const subjectCount = new Set(sessions?.filter((s: any) => s.subject_id).map((s: any) => s.subject_id) || []).size;\r\n      // Always compute streak from sessions (same algorithm as Dashboard's calculateStreak)\r\n      let streak = 0;\r\n      if (sessions && sessions.length > 0) {\r\n        const sessionDates = new Set<number>();\r\n        sessions.forEach((s: any) => { const d = new Date(s.start_time || s.created_at); d.setHours(0, 0, 0, 0); sessionDates.add(d.getTime()); });\r\n        let st = 0; const ch = new Date(); ch.setHours(0, 0, 0, 0);\r\n        if (sessionDates.has(ch.getTime())) { st = 1; ch.setDate(ch.getDate() - 1); } else { ch.setDate(ch.getDate() - 1); if (sessionDates.has(ch.getTime())) { st = 1; ch.setDate(ch.getDate() - 1); } }\r\n        while (st > 0 && sessionDates.has(ch.getTime())) { st++; ch.setDate(ch.getDate() - 1); }\r\n        streak = st;\r\n      }\r\n      // Prefer real DB avatar_url; skip ui-avatars.com generated ones\r\n      const dbAvatar = profile?.avatar_url && !profile.avatar_url.includes('ui-avatars.com') ? profile.avatar_url : null;\r\n      const contactAvatar = contact.avatarUrl && !contact.avatarUrl.includes('ui-avatars.com') ? contact.avatarUrl : null;\r\n      setProfileCard((prev: any) => prev ? ({\r\n        ...prev,\r\n        bio: profile?.bio || '',\r\n        role: profile?.role || contact.role || 'student',\r\n        profession: profile?.profession || '',\r\n        experience: profile?.experience || '',\r\n        joined: profile?.created_at ? new Date(profile.created_at).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : '',\r\n        totalMinutes,\r\n        totalSessions,\r\n        studyStreak: streak,\r\n        avgFocus,\r\n        subjectCount,\r\n        location: profile?.location || profile?.city || '',\r\n        username: profile?.username || contact.username || '',\r\n        avatarUrl: dbAvatar || contactAvatar || null,\r\n      }) : null);\r\n    } catch (err) { console.error('Error loading profile card:', err); }\r\n    finally { setProfileCardLoading(false); }\r\n  };\r\n\r\n  const formatTime = (mins: number) => {\r\n    if (mins < 60) return `${mins}m`;\r\n    const h = Math.floor(mins / 60);\r\n    const m = mins % 60;\r\n    return m > 0 ? `${h}h ${m}m` : `${h}h`;\r\n  };\r\n  return (\r\n    <div className={`flex h-full rounded-2xl overflow-hidden border ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} shadow-xl`}>\r\n\r\n      {/* â•â•â• LEFT SIDEBAR â€” friends list / group members â•â•â• */}\r\n      {sidebarOpen && (\r\n        <div className={`shrink-0 flex flex-col border-r ${dark ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`} style={{ width: 260 }}>\r\n          {/* sidebar header */}\r\n          <div className={`px-4 py-3 border-b ${dark ? 'border-slate-700/50' : 'border-slate-200'}`}>\r\n            <h3 className={`text-sm font-bold mb-2 ${dark ? 'text-white' : 'text-slate-800'}`}>\r\n              {friend.isGroup ? (\r\n                <span className=\"flex items-center gap-1.5\">\r\n                  <Users size={14} className=\"text-amber-500\" />\r\n                  Members ({groupMembers.length})\r\n                </span>\r\n              ) : 'Chats'}\r\n            </h3>\r\n            {!friend.isGroup && (\r\n              <div className=\"relative\">\r\n                <Search size={14} className=\"absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-500\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={sidebarSearch}\r\n                  onChange={(e) => setSidebarSearch(e.target.value)}\r\n                  placeholder=\"Search...\"\r\n                  className={`w-full pl-8 pr-3 py-1.5 rounded-lg text-xs focus:outline-none focus:ring-1 focus:ring-amber-500/50 ${dark ? 'bg-slate-800 text-white placeholder:text-slate-500' : 'bg-white text-slate-800 placeholder:text-slate-400 border border-slate-200'}`}\r\n                />\r\n              </div>\r\n            )}\r\n            {/* Add Member button for group admins */}\r\n            {friend.isGroup && currentUserIsAdmin && (\r\n              <button\r\n                onClick={() => setShowAddMember(!showAddMember)}\r\n                className={`w-full mt-2 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${showAddMember\r\n                  ? 'bg-red-500/10 text-red-400 hover:bg-red-500/20'\r\n                  : 'bg-amber-500/10 text-amber-500 hover:bg-amber-500/20'\r\n                  }`}\r\n              >\r\n                {showAddMember ? <X size={12} /> : <UserPlus size={12} />}\r\n                {showAddMember ? 'Cancel' : 'Add Member'}\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Add Member Search Panel */}\r\n          {friend.isGroup && showAddMember && currentUserIsAdmin && (\r\n            <div className={`px-3 py-3 border-b ${dark ? 'border-slate-700/50 bg-slate-800/50' : 'border-slate-200 bg-slate-100/50'}`}>\r\n              <div className=\"relative mb-2\">\r\n                <Search size={14} className=\"absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-500\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={memberSearchQuery}\r\n                  onChange={(e) => setMemberSearchQuery(e.target.value)}\r\n                  onKeyDown={(e) => e.key === 'Enter' && handleMemberSearch()}\r\n                  placeholder=\"Search users...\"\r\n                  className={`w-full pl-8 pr-16 py-1.5 rounded-lg text-xs focus:outline-none focus:ring-1 focus:ring-amber-500/50 ${dark ? 'bg-slate-700 text-white placeholder:text-slate-500' : 'bg-white text-slate-800 placeholder:text-slate-400 border border-slate-200'}`}\r\n                />\r\n                <button\r\n                  onClick={handleMemberSearch}\r\n                  disabled={searchingMembers}\r\n                  className=\"absolute right-1.5 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-amber-500 text-white rounded text-[10px] font-bold hover:bg-amber-600 disabled:opacity-50\"\r\n                >\r\n                  {searchingMembers ? '...' : 'Search'}\r\n                </button>\r\n              </div>\r\n              {memberSearchResults.length > 0 && (\r\n                <div className=\"space-y-1 max-h-32 overflow-y-auto scrollbar-hide\">\r\n                  {memberSearchResults.map((r: any) => (\r\n                    <div key={r.userId} className={`flex items-center gap-2 p-1.5 rounded-lg ${dark ? 'hover:bg-slate-700' : 'hover:bg-white'}`}>\r\n                      <img src={r.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(r.fullName || '')}&size=32`} alt=\"\" className=\"w-7 h-7 rounded-full object-cover\" />\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <p className={`text-[11px] font-semibold truncate ${dark ? 'text-white' : 'text-slate-800'}`}>{r.fullName}</p>\r\n                          {r.role === 'mentor' && (\r\n                            <span className=\"px-1 py-0.5 bg-purple-500/10 text-purple-500 text-[8px] font-bold rounded-full border border-purple-500/20 shrink-0\">\r\n                              Mentor\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <p className={`text-[9px] truncate ${dark ? 'text-slate-500' : 'text-slate-400'}`}>@{r.username}</p>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handleAddMember(r.userId)}\r\n                        disabled={addingMember === r.userId}\r\n                        className=\"p-1 bg-green-500 text-white rounded-md hover:bg-green-600 transition-all disabled:opacity-50\"\r\n                        title=\"Add to group\"\r\n                      >\r\n                        {addingMember === r.userId ? <Loader2 size={12} className=\"animate-spin\" /> : <UserPlus size={12} />}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n              {memberSearchResults.length === 0 && memberSearchQuery && !searchingMembers && (\r\n                <p className={`text-[10px] text-center py-2 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>No users found</p>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* contacts / members list */}\r\n          <div className=\"flex-1 overflow-y-auto scrollbar-hide\" style={{ minHeight: 0 }}>\r\n            {friend.isGroup ? (\r\n              /* â•â•â• GROUP MEMBERS LIST â•â•â• */\r\n              loadingMembers ? (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <Loader2 size={18} className=\"animate-spin text-amber-500\" />\r\n                </div>\r\n              ) : (\r\n                groupMembers.map((member) => {\r\n                  const isMe = member.userId === user?.id;\r\n                  const isAdmin = member.role === 'admin';\r\n                  return (\r\n                    <div\r\n                      key={member.userId}\r\n                      className={`flex items-center gap-3 px-4 py-3 border-l-2 border-transparent transition-all ${isMe\r\n                        ? (dark ? 'bg-amber-500/5' : 'bg-amber-50/50')\r\n                        : (dark ? 'hover:bg-slate-800' : 'hover:bg-slate-100')\r\n                        }`}\r\n                    >\r\n                      <div className=\"relative shrink-0\">\r\n                        {member.profile?.avatar_url ? (\r\n                          <img src={member.profile.avatar_url} alt=\"\" className={`w-9 h-9 rounded-full object-cover border ${dark ? 'border-slate-700' : 'border-slate-200'}`} />\r\n                        ) : (\r\n                          <div className={`w-9 h-9 rounded-full flex items-center justify-center text-xs font-bold text-white bg-gradient-to-br from-amber-500 to-orange-500`}>\r\n                            {(member.profile?.full_name || '?').charAt(0).toUpperCase()}\r\n                          </div>\r\n                        )}\r\n                        {isAdmin && (\r\n                          <div className={`absolute -top-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center ${dark ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n                            <Crown size={10} className=\"text-amber-500\" />\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"min-w-0 flex-1\">\r\n                        <div className=\"flex items-center gap-1.5\">\r\n                          <h4 className={`text-xs font-semibold truncate ${dark ? 'text-white' : 'text-slate-800'}`}>\r\n                            {member.profile?.full_name || 'Unknown'}{isMe ? ' (You)' : ''}\r\n                          </h4>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1.5\">\r\n                          {isAdmin && (\r\n                            <span className={`text-[9px] px-1 py-0 rounded font-bold ${dark ? 'bg-amber-500/20 text-amber-400' : 'bg-amber-100 text-amber-600'}`}>\r\n                              Admin\r\n                            </span>\r\n                          )}\r\n                          <p className={`text-[10px] truncate ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                            @{member.profile?.username || 'user'}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      {/* Admin controls: remove member (not self, not other admins) */}\r\n                      {currentUserIsAdmin && !isMe && !isAdmin && (\r\n                        <button\r\n                          onClick={() => handleRemoveMember(member.userId)}\r\n                          disabled={removingMember === member.userId}\r\n                          className={`p-1 rounded-md transition-all shrink-0 ${dark ? 'hover:bg-red-500/20 text-red-400' : 'hover:bg-red-50 text-red-400'} disabled:opacity-50`}\r\n                          title=\"Remove from group\"\r\n                        >\r\n                          {removingMember === member.userId ? <Loader2 size={12} className=\"animate-spin\" /> : <UserMinus size={12} />}\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })\r\n              )\r\n            ) : (\r\n              /* â•â•â• REGULAR CONTACTS LIST â•â•â• */\r\n              <>\r\n                {filteredContacts.map((c) => {\r\n                  const isActive = c.id === friend.id;\r\n                  const unread = unreadCounts[c.id] || 0;\r\n                  return (\r\n                    <button\r\n                      key={c.id}\r\n                      onClick={() => onSelectFriend(c)}\r\n                      className={`w-full flex items-center gap-3 px-4 py-3 text-left transition-all ${isActive\r\n                        ? (dark ? 'bg-amber-500/10 border-l-2 border-amber-500' : 'bg-amber-50 border-l-2 border-amber-500')\r\n                        : unread > 0\r\n                          ? (dark\r\n                            ? 'bg-gradient-to-r from-purple-500/15 via-blue-500/10 to-transparent border-l-2 border-purple-500'\r\n                            : 'bg-gradient-to-r from-purple-50 via-blue-50 to-transparent border-l-2 border-purple-500')\r\n                          : (dark ? 'hover:bg-slate-800 border-l-2 border-transparent' : 'hover:bg-slate-100 border-l-2 border-transparent')\r\n                        }`}\r\n                    >\r\n                      <div className=\"relative shrink-0\">\r\n                        {c.avatarUrl ? (\r\n                          <img\r\n                            src={c.avatarUrl} alt=\"\"\r\n                            className={`w-10 h-10 object-cover ${c.isGroup ? 'rounded-lg' : 'rounded-full cursor-pointer hover:ring-2 hover:ring-amber-500/60 transition-all'} border ${unread > 0 ? 'border-purple-500/60' : dark ? 'border-slate-700' : 'border-slate-200'}`}\r\n                            onClick={(e) => { e.stopPropagation(); openProfileCard(c); }}\r\n                          />\r\n                        ) : (\r\n                          <div\r\n                            className={`w-10 h-10 flex items-center justify-center text-sm font-bold text-white ${c.isGroup ? 'rounded-lg' : 'rounded-full cursor-pointer hover:ring-2 hover:ring-amber-500/60 transition-all'} bg-gradient-to-br from-amber-500 to-orange-500`}\r\n                            onClick={(e) => { e.stopPropagation(); openProfileCard(c); }}\r\n                          >\r\n                            {c.name.charAt(0).toUpperCase()}\r\n                          </div>\r\n                        )}\r\n                        {!c.isGroup && c.status !== 'offline' && (\r\n                          <div className={`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 ${dark ? 'border-slate-900' : 'border-slate-50'} ${c.status === 'studying' ? 'bg-blue-500' : 'bg-green-500'}`} />\r\n                        )}\r\n                      </div>\r\n                      <div className=\"min-w-0 flex-1\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <h4 className={`text-sm font-semibold truncate ${isActive ? 'text-amber-500' : dark ? 'text-white' : 'text-slate-800'}`}>\r\n                            {c.name}\r\n                          </h4>\r\n                          <div className=\"flex items-center gap-1.5 shrink-0 ml-1\">\r\n                            {!c.isGroup && (c.studyStreak ?? 0) > 0 && (\r\n                              <span className={`flex items-center gap-0.5 text-[10px] font-bold ${dark ? 'text-orange-400' : 'text-orange-500'}`}>\r\n                                <Flame size={11} className=\"text-orange-500\" />{c.studyStreak}\r\n                              </span>\r\n                            )}\r\n                            {unread > 0 && (\r\n                              <span className=\"min-w-[22px] h-5 flex items-center justify-center px-1 text-[10px] font-bold text-white bg-gradient-to-r from-purple-500 to-blue-500 rounded-full shadow-sm shadow-purple-500/30\">{unread}</span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <p className={`text-[11px] truncate ${unread > 0 ? 'text-purple-400 font-medium' : dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                          {unread > 0 ? `${unread} new message${unread > 1 ? 's' : ''}` : c.isGroup ? 'Grp' : (c.isMentor || c.role === 'mentor') ? 'Mentor' : `@${c.username || 'user'}`}\r\n                        </p>\r\n                      </div>\r\n                    </button>\r\n                  );\r\n                })}\r\n                {filteredContacts.length === 0 && (\r\n                  <div className=\"py-8 text-center\">\r\n                    <p className={`text-xs ${dark ? 'text-slate-500' : 'text-slate-400'}`}>No contacts found</p>\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* â•â•â• CHAT AREA â•â•â• */}\r\n      <div className=\"flex-1 flex flex-col min-w-0\">\r\n        {/* Header */}\r\n        <div className=\"shrink-0 flex items-center justify-between px-4 py-2.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white\">\r\n          <div className=\"flex items-center gap-3 min-w-0\">\r\n            <button onClick={() => setSidebarOpen(!sidebarOpen)} className=\"p-1.5 hover:bg-white/20 rounded-lg transition-all\" title={sidebarOpen ? 'Hide sidebar' : 'Show sidebar'}>\r\n              {sidebarOpen ? <PanelLeftClose size={18} /> : <PanelLeft size={18} />}\r\n            </button>\r\n            {friend.avatarUrl && (\r\n              <img\r\n                src={friend.avatarUrl} alt=\"\"\r\n                className={`${sidebarOpen ? 'w-8 h-8' : 'w-11 h-11'} rounded-full object-cover border-2 border-white/30 shrink-0 ${!friend.isGroup ? 'cursor-pointer hover:ring-2 hover:ring-white/50' : ''} transition-all duration-200`}\r\n                onClick={() => openProfileCard(friend)}\r\n              />\r\n            )}\r\n            <div className=\"min-w-0 cursor-pointer\" onClick={() => openProfileCard(friend)}>\r\n              <h3 className=\"font-bold text-sm truncate hover:underline\">{friend.name}</h3>\r\n              <p className=\"text-[10px] opacity-80 truncate\">\r\n                {friend.isGroup ? `${groupMembers.length} members` : `@${friend.username || 'user'}`}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-1\">\r\n            {/* Change Background */}\r\n            <div className=\"relative\">\r\n              <button onClick={() => { setShowBgPicker(!showBgPicker); setShowHistory(false); }} className=\"p-1.5 hover:bg-white/20 rounded-lg transition-all\" title=\"Change background\">\r\n                <Palette size={16} />\r\n              </button>\r\n              {showBgPicker && (\r\n                <div className={`absolute right-0 top-full mt-1 w-44 rounded-xl shadow-2xl border z-20 ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n                  {BG_THEMES.map((t) => (\r\n                    <button\r\n                      key={t.name}\r\n                      onClick={() => { setChatBg(t.value); setShowBgPicker(false); }}\r\n                      className={`w-full text-left px-3 py-2 text-xs font-medium transition-all first:rounded-t-xl last:rounded-b-xl ${chatBg === t.value ? 'bg-amber-500/20 text-amber-500' : dark ? 'text-slate-300 hover:bg-slate-700' : 'text-slate-700 hover:bg-slate-100'}`}\r\n                    >\r\n                      {t.name}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Video Call */}\r\n            {!friend.isGroup && (\r\n              <button onClick={() => onStartVideoCall(friend.name, friend.avatarUrl, friend.id)} className=\"p-1.5 hover:bg-white/20 rounded-lg transition-all\" title=\"Video Call\">\r\n                <Video size={16} />\r\n              </button>\r\n            )}\r\n\r\n            {/* History */}\r\n            <button onClick={() => { setShowHistory(!showHistory); setShowBgPicker(false); }} className=\"p-1.5 hover:bg-white/20 rounded-lg transition-all\" title=\"Chat history\">\r\n              <History size={16} />\r\n            </button>\r\n\r\n            {/* Close */}\r\n            <button onClick={onClose} className=\"p-1.5 hover:bg-white/20 rounded-lg transition-all\" title=\"Close chat\">\r\n              <X size={18} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* History panel */}\r\n        {showHistory && (\r\n          <div className={`border-b max-h-48 overflow-y-auto scrollbar-hide px-4 py-3 ${dark ? 'bg-slate-800/80 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n            <h4 className={`text-xs font-bold mb-2 ${dark ? 'text-slate-400' : 'text-slate-500'}`}>MESSAGE HISTORY</h4>\r\n            {Object.keys(messagesByDate).length > 0 ? (\r\n              Object.entries(messagesByDate).map(([date, msgs]) => (\r\n                <div key={date} className=\"mb-2\">\r\n                  <p className={`text-[10px] font-bold mb-1 ${dark ? 'text-amber-400' : 'text-amber-600'}`}>{date}</p>\r\n                  {msgs.slice(-3).map(msg => (\r\n                    <p key={msg.id} className={`text-xs truncate mb-0.5 ${dark ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                      <span className=\"font-medium\">{msg.sender_id === user?.id ? 'You' : friend.name}:</span>{' '}\r\n                      {(() => { const ct = inferContentType(msg.content || '', msg.content_type); return ct === 'image' ? '[Image]' : ct === 'voice' ? '[Voice]' : ct === 'video' ? '[Video]' : msg.content; })()}\r\n                    </p>\r\n                  ))}\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <p className={`text-xs ${dark ? 'text-slate-500' : 'text-slate-400'}`}>No history yet</p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Messages */}\r\n        <div\r\n          className={`flex-1 overflow-y-auto scrollbar-hide px-4 py-3 ${chatBg === '__profile__' ? '' : chatBg || (dark ? 'bg-slate-900' : 'bg-slate-50')}`}\r\n          style={{\r\n            minHeight: 0,\r\n            ...(chatBg && chatBg !== '__profile__' ? {\r\n              backgroundAttachment: 'local',\r\n            } : {}),\r\n            ...(chatBg === '__profile__' && friend.avatarUrl && !friend.avatarUrl.includes('ui-avatars.com') ? {\r\n              backgroundImage: `url(${friend.avatarUrl})`,\r\n              backgroundSize: 'cover',\r\n              backgroundPosition: 'center',\r\n              backgroundAttachment: 'local',\r\n              backgroundColor: dark ? '#0f172a' : '#f8fafc',\r\n            } : chatBg === '__profile__' ? {\r\n              backgroundColor: dark ? '#0f172a' : '#f8fafc',\r\n            } : {}),\r\n          }}\r\n        >\r\n          {loading ? (\r\n            <div className=\"flex flex-col items-center justify-center py-16 opacity-60\">\r\n              <Loader2 className=\"w-7 h-7 text-amber-500 animate-spin mb-2\" />\r\n              <p className={`text-xs ${dark ? 'text-slate-400' : 'text-slate-500'}`}>Loading messages...</p>\r\n            </div>\r\n          ) : messages.length === 0 ? (\r\n            <div className=\"flex flex-col items-center justify-center py-16 opacity-50 text-center\">\r\n              <div className={`w-14 h-14 rounded-full flex items-center justify-center mb-3 text-2xl ${dark ? 'bg-slate-800' : 'bg-slate-200'}`}>\r\n                {'\\u{1F4AC}'}\r\n              </div>\r\n              <p className={`text-sm font-medium ${dark ? 'text-slate-400' : 'text-slate-600'}`}>No messages yet</p>\r\n              <p className={`text-xs mt-1 ${dark ? 'text-slate-500' : 'text-slate-500'}`}>Say hello to {friend.name}!</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {messages.map((msg, idx) => {\r\n                const prev = idx > 0 ? messages[idx - 1] : null;\r\n                const msgDate = new Date(msg.created_at).toDateString();\r\n                const prevDate = prev ? new Date(prev.created_at).toDateString() : null;\r\n                const showDateSep = !prev || msgDate !== prevDate;\r\n                return (\r\n                  <div key={msg.id || idx}>\r\n                    {showDateSep && (\r\n                      <div className=\"flex items-center justify-center my-4\">\r\n                        <span className={`px-3 py-1 rounded-full text-[10px] font-semibold shadow-sm ${dark ? 'bg-slate-700/80 text-slate-300' : 'bg-white/90 text-slate-500 border border-slate-200'}`}>\r\n                          {getDateLabel(msg.created_at)}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                    {renderMessage(msg, idx)}\r\n                  </div>\r\n                );\r\n              })}\r\n              <div ref={bottomRef} />\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        {/* Emoji picker */}\r\n        {showEmoji && (\r\n          <div className={`px-3 py-2 border-t flex flex-wrap gap-1 ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>\r\n            {EMOJIS.map((emoji, i) => (\r\n              <button key={i} type=\"button\" onClick={() => { setNewMessage(p => p + emoji); setShowEmoji(false); }}\r\n                className={`text-lg p-1 rounded hover:scale-110 transition-transform ${dark ? 'hover:bg-slate-700' : 'hover:bg-slate-100'}`}>\r\n                {emoji}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {uploading && (\r\n          <div className={`px-4 py-2 border-t text-xs flex items-center gap-2 ${dark ? 'bg-slate-800 border-slate-700 text-slate-400' : 'bg-white border-slate-100 text-slate-500'}`}>\r\n            <Loader2 size={14} className=\"animate-spin text-amber-500\" /> Uploading...\r\n            <button onClick={cancelUpload} className={`ml-auto p-1 rounded-md transition-all ${dark ? 'hover:bg-red-500/20 text-red-400' : 'hover:bg-red-50 text-red-400'}`} title=\"Cancel upload\">\r\n              <X size={14} />\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {recording && (\r\n          <div className={`px-4 py-3 border-t flex items-center gap-3 ${dark ? 'bg-gradient-to-r from-red-950/60 via-slate-800 to-red-950/60 border-slate-700' : 'bg-gradient-to-r from-red-50 via-white to-red-50 border-slate-100'}`}>\r\n            {/* Delete / Cancel recording button */}\r\n            <button onClick={cancelRecording} className={`p-1.5 rounded-full transition-all shrink-0 ${dark ? 'bg-slate-700 hover:bg-slate-600 text-red-400' : 'bg-slate-200 hover:bg-slate-300 text-red-500'}`} title=\"Discard recording\">\r\n              <Trash2 size={14} />\r\n            </button>\r\n            {/* Pulsing record dot */}\r\n            <div className=\"relative shrink-0\">\r\n              <div className=\"w-3 h-3 rounded-full bg-red-500 animate-pulse\" />\r\n              <div className=\"absolute inset-0 w-3 h-3 rounded-full bg-red-500 animate-ping opacity-40\" />\r\n            </div>\r\n            {/* Live waveform bars */}\r\n            <div className=\"flex items-center gap-[2px] h-6 flex-1 min-w-0\">\r\n              {Array.from({ length: 28 }).map((_, i) => {\r\n                const h = Math.max(4, Math.min(24, audioLevel * 24 * (0.5 + Math.sin(Date.now() / 120 + i * 0.7) * 0.5)));\r\n                return <div key={i} className=\"w-[3px] rounded-full bg-red-500 transition-all duration-75\" style={{ height: `${h}px`, opacity: 0.5 + audioLevel * 0.5 }} />;\r\n              })}\r\n            </div>\r\n            {/* Timer */}\r\n            <span className={`font-mono text-sm font-bold tabular-nums shrink-0 ${dark ? 'text-red-400' : 'text-red-500'}`}>\r\n              {Math.floor(recordingDuration / 60)}:{(recordingDuration % 60).toString().padStart(2, '0')}\r\n            </span>\r\n            {/* Send recording button */}\r\n            <button onClick={stopRecording} className=\"p-1.5 bg-green-500 hover:bg-green-600 rounded-full text-white transition-all shrink-0\" title=\"Send recording\"><Send size={14} /></button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Input */}\r\n        <form onSubmit={handleSend} className={`shrink-0 px-3 py-2.5 border-t flex items-center gap-2 ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>\r\n          <input ref={fileInputRef} type=\"file\" accept=\"image/*,video/*\" className=\"hidden\" onChange={handleMediaUpload} />\r\n\r\n          <button type=\"button\" onClick={() => setShowEmoji(!showEmoji)}\r\n            className={`p-2 rounded-lg transition-all shrink-0 ${dark ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'}`} title=\"Emoji\">\r\n            <Smile size={18} />\r\n          </button>\r\n          <button type=\"button\" onClick={() => fileInputRef.current?.click()} disabled={uploading}\r\n            className={`p-2 rounded-lg transition-all shrink-0 ${dark ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'} disabled:opacity-40`} title=\"Send image\">\r\n            <Image size={18} />\r\n          </button>\r\n          <button type=\"button\" onClick={recording ? stopRecording : startRecording} disabled={uploading}\r\n            className={`p-2 rounded-lg transition-all shrink-0 ${recording ? 'bg-red-500 text-white' : dark ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'} disabled:opacity-40`}\r\n            title={recording ? 'Stop recording' : 'Voice message'}>\r\n            {recording ? <Square size={18} /> : <Mic size={18} />}\r\n          </button>\r\n\r\n          <input type=\"text\" value={newMessage} onChange={(e) => setNewMessage(e.target.value)}\r\n            placeholder=\"Type a message...\"\r\n            className={`flex-1 px-3 py-2 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/40 min-w-0 ${dark ? 'bg-slate-700 text-white placeholder:text-slate-500' : 'bg-slate-100 text-slate-900 placeholder:text-slate-400'}`}\r\n          />\r\n\r\n          <button type=\"submit\" disabled={!newMessage.trim() || sending}\r\n            className=\"p-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:from-amber-600 hover:to-orange-600 transition-all disabled:opacity-40 shrink-0\">\r\n            {sending ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Image Preview Lightbox */}\r\n      {imagePreview && (\r\n        <div className=\"fixed inset-0 z-[200] bg-black/90 flex items-center justify-center backdrop-blur-sm\" onClick={() => setImagePreview(null)}>\r\n          <button onClick={() => setImagePreview(null)} className=\"absolute top-4 right-4 p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all z-10\">\r\n            <X size={24} />\r\n          </button>\r\n          <img src={imagePreview} alt=\"Preview\" className=\"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl\" onClick={e => e.stopPropagation()} />\r\n          <a href={imagePreview} download target=\"_blank\" rel=\"noopener noreferrer\" className=\"absolute bottom-6 right-6 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all\" onClick={e => e.stopPropagation()} title=\"Download\">\r\n            <Download size={20} />\r\n          </a>\r\n        </div>\r\n      )}\r\n\r\n      {/* â•â•â• PROFILE CARD POPUP (portal to body to escape overflow clipping) â•â•â• */}\r\n      {profileCard && createPortal(\r\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm\" onClick={() => setProfileCard(null)} style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0 }}>\r\n          <div\r\n            onClick={e => e.stopPropagation()}\r\n            className={`w-full max-w-sm mx-4 rounded-3xl overflow-hidden border shadow-2xl animate-fade-in ${dark ? 'bg-slate-900 border-slate-700' : 'bg-white border-slate-200'}`}\r\n          >\r\n            {/* Banner + Avatar */}\r\n            <div className=\"relative h-36 bg-gradient-to-r from-amber-500 via-orange-500 to-rose-500\">\r\n              <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmZmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzRjMC0yLjIxLTEuNzktNC00LTRzLTQgMS43OS00IDQgMS43OSA0IDQgNCA0LTEuNzkgNC00eiIvPjwvZz48L2c+PC9zdmc+')] opacity-10\" />\r\n              <button\r\n                onClick={() => setProfileCard(null)}\r\n                className=\"absolute top-3 right-3 p-1.5 bg-black/30 hover:bg-black/50 rounded-full text-white transition-all\"\r\n              >\r\n                <X size={16} />\r\n              </button>\r\n              <div className=\"absolute -bottom-[4.5rem] left-1/2 -translate-x-1/2\">\r\n                {profileCard.avatarUrl && !profileCard.avatarUrl.includes('ui-avatars.com') ? (\r\n                  <img\r\n                    src={profileCard.avatarUrl}\r\n                    alt=\"\"\r\n                    className=\"w-36 h-36 rounded-full object-cover border-4 shadow-lg cursor-pointer hover:ring-4 hover:ring-white/30 transition-all\"\r\n                    style={{ borderColor: dark ? '#1e293b' : '#ffffff' }}\r\n                    onClick={(e) => { e.stopPropagation(); setImagePreview(profileCard.avatarUrl); }}\r\n                    onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\r\n                  />\r\n                ) : (\r\n                  <div className=\"w-36 h-36 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-4xl font-bold text-white border-4 shadow-lg\" style={{ borderColor: dark ? '#1e293b' : '#ffffff' }}>\r\n                    {profileCard.name?.charAt(0).toUpperCase()}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Info */}\r\n            <div className=\"pt-20 pb-5 px-6 text-center\">\r\n              <h3 className={`text-xl font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>{profileCard.name}</h3>\r\n              <p className={`text-sm mt-0.5 ${dark ? 'text-slate-400' : 'text-slate-500'}`}>@{profileCard.username || profileCard.id?.slice(0, 8) || 'user'}</p>\r\n\r\n              {/* Role Badge */}\r\n              <div className=\"flex items-center justify-center gap-2 mt-2\">\r\n                {profileCard.role === 'mentor' ? (\r\n                  <span className=\"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-purple-500/20 to-blue-500/20 text-purple-400 border border-purple-500/30\">\r\n                    <GraduationCap size={12} /> Mentor\r\n                  </span>\r\n                ) : (\r\n                  <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${dark ? 'bg-amber-500/10 text-amber-400 border border-amber-500/20' : 'bg-amber-50 text-amber-600 border border-amber-200'}`}>\r\n                    <BookOpen size={12} /> Student\r\n                  </span>\r\n                )}\r\n                {profileCard.profession && (\r\n                  <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${dark ? 'bg-slate-800 text-slate-400' : 'bg-slate-100 text-slate-600'}`}>\r\n                    {profileCard.profession}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              {/* Bio */}\r\n              {profileCard.bio && (\r\n                <p className={`text-sm mt-3 ${dark ? 'text-slate-300' : 'text-slate-600'}`}>{profileCard.bio}</p>\r\n              )}\r\n\r\n              {/* Location */}\r\n              {profileCard.location && (\r\n                <div className={`flex items-center justify-center gap-1 mt-2 text-xs ${dark ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                  <MapPin size={12} /> {profileCard.location}\r\n                </div>\r\n              )}\r\n\r\n              {/* Stats Grid */}\r\n              <div className=\"grid grid-cols-2 gap-3 mt-5\">\r\n                <div className={`rounded-xl p-3 ${profileCard.studyStreak > 0 ? 'bg-gradient-to-br from-orange-500/15 to-red-500/15 border border-orange-500/25' : dark ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n                  <Flame size={18} className={`mx-auto mb-1 ${profileCard.studyStreak > 0 ? 'text-orange-500' : dark ? 'text-slate-500' : 'text-slate-400'}`} />\r\n                  <p className={`text-lg font-bold ${profileCard.studyStreak > 0 ? 'text-orange-500' : dark ? 'text-white' : 'text-slate-900'}`}>\r\n                    {profileCardLoading ? '...' : profileCard.studyStreak}\r\n                  </p>\r\n                  <p className={`text-[10px] font-medium ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Day Streak</p>\r\n                </div>\r\n                <div className={`rounded-xl p-3 ${dark ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n                  <Clock size={18} className=\"mx-auto mb-1 text-amber-500\" />\r\n                  <p className={`text-lg font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n                    {profileCardLoading ? '...' : formatTime(profileCard.totalMinutes || 0)}\r\n                  </p>\r\n                  <p className={`text-[10px] font-medium ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Grind Time</p>\r\n                </div>\r\n                <div className={`rounded-xl p-3 ${dark ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n                  <Brain size={18} className=\"mx-auto mb-1 text-blue-500\" />\r\n                  <p className={`text-lg font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n                    {profileCardLoading ? '...' : (profileCard.avgFocus || 0) > 0 ? `${profileCard.avgFocus}/5` : 'â€”'}\r\n                  </p>\r\n                  <p className={`text-[10px] font-medium ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Avg Focus</p>\r\n                </div>\r\n                <div className={`rounded-xl p-3 ${dark ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n                  <Target size={18} className=\"mx-auto mb-1 text-green-500\" />\r\n                  <p className={`text-lg font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n                    {profileCardLoading ? '...' : profileCard.totalSessions || 0}\r\n                  </p>\r\n                  <p className={`text-[10px] font-medium ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Sessions</p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Joined + experience */}\r\n              <div className=\"flex items-center justify-center gap-4 mt-4\">\r\n                {profileCard.joined && (\r\n                  <span className={`flex items-center gap-1 text-xs ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                    <Calendar size={12} /> Joined {profileCard.joined}\r\n                  </span>\r\n                )}\r\n                {profileCard.experience && (\r\n                  <span className={`flex items-center gap-1 text-xs ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                    {profileCard.experience} experience\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex gap-2 mt-5\">\r\n                <button\r\n                  onClick={() => { onSelectFriend(profileCard); setProfileCard(null); }}\r\n                  className=\"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-bold bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700 transition-all shadow-md\"\r\n                >\r\n                  <MessageCircle size={16} /> Chat\r\n                </button>\r\n                <button\r\n                  onClick={() => { onStartVideoCall(profileCard.name, profileCard.avatarUrl, profileCard.id); setProfileCard(null); }}\r\n                  className={`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-bold transition-all ${dark ? 'bg-slate-800 text-blue-400 hover:bg-slate-700 border border-slate-700' : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200'}`}\r\n                >\r\n                  <Video size={16} /> Call\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {profileCardLoading && (\r\n              <div className={`px-6 pb-4 flex items-center justify-center gap-2 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                <Loader2 size={14} className=\"animate-spin\" />\r\n                <span className=\"text-xs\">Loading details...</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[182,185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[182,185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[233,236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[233,236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[358,361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[358,361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[547,550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[547,550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":68,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":68,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":68,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2152,2152],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2197,2200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2197,2200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2282,2285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2282,2285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":81,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":81,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":81,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2526,2526],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":85,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":45},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":85,"column":47,"nodeType":"BlockStatement","messageId":"unexpected","endLine":85,"endColumn":49,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2619,2619],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'friend.isGroup'. Either include it or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [ready, user.id, friend.id, friend.isGroup]","fix":{"range":[2633,2662],"text":"[ready, user.id, friend.id, friend.isGroup]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":276,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8840,8843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8840,8843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":279,"column":128,"nodeType":null,"messageId":"unusedVar","endLine":279,"endColumn":129},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":279,"column":131,"nodeType":"BlockStatement","messageId":"unexpected","endLine":279,"endColumn":133,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9082,9082],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useEffect, useState } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\n\n// Safe dynamic imports to prevent module-level crashes\nlet supabaseQueries: any = null;\n\ninterface ChatWindowProps {\n  friend: any;\n  onClose: () => void;\n  onStartVideoCall: (name: string, avatar?: string, friendId?: string) => void;\n  [key: string]: any;\n}\n\nexport function ChatWindow({ friend, onClose, isDarkMode, isMinimized, setIsMinimized }: ChatWindowProps) {\n  const { user } = useAuth();\n  const [messages, setMessages] = useState<any[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [ready, setReady] = useState(false);\n  const [initError, setInitError] = useState('');\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  // Dynamically import supabase queries to prevent module crash\n  useEffect(() => {\n    import('../utils/supabase-queries')\n      .then((mod) => {\n        supabaseQueries = mod;\n        setReady(true);\n      })\n      .catch((err) => {\n        console.error('Failed to load supabase queries:', err);\n        setInitError('Failed to initialize chat module');\n        setLoading(false);\n      });\n  }, []);\n\n  // Load messages once ready\n  useEffect(() => {\n    if (!ready || !user?.id || !friend?.id) return;\n\n    let cancelled = false;\n\n    const loadMessages = async () => {\n      setLoading(true);\n      try {\n        const data = friend.isGroup\n          ? await supabaseQueries.fetchGroupMessages(friend.id)\n          : await supabaseQueries.fetchMessages(user.id, friend.id);\n        if (!cancelled) setMessages(data || []);\n      } catch (err) {\n        console.error('Load messages error:', err);\n        if (!cancelled) setMessages([]);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    };\n\n    loadMessages();\n\n    // Mark as read\n    try {\n      if (friend.isGroup) {\n        supabaseQueries.markNotificationsAsRead?.(user.id, '', 'message', friend.id);\n      } else {\n        supabaseQueries.markNotificationsAsRead?.(user.id, friend.id);\n      }\n    } catch (_) {}\n\n    // Realtime subscription\n    let sub: any = null;\n    try {\n      sub = supabaseQueries.subscribeToMessages(user.id, (msg: any) => {\n        const isRelevant = friend.isGroup\n          ? msg.group_id === friend.id\n          : msg.sender_id === friend.id;\n        if (isRelevant) {\n          setMessages((prev) => [...prev, msg]);\n        }\n      });\n    } catch (_) {}\n\n    return () => {\n      cancelled = true;\n      try { sub?.unsubscribe?.(); } catch (_) {}\n    };\n  }, [ready, user?.id, friend?.id]);\n\n  // Auto scroll\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleSend = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user?.id || !friend?.id || !newMessage.trim() || sending || !supabaseQueries) return;\n\n    const content = newMessage.trim();\n    setSending(true);\n    setNewMessage('');\n\n    // Optimistic add\n    const tempId = 'temp-' + Date.now();\n    setMessages((prev) => [...prev, {\n      id: tempId,\n      sender_id: user.id,\n      content,\n      created_at: new Date().toISOString(),\n    }]);\n\n    try {\n      const result = friend.isGroup\n        ? await supabaseQueries.sendGroupMessage(friend.id, user.id, content)\n        : await supabaseQueries.sendMessage(user.id, friend.id, content);\n\n      if (result?.error) {\n        setMessages((prev) => prev.filter((m) => m.id !== tempId));\n        setNewMessage(content);\n      }\n    } catch (err) {\n      console.error('Send error:', err);\n      setMessages((prev) => prev.filter((m) => m.id !== tempId));\n      setNewMessage(content);\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const friendName = friend?.name || 'Chat';\n  const friendAvatar = friend?.avatarUrl || '';\n  const friendUsername = friend?.username || '';\n  const dark = isDarkMode === true;\n\n  // ===== MINIMIZED BAR =====\n  if (isMinimized) {\n    return (\n      <div\n        onClick={() => setIsMinimized?.(false)}\n        style={{\n          position: 'fixed',\n          bottom: 24,\n          right: 24,\n          width: 280,\n          zIndex: 99999,\n          borderRadius: 16,\n          overflow: 'hidden',\n          cursor: 'pointer',\n          boxShadow: '0 8px 32px rgba(0,0,0,0.25)',\n          background: 'linear-gradient(to right, #f59e0b, #ea580c)',\n          color: 'white',\n          padding: '10px 14px',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          {friendAvatar && <img src={friendAvatar} alt=\"\" style={{ width: 28, height: 28, borderRadius: '50%', objectFit: 'cover' as const }} />}\n          <span style={{ fontWeight: 700, fontSize: 13 }}>{friendName}</span>\n        </div>\n        <button\n          onClick={(ev) => { ev.stopPropagation(); onClose(); }}\n          style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', fontSize: 18, padding: '0 4px' }}\n        >\n          x\n        </button>\n      </div>\n    );\n  }\n\n  // ===== FULL CHAT =====\n  return (\n    <div\n      id=\"chat-overlay\"\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100vw',\n        height: '100vh',\n        zIndex: 99999,\n        display: 'flex',\n        flexDirection: 'row' as const,\n      }}\n    >\n      {/* Backdrop */}\n      <div\n        onClick={onClose}\n        style={{\n          flexGrow: 1,\n          backgroundColor: 'rgba(0, 0, 0, 0.45)',\n        }}\n      />\n\n      {/* Chat Panel */}\n      <div\n        onClick={(e) => e.stopPropagation()}\n        style={{\n          width: 400,\n          maxWidth: '100vw',\n          height: '100vh',\n          display: 'flex',\n          flexDirection: 'column' as const,\n          backgroundColor: dark ? '#0f172a' : '#ffffff',\n          boxShadow: '-4px 0 32px rgba(0,0,0,0.3)',\n        }}\n      >\n        {/* HEADER */}\n        <div\n          style={{\n            flexShrink: 0,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            padding: '12px 16px',\n            background: 'linear-gradient(to right, #f59e0b, #ea580c)',\n            color: 'white',\n          }}\n        >\n          <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n            <button\n              onClick={onClose}\n              style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', fontSize: 20, padding: '4px 8px' }}\n              title=\"Back\"\n            >\n              &#8592;\n            </button>\n            {friendAvatar && (\n              <img\n                src={friendAvatar}\n                alt=\"\"\n                style={{ width: 36, height: 36, borderRadius: '50%', objectFit: 'cover' as const, border: '2px solid rgba(255,255,255,0.3)' }}\n              />\n            )}\n            <div>\n              <div style={{ fontWeight: 700, fontSize: 14 }}>{friendName}</div>\n              {friendUsername && <div style={{ fontSize: 10, opacity: 0.8 }}>@{friendUsername}</div>}\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', fontSize: 22, padding: '4px 8px' }}\n            title=\"Close\"\n          >\n            x\n          </button>\n        </div>\n\n        {/* MESSAGES */}\n        <div\n          style={{\n            flexGrow: 1,\n            overflowY: 'auto' as const,\n            padding: 16,\n            backgroundColor: dark ? '#020617' : '#f8fafc',\n          }}\n        >\n          {initError ? (\n            <div style={{ textAlign: 'center', padding: 40, color: dark ? '#f87171' : '#dc2626' }}>\n              <p>{initError}</p>\n            </div>\n          ) : loading ? (\n            <div style={{ textAlign: 'center', padding: 40, color: dark ? '#94a3b8' : '#64748b' }}>\n              <div style={{ fontSize: 24, marginBottom: 8, animation: 'spin 1s linear infinite' }}>&#8987;</div>\n              <p style={{ fontSize: 13 }}>Loading messages...</p>\n              <style>{`@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`}</style>\n            </div>\n          ) : messages.length === 0 ? (\n            <div style={{ textAlign: 'center', padding: 40, color: dark ? '#94a3b8' : '#64748b' }}>\n              <div style={{ fontSize: 40, marginBottom: 8 }}>&#128172;</div>\n              <p style={{ fontSize: 14, fontWeight: 500 }}>No messages yet</p>\n              <p style={{ fontSize: 12, marginTop: 4 }}>Say hi to {friendName}!</p>\n            </div>\n          ) : (\n            <div>\n              {messages.map((msg: any, idx: number) => {\n                const isMe = msg.sender_id === user?.id;\n                let time = '';\n                try { time = new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); } catch (_) {}\n\n                return (\n                  <div\n                    key={msg.id || idx}\n                    style={{\n                      display: 'flex',\n                      justifyContent: isMe ? 'flex-end' : 'flex-start',\n                      marginBottom: 8,\n                    }}\n                  >\n                    <div\n                      style={{\n                        maxWidth: '75%',\n                        padding: '8px 14px',\n                        borderRadius: 16,\n                        fontSize: 14,\n                        lineHeight: '1.4',\n                        ...(isMe\n                          ? {\n                              background: 'linear-gradient(135deg, #f59e0b, #ea580c)',\n                              color: 'white',\n                              borderBottomRightRadius: 4,\n                            }\n                          : {\n                              backgroundColor: dark ? '#1e293b' : '#ffffff',\n                              color: dark ? '#f1f5f9' : '#1e293b',\n                              border: dark ? '1px solid #334155' : '1px solid #e2e8f0',\n                              borderBottomLeftRadius: 4,\n                            }),\n                      }}\n                    >\n                      <div style={{ whiteSpace: 'pre-wrap', wordBreak: 'break-word' }}>{msg.content || ''}</div>\n                      {time && (\n                        <div style={{ fontSize: 9, marginTop: 4, opacity: 0.6, textAlign: isMe ? 'right' : 'left' }}>\n                          {time}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n              <div ref={bottomRef} />\n            </div>\n          )}\n        </div>\n\n        {/* INPUT */}\n        <form\n          onSubmit={handleSend}\n          style={{\n            flexShrink: 0,\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            padding: 12,\n            borderTop: dark ? '1px solid #1e293b' : '1px solid #e2e8f0',\n            backgroundColor: dark ? '#0f172a' : '#ffffff',\n          }}\n        >\n          <input\n            type=\"text\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            placeholder=\"Type a message...\"\n            style={{\n              flexGrow: 1,\n              padding: '10px 16px',\n              borderRadius: 12,\n              border: 'none',\n              outline: 'none',\n              fontSize: 14,\n              backgroundColor: dark ? '#1e293b' : '#f1f5f9',\n              color: dark ? '#f1f5f9' : '#0f172a',\n            }}\n          />\n          <button\n            type=\"submit\"\n            disabled={!newMessage.trim() || sending}\n            style={{\n              padding: '10px 14px',\n              borderRadius: 12,\n              border: 'none',\n              background: 'linear-gradient(to right, #f59e0b, #ea580c)',\n              color: 'white',\n              cursor: !newMessage.trim() || sending ? 'default' : 'pointer',\n              opacity: !newMessage.trim() || sending ? 0.4 : 1,\n              fontSize: 16,\n              flexShrink: 0,\n            }}\n          >\n            {sending ? '...' : '\\u27A4'}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\CompletionTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":2,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used.","line":2,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BookOpen' is defined but never used.","line":2,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":257,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":257,"endColumn":46}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\nimport { Calendar, TrendingUp, Filter, Target, BookOpen, ChevronDown, ChevronUp } from 'lucide-react';\nimport { StudyGoal, Subject, StudySession } from '../types';\n\ninterface CompletionTrackerProps {\n  goals: StudyGoal[];\n  subjects: Subject[];\n  sessions: StudySession[];\n  isDarkMode: boolean;\n}\n\ninterface DailyCompletion {\n  date: string;\n  displayDate: string;\n  totalGoals: number;\n  completedGoals: number;\n  totalExams: number;\n  completedExams: number;\n  completionRate: number;\n  studyHours: number;\n}\n\nexport function CompletionTracker({ goals, subjects, sessions, isDarkMode }: CompletionTrackerProps) {\n  const [selectedFilter, setSelectedFilter] = useState<'all' | 'goals' | 'exams' | string>('all');\n  const [selectedSubject, setSelectedSubject] = useState<string>('all');\n  const [showFilters, setShowFilters] = useState(false);\n  const [timeRange, setTimeRange] = useState<'week' | 'month' | 'all'>('week');\n\n  // Calculate daily completion data\n  const dailyCompletions = useMemo(() => {\n    const now = new Date();\n    const days: DailyCompletion[] = [];\n    \n    // Determine date range\n    const daysToShow = timeRange === 'week' ? 7 : timeRange === 'month' ? 30 : 90;\n    \n    for (let i = daysToShow - 1; i >= 0; i--) {\n      const date = new Date(now);\n      date.setDate(date.getDate() - i);\n      const dateStr = date.toISOString().split('T')[0];\n      \n      // Filter goals based on selected filters\n      let filteredGoals = goals;\n      \n      if (selectedSubject !== 'all') {\n        filteredGoals = filteredGoals.filter(g => g.subjectId === selectedSubject);\n      }\n      \n      if (selectedFilter === 'goals') {\n        filteredGoals = filteredGoals.filter(g => !g.isExam);\n      } else if (selectedFilter === 'exams') {\n        filteredGoals = filteredGoals.filter(g => g.isExam);\n      }\n      \n      // Goals completed on this day\n      const completedOnDay = filteredGoals.filter(g => \n        g.completed && g.completedAt && \n        new Date(g.completedAt).toISOString().split('T')[0] === dateStr\n      );\n      \n      // Goals that were active on this day (created before or on this day, not completed before this day)\n      const activeOnDay = filteredGoals.filter(g => {\n        const createdDate = g.targetDate ? new Date(g.targetDate) : new Date();\n        const completedDate = g.completedAt ? new Date(g.completedAt) : null;\n        \n        return createdDate <= date && (!completedDate || completedDate >= date);\n      });\n      \n      // Study hours for this day\n      const dayStart = new Date(date);\n      dayStart.setHours(0, 0, 0, 0);\n      const dayEnd = new Date(date);\n      dayEnd.setHours(23, 59, 59, 999);\n      \n      const dayStudyMinutes = sessions\n        .filter(session => {\n          const sessionDate = new Date(session.startTime);\n          const matchesSubject = selectedSubject === 'all' || session.subjectId === selectedSubject;\n          return session.completed && \n                 sessionDate >= dayStart && \n                 sessionDate <= dayEnd && \n                 matchesSubject;\n        })\n        .reduce((total, session) => total + (session.durationMinutes || 0), 0);\n      \n      const studyHours = Math.round(dayStudyMinutes / 60 * 10) / 10;\n      \n      // Separate goals and exams\n      const regularGoals = activeOnDay.filter(g => !g.isExam);\n      const examGoals = activeOnDay.filter(g => g.isExam);\n      const completedRegular = completedOnDay.filter(g => !g.isExam);\n      const completedExams = completedOnDay.filter(g => g.isExam);\n      \n      const totalItems = activeOnDay.length;\n      const completedItems = completedOnDay.length;\n      const completionRate = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;\n      \n      days.push({\n        date: dateStr,\n        displayDate: date.toLocaleDateString('en-US', { \n          weekday: 'short', \n          month: 'short', \n          day: 'numeric' \n        }),\n        totalGoals: regularGoals.length,\n        completedGoals: completedRegular.length,\n        totalExams: examGoals.length,\n        completedExams: completedExams.length,\n        completionRate,\n        studyHours,\n      });\n    }\n    \n    return days.reverse(); // Show most recent first\n  }, [goals, sessions, selectedFilter, selectedSubject, timeRange]);\n\n  const averageCompletionRate = useMemo(() => {\n    const validDays = dailyCompletions.filter(day => day.totalGoals + day.totalExams > 0);\n    if (validDays.length === 0) return 0;\n    \n    const totalRate = validDays.reduce((sum, day) => sum + day.completionRate, 0);\n    return Math.round(totalRate / validDays.length);\n  }, [dailyCompletions]);\n\n  const totalStudyHours = useMemo(() => {\n    return dailyCompletions.reduce((sum, day) => sum + day.studyHours, 0);\n  }, [dailyCompletions]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Stats */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            Completion Tracker\n          </h2>\n          <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n            Track your daily progress and completion rates\n          </p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <div className={`text-center px-4 py-2 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n            <div className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n              {averageCompletionRate}%\n            </div>\n            <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n              Avg Rate\n            </div>\n          </div>\n          <div className={`text-center px-4 py-2 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n            <div className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n              {totalStudyHours}h\n            </div>\n            <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n              Study Time\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className={`rounded-xl p-4 border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <Filter className=\"text-amber-500\" size={20} />\n            <span className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n              Filters\n            </span>\n          </div>\n          <button\n            onClick={() => setShowFilters(!showFilters)}\n            className={`p-1 rounded transition-colors ${\n              isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-100'\n            }`}\n          >\n            {showFilters ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\n          </button>\n        </div>\n\n        <div className=\"flex flex-wrap gap-2 mb-4\">\n          {/* Time Range */}\n          <div className=\"flex gap-1\">\n            {(['week', 'month', 'all'] as const).map((range) => (\n              <button\n                key={range}\n                onClick={() => setTimeRange(range)}\n                className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${\n                  timeRange === range\n                    ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white'\n                    : isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                }`}\n              >\n                {range === 'week' ? '7 Days' : range === 'month' ? '30 Days' : '90 Days'}\n              </button>\n            ))}\n          </div>\n\n          {/* Type Filter */}\n          <div className=\"flex gap-1\">\n            {(['all', 'goals', 'exams'] as const).map((filter) => (\n              <button\n                key={filter}\n                onClick={() => setSelectedFilter(filter)}\n                className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${\n                  selectedFilter === filter\n                    ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white'\n                    : isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                }`}\n              >\n                {filter === 'all' ? 'All' : filter === 'goals' ? 'Goals' : 'Exams'}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {showFilters && (\n          <div className=\"space-y-3\">\n            {/* Subject Filter */}\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                Filter by Subject\n              </label>\n              <select\n                value={selectedSubject}\n                onChange={(e) => setSelectedSubject(e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${\n                  isDarkMode ? 'bg-slate-700 border-slate-600 text-white' : 'border-slate-300'\n                }`}\n              >\n                <option value=\"all\">All Subjects</option>\n                {subjects.map((subject) => (\n                  <option key={subject.id} value={subject.id}>\n                    {subject.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Daily Completion Chart */}\n      <div className={`rounded-xl p-6 border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n        <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n          Daily Completion Rates\n        </h3>\n        \n        {dailyCompletions.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <Calendar className={`mx-auto mb-4 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\n            <p className={`${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n              No data available for the selected filters\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {dailyCompletions.map((day, index) => (\n              <div\n                key={day.date}\n                className={`p-4 rounded-lg border transition-all hover:shadow-md ${\n                  isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'\n                }`}\n              >\n                <div className=\"flex items-center justify-between mb-2\">\n                  <div className=\"flex items-center gap-3\">\n                    <span className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                      {day.displayDate}\n                    </span>\n                    {day.studyHours > 0 && (\n                      <span className={`text-xs px-2 py-1 rounded-full ${\n                        isDarkMode ? 'bg-amber-900 text-amber-200' : 'bg-amber-100 text-amber-800'\n                      }`}>\n                        {day.studyHours}h studied\n                      </span>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    {selectedFilter !== 'exams' && (\n                      <div className=\"text-center\">\n                        <div className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                          {day.completedGoals}/{day.totalGoals}\n                        </div>\n                        <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                          Goals\n                        </div>\n                      </div>\n                    )}\n                    {selectedFilter !== 'goals' && (\n                      <div className=\"text-center\">\n                        <div className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                          {day.completedExams}/{day.totalExams}\n                        </div>\n                        <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                          Exams\n                        </div>\n                      </div>\n                    )}\n                    <div className={`text-lg font-bold ${\n                      day.completionRate >= 80 ? 'text-green-500' :\n                      day.completionRate >= 60 ? 'text-amber-500' :\n                      day.completionRate >= 40 ? 'text-orange-500' : 'text-red-500'\n                    }`}>\n                      {day.completionRate}%\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Progress Bar */}\n                <div className={`w-full rounded-full h-2 ${isDarkMode ? 'bg-slate-600' : 'bg-slate-200'}`}>\n                  <div\n                    className={`h-full rounded-full transition-all duration-300 ${\n                      day.completionRate >= 80 ? 'bg-gradient-to-r from-green-500 to-emerald-600' :\n                      day.completionRate >= 60 ? 'bg-gradient-to-r from-amber-500 to-orange-600' :\n                      day.completionRate >= 40 ? 'bg-gradient-to-r from-orange-500 to-red-500' :\n                      'bg-gradient-to-r from-red-500 to-red-600'\n                    }`}\n                    style={{ width: `${day.completionRate}%` }}\n                  />\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserData'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserData, user]","fix":{"range":[1216,1222],"text":"[loadUserData, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Brain, Target, Clock, Calendar, Flame, Users, X } from 'lucide-react';\nimport { StudySession, Subject, StudyGoal } from '../types';\nimport { calculateStudyStats, generateInsights, getWeeklyProgress, calculateDailyCompletionRate, calculateWeeklySubjectProgress, calculateStreak } from '../utils/analytics';\nimport { InterestingFacts } from './InterestingFacts';\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { fetchUpcomingSessions, getUserProfile } from '../utils/supabase-queries';\n\ninterface DashboardProps {\n  subjects: Subject[];\n  sessions: StudySession[];\n  goals: StudyGoal[];\n  isDarkMode: boolean;\n}\n\nexport function Dashboard({ subjects, sessions, goals, isDarkMode }: DashboardProps) {\n  const { user } = useAuth();\n  const [upcomingSessions, setUpcomingSessions] = useState<any[]>([]);\n  const [userRole, setUserRole] = useState<'student' | 'mentor'>('student');\n  const [dismissedInsights, setDismissedInsights] = useState<Set<string>>(new Set());\n\n  const handleDismissInsight = (title: string) => {\n    setDismissedInsights(prev => new Set([...prev, title]));\n  };\n\n  useEffect(() => {\n    if (user) {\n      loadUserData();\n    }\n  }, [user]);\n\n  const loadUserData = async () => {\n    if (!user) return;\n    const profile = await getUserProfile(user.id);\n    const role = profile?.role || 'student';\n    setUserRole(role);\n\n    if (role === 'student') {\n      const sessions = await fetchUpcomingSessions(user.id, 'student');\n      setUpcomingSessions(sessions || []);\n    }\n  };\n\n  // All data (subjects, sessions, goals) is persisted via localStorage (storage.ts)\n  // Weekly progress, daily stats, and subject progress are calculated from persisted sessions\n  // This ensures dashboard metrics remain consistent across page reloads and sign-outs\n  const stats = calculateStudyStats(sessions, subjects);\n  const insights = generateInsights(sessions, subjects);\n  const weeklyProgress = getWeeklyProgress(sessions, subjects);\n  const dailyStats = calculateDailyCompletionRate(sessions, subjects);\n  const weeklyStats = calculateWeeklySubjectProgress(sessions, subjects);\n  const currentStreak = calculateStreak(sessions);\n\n  const regularGoals = goals.filter(g => !g.isExam);\n  const activeGoals = regularGoals.filter(g => !g.completed);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center justify-between mb-2\">\n            <Clock className=\"text-amber-500\" size={24} />\n            <span className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{stats.totalHours}h</span>\n          </div>\n          <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Total Grind Time</p>\n        </div>\n\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center justify-between mb-2\">\n            <Calendar className=\"text-green-500\" size={24} />\n            <span className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{dailyStats.dailyCompletionRate}%</span>\n          </div>\n          <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Today's Progress</p>\n          <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n            {dailyStats.todayHours}h / {dailyStats.totalDailyTarget}h target\n          </p>\n        </div>\n\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center justify-between mb-2\">\n            <Brain className=\"text-blue-500\" size={24} />\n            <span className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{stats.avgFocusRating}/5</span>\n          </div>\n          <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Avg Focus Rating</p>\n        </div>\n\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center justify-between mb-2\">\n            <Flame className=\"text-orange-500\" size={24} />\n            <span className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{currentStreak}</span>\n          </div>\n          <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Day Streak</p>\n        </div>\n      </div>\n\n      {/* Upcoming Mentor Sessions - Only for students with sessions */}\n      {userRole === 'student' && upcomingSessions.length > 0 && (\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center gap-2 mb-4\">\n            <Users className=\"text-amber-500\" size={24} />\n            <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n              Upcoming Sessions ({upcomingSessions.length})\n            </h3>\n          </div>\n          <div className=\"space-y-3\">\n            {upcomingSessions.slice(0, 3).map((session) => (\n              <div\n                key={session.id}\n                className={`p-4 rounded-lg border ${isDarkMode\n                  ? 'bg-slate-700/50 border-slate-600'\n                  : 'bg-slate-50 border-slate-200'\n                  }`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  {session.mentorProfile?.avatarUrl ? (\n                    <img\n                      src={session.mentorProfile.avatarUrl}\n                      alt={session.mentorProfile.fullName}\n                      className=\"w-10 h-10 rounded-full object-cover\"\n                    />\n                  ) : (\n                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                      }`}>\n                      <Users className=\"w-5 h-5\" />\n                    </div>\n                  )}\n                  <div className=\"flex-1 min-w-0\">\n                    <p className={`font-semibold truncate ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                      {session.topic}\n                    </p>\n                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                      with {session.mentorProfile?.fullName || 'Mentor'}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"flex items-center gap-1 text-amber-500 text-sm font-medium\">\n                      <Calendar size={14} />\n                      <span>{new Date(session.preferredDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1 text-sm mt-1\">\n                      <Clock size={14} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\n                      <span className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>{session.preferredTime}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Interesting Facts Section */}\n      <InterestingFacts isDarkMode={isDarkMode} />\n\n      {/* Weekly Progress by Day */}\n      <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>This Week's Daily Progress</h3>\n          <div className=\"text-right\">\n            <div className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n              Week of {weeklyProgress[0]?.date} - {weeklyProgress[6]?.date}\n            </div>\n          </div>\n        </div>\n        <div className=\"overflow-x-auto pb-2\">\n          <div className=\"grid grid-cols-7 gap-2 min-w-[500px]\">\n            {weeklyProgress.map((day, idx) => (\n              <div key={idx} className=\"text-center\">\n                <div className={`text-xs font-medium mb-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                  {day.day}\n                </div>\n                <div className={`text-xs mb-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                  {day.date}\n                </div>\n                <div className={`rounded-lg p-3 border transition-all ${day.isToday\n                  ? isDarkMode ? 'bg-amber-900/30 border-amber-600' : 'bg-amber-50 border-amber-300'\n                  : day.isFuture\n                    ? isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-100 border-slate-200'\n                    : isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-white border-slate-200'\n                  }`}>\n                  {/* Time Spent */}\n                  <div className={`text-lg font-bold ${day.isToday\n                    ? 'text-amber-500'\n                    : day.isFuture\n                      ? isDarkMode ? 'text-slate-500' : 'text-slate-400'\n                      : day.hours > 0\n                        ? isDarkMode ? 'text-white' : 'text-slate-900'\n                        : isDarkMode ? 'text-slate-500' : 'text-slate-400'\n                    }`}>\n                    {day.isFuture ? '-' : `${day.hours}h`}\n                  </div>\n\n                  {/* Status */}\n                  <div className={`text-xs mt-1 ${day.isToday\n                    ? 'text-amber-600'\n                    : day.isFuture\n                      ? isDarkMode ? 'text-slate-500' : 'text-slate-400'\n                      : isDarkMode ? 'text-slate-400' : 'text-slate-600'\n                    }`}>\n                    {day.isFuture ? 'Upcoming' : day.hours > 0 ? 'Studied' : 'No study'}\n                  </div>\n\n                  {day.isToday && (\n                    <div className=\"text-xs text-amber-500 font-medium mt-1\">Today</div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div className=\"mt-4 flex items-center justify-between\">\n          <div className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n            Total this week: {weeklyProgress.reduce((sum, day) => sum + day.hours, 0)}h\n          </div>\n          <div className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n            Resets every Sunday\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Weekly Subject Progress</h3>\n            <div className=\"text-right\">\n              <div className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                {weeklyStats.overallWeeklyCompletion}%\n              </div>\n              <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                {weeklyStats.totalWeekHours}h / {weeklyStats.totalWeeklyTarget}h\n              </div>\n            </div>\n          </div>\n          {weeklyStats.subjectProgress.length === 0 ? (\n            <p className={`text-center py-8 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>No weekly targets set or no study sessions this week</p>\n          ) : (\n            <div className=\"space-y-4\">\n              {weeklyStats.subjectProgress.map((item, idx) => (\n                <div key={idx}>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"w-3 h-3 rounded-full\"\n                        style={{ backgroundColor: item.color }}\n                      />\n                      <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>{item.subject}</span>\n                    </div>\n                    <div className=\"text-right\">\n                      <span className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                        {item.hoursStudied}h / {item.targetHours}h\n                      </span>\n                      <div className={`text-xs ${item.completionRate >= 100 ? 'text-green-500' : item.completionRate >= 70 ? 'text-amber-500' : 'text-red-500'}`}>\n                        {item.completionRate}%\n                      </div>\n                    </div>\n                  </div>\n                  <div className={`w-full rounded-full h-3 ${isDarkMode ? 'bg-slate-700' : 'bg-slate-100'}`}>\n                    <div\n                      className={`h-full rounded-full transition-all duration-300 ${item.completionRate >= 100 ? 'bg-green-500' :\n                        item.completionRate >= 70 ? 'bg-amber-500' : 'bg-red-500'\n                        }`}\n                      style={{\n                        width: `${Math.min(item.completionRate, 100)}%`,\n                      }}\n                    />\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <h3 className={`text-xl font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Today's Subject Progress</h3>\n          {dailyStats.subjectProgress.length === 0 ? (\n            <p className={`text-center py-8 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>No daily targets set or no study sessions today</p>\n          ) : (\n            <div className=\"space-y-4\">\n              {dailyStats.subjectProgress.map((item, idx) => (\n                <div key={idx}>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"w-3 h-3 rounded-full\"\n                        style={{ backgroundColor: item.color }}\n                      />\n                      <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>{item.subject}</span>\n                    </div>\n                    <div className=\"text-right\">\n                      <span className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                        {item.hoursStudied}h / {item.targetHours}h\n                      </span>\n                      <div className={`text-xs ${item.completionRate >= 100 ? 'text-green-500' : item.completionRate >= 50 ? 'text-amber-500' : 'text-red-500'}`}>\n                        {item.completionRate}%\n                      </div>\n                    </div>\n                  </div>\n                  <div className={`w-full rounded-full h-3 ${isDarkMode ? 'bg-slate-700' : 'bg-slate-100'}`}>\n                    <div\n                      className={`h-full rounded-full transition-all duration-300 ${item.completionRate >= 100 ? 'bg-green-500' :\n                        item.completionRate >= 50 ? 'bg-amber-500' : 'bg-red-500'\n                        }`}\n                      style={{\n                        width: `${Math.min(item.completionRate, 100)}%`,\n                      }}\n                    />\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className={`rounded-xl p-6 shadow-lg text-white transition-colors ${isDarkMode ? 'bg-gradient-to-br from-amber-900 to-orange-900' : 'bg-gradient-to-br from-slate-900 to-slate-700'}`}>\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Brain size={24} />\n          <h3 className=\"text-xl font-bold\">Insights</h3>\n        </div>\n        <div className=\"space-y-3\">\n          {insights.filter(insight => !dismissedInsights.has(insight.title)).map((insight, idx) => (\n            <div\n              key={idx}\n              className=\"bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20 relative group\"\n            >\n              <button\n                onClick={() => handleDismissInsight(insight.title)}\n                className=\"absolute top-2 right-2 p-1 rounded-full bg-white/10 hover:bg-white/20 transition-all opacity-0 group-hover:opacity-100\"\n                title=\"Dismiss insight\"\n              >\n                <X size={14} />\n              </button>\n              <h4 className=\"font-semibold mb-1 pr-6\">{insight.title}</h4>\n              <p className=\"text-sm text-slate-200\">{insight.description}</p>\n            </div>\n          ))}\n          {insights.filter(insight => !dismissedInsights.has(insight.title)).length === 0 && (\n            <p className=\"text-center py-4 text-slate-300\">All insights dismissed</p>\n          )}\n        </div>\n      </div>\n\n      {activeGoals.length > 0 && (\n        <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <h3 className={`text-xl font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Active Goals</h3>\n          <div className=\"space-y-3\">\n            {activeGoals.slice(0, 5).map((goal) => (\n              <div key={goal.id} className={`flex items-start gap-3 p-3 rounded-lg ${isDarkMode ? 'bg-slate-700' : 'bg-slate-50'}`}>\n                <Target className=\"text-orange-500 flex-shrink-0 mt-1\" size={20} />\n                <div className=\"flex-1\">\n                  <p className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{goal.title}</p>\n                  {goal.targetDate && (\n                    <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                      Due: {new Date(goal.targetDate).toLocaleDateString()}\n                    </p>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\DoubtSolver.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":2,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BarChart3' is defined but never used.","line":2,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":2,"column":76,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Flame' is defined but never used.","line":2,"column":86,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Globe' is defined but never used.","line":2,"column":111,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":116},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Code' is defined but never used.","line":2,"column":126,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":130},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PenTool' is defined but never used.","line":2,"column":132,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":139},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowRight' is defined but never used.","line":2,"column":141,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":151},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'categories' is assigned a value but never used.","line":47,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedCategory' is assigned a value but never used.","line":128,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":128,"endColumn":47}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\nimport { X, Send, Bot, Search, HelpCircle, Book, Clock, Target, BarChart3, Calendar, Flame, Calculator, Atom, Globe, Beaker, Code, PenTool, ArrowRight, LucideIcon } from 'lucide-react';\n\ninterface DoubtSolverProps {\n  isDarkMode: boolean;\n}\n\ninterface FAQ {\n  id: string;\n  question: string;\n  answer: string;\n  category: string;\n  icon: LucideIcon;\n}\n\ninterface ChatMessage {\n  id: string;\n  type: 'user' | 'bot';\n  content: string;\n  timestamp: Date;\n}\n\nconst faqs: FAQ[] = [\n  {\n    id: 'timer',\n    question: 'How do I start a study timer?',\n    answer: 'Go to the Study Timer section, select a subject, set your desired duration, and click \"Start Timer\".',\n    category: 'timer',\n    icon: Clock\n  },\n  {\n    id: 'subjects',\n    question: 'How do I add new subjects?',\n    answer: 'Navigate to Subject Manager, click \"Add Subject\", enter the subject name, choose a color, and set your target study hours.',\n    category: 'subjects',\n    icon: Book\n  },\n  {\n    id: 'goals',\n    question: 'How do I create study goals?',\n    answer: 'Go to Goals Manager, click \"Add Goal\", fill in the details, select subjects, and set target date.',\n    category: 'goals',\n    icon: Target\n  }\n];\n\nconst categories = [\n  { id: 'all', name: 'All Topics', icon: HelpCircle },\n  { id: 'timer', name: 'Study Timer', icon: Clock },\n  { id: 'subjects', name: 'Subjects', icon: Book },\n  { id: 'goals', name: 'Goals', icon: Target },\n  { id: 'math', name: 'Mathematics', icon: Calculator },\n  { id: 'physics', name: 'Physics', icon: Atom },\n  { id: 'chemistry', name: 'Chemistry', icon: Beaker }\n];\n\n// Gemini API Integration\nconst GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY || '';\nconst GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';\n\nasync function askGemini(question: string, history: ChatMessage[] = []): Promise<string> {\n  if (!GEMINI_API_KEY) {\n    return \"âš ï¸ **Gemini AI not configured**\\n\\nTo enable AI responses:\\n1. Get free API key: https://makersuite.google.com/app/apikey\\n2. Add to .env: VITE_GEMINI_API_KEY=your-key\\n3. Restart server\\n\\nFor now, try browsing the FAQ section!\";\n  }\n\n  try {\n    const systemPrompt = `You are an expert AI study assistant for students. Provide clear, accurate, and helpful responses about:\n- Math, Physics, Chemistry, Biology (with step-by-step solutions)\n- Programming and Computer Science\n- Study techniques and strategies\n- Time management and productivity\n- Using the Grind Clock study app\n\nBe friendly, encouraging, and provide detailed explanations with examples.`;\n\n    const contents = [\n      {\n        role: 'user',\n        parts: [{ text: systemPrompt }]\n      },\n      {\n        role: 'model',\n        parts: [{ text: 'I understand. I will provide accurate, detailed, and helpful responses to students.' }]\n      },\n      ...history.slice(-4).map(msg => ({\n        role: msg.type === 'user' ? 'user' : 'model',\n        parts: [{ text: msg.content }]\n      })),\n      {\n        role: 'user',\n        parts: [{ text: question }]\n      }\n    ];\n\n    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        contents,\n        generationConfig: {\n          temperature: 0.4,\n          topK: 40,\n          topP: 0.95,\n          maxOutputTokens: 1024,\n        }\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error(`API Error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    \n    if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {\n      return data.candidates[0].content.parts[0].text;\n    }\n    \n    throw new Error('No response from Gemini');\n  } catch (error) {\n    console.error('Gemini Error:', error);\n    return \"I'm having trouble connecting right now. Please try again in a moment. ðŸ”„\";\n  }\n}\n\nexport function DoubtSolver({ isDarkMode }: DoubtSolverProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [customQuestion, setCustomQuestion] = useState('');\n  const [activeTab, setActiveTab] = useState<'faq' | 'chat'>('chat');\n  const [isTyping, setIsTyping] = useState(false);\n  const chatMessagesRef = useRef<HTMLDivElement>(null);\n\n  const welcomeMessage = GEMINI_API_KEY \n    ? \"Hello! I'm your AI study assistant powered by Google Gemini! ðŸ¤–âœ¨\\n\\nI can help you with:\\nðŸ“ Math, Physics, Chemistry\\nðŸ’» Programming\\nðŸ“š Study strategies\\nðŸŽ¯ Grind Clock features\\n\\nAsk me anything!\"\n    : \"Hello! I'm your AI study assistant! ðŸ¤–\\n\\nâš ï¸ Gemini AI is not configured yet.\\n\\nGet your FREE API key:\\n1. Visit: https://makersuite.google.com/app/apikey\\n2. Add to .env file\\n3. Restart server\\n\\nFor now, check out the FAQ section!\";\n\n  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([\n    {\n      id: '1',\n      type: 'bot',\n      content: welcomeMessage,\n      timestamp: new Date()\n    }\n  ]);\n\n  const filteredFAQs = faqs.filter(faq => {\n    const matchesCategory = selectedCategory === 'all' || faq.category === selectedCategory;\n    const matchesSearch = faq.question.toLowerCase().includes(searchQuery.toLowerCase()) ||\n                         faq.answer.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesCategory && matchesSearch;\n  });\n\n  const handleSubmitQuestion = async () => {\n    const question = customQuestion.trim();\n    if (!question) return;\n    \n    // Add user message\n    const userMsg: ChatMessage = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: question,\n      timestamp: new Date()\n    };\n    \n    setChatMessages(prev => [...prev, userMsg]);\n    setCustomQuestion('');\n    setIsTyping(true);\n    \n    // Get AI response\n    const aiResponse = await askGemini(question, chatMessages);\n    \n    const botMsg: ChatMessage = {\n      id: (Date.now() + 1).toString(),\n      type: 'bot',\n      content: aiResponse,\n      timestamp: new Date()\n    };\n    \n    setChatMessages(prev => [...prev, botMsg]);\n    setIsTyping(false);\n  };\n\n  const clearChat = () => {\n    setChatMessages([\n      {\n        id: '1',\n        type: 'bot',\n        content: welcomeMessage,\n        timestamp: new Date()\n      }\n    ]);\n  };\n\n  useEffect(() => {\n    if (chatMessagesRef.current) {\n      chatMessagesRef.current.scrollTop = chatMessagesRef.current.scrollHeight;\n    }\n  }, [chatMessages, isTyping]);\n\n  return (\n    <>\n      {/* Floating Button */}\n      <div className=\"fixed bottom-6 right-6 z-40\">\n        <button\n          onClick={() => setIsOpen(true)}\n          className={`relative w-16 h-16 rounded-full shadow-2xl transition-all duration-300 hover:scale-110 ${\n            isDarkMode\n              ? 'bg-gradient-to-br from-blue-600 to-purple-700'\n              : 'bg-gradient-to-br from-blue-500 to-purple-600'\n          }`}\n        >\n          <Bot className=\"text-white mx-auto\" size={28} />\n          <div className=\"absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full\">\n            AI\n          </div>\n        </button>\n      </div>\n\n      {/* Modal */}\n      {isOpen && (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n          <div className={`w-full max-w-2xl h-[80vh] rounded-2xl shadow-2xl flex flex-col ${\n            isDarkMode ? 'bg-slate-800' : 'bg-white'\n          }`}>\n            {/* Header */}\n            <div className={`p-6 border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Bot className={isDarkMode ? 'text-blue-400' : 'text-blue-600'} size={24} />\n                  <div>\n                    <h2 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                      AI Study Assistant\n                    </h2>\n                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                      {GEMINI_API_KEY ? 'âœ… Gemini AI Active' : 'âš ï¸ Limited Mode'}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setIsOpen(false)}\n                  className={`p-2 rounded-lg ${isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-100'}`}\n                >\n                  <X size={20} />\n                </button>\n              </div>\n            </div>\n\n            {/* Tabs */}\n            <div className={`flex border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\n              <button\n                onClick={() => setActiveTab('chat')}\n                className={`flex-1 px-6 py-3 font-medium ${\n                  activeTab === 'chat'\n                    ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'\n                    : isDarkMode ? 'text-slate-300' : 'text-slate-600'\n                }`}\n              >\n                ðŸ’¬ AI Chat\n              </button>\n              <button\n                onClick={() => setActiveTab('faq')}\n                className={`flex-1 px-6 py-3 font-medium ${\n                  activeTab === 'faq'\n                    ? isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'\n                    : isDarkMode ? 'text-slate-300' : 'text-slate-600'\n                }`}\n              >\n                ðŸ“š FAQ\n              </button>\n            </div>\n\n            {/* Chat Tab */}\n            {activeTab === 'chat' && (\n              <div className=\"flex flex-col flex-1 min-h-0\">\n                {/* Messages */}\n                <div \n                  ref={chatMessagesRef}\n                  className=\"flex-1 overflow-y-auto p-4 space-y-4\"\n                >\n                  {chatMessages.map((msg) => (\n                    <div\n                      key={msg.id}\n                      className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}\n                    >\n                      <div\n                        className={`max-w-[80%] p-3 rounded-lg ${\n                          msg.type === 'user'\n                            ? 'bg-blue-500 text-white'\n                            : isDarkMode ? 'bg-slate-700 text-slate-200' : 'bg-slate-100 text-slate-800'\n                        }`}\n                      >\n                        {msg.type === 'bot' && (\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <Bot size={16} />\n                            <span className=\"text-xs font-medium\">AI Assistant</span>\n                          </div>\n                        )}\n                        <div className=\"whitespace-pre-line text-sm\">{msg.content}</div>\n                        <div className=\"text-xs mt-2 opacity-70\">\n                          {msg.timestamp.toLocaleTimeString()}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                  \n                  {isTyping && (\n                    <div className=\"flex justify-start\">\n                      <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-700' : 'bg-slate-100'}`}>\n                        <div className=\"flex gap-1\">\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\"></div>\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Input */}\n                <div className={`p-4 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\n                  <button\n                    onClick={clearChat}\n                    className={`text-xs px-3 py-1 rounded mb-2 ${\n                      isDarkMode ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'\n                    }`}\n                  >\n                    Clear Chat\n                  </button>\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"text\"\n                      placeholder=\"Ask me anything...\"\n                      value={customQuestion}\n                      onChange={(e) => setCustomQuestion(e.target.value)}\n                      onKeyPress={(e) => e.key === 'Enter' && !isTyping && handleSubmitQuestion()}\n                      disabled={isTyping}\n                      className={`flex-1 px-3 py-2 rounded-lg border ${\n                        isDarkMode\n                          ? 'bg-slate-700 border-slate-600 text-white'\n                          : 'bg-slate-50 border-slate-200 text-slate-900'\n                      } focus:outline-none focus:ring-2 focus:ring-blue-500`}\n                    />\n                    <button\n                      onClick={handleSubmitQuestion}\n                      disabled={!customQuestion.trim() || isTyping}\n                      className=\"px-4 py-2 bg-blue-500 text-white rounded-lg disabled:opacity-50\"\n                    >\n                      <Send size={16} />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* FAQ Tab */}\n            {activeTab === 'faq' && (\n              <div className=\"flex-1 overflow-y-auto p-4\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Search FAQs...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className={`w-full px-4 py-2 rounded-lg border mb-4 ${\n                    isDarkMode\n                      ? 'bg-slate-700 border-slate-600 text-white'\n                      : 'bg-white border-slate-200 text-slate-900'\n                  }`}\n                />\n                \n                <div className=\"space-y-4\">\n                  {filteredFAQs.map((faq) => {\n                    const Icon = faq.icon;\n                    return (\n                      <div\n                        key={faq.id}\n                        className={`p-4 rounded-lg ${\n                          isDarkMode ? 'bg-slate-700' : 'bg-slate-50'\n                        }`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <Icon size={20} className=\"text-blue-500 mt-1\" />\n                          <div>\n                            <h3 className={`font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                              {faq.question}\n                            </h3>\n                            <p className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\n                              {faq.answer}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ExamCountdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\FriendsCircle.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Zap' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[879,882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[879,882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onStartChat' is defined but never used.","line":17,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1145,1148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1145,1148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1693,1696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1693,1696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2534,2537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2534,2537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2597,2600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2597,2600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3012,3015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3012,3015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3745,3748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3745,3748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3904,3907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3904,3907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4041,4044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4041,4044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4362,4365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4362,4365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5387,5390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5387,5390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":131,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":27},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":131,"column":29,"nodeType":"BlockStatement","messageId":"unexpected","endLine":131,"endColumn":32,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7978,7979],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":133,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":133,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":133,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8018,8019],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadData', 'loadUnreadCounts', and 'playIncomingCallSound'. Either include them or remove the dependency array.","line":169,"column":8,"nodeType":"ArrayExpression","endLine":169,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, loadUnreadCounts, playIncomingCallSound, user]","fix":{"range":[9419,9425],"text":"[loadData, loadUnreadCounts, playIncomingCallSound, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedChat'. Either include it or remove the dependency array.","line":180,"column":8,"nodeType":"ArrayExpression","endLine":180,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [selectedChat, selectedChat.id]","fix":{"range":[9738,9756],"text":"[selectedChat, selectedChat.id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10679,10682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10679,10682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11225,11228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11225,11228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12256,12259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12256,12259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15915,15918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15915,15918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15960,15963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15960,15963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16070,16073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16070,16073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":471,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":471,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26446,26449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26446,26449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":472,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26621,26624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26621,26624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":472,"column":168,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":171,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26680,26683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26680,26683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":589,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":589,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36759,36762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36759,36762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":28,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from 'react';\nimport { createPortal } from 'react-dom';\nimport { Users, Zap, Trophy, MessageCircle, UserPlus, Video, Search, Loader2, X, Check, UserCheck, Plus, LayoutGrid, GraduationCap, Phone, Flame, Clock, BookOpen, Calendar, Brain, MapPin, Target } from 'lucide-react';\nimport { ChatBox } from './ChatBox';\nimport { Friend, UserProfile, Group } from '../types';\nimport { fetchFriends, searchUsers, sendFriendRequest, fetchUnreadCounts, subscribeToNotifications, fetchUserGroups, createGroup, fetchSessionRequests, fetchGroupMembers } from '../utils/supabase-queries';\nimport { useAuth } from '../contexts/AuthContext';\nimport { supabase } from '../utils/supabase';\n\ninterface FriendsCircleProps {\n    isDarkMode: boolean;\n    onStartVideoCall: (name: string, avatar?: string, friendId?: string) => void;\n    onStartChat?: (friend: any) => void;\n    userRole?: 'student' | 'mentor';\n}\n\nexport function FriendsCircle({ isDarkMode, onStartVideoCall, onStartChat, userRole }: FriendsCircleProps) {\n    const [selectedChat, setSelectedChat] = useState<any | null>(null);\n\n    const openChat = (friend: any) => {\n        // Immediately clear unread count for this friend\n        setUnreadCounts(prev => {\n            const next = { ...prev };\n            delete next[friend.id];\n            return next;\n        });\n        setSelectedChat(friend);\n    };\n    const { user } = useAuth();\n    const [activeTab, setActiveTab] = useState<'friends' | 'groups' | 'mentors'>('friends');\n    const [friends, setFriends] = useState<Friend[]>([]);\n    const [groups, setGroups] = useState<Group[]>([]);\n    const [mentorSessions, setMentorSessions] = useState<any[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [showAddFriend, setShowAddFriend] = useState(false);\n    const [showCreateGroup, setShowCreateGroup] = useState(false);\n    const [searchQuery, setSearchQuery] = useState('');\n    const [searchResults, setSearchResults] = useState<UserProfile[]>([]);\n    const [searching, setSearching] = useState(false);\n    const [requestSent, setRequestSent] = useState<string[]>([]);\n    const [error, setError] = useState<string | null>(null);\n    const [unreadCounts, setUnreadCounts] = useState<Record<string, number>>({});\n    const [activeCalls, setActiveCalls] = useState<string[]>([]);\n    const [groupMemberCounts, setGroupMemberCounts] = useState<Record<string, number>>({});\n    const [myStreak, setMyStreak] = useState(0);\n    const [myProfile, setMyProfile] = useState<any>(null);\n    const [profileCard, setProfileCard] = useState<any>(null);\n    const [profileCardLoading, setProfileCardLoading] = useState(false);\n    const [imagePreview, setImagePreview] = useState<string | null>(null);\n\n    const formatTime = (mins: number) => {\n        if (mins < 60) return `${mins}m`;\n        const h = Math.floor(mins / 60);\n        const m = mins % 60;\n        return m > 0 ? `${h}h ${m}m` : `${h}h`;\n    };\n\n    const openProfileCard = async (friend: any) => {\n        if (friend.isGroup) return;\n        setProfileCardLoading(true);\n        setProfileCard({ id: friend.id, name: friend.name, avatarUrl: friend.avatarUrl && !friend.avatarUrl.includes('ui-avatars.com') ? friend.avatarUrl : null, username: friend.username, role: friend.role, studyStreak: 0 });\n        try {\n            const { data: profile } = await supabase.from('user_profiles').select('*').eq('user_id', friend.id).single();\n            const { data: sessions } = await supabase.from('study_sessions').select('duration_minutes, start_time, created_at, focus_rating, subject_id').eq('user_id', friend.id).order('start_time', { ascending: false });\n            const totalMinutes = sessions?.reduce((s: number, r: any) => s + (r.duration_minutes || 0), 0) || 0;\n            const totalSessions = sessions?.length || 0;\n            const focusRatings = sessions?.filter((s: any) => s.focus_rating > 0) || [];\n            const avgFocus = focusRatings.length > 0 ? Math.round((focusRatings.reduce((a: number, s: any) => a + s.focus_rating, 0) / focusRatings.length) * 10) / 10 : 0;\n            // Compute streak using the same algorithm as computeStreak helper\n            let streak = 0;\n            if (sessions && sessions.length > 0) {\n                const sessionDates = new Set<number>();\n                sessions.forEach((s: any) => { const d = new Date(s.start_time || s.created_at); d.setHours(0, 0, 0, 0); sessionDates.add(d.getTime()); });\n                const check = new Date(); check.setHours(0, 0, 0, 0);\n                if (sessionDates.has(check.getTime())) {\n                    streak = 1; check.setDate(check.getDate() - 1);\n                } else {\n                    check.setDate(check.getDate() - 1);\n                    if (sessionDates.has(check.getTime())) { streak = 1; check.setDate(check.getDate() - 1); }\n                }\n                while (streak > 0 && sessionDates.has(check.getTime())) { streak++; check.setDate(check.getDate() - 1); }\n            }\n            // Prefer real DB avatar_url; skip generated ui-avatars.com ones\n            const dbAvatar = profile?.avatar_url && !profile.avatar_url.includes('ui-avatars.com') ? profile.avatar_url : null;\n            const contactAvatar = friend.avatarUrl && !friend.avatarUrl.includes('ui-avatars.com') ? friend.avatarUrl : null;\n            setProfileCard((prev: any) => prev ? ({\n                ...prev,\n                bio: profile?.bio || '',\n                role: profile?.role || friend.role || 'student',\n                profession: profile?.profession || '',\n                experience: profile?.experience || '',\n                joined: profile?.created_at ? new Date(profile.created_at).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : '',\n                totalMinutes,\n                totalSessions,\n                studyStreak: streak,\n                avgFocus,\n                location: profile?.location || profile?.city || '',\n                username: profile?.username || friend.username || '',\n                avatarUrl: dbAvatar || contactAvatar || null,\n            }) : null);\n        } catch (err) { console.error('Error loading profile card:', err); }\n        finally { setProfileCardLoading(false); }\n    };\n\n    // Incoming call sound â€” plays real audio file, falls back to Web Audio API\n    const playIncomingCallSound = useCallback(() => {\n        const masterEnabled = localStorage.getItem('grind_clock_sound_enabled');\n        if (masterEnabled === 'false') return;\n        const callEnabled = localStorage.getItem('grind_clock_incoming_call_sound');\n        if (callEnabled === 'false') return;\n        const vol = parseFloat(localStorage.getItem('grind_clock_sound_volume') || '0.7');\n        try {\n            const a = new Audio('https://cdn.pixabay.com/audio/2022/10/30/audio_f3f8e5a830.mp3');\n            a.volume = vol;\n            a.play().catch(() => {\n                // Web Audio API fallback\n                try {\n                    const ctx = new AudioContext();\n                    const playPulse = (offset: number) => {\n                        const osc = ctx.createOscillator();\n                        const gain = ctx.createGain();\n                        osc.connect(gain); gain.connect(ctx.destination);\n                        osc.frequency.setValueAtTime(440, ctx.currentTime + offset);\n                        osc.frequency.setValueAtTime(520, ctx.currentTime + offset + 0.15);\n                        osc.frequency.setValueAtTime(440, ctx.currentTime + offset + 0.30);\n                        gain.gain.setValueAtTime(vol * 0.4, ctx.currentTime + offset);\n                        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + offset + 0.5);\n                        osc.start(ctx.currentTime + offset); osc.stop(ctx.currentTime + offset + 0.5);\n                    };\n                    playPulse(0); playPulse(0.7); playPulse(1.4);\n                } catch (_) { }\n            });\n        } catch (_) { }\n    }, []);\n\n    // Create Group State\n    const [newGroupName, setNewGroupName] = useState('');\n    const [creatingGroup, setCreatingGroup] = useState(false);\n\n    useEffect(() => {\n        if (user) {\n            loadData();\n            loadUnreadCounts();\n\n            // Subscribe to notifications for real-time updates\n            const sub = subscribeToNotifications(user.id, (notif) => {\n                if (notif.type === 'message' || notif.type === 'group_message') {\n                    loadUnreadCounts();\n                } else if (notif.type === 'call') {\n                    setActiveCalls(prev => [...prev, notif.sender_id]);\n                    playIncomingCallSound();\n                    // Auto-remove call indicator after 30 seconds\n                    setTimeout(() => {\n                        setActiveCalls(prev => prev.filter(id => id !== notif.sender_id));\n                    }, 30000);\n                } else if (notif.type === 'group_invite' || notif.type === 'group_remove') {\n                    // Reload groups when added/removed from a group\n                    loadData();\n                } else if (notif.type === 'friend_request') {\n                    // Reload friends list for new friend requests\n                    loadData();\n                }\n            });\n\n            return () => {\n                sub.unsubscribe();\n            };\n        }\n    }, [user]);\n\n    // Immediately clear unread count when switching chats via sidebar\n    useEffect(() => {\n        if (selectedChat) {\n            setUnreadCounts(prev => {\n                const next = { ...prev };\n                delete next[selectedChat.id];\n                return next;\n            });\n        }\n    }, [selectedChat?.id]);\n\n    // Listen for notifications-read events from other components (e.g. ChatBox, NotificationCenter)\n    useEffect(() => {\n        const handler = async () => {\n            if (!user) return;\n            const counts = await fetchUnreadCounts(user.id);\n            setUnreadCounts(counts);\n        };\n        window.addEventListener('notifications-read', handler);\n        return () => window.removeEventListener('notifications-read', handler);\n    }, [user]);\n\n    const loadData = async () => {\n        setLoading(true);\n        const [friendsData, groupsData] = await Promise.all([\n            fetchFriends(user!.id),\n            fetchUserGroups(user!.id)\n        ]);\n        setFriends(friendsData);\n        setGroups(groupsData);\n\n        // Load group member counts\n        if (groupsData.length > 0) {\n            const counts: Record<string, number> = {};\n            await Promise.all(groupsData.map(async (g: any) => {\n                try {\n                    const members = await fetchGroupMembers(g.id);\n                    counts[g.id] = members.length;\n                } catch {\n                    counts[g.id] = 0;\n                }\n            }));\n            setGroupMemberCounts(counts);\n        }\n\n        // Load mentor sessions (accepted/upcoming sessions with mentors)\n        try {\n            const sessions = await fetchSessionRequests(user!.id, 'student');\n            const activeMentorSessions = sessions.filter(\n                (s: any) => s.status === 'accepted' || s.status === 'pending'\n            );\n            setMentorSessions(activeMentorSessions);\n        } catch (err) {\n            console.error('Error loading mentor sessions:', err);\n        }\n\n        // Load current user's streak from user_profiles or compute from study_sessions\n        try {\n            const { data: myProf } = await supabase.from('user_profiles').select('full_name, avatar_url, username, study_streak').eq('user_id', user!.id).single();\n            if (myProf) {\n                setMyProfile(myProf);\n                // Always compute streak from study_sessions (same algorithm as Dashboard's calculateStreak, using getTime for local timezone)\n                const { data: sess } = await supabase.from('study_sessions').select('start_time, created_at').eq('user_id', user!.id).order('start_time', { ascending: false }).limit(90);\n                if (sess && sess.length > 0) {\n                    const sessionDates = new Set<number>();\n                    sess.forEach((s: any) => { const d = new Date(s.start_time || s.created_at); d.setHours(0, 0, 0, 0); sessionDates.add(d.getTime()); });\n                    let st = 0; const ch = new Date(); ch.setHours(0, 0, 0, 0);\n                    if (sessionDates.has(ch.getTime())) { st = 1; ch.setDate(ch.getDate() - 1); } else { ch.setDate(ch.getDate() - 1); if (sessionDates.has(ch.getTime())) { st = 1; ch.setDate(ch.getDate() - 1); } }\n                    while (st > 0 && sessionDates.has(ch.getTime())) { st++; ch.setDate(ch.getDate() - 1); }\n                    setMyStreak(st);\n                } else {\n                    setMyStreak(0);\n                }\n            }\n        } catch { /* ignore */ }\n\n        setLoading(false);\n    };\n\n    const loadUnreadCounts = async () => {\n        if (!user) return;\n        const counts = await fetchUnreadCounts(user.id);\n        setUnreadCounts(counts);\n    };\n\n    const handleSearch = async () => {\n        if (!searchQuery.trim() || !user) return;\n        setSearching(true);\n        setError(null);\n        try {\n            const results = await searchUsers(searchQuery, user.id);\n            setSearchResults(results);\n            if (results.length === 0) {\n                setError('No users found matching your search.');\n            }\n        } catch (err) {\n            console.error('Search error:', err);\n            setError('Failed to search users. Please check your database permissions.');\n        } finally {\n            setSearching(false);\n        }\n    };\n\n    const handleSendRequest = async (friendId: string) => {\n        if (!user) return;\n        setError(null);\n        const { error: reqError } = await sendFriendRequest(user.id, friendId);\n        if (!reqError) {\n            setRequestSent(prev => [...prev, friendId]);\n        } else {\n            console.error('Friend request error details:', reqError);\n            setError(reqError.message || 'Failed to send friend request. Please try again.');\n        }\n    };\n\n    const handleCreateGroup = async () => {\n        if (!newGroupName.trim() || !user) return;\n        setCreatingGroup(true);\n        setError('');\n\n        try {\n            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(newGroupName)}&background=random`;\n            const { data, error } = await createGroup(newGroupName, avatarUrl, user.id);\n\n            if (error) {\n                console.error('Error creating group:', error);\n                setError('Failed to create group.');\n            } else if (data) {\n                setGroups(prev => [...prev, data]);\n                setShowCreateGroup(false);\n                setNewGroupName('');\n            } else {\n                setError('Failed to create group. No data returned.');\n            }\n        } catch (err) {\n            console.error('Unexpected error creating group:', err);\n            setError('An unexpected error occurred.');\n        } finally {\n            setCreatingGroup(false);\n        }\n    };\n\n\n\n    if (loading) {\n        return (\n            <div className=\"flex flex-col items-center justify-center py-20\">\n                <Loader2 className=\"w-12 h-12 text-amber-500 animate-spin mb-4\" />\n                <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>Loading friends...</p>\n            </div>\n        );\n    }\n\n    /* â”€â”€â”€ If a chat is selected, render ChatBox full-width â”€â”€â”€ */\n    if (selectedChat) {\n        return (\n            <div className=\"h-[calc(100vh-200px)] min-h-[400px] sticky top-0\">\n                <ChatBox\n                    key={selectedChat.id}\n                    friend={selectedChat}\n                    friends={friends as any[]}\n                    groups={groups as any[]}\n                    onClose={() => { setSelectedChat(null); }}\n                    onSelectFriend={(f: any) => setSelectedChat(f)}\n                    onStartVideoCall={onStartVideoCall}\n                    isDarkMode={isDarkMode}\n                    unreadCounts={unreadCounts}\n                />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h2 className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Friends Circle</h2>\n                    <p className={`${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Study together and stay motivated</p>\n                </div>\n                <div className=\"flex gap-2\">\n                    <button\n                        onClick={() => setShowCreateGroup(true)}\n                        className={`flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition-all ${isDarkMode ? 'bg-slate-800 text-white hover:bg-slate-700' : 'bg-white text-slate-700 hover:bg-slate-50 border border-slate-200'}`}\n                    >\n                        <Plus size={20} />\n                        New Group\n                    </button>\n                    <button\n                        onClick={() => setShowAddFriend(true)}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-bold shadow-md hover:shadow-lg transition-all\"\n                    >\n                        <UserPlus size={20} />\n                        Add Friend\n                    </button>\n                </div>\n            </div>\n\n            {/* Tabs */}\n            <div className=\"flex gap-4 border-b border-slate-700/50\">\n                <button\n                    onClick={() => setActiveTab('friends')}\n                    className={`pb-4 px-2 font-bold transition-all relative ${activeTab === 'friends' ? 'text-amber-500' : 'text-slate-500 hover:text-slate-400'}`}\n                >\n                    <span className=\"flex items-center gap-1.5\">\n                        <Users size={16} />\n                        Friends\n                    </span>\n                    {activeTab === 'friends' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-amber-500 rounded-full\" />}\n                </button>\n                <button\n                    onClick={() => setActiveTab('groups')}\n                    className={`pb-4 px-2 font-bold transition-all relative ${activeTab === 'groups' ? 'text-amber-500' : 'text-slate-500 hover:text-slate-400'}`}\n                >\n                    <span className=\"flex items-center gap-1.5\">\n                        <LayoutGrid size={16} />\n                        Groups\n                    </span>\n                    {activeTab === 'groups' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-amber-500 rounded-full\" />}\n                </button>\n                {userRole !== 'mentor' && (\n                    <button\n                        onClick={() => setActiveTab('mentors')}\n                        className={`pb-4 px-2 font-bold transition-all relative ${activeTab === 'mentors' ? 'text-amber-500' : 'text-slate-500 hover:text-slate-400'}`}\n                    >\n                        <span className=\"flex items-center gap-1.5\">\n                            <GraduationCap size={16} />\n                            Mentors\n                            {mentorSessions.length > 0 && (\n                                <span className=\"px-1.5 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded-full\">\n                                    {mentorSessions.length}\n                                </span>\n                            )}\n                        </span>\n                        {activeTab === 'mentors' && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-amber-500 rounded-full\" />}\n                    </button>\n                )}\n            </div>\n\n            <div className={`grid grid-cols-1 ${userRole !== 'mentor' ? 'lg:grid-cols-3' : ''} gap-6`}>\n                {/* Main List */}\n                <div className={`${userRole !== 'mentor' ? 'lg:col-span-2' : ''} space-y-4`}>\n                    <div className={`rounded-2xl p-6 shadow-md border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n                        <h3 className={`text-xl font-bold mb-4 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                            {activeTab === 'friends' ? <Users size={20} className=\"text-amber-500\" /> : activeTab === 'groups' ? <LayoutGrid size={20} className=\"text-amber-500\" /> : <GraduationCap size={20} className=\"text-amber-500\" />}\n                            {activeTab === 'friends' ? 'Your Friends' : activeTab === 'groups' ? 'Your Groups' : 'Mentor Sessions'}\n                        </h3>\n                        <div className=\"space-y-4\">\n                            {activeTab === 'friends' ? (\n                                friends.length > 0 ? (\n                                    friends.map(friend => (\n                                        <div\n                                            key={friend.id}\n                                            onClick={() => openChat(friend)}\n                                            className={`flex items-center justify-between p-4 rounded-xl transition-all cursor-pointer ${unreadCounts[friend.id] > 0\n                                                ? 'bg-gradient-to-r from-purple-500/15 via-blue-500/10 to-purple-500/5 border border-purple-500/30 shadow-sm shadow-purple-500/10'\n                                                : isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-50'\n                                                }`}\n                                        >\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"relative cursor-pointer\" onClick={(e) => { e.stopPropagation(); openProfileCard(friend); }}>\n                                                    <img\n                                                        src={friend.avatarUrl}\n                                                        alt={friend.name}\n                                                        className={`w-12 h-12 rounded-full object-cover border-2 ${activeCalls.includes(friend.id)\n                                                            ? 'border-green-500 ring-2 ring-green-400/50 ring-offset-2 ring-offset-transparent animate-pulse'\n                                                            : unreadCounts[friend.id] > 0\n                                                                ? 'border-purple-500/60 ring-2 ring-purple-400/30'\n                                                                : 'border-amber-500/20'\n                                                            }`}\n                                                    />\n                                                    <div className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 ${isDarkMode ? 'border-slate-800' : 'border-white'\n                                                        } ${friend.status === 'studying' ? 'bg-blue-500' :\n                                                            friend.status === 'online' ? 'bg-green-500' : 'bg-slate-400'\n                                                        }`} />\n                                                </div>\n                                                <div>\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <h4 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{friend.name}</h4>\n                                                        {friend.role === 'mentor' && (\n                                                            <span className={`text-[9px] px-1.5 py-0.5 rounded font-bold uppercase tracking-wider ${isDarkMode ? 'bg-purple-500/20 text-purple-400 border border-purple-500/30' : 'bg-purple-50 text-purple-600 border border-purple-200'}`}>\n                                                                Mentor\n                                                            </span>\n                                                        )}\n                                                        {unreadCounts[friend.id] > 0 && (\n                                                            <div className=\"flex items-center gap-1.5 bg-gradient-to-r from-purple-500/20 to-blue-500/20 text-purple-400 text-[10px] font-bold px-2.5 py-0.5 rounded-full border border-purple-500/30 animate-pulse\">\n                                                                <span className=\"relative flex h-2 w-2\">\n                                                                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-purple-400 opacity-75\"></span>\n                                                                    <span className=\"relative inline-flex rounded-full h-2 w-2 bg-gradient-to-r from-purple-500 to-blue-500\"></span>\n                                                                </span>\n                                                                {unreadCounts[friend.id]} New\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                    <p className={`text-xs ${activeCalls.includes(friend.id) ? 'text-green-500 font-bold' : isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                                        {activeCalls.includes(friend.id) ? (\n                                                            <span className=\"flex items-center gap-1.5 animate-pulse\">\n                                                                <Phone size={12} className=\"animate-bounce\" />\n                                                                <span>Incoming Call...</span>\n                                                            </span>\n                                                        ) :\n                                                            friend.status === 'studying' ? `@${(friend as any).username || 'unknown'} Â· Studying ${friend.currentSubject}` :\n                                                                friend.status === 'online' ? `@${(friend as any).username || 'unknown'} Â· Active now` : `@${(friend as any).username || 'unknown'} Â· Offline`}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                            <div className=\"flex items-center gap-4\">\n                                                {/* Only show streaks for student friends, not mentors */}\n                                                {friend.role !== 'mentor' && (\n                                                    <div className=\"text-right\">\n                                                        <div className={`flex items-center gap-1 font-bold ${friend.studyStreak > 0 ? 'text-orange-500' : 'text-slate-400'}`}>\n                                                            <Flame size={14} className={friend.studyStreak > 0 ? 'text-orange-500' : 'text-slate-400'} />\n                                                            <span>{friend.studyStreak}</span>\n                                                        </div>\n                                                        <p className=\"text-[10px] text-slate-500 uppercase font-bold tracking-wider\">Streak</p>\n                                                    </div>\n                                                )}\n                                                <div className=\"flex gap-2\">\n                                                    <button\n                                                        onClick={(e) => { e.stopPropagation(); openChat(friend); }}\n                                                        className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                                                            }`}\n                                                        title=\"Send Message\"\n                                                    >\n                                                        <MessageCircle size={18} />\n                                                    </button>\n                                                    <button\n                                                        onClick={(e) => { e.stopPropagation(); onStartVideoCall(friend.name, friend.avatarUrl, friend.id); }}\n                                                        className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-blue-400 hover:bg-slate-600' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'\n                                                            }`}\n                                                        title=\"Start Video Call\"\n                                                    >\n                                                        <Video size={18} />\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ))\n                                ) : (\n                                    <div className=\"text-center py-8\">\n                                        <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No friends yet. Add some to start studying together!</p>\n                                    </div>\n                                )\n                            ) : activeTab === 'groups' ? (\n                                // Groups List\n                                groups.length > 0 ? (\n                                    groups.map(group => (\n                                        <div\n                                            key={group.id}\n                                            onClick={() => openChat({ ...group, isGroup: true })}\n                                            className={`flex items-center justify-between p-4 rounded-xl transition-all cursor-pointer ${unreadCounts[group.id] > 0\n                                                ? 'bg-gradient-to-r from-purple-500/15 via-blue-500/10 to-purple-500/5 border border-purple-500/30 shadow-sm shadow-purple-500/10'\n                                                : isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-50'\n                                                }`}\n                                        >\n                                            <div className=\"flex items-center gap-4\">\n                                                {group.avatarUrl ? (\n                                                    <img\n                                                        src={group.avatarUrl}\n                                                        alt={group.name}\n                                                        className={`w-12 h-12 rounded-xl object-cover border-2 ${unreadCounts[group.id] > 0\n                                                            ? 'border-purple-500/60 ring-2 ring-purple-400/30'\n                                                            : 'border-amber-500/20'\n                                                            }`}\n                                                    />\n                                                ) : (\n                                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-lg font-bold text-white bg-gradient-to-br from-amber-500 to-orange-500 border-2 ${unreadCounts[group.id] > 0\n                                                        ? 'border-purple-500/60 ring-2 ring-purple-400/30'\n                                                        : 'border-amber-500/20'\n                                                        }`}>\n                                                        {group.name.charAt(0).toUpperCase()}\n                                                    </div>\n                                                )}\n                                                <div>\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <h4 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{group.name}</h4>\n                                                        {unreadCounts[group.id] > 0 && (\n                                                            <div className=\"flex items-center gap-1.5 bg-gradient-to-r from-purple-500/20 to-blue-500/20 text-purple-400 text-[10px] font-bold px-2.5 py-0.5 rounded-full border border-purple-500/30 animate-pulse\">\n                                                                <span className=\"relative flex h-2 w-2\">\n                                                                    <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-purple-400 opacity-75\"></span>\n                                                                    <span className=\"relative inline-flex rounded-full h-2 w-2 bg-gradient-to-r from-purple-500 to-blue-500\"></span>\n                                                                </span>\n                                                                {unreadCounts[group.id]} New\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                    <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                                        {groupMemberCounts[group.id]\n                                                            ? `${groupMemberCounts[group.id]} members`\n                                                            : 'Group Chat'}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                            <div className=\"flex gap-2\">\n                                                <button\n                                                    onClick={(e) => { e.stopPropagation(); openChat({ ...group, isGroup: true }); }}\n                                                    className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}\n                                                    title=\"Open Group Chat\"\n                                                >\n                                                    <MessageCircle size={18} />\n                                                </button>\n                                                <button\n                                                    onClick={(e) => { e.stopPropagation(); onStartVideoCall(group.name, group.avatarUrl, group.id); }}\n                                                    className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-blue-400 hover:bg-slate-600' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'}`}\n                                                    title=\"Start Video Call\"\n                                                >\n                                                    <Video size={18} />\n                                                </button>\n                                            </div>\n                                        </div>\n                                    ))\n                                ) : (\n                                    <div className=\"text-center py-8\">\n                                        <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No groups yet. Create one to chat with multiple friends!</p>\n                                    </div>\n                                )\n                            ) : (\n                                // Mentors Tab - Active mentor sessions\n                                mentorSessions.length > 0 ? (\n                                    mentorSessions.map((session: any) => (\n                                        <div\n                                            key={session.id}\n                                            onClick={() => openChat({\n                                                id: session.mentorId,\n                                                name: session.mentorProfile?.fullName || 'Mentor',\n                                                avatarUrl: session.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=Mentor&background=random`,\n                                                status: 'online',\n                                                isMentor: true\n                                            })}\n                                            className={`flex items-center justify-between p-4 rounded-xl transition-all cursor-pointer ${isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-50'}`}\n                                        >\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"relative\">\n                                                    <img\n                                                        src={session.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=Mentor&background=random`}\n                                                        alt={session.mentorProfile?.fullName || 'Mentor'}\n                                                        className=\"w-12 h-12 rounded-full object-cover border-2 border-purple-500/30\"\n                                                    />\n                                                    <div className={`absolute -top-1 -right-1 p-0.5 rounded-full ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\n                                                        <GraduationCap size={14} className=\"text-purple-500\" />\n                                                    </div>\n                                                </div>\n                                                <div>\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <h4 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                                            {session.mentorProfile?.fullName || 'Mentor'}\n                                                        </h4>\n                                                        <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold ${session.status === 'accepted'\n                                                            ? 'bg-green-500/10 text-green-500 border border-green-500/20'\n                                                            : 'bg-amber-500/10 text-amber-500 border border-amber-500/20'\n                                                            }`}>\n                                                            {session.status === 'accepted' ? 'Active' : 'Pending'}\n                                                        </span>\n                                                    </div>\n                                                    <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                                        {session.topic}\n                                                    </p>\n                                                    {session.preferredDate && (\n                                                        <p className={`text-[10px] mt-0.5 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                                            ðŸ“… {session.preferredDate} {session.preferredTime && `at ${session.preferredTime}`}\n                                                        </p>\n                                                    )}\n                                                </div>\n                                            </div>\n                                            <div className=\"flex gap-2\">\n                                                <button\n                                                    onClick={(e) => {\n                                                        e.stopPropagation();\n                                                        openChat({\n                                                            id: session.mentorId,\n                                                            name: session.mentorProfile?.fullName || 'Mentor',\n                                                            avatarUrl: session.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=Mentor&background=random`,\n                                                            status: 'online',\n                                                            isMentor: true\n                                                        });\n                                                    }}\n                                                    className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-purple-400 hover:bg-slate-600' : 'bg-purple-50 text-purple-600 hover:bg-purple-100'}`}\n                                                    title=\"Chat with Mentor\"\n                                                >\n                                                    <MessageCircle size={18} />\n                                                </button>\n                                                <button\n                                                    onClick={(e) => {\n                                                        e.stopPropagation();\n                                                        onStartVideoCall(\n                                                            session.mentorProfile?.fullName || 'Mentor',\n                                                            session.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=Mentor&background=random`,\n                                                            session.mentorId\n                                                        );\n                                                    }}\n                                                    className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-blue-400 hover:bg-slate-600' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'}`}\n                                                    title=\"Video Call Mentor\"\n                                                >\n                                                    <Video size={18} />\n                                                </button>\n                                            </div>\n                                        </div>\n                                    ))\n                                ) : (\n                                    <div className=\"text-center py-8\">\n                                        <GraduationCap className={`mx-auto mb-2 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={40} />\n                                        <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No active mentor sessions</p>\n                                        <p className={`text-sm mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Book a session with a mentor to see them here</p>\n                                    </div>\n                                )\n                            )}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Sidebar Stats */}\n                {userRole !== 'mentor' && (\n                    <div className=\"space-y-6\">\n                        <div className={`rounded-2xl p-6 shadow-md border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n                            <h3 className={`text-lg font-bold mb-4 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                <Trophy size={20} className=\"text-amber-500\" />\n                                Leaderboard\n                            </h3>\n                            <div className=\"space-y-3\">\n                                {(() => {\n                                    // Build leaderboard: friends + current user\n                                    const entries = [\n                                        ...friends.filter(f => f.role !== 'mentor').map(f => ({ id: f.id, name: f.name, avatarUrl: f.avatarUrl, streak: f.studyStreak, isMe: false })),\n                                        ...(user && myProfile ? [{ id: user.id, name: myProfile.full_name || 'You', avatarUrl: myProfile.avatar_url || `https://ui-avatars.com/api/?name=You&background=random`, streak: myStreak, isMe: true }] : [])\n                                    ].sort((a, b) => b.streak - a.streak);\n\n                                    return entries.length > 0 ? entries.map((entry, idx) => (\n                                        <div key={entry.id} className={`flex items-center gap-3 p-2 rounded-xl transition-all ${entry.isMe ? (isDarkMode ? 'bg-amber-500/10 border border-amber-500/20' : 'bg-amber-50 border border-amber-100') : ''}`}>\n                                            <span className={`w-6 text-sm font-bold ${idx === 0 ? 'text-amber-500' : idx === 1 ? 'text-slate-400' : idx === 2 ? 'text-orange-400' : 'text-slate-500'}`}>\n                                                #{idx + 1}\n                                            </span>\n                                            <img src={entry.avatarUrl} alt=\"\" className=\"w-8 h-8 rounded-full object-cover\" />\n                                            <span className={`flex-1 text-sm font-medium truncate ${entry.isMe ? 'text-amber-500 font-bold' : isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                                                {entry.isMe ? `${entry.name} (You)` : entry.name}\n                                            </span>\n                                            <span className={`flex items-center gap-1 text-sm font-bold ${entry.streak > 0 ? 'text-orange-500' : isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                                <Flame size={14} className={entry.streak > 0 ? 'text-orange-500' : isDarkMode ? 'text-slate-600' : 'text-slate-300'} />\n                                                {entry.streak}\n                                            </span>\n                                        </div>\n                                    )) : (\n                                        <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>No data available</p>\n                                    );\n                                })()}\n                            </div>\n                        </div>\n\n\n                    </div>\n                )}\n            </div>\n\n            {/* Add Friend Modal */}\n            {showAddFriend && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\n                    <div className={`w-full max-w-md rounded-3xl shadow-2xl border overflow-hidden animate-fade-in ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'\n                        }`}>\n                        <div className=\"p-6 border-b border-slate-800/50 flex items-center justify-between bg-gradient-to-r from-amber-500/10 to-transparent\">\n                            <h3 className={`text-xl font-bold flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                <UserPlus className=\"text-amber-500\" />\n                                Add New Friend\n                            </h3>\n                            <button\n                                onClick={() => {\n                                    setShowAddFriend(false);\n                                    setSearchQuery('');\n                                    setSearchResults([]);\n                                }}\n                                className={`p-2 rounded-full transition-all ${isDarkMode ? 'hover:bg-slate-800 text-slate-400' : 'hover:bg-slate-100 text-slate-500'\n                                    }`}\n                            >\n                                <X size={20} />\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 space-y-6\">\n                            {error && (\n                                <div className={`p-3 rounded-xl text-sm font-medium animate-fade-in ${isDarkMode ? 'bg-red-500/10 text-red-400 border border-red-500/20' : 'bg-red-50 text-red-600 border border-red-100'\n                                    }`}>\n                                    {error}\n                                </div>\n                            )}\n                            <div className=\"relative\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                                <input\n                                    type=\"text\"\n                                    placeholder=\"Search by username or name...\"\n                                    value={searchQuery}\n                                    onChange={(e) => setSearchQuery(e.target.value)}\n                                    onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                                    className={`w-full pl-10 pr-4 py-3 rounded-xl border transition-all ${isDarkMode\n                                        ? 'bg-slate-800 border-slate-700 text-white focus:border-amber-500'\n                                        : 'bg-slate-50 border-slate-200 text-slate-900 focus:border-amber-500'\n                                        }`}\n                                />\n                                <button\n                                    onClick={handleSearch}\n                                    disabled={searching}\n                                    className=\"absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-amber-500 text-white rounded-lg text-sm font-bold hover:bg-amber-600 transition-all disabled:opacity-50\"\n                                >\n                                    {searching ? <Loader2 size={16} className=\"animate-spin\" /> : 'Search'}\n                                </button>\n                            </div>\n\n                            <div className=\"space-y-3 max-h-64 overflow-y-auto pr-2 scrollbar-hide\">\n                                {searchResults.length > 0 ? (\n                                    searchResults.map(result => (\n                                        <div\n                                            key={result.id}\n                                            className={`flex items-center justify-between p-3 rounded-2xl border transition-all ${isDarkMode ? 'bg-slate-800/50 border-slate-700 hover:bg-slate-800' : 'bg-slate-50 border-slate-100 hover:bg-white'\n                                                }`}\n                                        >\n                                            <div className=\"flex items-center gap-3\">\n                                                <img\n                                                    src={result.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(result.fullName || '')}&background=random`}\n                                                    alt=\"\"\n                                                    className=\"w-10 h-10 rounded-full object-cover\"\n                                                />\n                                                <div>\n                                                    <div className=\"flex items-center gap-1.5\">\n                                                        <h4 className={`text-sm font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{result.fullName}</h4>\n                                                        {result.role === 'mentor' && (\n                                                            <span className=\"px-1.5 py-0.5 bg-purple-500/10 text-purple-500 text-[10px] font-bold rounded-full border border-purple-500/20\">\n                                                                Mentor\n                                                            </span>\n                                                        )}\n                                                    </div>\n                                                    <p className=\"text-xs text-slate-500\">@{result.username}</p>\n                                                </div>\n                                            </div>\n                                            {requestSent.includes(result.userId!) ? (\n                                                <div className=\"flex items-center gap-1 text-green-500 text-xs font-bold px-3 py-1.5 bg-green-500/10 rounded-lg\">\n                                                    <Check size={14} />\n                                                    Sent\n                                                </div>\n                                            ) : (\n                                                <button\n                                                    onClick={() => handleSendRequest(result.userId!)}\n                                                    className=\"p-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-all shadow-sm\"\n                                                    title=\"Send Friend Request\"\n                                                >\n                                                    <UserPlus size={18} />\n                                                </button>\n                                            )}\n                                        </div>\n                                    ))\n                                ) : searchQuery && !searching ? (\n                                    <div className=\"text-center py-8\">\n                                        <p className=\"text-slate-500 text-sm\">No users found matching \"{searchQuery}\"</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"text-center py-8\">\n                                        <UserCheck className=\"w-12 h-12 text-slate-700 mx-auto mb-2 opacity-20\" />\n                                        <p className=\"text-slate-500 text-sm\">Search for friends to connect</p>\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Create Group Modal */}\n            {showCreateGroup && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm\">\n                    <div className={`w-full max-w-md rounded-3xl shadow-2xl border overflow-hidden animate-fade-in ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'}`}>\n                        <div className=\"p-6 border-b border-slate-800/50 flex items-center justify-between bg-gradient-to-r from-amber-500/10 to-transparent\">\n                            <h3 className={`text-xl font-bold flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                <Plus className=\"text-amber-500\" />\n                                Create New Group\n                            </h3>\n                            <button\n                                onClick={() => setShowCreateGroup(false)}\n                                className={`p-2 rounded-full transition-all ${isDarkMode ? 'hover:bg-slate-800 text-slate-400' : 'hover:bg-slate-100 text-slate-500'}`}\n                            >\n                                <X size={20} />\n                            </button>\n                        </div>\n                        <div className=\"p-6 space-y-6\">\n                            <div>\n                                <label className={`block text-sm font-bold mb-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Group Name</label>\n                                <input\n                                    type=\"text\"\n                                    placeholder=\"e.g. Study Squad\"\n                                    value={newGroupName}\n                                    onChange={(e) => setNewGroupName(e.target.value)}\n                                    className={`w-full px-4 py-3 rounded-xl border transition-all ${isDarkMode ? 'bg-slate-800 border-slate-700 text-white focus:border-amber-500' : 'bg-slate-50 border-slate-200 text-slate-900 focus:border-amber-500'}`}\n                                />\n                            </div>\n                            <button\n                                onClick={handleCreateGroup}\n                                disabled={creatingGroup || !newGroupName.trim()}\n                                className=\"w-full py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2\"\n                            >\n                                {creatingGroup ? <Loader2 size={20} className=\"animate-spin\" /> : 'Create Group'}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* â•â•â• PROFILE CARD POPUP (portal to body) â•â•â• */}\n            {profileCard && createPortal(\n                <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm\" onClick={() => setProfileCard(null)} style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0 }}>\n                    <div\n                        onClick={e => e.stopPropagation()}\n                        className={`w-full max-w-sm mx-4 rounded-3xl overflow-hidden border shadow-2xl animate-fade-in ${isDarkMode ? 'bg-slate-900 border-slate-700' : 'bg-white border-slate-200'}`}\n                    >\n                        {/* Banner + Avatar */}\n                        <div className=\"relative h-36 bg-gradient-to-r from-amber-500 via-orange-500 to-rose-500\">\n                            <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmZmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzRjMC0yLjIxLTEuNzktNC00LTRzLTQgMS43OS00IDQgMS43OSA0IDQgNCA0LTEuNzkgNC00eiIvPjwvZz48L2c+PC9zdmc+')] opacity-10\" />\n                            <button\n                                onClick={() => setProfileCard(null)}\n                                className=\"absolute top-3 right-3 p-1.5 bg-black/30 hover:bg-black/50 rounded-full text-white transition-all\"\n                            >\n                                <X size={16} />\n                            </button>\n                            <div className=\"absolute -bottom-[4.5rem] left-1/2 -translate-x-1/2\">\n                                {profileCard.avatarUrl && !profileCard.avatarUrl.includes('ui-avatars.com') ? (\n                                    <img\n                                        src={profileCard.avatarUrl}\n                                        alt=\"\"\n                                        className=\"w-36 h-36 rounded-full object-cover border-4 shadow-lg cursor-pointer hover:ring-4 hover:ring-white/30 transition-all\"\n                                        style={{ borderColor: isDarkMode ? '#1e293b' : '#ffffff' }}\n                                        onClick={(e) => { e.stopPropagation(); setImagePreview(profileCard.avatarUrl); }}\n                                        onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\n                                    />\n                                ) : (\n                                    <div className=\"w-36 h-36 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-4xl font-bold text-white border-4 shadow-lg\" style={{ borderColor: isDarkMode ? '#1e293b' : '#ffffff' }}>\n                                        {profileCard.name?.charAt(0).toUpperCase()}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        {/* Info */}\n                        <div className=\"pt-20 pb-5 px-6 text-center\">\n                            <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{profileCard.name}</h3>\n                            <p className={`text-sm mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>@{profileCard.username || 'user'}</p>\n\n                            {/* Role Badge */}\n                            <div className=\"flex items-center justify-center gap-2 mt-2\">\n                                {profileCard.role === 'mentor' ? (\n                                    <span className=\"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-purple-500/20 to-blue-500/20 text-purple-400 border border-purple-500/30\">\n                                        <GraduationCap size={12} /> Mentor\n                                    </span>\n                                ) : (\n                                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${isDarkMode ? 'bg-amber-500/10 text-amber-400 border border-amber-500/20' : 'bg-amber-50 text-amber-600 border border-amber-200'}`}>\n                                        <BookOpen size={12} /> Student\n                                    </span>\n                                )}\n                                {profileCard.profession && (\n                                    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${isDarkMode ? 'bg-slate-800 text-slate-400' : 'bg-slate-100 text-slate-600'}`}>\n                                        {profileCard.profession}\n                                    </span>\n                                )}\n                            </div>\n\n                            {/* Bio */}\n                            {profileCard.bio && (\n                                <p className={`text-sm mt-3 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>{profileCard.bio}</p>\n                            )}\n\n                            {/* Location */}\n                            {profileCard.location && (\n                                <div className={`flex items-center justify-center gap-1 mt-2 text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                    <MapPin size={12} /> {profileCard.location}\n                                </div>\n                            )}\n\n                            {/* Stats Grid */}\n                            <div className=\"grid grid-cols-2 gap-3 mt-5\">\n                                <div className={`rounded-xl p-3 ${profileCard.studyStreak > 0 ? 'bg-gradient-to-br from-orange-500/15 to-red-500/15 border border-orange-500/25' : isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n                                    <Flame size={18} className={`mx-auto mb-1 ${profileCard.studyStreak > 0 ? 'text-orange-500' : isDarkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                    <p className={`text-lg font-bold ${profileCard.studyStreak > 0 ? 'text-orange-500' : isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {profileCardLoading ? '...' : profileCard.studyStreak}\n                                    </p>\n                                    <p className={`text-[10px] font-medium ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Day Streak</p>\n                                </div>\n                                <div className={`rounded-xl p-3 ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n                                    <Clock size={18} className=\"mx-auto mb-1 text-amber-500\" />\n                                    <p className={`text-lg font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {profileCardLoading ? '...' : formatTime(profileCard.totalMinutes || 0)}\n                                    </p>\n                                    <p className={`text-[10px] font-medium ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Grind Time</p>\n                                </div>\n                                <div className={`rounded-xl p-3 ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n                                    <Brain size={18} className=\"mx-auto mb-1 text-blue-500\" />\n                                    <p className={`text-lg font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {profileCardLoading ? '...' : (profileCard.avgFocus || 0) > 0 ? `${profileCard.avgFocus}/5` : '\\u2014'}\n                                    </p>\n                                    <p className={`text-[10px] font-medium ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Avg Focus</p>\n                                </div>\n                                <div className={`rounded-xl p-3 ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\n                                    <Target size={18} className=\"mx-auto mb-1 text-green-500\" />\n                                    <p className={`text-lg font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {profileCardLoading ? '...' : profileCard.totalSessions || 0}\n                                    </p>\n                                    <p className={`text-[10px] font-medium ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Sessions</p>\n                                </div>\n                            </div>\n\n                            {/* Joined + Experience */}\n                            <div className=\"flex items-center justify-center gap-4 mt-4\">\n                                {profileCard.joined && (\n                                    <span className={`flex items-center gap-1 text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                        <Calendar size={12} /> Joined {profileCard.joined}\n                                    </span>\n                                )}\n                                {profileCard.experience && (\n                                    <span className={`flex items-center gap-1 text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                        {profileCard.experience} experience\n                                    </span>\n                                )}\n                            </div>\n\n                            {/* Actions */}\n                            <div className=\"flex gap-2 mt-5\">\n                                <button\n                                    onClick={() => { openChat(profileCard); setProfileCard(null); }}\n                                    className=\"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-bold bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700 transition-all shadow-md\"\n                                >\n                                    <MessageCircle size={16} /> Chat\n                                </button>\n                                <button\n                                    onClick={() => { onStartVideoCall(profileCard.name, profileCard.avatarUrl, profileCard.id); setProfileCard(null); }}\n                                    className={`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-bold transition-all ${isDarkMode ? 'bg-slate-800 text-blue-400 hover:bg-slate-700 border border-slate-700' : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200'}`}\n                                >\n                                    <Video size={16} /> Call\n                                </button>\n                            </div>\n                        </div>\n\n                        {profileCardLoading && (\n                            <div className={`px-6 pb-4 flex items-center justify-center gap-2 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                <Loader2 size={14} className=\"animate-spin\" />\n                                <span className=\"text-xs\">Loading details...</span>\n                            </div>\n                        )}\n                    </div>\n                </div>,\n                document.body\n            )}\n\n            {/* Image Preview Lightbox */}\n            {imagePreview && createPortal(\n                <div className=\"fixed inset-0 z-[10000] bg-black/90 flex items-center justify-center backdrop-blur-sm\" onClick={() => setImagePreview(null)}>\n                    <button onClick={() => setImagePreview(null)} className=\"absolute top-4 right-4 p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all z-10\">\n                        <X size={24} />\n                    </button>\n                    <img src={imagePreview} alt=\"Preview\" className=\"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl\" onClick={e => e.stopPropagation()} />\n                </div>,\n                document.body\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\GoalReminderPopup.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":2,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":41}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Target, Clock, X, Zap, Calendar } from 'lucide-react';\nimport { StudyGoal, Subject } from '../types';\n\ninterface GoalReminderPopupProps {\n  goals: StudyGoal[];\n  subjects: Subject[];\n  isDarkMode: boolean;\n  onClose: () => void;\n}\n\nexport function GoalReminderPopup({ goals, subjects, isDarkMode, onClose }: GoalReminderPopupProps) {\n  const [currentGoalIndex, setCurrentGoalIndex] = useState(0);\n  const [isVisible, setIsVisible] = useState(false);\n\n  // Filter active goals and prioritize by urgency\n  const activeGoals = goals\n    .filter(g => !g.completed)\n    .sort((a, b) => {\n      if (a.targetDate && b.targetDate) {\n        return new Date(a.targetDate).getTime() - new Date(b.targetDate).getTime();\n      }\n      if (a.targetDate && !b.targetDate) return -1;\n      if (!a.targetDate && b.targetDate) return 1;\n      return 0;\n    });\n\n  useEffect(() => {\n    if (activeGoals.length > 0) {\n      setIsVisible(true);\n    }\n  }, [activeGoals.length]);\n\n  if (activeGoals.length === 0 || !isVisible) return null;\n\n  const currentGoal = activeGoals[currentGoalIndex];\n  const subject = subjects.find(s => s.id === currentGoal.subjectId);\n  \n  const getDaysUntilDeadline = (targetDate?: Date) => {\n    if (!targetDate) return null;\n    const now = new Date();\n    const target = new Date(targetDate);\n    const diffTime = target.getTime() - now.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    return diffDays;\n  };\n\n  const daysLeft = getDaysUntilDeadline(currentGoal.targetDate);\n  \n  const getUrgencyColor = (days: number | null) => {\n    if (days === null) return isDarkMode ? 'text-blue-400' : 'text-blue-600';\n    if (days <= 3) return 'text-red-500';\n    if (days <= 7) return 'text-orange-500';\n    if (days <= 14) return 'text-yellow-500';\n    return isDarkMode ? 'text-green-400' : 'text-green-600';\n  };\n\n  const getUrgencyMessage = (days: number | null) => {\n    if (days === null) return \"No deadline set - perfect time to make progress!\";\n    if (days < 0) return `${Math.abs(days)} days overdue - time to grind!`;\n    if (days === 0) return \"Due today - final push!\";\n    if (days === 1) return \"Due tomorrow - crunch time!\";\n    if (days <= 3) return `Only ${days} days left - sprint mode!`;\n    if (days <= 7) return `${days} days remaining - stay focused!`;\n    return `${days} days to go - keep grinding!`;\n  };\n\n  const handleClose = () => {\n    setIsVisible(false);\n    setTimeout(onClose, 300);\n  };\n\n  const nextGoal = () => {\n    if (currentGoalIndex < activeGoals.length - 1) {\n      setCurrentGoalIndex(currentGoalIndex + 1);\n    }\n  };\n\n  const prevGoal = () => {\n    if (currentGoalIndex > 0) {\n      setCurrentGoalIndex(currentGoalIndex - 1);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n      <div className={`max-w-md w-full rounded-2xl shadow-2xl border transform transition-all duration-300 ${\n        isVisible ? 'scale-100 opacity-100' : 'scale-95 opacity-0'\n      } ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"bg-gradient-to-br from-amber-500 to-orange-600 p-2 rounded-xl\">\n              <Target className=\"text-white\" size={20} />\n            </div>\n            <div>\n              <h3 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                Goal Reminder\n              </h3>\n              <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                {currentGoalIndex + 1} of {activeGoals.length}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={handleClose}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'\n            }`}\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        {/* Goal Content */}\n        <div className=\"p-6\">\n          {subject && (\n            <div className=\"flex items-center gap-2 mb-3\">\n              <div\n                className=\"w-3 h-3 rounded-full\"\n                style={{ backgroundColor: subject.color }}\n              />\n              <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\n                {subject.name}\n              </span>\n            </div>\n          )}\n          \n          <h4 className={`text-lg font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            {currentGoal.title}\n          </h4>\n          \n          {currentGoal.description && (\n            <p className={`text-sm mb-4 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\n              {currentGoal.description}\n            </p>\n          )}\n\n          {/* Urgency Indicator */}\n          <div className={`flex items-center gap-2 p-3 rounded-lg mb-4 ${\n            isDarkMode ? 'bg-slate-700' : 'bg-slate-50'\n          }`}>\n            <Clock className={getUrgencyColor(daysLeft)} size={20} />\n            <div>\n              <p className={`font-medium ${getUrgencyColor(daysLeft)}`}>\n                {getUrgencyMessage(daysLeft)}\n              </p>\n              {currentGoal.targetDate && (\n                <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                  Target: {new Date(currentGoal.targetDate).toLocaleDateString()}\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Motivational Message */}\n          <div className={`p-4 rounded-lg border-l-4 border-amber-500 ${\n            isDarkMode ? 'bg-amber-900/20' : 'bg-amber-50'\n          }`}>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Zap className=\"text-amber-500\" size={16} />\n              <span className={`font-medium ${isDarkMode ? 'text-amber-200' : 'text-amber-800'}`}>\n                Grind Time!\n              </span>\n            </div>\n            <p className={`text-sm ${isDarkMode ? 'text-amber-100' : 'text-amber-700'}`}>\n              Every study session brings you closer to your goal. Start your timer and make progress today!\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"flex gap-2\">\n            {activeGoals.length > 1 && (\n              <>\n                <button\n                  onClick={prevGoal}\n                  disabled={currentGoalIndex === 0}\n                  className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${\n                    isDarkMode \n                      ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' \n                      : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                  }`}\n                >\n                  Previous\n                </button>\n                <button\n                  onClick={nextGoal}\n                  disabled={currentGoalIndex === activeGoals.length - 1}\n                  className={`px-3 py-1 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${\n                    isDarkMode \n                      ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' \n                      : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\n                  }`}\n                >\n                  Next\n                </button>\n              </>\n            )}\n          </div>\n          <button\n            onClick={handleClose}\n            className=\"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-colors font-medium\"\n          >\n            Let's Grind!\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\GoalsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":2,"column":97,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":101},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MessageCircle' is defined but never used.","line":2,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":131},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[526,529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[526,529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[653,656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[653,656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Menu, Zap, Sun, Moon, LayoutDashboard, Clock, BookOpen, Users, GraduationCap, History, User, CalendarCheck, MessageCircle, Tag } from 'lucide-react';\r\nimport { NotificationCenter } from './NotificationCenter';\r\nimport { UserProfile } from './UserProfile';\r\n\r\ninterface HeaderProps {\r\n    isDarkMode: boolean;\r\n    setIsDarkMode: (isDark: boolean) => void;\r\n    isSidebarOpen: boolean;\r\n    setIsSidebarOpen: (isOpen: boolean) => void;\r\n    currentView: string;\r\n    setCurrentView: (view: any) => void;\r\n    totalUnreadMessages: number;\r\n    onNotificationClick: (type: 'message' | 'call' | 'friend_request', data?: any) => void;\r\n    userRole?: 'student' | 'mentor';\r\n    // Timer props\r\n    timerState?: {\r\n        isRunning: boolean;\r\n        isPaused: boolean;\r\n        elapsedSeconds: number;\r\n        selectedSubjectId: string;\r\n    };\r\n    formatTime?: (seconds: number) => string;\r\n    onTimerPause?: () => void;\r\n    onTimerResume?: () => void;\r\n    subjects?: Array<{ id: string; name: string; color: string }>;\r\n}\r\n\r\nexport const Header: React.FC<HeaderProps> = ({\r\n    isDarkMode,\r\n    setIsDarkMode,\r\n    isSidebarOpen,\r\n    setIsSidebarOpen,\r\n    currentView,\r\n    setCurrentView,\r\n    totalUnreadMessages,\r\n    onNotificationClick,\r\n    userRole = 'student',\r\n    timerState,\r\n    formatTime,\r\n    onTimerPause,\r\n    onTimerResume,\r\n    subjects\r\n}) => {\r\n    // Different navigation for mentors vs students\r\n    const mainNavigation = userRole === 'mentor'\r\n        ? [\r\n            { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },\r\n            { id: 'mentor-sessions', label: 'Sessions', icon: CalendarCheck },\r\n            { id: 'mentor-students', label: 'Students', icon: GraduationCap },\r\n            { id: 'friends', label: 'Friends', icon: Users },\r\n            { id: 'mentor-offerings', label: 'Offerings', icon: Tag },\r\n        ]\r\n        : [\r\n            { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },\r\n            { id: 'timer', label: 'Study Timer', icon: Clock },\r\n            { id: 'subjects', label: 'Subjects', icon: BookOpen },\r\n            { id: 'friends', label: 'Friends', icon: Users },\r\n            { id: 'mentors', label: 'Mentors', icon: GraduationCap },\r\n            { id: 'history', label: 'History', icon: History },\r\n        ];\r\n\r\n    const showTimer = timerState?.isRunning && currentView !== 'timer' && userRole === 'student';\r\n\r\n    return (\r\n        <nav className={`shadow-md border-b transition-colors relative z-40 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n            <div className=\"w-full px-6 py-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    {/* Logo and Text */}\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {/* Menu Toggle Button - Only visible when sidebar is closed */}\r\n                        {!isSidebarOpen && (\r\n                            <button\r\n                                onClick={() => setIsSidebarOpen(true)}\r\n                                className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-700 text-slate-300' : 'hover:bg-slate-100 text-slate-600'\r\n                                    }`}\r\n                                title=\"Show menu\"\r\n                            >\r\n                                <Menu size={24} />\r\n                            </button>\r\n                        )}\r\n\r\n                        {!isSidebarOpen && (\r\n                            <>\r\n                                <div className=\"bg-gradient-to-br from-amber-500 to-orange-600 p-2 rounded-xl shadow-lg\">\r\n                                    <Zap className=\"text-white\" size={28} />\r\n                                </div>\r\n                                <div>\r\n                                    <h1 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Grind Clock</h1>\r\n                                    <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>Push Your Limits</p>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Main Navigation - Desktop */}\r\n                    <div className=\"hidden lg:flex gap-2 items-center\">\r\n                        {mainNavigation.map((item) => {\r\n                            const Icon = item.icon;\r\n                            return (\r\n                                <button\r\n                                    key={item.id}\r\n                                    onClick={() => setCurrentView(item.id)}\r\n                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${currentView === item.id\r\n                                        ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md'\r\n                                        : isDarkMode ? 'text-slate-300 hover:bg-slate-700' : 'text-slate-600 hover:bg-slate-100'\r\n                                        }`}\r\n                                >\r\n                                    <Icon size={18} />\r\n                                    <span>{item.label}</span>\r\n                                    {item.id === 'friends' && totalUnreadMessages > 0 && (\r\n                                        <span className=\"ml-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full bg-amber-500 text-white text-[10px] font-bold leading-none\">\r\n                                            {totalUnreadMessages > 99 ? '99+' : totalUnreadMessages}\r\n                                        </span>\r\n                                    )}\r\n                                </button>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Timer Display - Only when timer is running and not on timer page */}\r\n                        {showTimer && formatTime && (\r\n                            <div className={`flex items-center gap-2 px-3 py-2 rounded-lg border ${isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'}`}>\r\n                                <div\r\n                                    className=\"w-2 h-2 rounded-full animate-pulse\"\r\n                                    style={{\r\n                                        backgroundColor: subjects?.find((s) => s.id === timerState.selectedSubjectId)?.color || '#f59e0b',\r\n                                    }}\r\n                                />\r\n                                <span className={`text-sm font-mono font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                    {formatTime(timerState.elapsedSeconds)}\r\n                                </span>\r\n                                {timerState.isPaused ? (\r\n                                    <button\r\n                                        onClick={onTimerResume}\r\n                                        className=\"p-1 hover:bg-amber-500/20 rounded transition-colors\"\r\n                                        title=\"Resume\"\r\n                                    >\r\n                                        <svg className=\"w-3 h-3 text-amber-500\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\r\n                                            <path d=\"M3 1.5A1.5 1.5 0 0 1 4.5 0h7A1.5 1.5 0 0 1 13 1.5v13a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 14.5v-13zM4.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5h-7z\" />\r\n                                            <path d=\"m5.5 4 4.5 3.5-4.5 3.5V4z\" />\r\n                                        </svg>\r\n                                    </button>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={onTimerPause}\r\n                                        className=\"p-1 hover:bg-yellow-500/20 rounded transition-colors\"\r\n                                        title=\"Pause\"\r\n                                    >\r\n                                        <svg className=\"w-3 h-3 text-yellow-500\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\r\n                                            <path d=\"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z\" />\r\n                                        </svg>\r\n                                    </button>\r\n                                )}\r\n                                <button\r\n                                    onClick={() => setCurrentView('timer')}\r\n                                    className={`text-xs px-2 py-1 rounded font-medium transition-colors ${isDarkMode ? 'hover:bg-slate-600 text-slate-300' : 'hover:bg-slate-200 text-slate-600'}`}\r\n                                >\r\n                                    View\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Dark Mode Toggle */}\r\n                        <button\r\n                            onClick={() => setIsDarkMode(!isDarkMode)}\r\n                            className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-yellow-400' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}\r\n                            title={isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'}\r\n                        >\r\n                            {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\r\n                        </button>\r\n\r\n                        <NotificationCenter isDarkMode={isDarkMode} onNotificationClick={onNotificationClick} />\r\n\r\n                        {/* Profile Icon */}\r\n                        <UserProfile\r\n                            isDarkMode={isDarkMode}\r\n                            variant=\"header\"\r\n                            onSettingsClick={() => setCurrentView('settings')}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Mobile Navigation */}\r\n                    <div className=\"flex lg:hidden items-center gap-2\">\r\n                        <NotificationCenter isDarkMode={isDarkMode} onNotificationClick={onNotificationClick} />\r\n\r\n                        {/* Profile Icon - Mobile */}\r\n                        <UserProfile\r\n                            isDarkMode={isDarkMode}\r\n                            variant=\"header\"\r\n                            onSettingsClick={() => setCurrentView('settings')}\r\n                        />\r\n\r\n                        <button\r\n                            onClick={() => setIsDarkMode(!isDarkMode)}\r\n                            className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-yellow-400' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}\r\n                            title={isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'}\r\n                        >\r\n                            {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </nav>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\IncomingCallPopup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\InterestingFacts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\LoadingSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BarChart3' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":14,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":14,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Award' is defined but never used.","line":14,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":70},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnalytics'. Either include it or remove the dependency array.","line":44,"column":8,"nodeType":"ArrayExpression","endLine":44,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [loadAnalytics, mentorId, timeRange]","fix":{"range":[1439,1460],"text":"[loadAnalytics, mentorId, timeRange]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'profile' is assigned a value but never used.","line":89,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":89,"endColumn":38}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Mentor Analytics Dashboard\r\n * \r\n * Comprehensive analytics for mentors showing:\r\n * - Sessions completed\r\n * - Average rating\r\n * - Response time\r\n * - Student satisfaction\r\n * - Earnings (if paid)\r\n * - Popular topics\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { BarChart3, Star, Clock, TrendingUp, DollarSign, Users, Award, Calendar } from 'lucide-react';\r\nimport { supabase } from '../utils/supabase';\r\nimport { logger, measureAsync } from '../utils/logger';\r\nimport { ChartSkeleton, StatsCardSkeleton } from './LoadingSkeleton';\r\n\r\ninterface MentorStats {\r\n    totalSessions: number;\r\n    completedSessions: number;\r\n    cancelledSessions: number;\r\n    averageRating: number;\r\n    totalReviews: number;\r\n    responseTimeMinutes: number;\r\n    repeatStudents: number;\r\n    totalEarnings: number;\r\n    popularTopics: Array<{ topic: string; count: number }>;\r\n    ratingDistribution: Array<{ rating: number; count: number }>;\r\n    monthlyTrend: Array<{ month: string; sessions: number; rating: number }>;\r\n}\r\n\r\ninterface Props {\r\n    mentorId: string;\r\n}\r\n\r\nexport const MentorAnalyticsDashboard: React.FC<Props> = ({ mentorId }) => {\r\n    const [stats, setStats] = useState<MentorStats | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [timeRange, setTimeRange] = useState<'week' | 'month' | 'year' | 'all'>('month');\r\n\r\n    useEffect(() => {\r\n        loadAnalytics();\r\n    }, [mentorId, timeRange]);\r\n\r\n    const loadAnalytics = async () => {\r\n        setLoading(true);\r\n\r\n        try {\r\n            const data = await measureAsync('Load mentor analytics', async () => {\r\n                // Calculate date range\r\n                const now = new Date();\r\n                let startDate = new Date();\r\n\r\n                switch (timeRange) {\r\n                    case 'week':\r\n                        startDate.setDate(now.getDate() - 7);\r\n                        break;\r\n                    case 'month':\r\n                        startDate.setMonth(now.getMonth() - 1);\r\n                        break;\r\n                    case 'year':\r\n                        startDate.setFullYear(now.getFullYear() - 1);\r\n                        break;\r\n                    case 'all':\r\n                        startDate = new Date('2020-01-01');\r\n                        break;\r\n                }\r\n\r\n                // Fetch session data\r\n                const { data: sessions, error: sessionsError } = await supabase\r\n                    .from('session_requests')\r\n                    .select('*')\r\n                    .eq('mentor_id', mentorId)\r\n                    .gte('created_at', startDate.toISOString());\r\n\r\n                if (sessionsError) throw sessionsError;\r\n\r\n                // Fetch reviews\r\n                const { data: reviews, error: reviewsError } = await supabase\r\n                    .from('session_reviews')\r\n                    .select('*')\r\n                    .eq('mentor_id', mentorId)\r\n                    .gte('created_at', startDate.toISOString());\r\n\r\n                if (reviewsError) throw reviewsError;\r\n\r\n                // Fetch mentor profile for current stats\r\n                const { data: profile, error: profileError } = await supabase\r\n                    .from('mentor_profiles')\r\n                    .select('*')\r\n                    .eq('user_id', mentorId)\r\n                    .single();\r\n\r\n                if (profileError) throw profileError;\r\n\r\n                // Calculate stats\r\n                const completedSessions = sessions?.filter(s => s.status === 'completed').length || 0;\r\n                const cancelledSessions = sessions?.filter(s => s.status === 'cancelled').length || 0;\r\n\r\n                const averageRating = reviews && reviews.length > 0\r\n                    ? reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length\r\n                    : 0;\r\n\r\n                // Calculate response time (average time to accept requests)\r\n                const acceptedSessions = sessions?.filter(s => s.status === 'accepted' || s.status === 'completed') || [];\r\n                const responseTimes = acceptedSessions\r\n                    .filter(s => s.updated_at && s.created_at)\r\n                    .map(s => {\r\n                        const created = new Date(s.created_at).getTime();\r\n                        const updated = new Date(s.updated_at).getTime();\r\n                        return (updated - created) / (1000 * 60); // Convert to minutes\r\n                    });\r\n\r\n                const avgResponseTime = responseTimes.length > 0\r\n                    ? responseTimes.reduce((sum, time) => sum + time, 0) / responseTimes.length\r\n                    : 0;\r\n\r\n                // Calculate repeat students\r\n                const studentCounts = new Map<string, number>();\r\n                sessions?.forEach(s => {\r\n                    studentCounts.set(s.student_id, (studentCounts.get(s.student_id) || 0) + 1);\r\n                });\r\n                const repeatStudents = Array.from(studentCounts.values()).filter(count => count > 1).length;\r\n\r\n                // Popular topics\r\n                const topicCounts = new Map<string, number>();\r\n                sessions?.forEach(s => {\r\n                    if (s.topic) {\r\n                        topicCounts.set(s.topic, (topicCounts.get(s.topic) || 0) + 1);\r\n                    }\r\n                });\r\n                const popularTopics = Array.from(topicCounts.entries())\r\n                    .map(([topic, count]) => ({ topic, count }))\r\n                    .sort((a, b) => b.count - a.count)\r\n                    .slice(0, 5);\r\n\r\n                // Rating distribution\r\n                const ratingCounts = new Map<number, number>();\r\n                reviews?.forEach(r => {\r\n                    ratingCounts.set(r.rating, (ratingCounts.get(r.rating) || 0) + 1);\r\n                });\r\n                const ratingDistribution = [5, 4, 3, 2, 1].map(rating => ({\r\n                    rating,\r\n                    count: ratingCounts.get(rating) || 0,\r\n                }));\r\n\r\n                // Monthly trend (last 6 months)\r\n                const monthlyData = new Map<string, { sessions: number; ratings: number[]; }>();\r\n                const last6Months = Array.from({ length: 6 }, (_, i) => {\r\n                    const date = new Date();\r\n                    date.setMonth(date.getMonth() - i);\r\n                    return date.toISOString().slice(0, 7); // YYYY-MM\r\n                }).reverse();\r\n\r\n                last6Months.forEach(month => {\r\n                    monthlyData.set(month, { sessions: 0, ratings: [] });\r\n                });\r\n\r\n                sessions?.forEach(s => {\r\n                    const month = s.created_at.slice(0, 7);\r\n                    if (monthlyData.has(month)) {\r\n                        const data = monthlyData.get(month)!;\r\n                        data.sessions++;\r\n                    }\r\n                });\r\n\r\n                reviews?.forEach(r => {\r\n                    const month = r.created_at.slice(0, 7);\r\n                    if (monthlyData.has(month)) {\r\n                        const data = monthlyData.get(month)!;\r\n                        data.ratings.push(r.rating);\r\n                    }\r\n                });\r\n\r\n                const monthlyTrend = last6Months.map(month => {\r\n                    const data = monthlyData.get(month)!;\r\n                    const avgRating = data.ratings.length > 0\r\n                        ? data.ratings.reduce((sum, r) => sum + r, 0) / data.ratings.length\r\n                        : 0;\r\n\r\n                    return {\r\n                        month: new Date(month + '-01').toLocaleDateString('en-US', { month: 'short' }),\r\n                        sessions: data.sessions,\r\n                        rating: avgRating,\r\n                    };\r\n                });\r\n\r\n                return {\r\n                    totalSessions: sessions?.length || 0,\r\n                    completedSessions,\r\n                    cancelledSessions,\r\n                    averageRating,\r\n                    totalReviews: reviews?.length || 0,\r\n                    responseTimeMinutes: Math.round(avgResponseTime),\r\n                    repeatStudents,\r\n                    totalEarnings: 0, // TODO: Calculate from paid sessions\r\n                    popularTopics,\r\n                    ratingDistribution,\r\n                    monthlyTrend,\r\n                };\r\n            });\r\n\r\n            setStats(data);\r\n        } catch (error) {\r\n            logger.error('Failed to load mentor analytics', error as Error, { mentorId });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-6 space-y-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                    <StatsCardSkeleton />\r\n                    <StatsCardSkeleton />\r\n                    <StatsCardSkeleton />\r\n                    <StatsCardSkeleton />\r\n                </div>\r\n                <ChartSkeleton />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!stats) {\r\n        return (\r\n            <div className=\"p-6 text-center text-gray-500 dark:text-gray-400\">\r\n                Failed to load analytics. Please try again.\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-6 space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                    Analytics Dashboard\r\n                </h2>\r\n\r\n                {/* Time Range Selector */}\r\n                <div className=\"flex gap-2\">\r\n                    {(['week', 'month', 'year', 'all'] as const).map(range => (\r\n                        <button\r\n                            key={range}\r\n                            onClick={() => setTimeRange(range)}\r\n                            className={`px-4 py-2 rounded-lg font-medium transition-all ${timeRange === range\r\n                                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white'\r\n                                    : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'\r\n                                }`}\r\n                        >\r\n                            {range.charAt(0).toUpperCase() + range.slice(1)}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                {/* Total Sessions */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n                            Total Sessions\r\n                        </h3>\r\n                        <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center\">\r\n                            <Calendar className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                        {stats.totalSessions}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        {stats.completedSessions} completed â€¢ {stats.cancelledSessions} cancelled\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Average Rating */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n                            Average Rating\r\n                        </h3>\r\n                        <div className=\"w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg flex items-center justify-center\">\r\n                            <Star className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-baseline gap-2 mb-2\">\r\n                        <p className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n                            {stats.averageRating.toFixed(1)}\r\n                        </p>\r\n                        <div className=\"flex\">\r\n                            {Array.from({ length: 5 }).map((_, i) => (\r\n                                <Star\r\n                                    key={i}\r\n                                    className={`w-4 h-4 ${i < Math.round(stats.averageRating)\r\n                                            ? 'text-yellow-400 fill-yellow-400'\r\n                                            : 'text-gray-300 dark:text-gray-600'\r\n                                        }`}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        From {stats.totalReviews} reviews\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Response Time */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n                            Avg Response Time\r\n                        </h3>\r\n                        <div className=\"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center\">\r\n                            <Clock className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                        {stats.responseTimeMinutes}m\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        {stats.responseTimeMinutes < 60 ? 'Excellent' : stats.responseTimeMinutes < 180 ? 'Good' : 'Needs improvement'}\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Repeat Students */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n                            Repeat Students\r\n                        </h3>\r\n                        <div className=\"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center\">\r\n                            <Users className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                        {stats.repeatStudents}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                        High satisfaction rate\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Charts Row */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Monthly Trend */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-6\">\r\n                        Monthly Trend\r\n                    </h3>\r\n                    <div className=\"space-y-4\">\r\n                        {stats.monthlyTrend.map((month, index) => (\r\n                            <div key={index}>\r\n                                <div className=\"flex items-center justify-between mb-2\">\r\n                                    <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">\r\n                                        {month.month}\r\n                                    </span>\r\n                                    <span className=\"text-sm text-gray-900 dark:text-white\">\r\n                                        {month.sessions} sessions â€¢ {month.rating > 0 ? `${month.rating.toFixed(1)}â­` : 'No ratings'}\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                                    <div\r\n                                        className=\"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all\"\r\n                                        style={{ width: `${(month.sessions / Math.max(...stats.monthlyTrend.map(m => m.sessions), 1)) * 100}%` }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Popular Topics */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-6\">\r\n                        Popular Topics\r\n                    </h3>\r\n                    {stats.popularTopics.length > 0 ? (\r\n                        <div className=\"space-y-4\">\r\n                            {stats.popularTopics.map((topic, index) => (\r\n                                <div key={index}>\r\n                                    <div className=\"flex items-center justify-between mb-2\">\r\n                                        <span className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\r\n                                            {topic.topic}\r\n                                        </span>\r\n                                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                                            {topic.count} sessions\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                                        <div\r\n                                            className=\"bg-gradient-to-r from-green-600 to-teal-600 h-2 rounded-full transition-all\"\r\n                                            style={{ width: `${(topic.count / Math.max(...stats.popularTopics.map(t => t.count), 1)) * 100}%` }}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    ) : (\r\n                        <p className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\r\n                            No session data yet\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Rating Distribution */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-6\">\r\n                    Rating Distribution\r\n                </h3>\r\n                <div className=\"space-y-3\">\r\n                    {stats.ratingDistribution.map(({ rating, count }) => {\r\n                        const maxCount = Math.max(...stats.ratingDistribution.map(r => r.count), 1);\r\n                        const percentage = (count / maxCount) * 100;\r\n\r\n                        return (\r\n                            <div key={rating} className=\"flex items-center gap-4\">\r\n                                <div className=\"flex items-center gap-1 w-16\">\r\n                                    <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                                        {rating}\r\n                                    </span>\r\n                                    <Star className=\"w-4 h-4 text-yellow-400 fill-yellow-400\" />\r\n                                </div>\r\n                                <div className=\"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-3\">\r\n                                    <div\r\n                                        className=\"bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full transition-all\"\r\n                                        style={{ width: `${percentage}%` }}\r\n                                    />\r\n                                </div>\r\n                                <span className=\"text-sm text-gray-600 dark:text-gray-400 w-12 text-right\">\r\n                                    {count}\r\n                                </span>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorConnect.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1049,1052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1049,1052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1094,1097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1094,1097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3029,3032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3029,3032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMyRequests'. Either include it or remove the dependency array.","line":175,"column":6,"nodeType":"ArrayExpression","endLine":175,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadMyRequests, user]","fix":{"range":[6991,6997],"text":"[loadMyRequests, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":203,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":203,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":203,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":203,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8196,8197],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":225,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":225,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":225,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":225,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9057,9058],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10235,10238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10235,10238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'allDomains' is assigned a value but never used.","line":411,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":411,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1056,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1056,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49002,49005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49002,49005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Search, Star, Shield, GraduationCap, Briefcase, Globe, Clock,\r\n  MessageCircle, Video, X, Send, Filter, CheckCircle, XCircle, Calendar,\r\n  BookOpen, CheckCheck, Trash2, Timer, Bell, User\r\n} from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport {\r\n  fetchMentorsFromProfiles,\r\n  fetchMentorOfferings,\r\n  fetchMentorReviews,\r\n  fetchAllMentorReviews,\r\n  fetchAllMentorOfferings,\r\n  createSessionRequest,\r\n  fetchSessionRequests,\r\n  subscribeToSessionRequests,\r\n  completeSessionRequest,\r\n  cancelSessionRequest,\r\n  deleteSessionRequest,\r\n  getTimeUntilSession,\r\n  isSessionIn30Minutes,\r\n  submitMentorReview,\r\n  hasSessionStarted,\r\n  isSessionStartingNow,\r\n  getUserProfile\r\n} from '../utils/supabase-queries';\r\nimport { getRecommendedMentors, MatchScore } from '../utils/matching-algorithm';\r\nimport { Mentor, MentorshipOffering, SessionRequest } from '../types';\r\n\r\ninterface MentorConnectProps {\r\n  isDarkMode: boolean;\r\n  onStartVideoCall?: (participant: any) => void;\r\n  onStartChat?: (participant: any) => void;\r\n}\r\n\r\nexport const MentorConnect: React.FC<MentorConnectProps> = ({\r\n  isDarkMode,\r\n  onStartVideoCall,\r\n  onStartChat\r\n}) => {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const [mentors, setMentors] = useState<Mentor[]>([]);\r\n  const [userRole, setUserRole] = useState<'student' | 'mentor'>('student');\r\n  // Use useMemo for filteredMentors instead of useEffect to avoid double renders\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedDomain, setSelectedDomain] = useState<string>('');\r\n  const [selectedOfferingType, setSelectedOfferingType] = useState<string>('');\r\n\r\n  // Use useMemo for filteredMentors instead of useEffect to avoid double renders\r\n  const filteredMentors = React.useMemo(() => {\r\n    let filtered = mentors;\r\n\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      filtered = filtered.filter(m =>\r\n        m.name.toLowerCase().includes(query) ||\r\n        (m.username && m.username.toLowerCase().includes(query)) ||\r\n        m.bio.toLowerCase().includes(query) ||\r\n        m.domain.some(d => d.toLowerCase().includes(query)) ||\r\n        m.skills.some(s => s.toLowerCase().includes(query))\r\n      );\r\n    }\r\n\r\n    if (selectedDomain) {\r\n      filtered = filtered.filter(m =>\r\n        m.domain.some(d => d.toLowerCase().includes(selectedDomain.toLowerCase()))\r\n      );\r\n    }\r\n\r\n    if (selectedOfferingType) {\r\n      filtered = filtered.filter(m =>\r\n        m.offerings && m.offerings.some(o => o.title.toLowerCase().includes(selectedOfferingType.toLowerCase()))\r\n      );\r\n    }\r\n\r\n    return filtered;\r\n  }, [mentors, searchQuery, selectedDomain, selectedOfferingType]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedMentor, setSelectedMentor] = useState<Mentor | null>(null);\r\n  const [mentorOfferings, setMentorOfferings] = useState<MentorshipOffering[]>([]);\r\n  const [mentorReviews, setMentorReviews] = useState<any[]>([]);\r\n  const [myRequests, setMyRequests] = useState<SessionRequest[]>([]);\r\n  const [showRequestForm, setShowRequestForm] = useState(false);\r\n  const [activeView, setActiveView] = useState<'browse' | 'sessions'>('browse');\r\n  const [showSuccessPopup, setShowSuccessPopup] = useState(false);\r\n  const [showConfirmPopup, setShowConfirmPopup] = useState<{ type: 'complete' | 'cancel', requestId: string, topic: string, mentorId?: string, mentorName?: string } | null>(null);\r\n  const [showDeletePopup, setShowDeletePopup] = useState<{ requestId: string, topic: string } | null>(null);\r\n  const [showActionSuccessPopup, setShowActionSuccessPopup] = useState<{ type: 'completed' | 'cancelled' | 'deleted' } | null>(null);\r\n  const [showReviewPopup, setShowReviewPopup] = useState<{ requestId: string, mentorId: string, mentorName: string, topic: string } | null>(null);\r\n  const [reviewRating, setReviewRating] = useState(5);\r\n  const [reviewText, setReviewText] = useState('');\r\n  const [submittingReview, setSubmittingReview] = useState(false);\r\n  const [sessionFilter, setSessionFilter] = useState<'upcoming' | 'pending' | 'past'>('upcoming');\r\n\r\n  // Timer state to force re-render for countdown updates\r\n  const [, setTimerTick] = useState(0);\r\n  const [pastSessionFilter, setPastSessionFilter] = useState<'completed' | 'rejected'>('completed');\r\n\r\n  // Session start popup state\r\n  const [showSessionStartPopup, setShowSessionStartPopup] = useState<{ mentorName: string, topic: string, mode: string, meetingLink?: string } | null>(null);\r\n  const [shownSessionStartIds, setShownSessionStartIds] = useState<Set<string>>(new Set());\r\n  const [requestForm, setRequestForm] = useState({\r\n    offeringId: '',\r\n    topic: '',\r\n    message: '',\r\n    preferredDate: '',\r\n    preferredTime: '',\r\n  });\r\n\r\n  const [recommendations, setRecommendations] = useState<MatchScore[]>([]);\r\n\r\n  useEffect(() => {\r\n    loadMentors();\r\n    // Check if we should open sessions view (from notification click)\r\n    const openSessions = localStorage.getItem('openSessionsView');\r\n    if (openSessions === 'true') {\r\n      setActiveView('sessions');\r\n      localStorage.removeItem('openSessionsView');\r\n    }\r\n\r\n    // Check for pending review (from session_completed notification)\r\n    const pendingReviewData = localStorage.getItem('pendingReview');\r\n    if (pendingReviewData) {\r\n      try {\r\n        const reviewData = JSON.parse(pendingReviewData);\r\n        // We'll load mentor name after we have requests loaded\r\n        setShowReviewPopup({\r\n          requestId: reviewData.sessionId,\r\n          mentorId: reviewData.mentorId,\r\n          mentorName: 'Mentor', // Will be updated when requests load\r\n          topic: reviewData.topic\r\n        });\r\n        localStorage.removeItem('pendingReview');\r\n      } catch (e) {\r\n        console.error('Error parsing pending review data:', e);\r\n        localStorage.removeItem('pendingReview');\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchRecommendations = async () => {\r\n      if (user && userRole === 'student') {\r\n        const recs = await getRecommendedMentors(user.id);\r\n        setRecommendations(recs);\r\n      }\r\n    };\r\n    fetchRecommendations();\r\n  }, [user, userRole]);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      console.log('User detected, loading requests for:', user.id);\r\n\r\n      // Load user role\r\n      getUserProfile(user.id).then(profile => {\r\n        if (profile) setUserRole(profile.role);\r\n      });\r\n\r\n      loadMyRequests();\r\n\r\n      // Subscribe to real-time session request updates\r\n      const subscription = subscribeToSessionRequests(user.id, 'student', () => {\r\n        console.log('Real-time update detected, reloading requests');\r\n        loadMyRequests();\r\n      });\r\n\r\n      return () => {\r\n        console.log('Unsubscribing from session requests');\r\n        subscription.unsubscribe();\r\n      };\r\n    } else {\r\n      console.log('No user available yet');\r\n    }\r\n  }, [user]);\r\n\r\n  // Removed useEffect for filtering as we now use useMemo\r\n\r\n  // Update timer every second to refresh countdown displays in real-time\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setTimerTick(tick => tick + 1);\r\n\r\n      // Check for sessions starting now\r\n      const acceptedRequests = myRequests.filter(r => r.status === 'accepted');\r\n      for (const request of acceptedRequests) {\r\n        if (request.preferredDate && request.preferredTime &&\r\n          isSessionStartingNow(request.preferredDate, request.preferredTime) &&\r\n          !shownSessionStartIds.has(request.id)) {\r\n          // Show popup for this session\r\n          setShowSessionStartPopup({\r\n            mentorName: request.mentorProfile?.fullName || 'Your Mentor',\r\n            topic: request.topic,\r\n            mode: request.mode || 'chat',\r\n            meetingLink: request.meetingLink\r\n          });\r\n          setShownSessionStartIds(prev => new Set([...prev, request.id]));\r\n          // Play notification sound\r\n          try {\r\n            const audio = new Audio('/notification.mp3');\r\n            audio.volume = 0.5;\r\n            audio.play().catch(() => { });\r\n          } catch (e) { }\r\n          break; // Only show one popup at a time\r\n        }\r\n      }\r\n\r\n      // Check for pending review from session_completed notification (in case we're already on this page)\r\n      const pendingReviewData = localStorage.getItem('pendingReview');\r\n      if (pendingReviewData && !showReviewPopup) {\r\n        try {\r\n          const reviewData = JSON.parse(pendingReviewData);\r\n          setShowReviewPopup({\r\n            requestId: reviewData.sessionId,\r\n            mentorId: reviewData.mentorId,\r\n            mentorName: 'Mentor',\r\n            topic: reviewData.topic\r\n          });\r\n          localStorage.removeItem('pendingReview');\r\n          // Play notification sound\r\n          try {\r\n            const audio = new Audio('/notification.mp3');\r\n            audio.volume = 0.5;\r\n            audio.play().catch(() => { });\r\n          } catch (e) { }\r\n        } catch (e) {\r\n          console.error('Error parsing pending review data:', e);\r\n          localStorage.removeItem('pendingReview');\r\n        }\r\n      }\r\n    }, 1000); // Update every second\r\n    return () => clearInterval(interval);\r\n  }, [myRequests, shownSessionStartIds, showReviewPopup]);\r\n\r\n  const loadMentors = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await fetchMentorsFromProfiles().catch(err => {\r\n        console.error('Error loading mentors:', err);\r\n        return [];\r\n      });\r\n\r\n\r\n      // Batch fetch reviews and offerings for all mentors in parallel\r\n      const mentorIds = data.map(m => m.id);\r\n      const [reviewsMap, offeringsMap] = await Promise.all([\r\n        fetchAllMentorReviews(mentorIds, 3),\r\n        fetchAllMentorOfferings(mentorIds),\r\n      ]);\r\n\r\n      // Map reviews and offerings to mentors, compute real ratings\r\n      const mentorsWithData = data.map(mentor => {\r\n        const mentorReviews = reviewsMap.get(mentor.id) || [];\r\n        const mentorOfferings = offeringsMap.get(mentor.id) || [];\r\n        const avgRating = mentorReviews.length > 0\r\n          ? mentorReviews.reduce((sum: number, r: any) => sum + (r.rating || 0), 0) / mentorReviews.length\r\n          : 0;\r\n        return {\r\n          ...mentor,\r\n          reviews: mentorReviews,\r\n          offerings: mentorOfferings,\r\n          rating: avgRating,\r\n          totalReviews: mentorReviews.length,\r\n        };\r\n      });\r\n\r\n\r\n      setMentors(mentorsWithData);\r\n    } catch (error) {\r\n      console.error('Error loading mentors:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadMyRequests = async () => {\r\n    if (!user) return;\r\n    console.log('=== Loading my requests for user:', user.id);\r\n    try {\r\n      const data = await fetchSessionRequests(user.id, 'student').catch(err => {\r\n        console.error('Error loading requests:', err);\r\n        return [];\r\n      });\r\n      console.log('=== Loaded session requests:', data);\r\n      console.log('=== Number of requests:', data.length);\r\n      if (data.length > 0) {\r\n        console.log('=== First request:', data[0]);\r\n        console.log('=== First request status:', data[0].status);\r\n      }\r\n      setMyRequests(data);\r\n      console.log('=== State updated with requests');\r\n    } catch (error) {\r\n      console.error('Error loading requests:', error);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleViewMentor = async (mentor: Mentor) => {\r\n    setSelectedMentor(mentor);\r\n    const [offerings, reviews] = await Promise.all([\r\n      fetchMentorOfferings(mentor.id),\r\n      fetchMentorReviews(mentor.id)\r\n    ]);\r\n    setMentorOfferings(offerings);\r\n    setMentorReviews(reviews);\r\n\r\n    // If a domain filter is selected, pre-fill the topic\r\n    if (selectedOfferingType) {\r\n      setRequestForm(prev => ({ ...prev, topic: selectedOfferingType }));\r\n    }\r\n  };\r\n\r\n  const handleRequestSession = async () => {\r\n    if (!user || !selectedMentor) return;\r\n\r\n    console.log('Starting session request...');\r\n    // Validate required fields\r\n    if (!requestForm.topic.trim()) {\r\n      alert('Please enter a topic for the session');\r\n      return;\r\n    }\r\n\r\n    if (!requestForm.preferredDate) {\r\n      alert('Please select a preferred date for the session');\r\n      return;\r\n    }\r\n\r\n    if (!requestForm.preferredTime) {\r\n      alert('Please select a preferred time for the session');\r\n      return;\r\n    }\r\n\r\n    // Validate that the selected date/time is in the future\r\n    const selectedDateTime = new Date(`${requestForm.preferredDate}T${requestForm.preferredTime}`);\r\n    if (selectedDateTime <= new Date()) {\r\n      alert('Please select a future date and time for the session');\r\n      return;\r\n    }\r\n\r\n    // Get the selected offering to extract mode - if filter applied, find matching offering\r\n    let selectedOffering = mentorOfferings.find(o => o.id === requestForm.offeringId);\r\n    if (!selectedOffering && selectedOfferingType) {\r\n      // Try to find an offering matching the filter type\r\n      selectedOffering = mentorOfferings.find(o =>\r\n        o.title.toLowerCase().includes(selectedOfferingType.toLowerCase())\r\n      );\r\n    }\r\n    const sessionMode = selectedOffering?.mode || 'video'; // Default to video if no offering\r\n\r\n    // Build the topic - include the offering type if filter was applied\r\n    const finalTopic = selectedOfferingType\r\n      ? `[${selectedOfferingType}] ${requestForm.topic}`\r\n      : requestForm.topic;\r\n\r\n    const request = {\r\n      mentor_id: selectedMentor.id,\r\n      student_id: user.id,\r\n      offering_id: selectedOffering?.id || null,\r\n      topic: finalTopic,\r\n      student_message: requestForm.message,\r\n      preferred_date: requestForm.preferredDate,\r\n      preferred_time: requestForm.preferredTime,\r\n      mode: sessionMode,\r\n      status: 'pending',\r\n    };\r\n\r\n    console.log('Submitting request:', request);\r\n    const result = await createSessionRequest(request);\r\n    if (result.error) {\r\n      console.error('Error creating session request:', result.error);\r\n      alert('Failed to send session request. Please try again.');\r\n      return;\r\n    }\r\n\r\n    if (result.data) {\r\n      console.log('Session request created successfully!');\r\n      // Close the form and modal\r\n      setShowRequestForm(false);\r\n      setSelectedMentor(null);\r\n\r\n      // Reset form\r\n      setRequestForm({\r\n        offeringId: '',\r\n        topic: '',\r\n        message: '',\r\n        preferredDate: '',\r\n        preferredTime: '',\r\n      });\r\n\r\n      // Reload requests to show the new one\r\n      console.log('Reloading requests...');\r\n      await loadMyRequests();\r\n\r\n      // Small delay to ensure state updates\r\n      setTimeout(() => {\r\n        console.log('After state update - myRequests:', myRequests);\r\n      }, 100);\r\n\r\n      // Switch to sessions view to show the pending request\r\n      console.log('Switching to sessions view');\r\n      setActiveView('sessions');\r\n      setSessionFilter('pending');\r\n\r\n      // Show success popup\r\n      setShowSuccessPopup(true);\r\n      setTimeout(() => setShowSuccessPopup(false), 4000);\r\n    }\r\n  };\r\n\r\n  const allDomains = Array.from(new Set(mentors.flatMap(m => m.domain)));\r\n\r\n  // Predefined offering types for filtering\r\n  const predefinedOfferingTypes = [\r\n    '1:1 Mentorship',\r\n    'Doubt Solving',\r\n    'Resume Review',\r\n    'Project Guidance',\r\n    'Career Guidance',\r\n    'Mock Interview'\r\n  ];\r\n\r\n  const pendingRequests = myRequests.filter(r => r.status === 'pending');\r\n  const acceptedRequests = myRequests.filter(r => r.status === 'accepted');\r\n  const completedRequests = myRequests.filter(r => r.status === 'completed');\r\n  const rejectedRequests = myRequests.filter(r => r.status === 'rejected' || r.status === 'cancelled');\r\n\r\n  const handleCompleteSession = async (requestId: string, mentorId: string, mentorName: string, topic: string) => {\r\n    await completeSessionRequest(requestId);\r\n    setShowConfirmPopup(null);\r\n    // Show review popup after completing session\r\n    setShowReviewPopup({ requestId, mentorId, mentorName, topic });\r\n    loadMyRequests();\r\n  };\r\n\r\n  const handleSubmitReview = async () => {\r\n    if (!showReviewPopup || !user) return;\r\n\r\n    setSubmittingReview(true);\r\n    try {\r\n      await submitMentorReview(\r\n        showReviewPopup.mentorId,\r\n        user.id,\r\n        showReviewPopup.requestId,\r\n        reviewRating,\r\n        reviewText\r\n      );\r\n      setShowReviewPopup(null);\r\n      setReviewRating(5);\r\n      setReviewText('');\r\n      setShowActionSuccessPopup({ type: 'completed' });\r\n      setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    } catch (error) {\r\n      console.error('Error submitting review:', error);\r\n    } finally {\r\n      setSubmittingReview(false);\r\n    }\r\n  };\r\n\r\n  const handleSkipReview = () => {\r\n    setShowReviewPopup(null);\r\n    setReviewRating(5);\r\n    setReviewText('');\r\n    setShowActionSuccessPopup({ type: 'completed' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n  };\r\n\r\n  const handleCancelSession = async (requestId: string) => {\r\n    await cancelSessionRequest(requestId);\r\n    setShowConfirmPopup(null);\r\n    setShowActionSuccessPopup({ type: 'cancelled' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    loadMyRequests();\r\n  };\r\n\r\n  const handleDeleteSession = async (requestId: string) => {\r\n    await deleteSessionRequest(requestId);\r\n    setShowDeletePopup(null);\r\n    setShowActionSuccessPopup({ type: 'deleted' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    loadMyRequests();\r\n  };\r\n\r\n  console.log('=== RENDER - My Requests:', myRequests);\r\n  console.log('=== RENDER - Pending Requests:', pendingRequests);\r\n  console.log('=== RENDER - Accepted Requests:', acceptedRequests);\r\n  console.log('=== RENDER - Active View:', activeView);\r\n  console.log('=== RENDER - Auth Loading:', authLoading);\r\n  console.log('=== RENDER - User:', user?.id);\r\n\r\n  if (loading || authLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4\"></div>\r\n          <p className={isDarkMode ? 'text-slate-300' : 'text-slate-600'}>\r\n            {authLoading ? 'Authenticating...' : 'Loading mentors...'}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`min-h-screen px-4 sm:px-6 lg:px-8 ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n      {/* Success Popup */}\r\n      {showSuccessPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mb-4\">\r\n                <CheckCircle className=\"w-10 h-10 text-green-500\" />\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                Request Sent Successfully!\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                Your session booking request has been sent to the mentor.\r\n              </p>\r\n              <p className={`text-sm mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                You'll be notified once they respond.\r\n              </p>\r\n              <button\r\n                onClick={() => setShowSuccessPopup(false)}\r\n                className=\"mt-6 px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium\"\r\n              >\r\n                Got it!\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Confirmation Popup */}\r\n      {showConfirmPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-md ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${showConfirmPopup.type === 'complete' ? 'bg-green-500/20' : 'bg-red-500/20'\r\n                }`}>\r\n                {showConfirmPopup.type === 'complete' ? (\r\n                  <CheckCheck className=\"w-10 h-10 text-green-500\" />\r\n                ) : (\r\n                  <XCircle className=\"w-10 h-10 text-red-500\" />\r\n                )}\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                {showConfirmPopup.type === 'complete' ? 'Mark Session Complete?' : 'Cancel Session?'}\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                {showConfirmPopup.type === 'complete'\r\n                  ? `Are you sure you want to mark \"${showConfirmPopup.topic}\" as completed?`\r\n                  : `Are you sure you want to cancel \"${showConfirmPopup.topic}\"?`\r\n                }\r\n              </p>\r\n              <p className={`text-sm mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                The mentor will be notified of this action.\r\n              </p>\r\n              <div className=\"flex gap-3 mt-6\">\r\n                <button\r\n                  onClick={() => setShowConfirmPopup(null)}\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${isDarkMode ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                    }`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={() => showConfirmPopup.type === 'complete'\r\n                    ? handleCompleteSession(\r\n                      showConfirmPopup.requestId,\r\n                      showConfirmPopup.mentorId || '',\r\n                      showConfirmPopup.mentorName || 'Mentor',\r\n                      showConfirmPopup.topic\r\n                    )\r\n                    : handleCancelSession(showConfirmPopup.requestId)\r\n                  }\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${showConfirmPopup.type === 'complete'\r\n                    ? 'bg-green-500 hover:bg-green-600 text-white'\r\n                    : 'bg-red-500 hover:bg-red-600 text-white'\r\n                    }`}\r\n                >\r\n                  {showConfirmPopup.type === 'complete' ? 'Yes, Complete' : 'Yes, Cancel'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Popup */}\r\n      {showDeletePopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-md ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4\">\r\n                <Trash2 className=\"w-10 h-10 text-red-500\" />\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                Delete Session?\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                Are you sure you want to delete \"{showDeletePopup.topic}\" from your history?\r\n              </p>\r\n              <p className={`text-sm mt-1 text-red-500 font-medium`}>\r\n                This action cannot be undone.\r\n              </p>\r\n              <div className=\"flex gap-3 mt-6\">\r\n                <button\r\n                  onClick={() => setShowDeletePopup(null)}\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${isDarkMode ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                    }`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDeleteSession(showDeletePopup.requestId)}\r\n                  className=\"px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  Yes, Delete\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Action Success Popup */}\r\n      {showActionSuccessPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${showActionSuccessPopup.type === 'completed' ? 'bg-green-500/20' :\r\n                showActionSuccessPopup.type === 'deleted' ? 'bg-red-500/20' : 'bg-amber-500/20'\r\n                }`}>\r\n                {showActionSuccessPopup.type === 'completed' ? (\r\n                  <CheckCheck className=\"w-10 h-10 text-green-500\" />\r\n                ) : showActionSuccessPopup.type === 'deleted' ? (\r\n                  <Trash2 className=\"w-10 h-10 text-red-500\" />\r\n                ) : (\r\n                  <XCircle className=\"w-10 h-10 text-amber-500\" />\r\n                )}\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                {showActionSuccessPopup.type === 'completed' ? 'Session Completed!' :\r\n                  showActionSuccessPopup.type === 'deleted' ? 'Session Deleted!' : 'Session Cancelled'}\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                {showActionSuccessPopup.type === 'completed'\r\n                  ? 'The session has been marked as complete. The mentor has been notified.'\r\n                  : showActionSuccessPopup.type === 'deleted'\r\n                    ? 'The session has been removed from your history.'\r\n                    : 'The session has been cancelled. The mentor has been notified.'\r\n                }\r\n              </p>\r\n              <button\r\n                onClick={() => setShowActionSuccessPopup(null)}\r\n                className={`mt-6 px-6 py-2 rounded-lg font-medium transition-colors ${showActionSuccessPopup.type === 'completed'\r\n                  ? 'bg-green-500 hover:bg-green-600 text-white'\r\n                  : showActionSuccessPopup.type === 'deleted'\r\n                    ? 'bg-red-500 hover:bg-red-600 text-white'\r\n                    : 'bg-amber-500 hover:bg-amber-600 text-white'\r\n                  }`}\r\n              >\r\n                Got it!\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Session Start Popup */}\r\n      {showSessionStartPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-lg w-full mx-4 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mb-4 animate-pulse\">\r\n                <Bell className=\"w-12 h-12 text-green-500\" />\r\n              </div>\r\n              <h3 className={`text-2xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                ðŸŽ‰ Session Starting Now!\r\n              </h3>\r\n              <p className={`text-lg mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                Your session with <span className=\"font-bold text-amber-500\">{showSessionStartPopup.mentorName}</span> is starting!\r\n              </p>\r\n              <p className={`text-sm mb-4 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                Topic: {showSessionStartPopup.topic}\r\n              </p>\r\n              <div className={`flex items-center gap-2 px-4 py-2 rounded-full mb-4 ${showSessionStartPopup.mode === 'video' ? 'bg-blue-500/20 text-blue-500' :\r\n                showSessionStartPopup.mode === 'call' ? 'bg-green-500/20 text-green-500' :\r\n                  'bg-amber-500/20 text-amber-500'\r\n                }`}>\r\n                {showSessionStartPopup.mode === 'video' && <><Video size={18} /> Video Call</>}\r\n                {showSessionStartPopup.mode === 'call' && <><MessageCircle size={18} /> Voice Call</>}\r\n                {showSessionStartPopup.mode === 'chat' && <><MessageCircle size={18} /> Chat</>}\r\n              </div>\r\n              {showSessionStartPopup.meetingLink && (\r\n                <a\r\n                  href={showSessionStartPopup.meetingLink}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"mb-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  Join Meeting Link\r\n                </a>\r\n              )}\r\n              <button\r\n                onClick={() => setShowSessionStartPopup(null)}\r\n                className=\"px-8 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-bold transition-colors\"\r\n              >\r\n                Got it!\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Review Popup */}\r\n      {showReviewPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-lg w-full mx-4 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <button\r\n              onClick={handleSkipReview}\r\n              className={`absolute top-4 right-4 p-2 rounded-full transition-colors ${isDarkMode ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'\r\n                }`}\r\n            >\r\n              <X size={20} />\r\n            </button>\r\n\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center mb-4\">\r\n                <Star className=\"w-10 h-10 text-amber-500\" />\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                Session Completed! ðŸŽ‰\r\n              </h3>\r\n              <p className={`text-sm mb-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                How was your session with <span className=\"font-medium text-amber-500\">{showReviewPopup.mentorName}</span>?\r\n              </p>\r\n              <p className={`text-xs mb-4 ${isDarkMode ? 'text-gray-500' : 'text-gray-500'}`}>\r\n                Topic: {showReviewPopup.topic}\r\n              </p>\r\n\r\n              {/* Star Rating */}\r\n              <div className=\"flex gap-2 mb-4\">\r\n                {[1, 2, 3, 4, 5].map((star) => (\r\n                  <button\r\n                    key={star}\r\n                    onClick={() => setReviewRating(star)}\r\n                    className=\"transition-transform hover:scale-110\"\r\n                  >\r\n                    <Star\r\n                      size={36}\r\n                      className={star <= reviewRating ? 'text-yellow-500' : isDarkMode ? 'text-slate-600' : 'text-slate-300'}\r\n                      fill={star <= reviewRating ? 'currentColor' : 'none'}\r\n                    />\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <p className={`text-sm font-medium mb-4 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                {reviewRating === 5 ? 'Excellent!' : reviewRating === 4 ? 'Very Good!' : reviewRating === 3 ? 'Good' : reviewRating === 2 ? 'Fair' : 'Poor'}\r\n              </p>\r\n\r\n              {/* Review Text */}\r\n              <textarea\r\n                value={reviewText}\r\n                onChange={(e) => setReviewText(e.target.value)}\r\n                placeholder=\"Share your experience with this mentor... (optional)\"\r\n                className={`w-full p-3 rounded-xl mb-4 min-h-[100px] resize-none ${isDarkMode\r\n                  ? 'bg-slate-700 text-white placeholder-slate-400 border border-slate-600'\r\n                  : 'bg-slate-50 text-slate-900 placeholder-slate-400 border border-slate-200'\r\n                  } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n              />\r\n\r\n              <div className=\"flex gap-3 w-full\">\r\n                <button\r\n                  onClick={handleSkipReview}\r\n                  className={`flex-1 px-6 py-2 rounded-lg font-medium transition-colors ${isDarkMode ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                    }`}\r\n                >\r\n                  Skip\r\n                </button>\r\n                <button\r\n                  onClick={handleSubmitReview}\r\n                  disabled={submittingReview}\r\n                  className=\"flex-1 px-6 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {submittingReview ? 'Submitting...' : 'Submit Review'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        {/* Header with View Toggle */}\r\n        <div className=\"mb-8\">\r\n          <h1 className={`text-3xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            {activeView === 'browse' ? 'Find Your Mentor' : 'My Sessions'}\r\n          </h1>\r\n          <p className={`mb-4 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n            {activeView === 'browse'\r\n              ? 'Connect with experienced mentors for guidance, doubt solving, and career advice'\r\n              : 'View and manage your mentorship sessions and requests'}\r\n          </p>\r\n\r\n          {/* View Toggle Tabs */}\r\n          <div className=\"flex gap-2 flex-wrap items-center\">\r\n            <button\r\n              onClick={() => setActiveView('browse')}\r\n              className={`px-6 py-2.5 rounded-xl font-medium transition-all ${activeView === 'browse'\r\n                ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-lg shadow-amber-500/20'\r\n                : isDarkMode\r\n                  ? 'bg-slate-800 text-slate-300 hover:bg-slate-700 border border-slate-700'\r\n                  : 'bg-white text-slate-700 hover:bg-slate-100 border border-slate-200'\r\n                }`}\r\n            >\r\n              <span className=\"flex items-center gap-2\">\r\n                <Search size={18} />\r\n                Browse Mentors\r\n              </span>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveView('sessions')}\r\n              className={`px-6 py-2.5 rounded-xl font-medium transition-all ${activeView === 'sessions'\r\n                ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-lg shadow-amber-500/20'\r\n                : isDarkMode\r\n                  ? 'bg-slate-800 text-slate-300 hover:bg-slate-700 border border-slate-700'\r\n                  : 'bg-white text-slate-700 hover:bg-slate-100 border border-slate-200'\r\n                }`}\r\n            >\r\n              <span className=\"flex items-center gap-2\">\r\n                <BookOpen size={18} />\r\n                My Sessions\r\n                {(pendingRequests.length + acceptedRequests.length) > 0 && (\r\n                  <span className=\"px-2 py-0.5 bg-white/20 text-xs rounded-full font-bold\">\r\n                    {pendingRequests.length + acceptedRequests.length}\r\n                  </span>\r\n                )}\r\n              </span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Browse Mentors View */}\r\n        {activeView === 'browse' && (\r\n          <>\r\n            {/* My Requests Summary - Hidden per user request */}\r\n            {/* {user && (pendingRequests.length > 0 || acceptedRequests.length > 0) && (\r\n              <div className=\"mb-8 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {pendingRequests.length > 0 && (\r\n                  <div className={`p-4 rounded-lg ${isDarkMode ? 'bg-amber-500/10 border border-amber-500/20' : 'bg-amber-50 border border-amber-200'}`}>\r\n                    <p className={`text-sm font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-700'}`}>\r\n                      {pendingRequests.length} Pending Request{pendingRequests.length > 1 ? 's' : ''}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n                {acceptedRequests.length > 0 && (\r\n                  <div className={`p-4 rounded-lg ${isDarkMode ? 'bg-green-500/10 border border-green-500/20' : 'bg-green-50 border border-green-200'}`}>\r\n                    <p className={`text-sm font-medium ${isDarkMode ? 'text-green-400' : 'text-green-700'}`}>\r\n                      {acceptedRequests.length} Accepted Session{acceptedRequests.length > 1 ? 's' : ''}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )} */}\r\n\r\n            {/* Search and Filter */}\r\n            <div className=\"mb-8 space-y-4\">\r\n              <div className=\"relative flex-1\">\r\n                <Search className={`absolute left-4 top-1/2 transform -translate-y-1/2 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} size={20} />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search mentors by name, username, domain, or skills...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className={`w-full pl-12 pr-4 py-3 rounded-xl ${isDarkMode\r\n                    ? 'bg-slate-800 text-white border-slate-700'\r\n                    : 'bg-white text-slate-900 border-slate-300'\r\n                    } border focus:ring-2 focus:ring-amber-500 focus:border-transparent`}\r\n                />\r\n              </div>\r\n\r\n              {/* Simplified Filter - 6 main items */}\r\n              <div className=\"flex items-center gap-2 overflow-x-auto pb-2\">\r\n                <Filter size={18} className={isDarkMode ? 'text-slate-400' : 'text-slate-600'} />\r\n                <button\r\n                  onClick={() => { setSelectedDomain(''); setSelectedOfferingType(''); }}\r\n                  className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-all ${selectedDomain === '' && selectedOfferingType === ''\r\n                    ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md'\r\n                    : isDarkMode\r\n                      ? 'bg-slate-800 text-slate-300 hover:bg-slate-700 border border-slate-700'\r\n                      : 'bg-white text-slate-700 hover:bg-slate-100 border border-slate-200'\r\n                    }`}\r\n                >\r\n                  All\r\n                </button>\r\n                {predefinedOfferingTypes.map(offeringType => (\r\n                  <button\r\n                    key={offeringType}\r\n                    onClick={() => { setSelectedOfferingType(offeringType); setSelectedDomain(''); }}\r\n                    className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-all ${selectedOfferingType === offeringType\r\n                      ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md'\r\n                      : isDarkMode\r\n                        ? 'bg-slate-800 text-slate-300 hover:bg-slate-700 border border-slate-700'\r\n                        : 'bg-white text-slate-700 hover:bg-slate-100 border border-slate-200'\r\n                      }`}\r\n                  >\r\n                    {offeringType}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n\r\n            {/* Recommendations Section */}\r\n            {activeView === 'browse' && !searchQuery && !selectedDomain && !selectedOfferingType && recommendations.length > 0 && (\r\n              <div className=\"mb-8\">\r\n                <div className=\"flex items-center gap-2 mb-4\">\r\n                  <Star className=\"text-amber-500\" fill=\"currentColor\" size={24} />\r\n                  <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Recommended for You\r\n                  </h2>\r\n                </div>\r\n                <div className=\"flex gap-4 overflow-x-auto pb-4 snap-x\">\r\n                  {recommendations.map(match => {\r\n                    const mentor = mentors.find(m => m.id === match.mentorId);\r\n                    if (!mentor) return null;\r\n                    return (\r\n                      <div key={match.mentorId} onClick={() => handleViewMentor(mentor)} className={`min-w-[320px] p-5 rounded-xl border flex-shrink-0 cursor-pointer transition-all hover:scale-[1.02] snap-start ${isDarkMode ? 'bg-slate-800 border-amber-500/30 shadow-lg shadow-amber-900/10' : 'bg-white border-amber-200 shadow-lg shadow-amber-100'}`}>\r\n                        <div className=\"flex items-start justify-between mb-3\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <img src={mentor.avatarUrl} alt={mentor.name} className=\"w-12 h-12 rounded-full border-2 border-amber-500\" />\r\n                            <div>\r\n                              <h3 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{mentor.name}</h3>\r\n                              <div className=\"flex items-center gap-1 text-xs text-amber-500 font-bold\">\r\n                                <Star size={12} fill=\"currentColor\" />\r\n                                {match.matchPercentage}% Match\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                          <span className=\"px-2 py-1 bg-amber-500/10 text-amber-500 text-xs font-bold rounded-lg border border-amber-500/20\">\r\n                            Top Pick\r\n                          </span>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2 mb-4\">\r\n                          {match.reasoning.slice(0, 2).map((reason, i) => (\r\n                            <div key={i} className={`text-xs px-2 py-1 rounded flex items-center gap-1 ${isDarkMode ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>\r\n                              <CheckCheck size={12} className=\"text-green-500\" />\r\n                              {reason}\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2 mt-auto\">\r\n                          <button className=\"flex-1 py-1.5 bg-amber-500 text-white text-sm font-bold rounded-lg hover:bg-amber-600 transition-colors\">\r\n                            View Profile\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Mentors Grid */}\r\n            {filteredMentors.length === 0 ? (\r\n              <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                <GraduationCap className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No mentors found</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {filteredMentors.map(mentor => (\r\n                  <div\r\n                    key={mentor.id}\r\n                    className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg hover:shadow-xl transition-all cursor-pointer`}\r\n                    onClick={() => handleViewMentor(mentor)}\r\n                  >\r\n                    {/* Mentor Header */}\r\n                    <div className=\"flex items-start gap-4 mb-4\">\r\n                      <img\r\n                        src={mentor.avatarUrl}\r\n                        alt={mentor.name}\r\n                        className=\"w-16 h-16 rounded-full\"\r\n                      />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-1\">\r\n                          <h3 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            {mentor.name}\r\n                          </h3>\r\n                          {mentor.isVerified && (\r\n                            <Shield className=\"text-blue-500\" size={16} />\r\n                          )}\r\n                        </div>\r\n                        {mentor.username && (\r\n                          <p className={`text-xs mb-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                            @{mentor.username}\r\n                          </p>\r\n                        )}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"flex items-center gap-1\">\r\n                            <Star className=\"text-yellow-500\" size={14} fill=\"currentColor\" />\r\n                            <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                              {mentor.rating.toFixed(1)}\r\n                            </span>\r\n                          </div>\r\n                          <span className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                            ({mentor.totalReviews} reviews)\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Domain Tags */}\r\n                    {mentor.domain.length > 0 && (\r\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                        {mentor.domain.map((d, idx) => (\r\n                          <span\r\n                            key={idx}\r\n                            className=\"px-2 py-1 bg-amber-500/10 text-amber-500 text-xs rounded-full font-medium\"\r\n                          >\r\n                            {d}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Experience */}\r\n                    {(mentor.experienceYears || mentor.company) && (\r\n                      <div className=\"flex items-center gap-2 mb-3\">\r\n                        <Briefcase size={14} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                        <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                          {mentor.experienceYears && `${mentor.experienceYears}+ yrs`}\r\n                          {mentor.company && ` â€¢ ${mentor.company}`}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Bio */}\r\n                    <p className={`text-sm line-clamp-2 mb-4 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                      {mentor.bio || 'Experienced mentor ready to help you grow!'}\r\n                    </p>\r\n\r\n                    {/* Offerings Tags Preview (when no filter applied) */}\r\n                    {!selectedOfferingType && mentor.offerings && mentor.offerings.length > 0 && (\r\n                      <div className=\"flex flex-wrap gap-1 mb-4\">\r\n                        {mentor.offerings.slice(0, 3).map((offering: any, idx: number) => (\r\n                          <span\r\n                            key={idx}\r\n                            className={`px-2 py-1 text-xs rounded-full font-medium ${isDarkMode ? 'bg-purple-500/15 text-purple-400 border border-purple-500/20' : 'bg-purple-50 text-purple-600 border border-purple-200'}`}\r\n                          >\r\n                            {offering.title}{offering.isFree ? '' : ` â€¢ â‚¹${offering.price}`}\r\n                          </span>\r\n                        ))}\r\n                        {mentor.offerings.length > 3 && (\r\n                          <span className={`px-2 py-1 text-xs rounded-full ${isDarkMode ? 'bg-slate-700 text-slate-400' : 'bg-slate-100 text-slate-500'}`}>\r\n                            +{mentor.offerings.length - 3} more\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Matched Offering Preview (when filter is applied) */}\r\n                    {selectedOfferingType && mentor.offerings && mentor.offerings.filter(o =>\r\n                      o.title.toLowerCase().includes(selectedOfferingType.toLowerCase())\r\n                    ).length > 0 && (\r\n                        <div className={`p-3 rounded-lg mb-4 ${isDarkMode ? 'bg-amber-500/10 border border-amber-500/20' : 'bg-amber-50 border border-amber-200'}`}>\r\n                          <p className={`text-xs font-medium mb-2 ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                            {selectedOfferingType} Offerings:\r\n                          </p>\r\n                          {mentor.offerings.filter(o =>\r\n                            o.title.toLowerCase().includes(selectedOfferingType.toLowerCase())\r\n                          ).slice(0, 2).map((offering, idx) => (\r\n                            <div key={idx} className=\"flex items-center justify-between text-sm\">\r\n                              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>{offering.title}</span>\r\n                              <span className={`text-xs ${offering.isFree ? 'text-green-500' : 'text-amber-500'}`}>\r\n                                {offering.isFree ? 'Free' : `â‚¹${offering.price}`}\r\n                              </span>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n\r\n                    {/* Skills Preview */}\r\n                    {mentor.skills.length > 0 && !selectedOfferingType && (\r\n                      <div className=\"flex flex-wrap gap-1 mb-4\">\r\n                        {mentor.skills.slice(0, 3).map((skill, idx) => (\r\n                          <span\r\n                            key={idx}\r\n                            className={`px-2 py-1 text-xs rounded ${isDarkMode\r\n                              ? 'bg-slate-700 text-slate-300'\r\n                              : 'bg-slate-100 text-slate-700'\r\n                              }`}\r\n                          >\r\n                            {skill}\r\n                          </span>\r\n                        ))}\r\n                        {mentor.skills.length > 3 && (\r\n                          <span className={`px-2 py-1 text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                            +{mentor.skills.length - 3} more\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Recent Reviews */}\r\n                    {mentor.reviews && mentor.reviews.length > 0 && (\r\n                      <div className={`mt-4 pt-4 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                        <h4 className={`text-sm font-medium mb-3 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          Recent Reviews\r\n                        </h4>\r\n                        <div className=\"space-y-3\">\r\n                          {mentor.reviews.slice(0, 2).map((review) => (\r\n                            <div key={review.id} className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-700/50' : 'bg-slate-50'}`}>\r\n                              <div className=\"flex items-start gap-2\">\r\n                                {review.studentAvatarUrl ? (\r\n                                  <img\r\n                                    src={review.studentAvatarUrl}\r\n                                    alt={review.studentName}\r\n                                    className=\"w-8 h-8 rounded-full object-cover flex-shrink-0\"\r\n                                  />\r\n                                ) : (\r\n                                  <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${isDarkMode ? 'bg-slate-600' : 'bg-slate-200'\r\n                                    }`}>\r\n                                    <User className=\"w-4 h-4\" />\r\n                                  </div>\r\n                                )}\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                  <div className=\"flex items-center justify-between gap-2 mb-1\">\r\n                                    <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-200' : 'text-slate-800'}`}>\r\n                                      {review.studentName}\r\n                                    </span>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                      {[...Array(5)].map((_, i) => (\r\n                                        <Star\r\n                                          key={i}\r\n                                          className={`w-3 h-3 ${i < review.rating\r\n                                            ? 'fill-amber-500 text-amber-500'\r\n                                            : isDarkMode\r\n                                              ? 'text-slate-600'\r\n                                              : 'text-slate-300'\r\n                                            }`}\r\n                                        />\r\n                                      ))}\r\n                                    </div>\r\n                                  </div>\r\n                                  {review.reviewText && (\r\n                                    <p className={`text-xs line-clamp-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                      {review.reviewText}\r\n                                    </p>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          ))}\r\n                          {mentor.reviews.length > 2 && (\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                handleViewMentor(mentor);\r\n                              }}\r\n                              className={`text-xs ${isDarkMode ? 'text-amber-400 hover:text-amber-300' : 'text-amber-600 hover:text-amber-700'}`}\r\n                            >\r\n                              View all {mentor.reviews.length} reviews\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Buttons - Show Book Session when filter is applied */}\r\n                    {selectedOfferingType ? (\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          className=\"flex-1 py-2 bg-slate-500 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors text-sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleViewMentor(mentor);\r\n                          }}\r\n                        >\r\n                          View Profile\r\n                        </button>\r\n                        <button\r\n                          className=\"flex-1 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition-colors text-sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleViewMentor(mentor);\r\n                            // Auto-open request form after viewing mentor\r\n                            setTimeout(() => setShowRequestForm(true), 100);\r\n                          }}\r\n                        >\r\n                          Book Session\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <button\r\n                        className=\"w-full py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition-colors\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewMentor(mentor);\r\n                        }}\r\n                      >\r\n                        View Profile\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* My Sessions View */}\r\n        {activeView === 'sessions' && (\r\n          <div className=\"space-y-6\">\r\n            {/* Session Filter Tabs */}\r\n            <div className=\"flex gap-2 flex-wrap\">\r\n              <button\r\n                onClick={() => setSessionFilter('upcoming')}\r\n                className={`px-4 py-2 rounded-lg font-medium transition-colors ${sessionFilter === 'upcoming'\r\n                  ? 'bg-green-500 text-white'\r\n                  : isDarkMode\r\n                    ? 'bg-slate-800 text-slate-300 hover:bg-slate-700'\r\n                    : 'bg-white text-slate-700 hover:bg-slate-100'\r\n                  }`}\r\n              >\r\n                <span className=\"flex items-center gap-2\">\r\n                  <CheckCircle size={16} />\r\n                  Upcoming ({acceptedRequests.length})\r\n                </span>\r\n              </button>\r\n              <button\r\n                onClick={() => setSessionFilter('pending')}\r\n                className={`px-4 py-2 rounded-lg font-medium transition-colors ${sessionFilter === 'pending'\r\n                  ? 'bg-amber-500 text-white'\r\n                  : isDarkMode\r\n                    ? 'bg-slate-800 text-slate-300 hover:bg-slate-700'\r\n                    : 'bg-white text-slate-700 hover:bg-slate-100'\r\n                  }`}\r\n              >\r\n                <span className=\"flex items-center gap-2\">\r\n                  <Clock size={16} />\r\n                  Pending ({pendingRequests.length})\r\n                </span>\r\n              </button>\r\n              <button\r\n                onClick={() => setSessionFilter('past')}\r\n                className={`px-4 py-2 rounded-lg font-medium transition-colors ${sessionFilter === 'past'\r\n                  ? 'bg-slate-500 text-white'\r\n                  : isDarkMode\r\n                    ? 'bg-slate-800 text-slate-300 hover:bg-slate-700'\r\n                    : 'bg-white text-slate-700 hover:bg-slate-100'\r\n                  }`}\r\n              >\r\n                <span className=\"flex items-center gap-2\">\r\n                  <BookOpen size={16} />\r\n                  Past Sessions ({completedRequests.length + rejectedRequests.length})\r\n                </span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Upcoming Sessions (Accepted) */}\r\n            {sessionFilter === 'upcoming' && (\r\n              <div>\r\n                <h2 className={`text-2xl font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Upcoming Sessions\r\n                </h2>\r\n                {acceptedRequests.length === 0 ? (\r\n                  <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                    <CheckCircle className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                    <p className={`mb-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>No upcoming sessions yet</p>\r\n                    <p className={`text-sm ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Your accepted sessions will appear here</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-4\">\r\n                    {acceptedRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800 border-2 border-green-500/30' : 'bg-white border-2 border-green-200'} shadow-lg`}\r\n                      >\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <img\r\n                            src={request.mentorProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=mentor'}\r\n                            alt=\"Mentor\"\r\n                            className=\"w-16 h-16 rounded-full\"\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                              <div>\r\n                                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {request.mentorProfile?.fullName || 'Mentor'}\r\n                                </h3>\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  Professional Mentor\r\n                                </p>\r\n                              </div>\r\n                              <span className=\"px-3 py-1 bg-green-500 text-white text-xs font-medium rounded-full flex items-center gap-1\">\r\n                                <CheckCircle size={14} />\r\n                                Confirmed\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 mb-4\">\r\n                              <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-green-500/10 border border-green-500/20' : 'bg-green-50 border border-green-200'}`}>\r\n                                <p className={`font-medium ${isDarkMode ? 'text-green-400' : 'text-green-700'}`}>\r\n                                  ðŸ“š Topic: {request.topic}\r\n                                </p>\r\n                                {request.mode && (\r\n                                  <p className={`text-xs flex items-center gap-2 mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                    <span className=\"font-medium\">Mode:</span>\r\n                                    {request.mode === 'video' && 'ðŸŽ¥ Video Call'}\r\n                                    {request.mode === 'call' && 'ðŸ“ž Voice Call'}\r\n                                    {request.mode === 'chat' && 'ðŸ’¬ Chat Only'}\r\n                                  </p>\r\n                                )}\r\n                                {request.preferredDate && (\r\n                                  <p className={`text-sm flex items-center gap-2 mt-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                    <Calendar size={16} />\r\n                                    {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                  </p>\r\n                                )}\r\n                                {/* Countdown Timer */}\r\n                                {request.preferredDate && request.preferredTime && (\r\n                                  <div className={`mt-2 p-2 rounded-lg flex items-center gap-2 ${isSessionIn30Minutes(request.preferredDate, request.preferredTime)\r\n                                    ? 'bg-amber-500/20 border border-amber-500/40'\r\n                                    : isDarkMode ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-blue-50 border border-blue-200'\r\n                                    }`}>\r\n                                    <Timer size={16} className={isSessionIn30Minutes(request.preferredDate, request.preferredTime) ? 'text-amber-500 animate-pulse' : 'text-blue-500'} />\r\n                                    <span className={`text-sm font-medium ${isSessionIn30Minutes(request.preferredDate, request.preferredTime)\r\n                                      ? 'text-amber-500'\r\n                                      : isDarkMode ? 'text-blue-400' : 'text-blue-600'\r\n                                      }`}>\r\n                                      {getTimeUntilSession(request.preferredDate, request.preferredTime)}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n\r\n                              {request.mentorResponse && (\r\n                                <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n                                  <p className={`text-xs font-medium mb-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                                    Mentor's Message:\r\n                                  </p>\r\n                                  <p className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                    {request.mentorResponse}\r\n                                  </p>\r\n                                </div>\r\n                              )}\r\n\r\n                              {request.meetingLink && (\r\n                                <a\r\n                                  href={request.meetingLink}\r\n                                  target=\"_blank\"\r\n                                  rel=\"noopener noreferrer\"\r\n                                  className=\"inline-flex items-center gap-2 text-sm text-amber-500 hover:text-amber-600 underline font-medium\"\r\n                                >\r\n                                  <Video size={16} />\r\n                                  Join Meeting Link\r\n                                </a>\r\n                              )}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-2 flex-wrap\">\r\n                              {onStartChat && (\r\n                                <button\r\n                                  onClick={() => onStartChat({\r\n                                    id: request.mentorId,\r\n                                    name: request.mentorProfile?.fullName || 'Mentor',\r\n                                    avatarUrl: request.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(request.mentorProfile?.fullName || 'Mentor')}&background=random`,\r\n                                    status: 'online',\r\n                                    isMentor: true\r\n                                  })}\r\n                                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium ${isDarkMode\r\n                                    ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                    : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                    } transition-colors`}\r\n                                >\r\n                                  <MessageCircle size={18} />\r\n                                  Chat with Mentor\r\n                                </button>\r\n                              )}\r\n                              {request.mode && request.mode !== 'chat' && (\r\n                                <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'} flex items-center`}>\r\n                                  <Video size={14} className=\"mr-1\" />\r\n                                  Mentor will initiate the call\r\n                                </p>\r\n                              )}\r\n                              <button\r\n                                onClick={() => setShowConfirmPopup({\r\n                                  type: 'complete',\r\n                                  requestId: request.id,\r\n                                  topic: request.topic,\r\n                                  mentorId: request.mentorId,\r\n                                  mentorName: request.mentorProfile?.fullName || 'Mentor'\r\n                                })}\r\n                                disabled={!hasSessionStarted(request.preferredDate || '', request.preferredTime || '')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${hasSessionStarted(request.preferredDate || '', request.preferredTime || '')\r\n                                  ? 'bg-amber-500 hover:bg-amber-600 text-white cursor-pointer'\r\n                                  : 'bg-slate-400 text-slate-200 cursor-not-allowed opacity-60'\r\n                                  }`}\r\n                                title={!hasSessionStarted(request.preferredDate || '', request.preferredTime || '') ? 'Session has not started yet' : ''}\r\n                              >\r\n                                <CheckCheck size={18} />\r\n                                Mark Complete\r\n                              </button>\r\n                              <button\r\n                                onClick={() => setShowConfirmPopup({ type: 'cancel', requestId: request.id, topic: request.topic })}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors\"\r\n                              >\r\n                                <XCircle size={18} />\r\n                                Cancel Session\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Pending Requests */}\r\n            {sessionFilter === 'pending' && (\r\n              <div>\r\n                <h2 className={`text-2xl font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Pending Requests\r\n                </h2>\r\n                {pendingRequests.length === 0 ? (\r\n                  <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                    <Clock className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                    <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No pending requests</p>\r\n                    <button\r\n                      onClick={() => setActiveView('browse')}\r\n                      className=\"mt-4 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition-colors\"\r\n                    >\r\n                      Browse Mentors\r\n                    </button>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-4\">\r\n                    {pendingRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}\r\n                      >\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <img\r\n                            src={request.mentorProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=mentor'}\r\n                            alt=\"Mentor\"\r\n                            className=\"w-16 h-16 rounded-full\"\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                              <div>\r\n                                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {request.mentorProfile?.fullName || 'Mentor'}\r\n                                </h3>\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  Professional Mentor\r\n                                </p>\r\n                              </div>\r\n                              <span className=\"px-3 py-1 bg-amber-500/10 text-amber-500 text-xs font-medium rounded-full\">\r\n                                Pending\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 mb-4\">\r\n                              <p className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                Topic: {request.topic}\r\n                              </p>\r\n                              {request.studentMessage && (\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  \"{request.studentMessage}\"\r\n                                </p>\r\n                              )}\r\n                              {request.preferredDate && (\r\n                                <p className={`text-sm flex items-center gap-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  <Calendar size={16} />\r\n                                  {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                </p>\r\n                              )}\r\n                              <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                                Requested on {new Date(request.createdAt).toLocaleDateString()}\r\n                              </p>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-2\">\r\n                              {onStartChat && (\r\n                                <button\r\n                                  onClick={() => onStartChat({\r\n                                    id: request.mentorId,\r\n                                    name: request.mentorProfile?.fullName || 'Mentor',\r\n                                    avatarUrl: request.mentorProfile?.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(request.mentorProfile?.fullName || 'Mentor')}&background=random`,\r\n                                    status: 'online',\r\n                                    isMentor: true\r\n                                  })}\r\n                                  className={`flex items-center gap-2 px-4 py-2 rounded-lg ${isDarkMode\r\n                                    ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                    : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                    } transition-colors`}\r\n                                >\r\n                                  <MessageCircle size={18} />\r\n                                  Chat with Mentor\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Past Sessions */}\r\n            {sessionFilter === 'past' && (\r\n              <div>\r\n                <div className=\"flex items-center justify-between mb-4 flex-wrap gap-3\">\r\n                  <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Past Sessions\r\n                  </h2>\r\n                  {/* Past Session Filter Buttons */}\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      onClick={() => setPastSessionFilter('completed')}\r\n                      className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5 ${pastSessionFilter === 'completed'\r\n                        ? 'bg-green-500 text-white'\r\n                        : isDarkMode\r\n                          ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                          : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\r\n                        }`}\r\n                    >\r\n                      <CheckCheck size={14} />\r\n                      Completed ({completedRequests.length})\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setPastSessionFilter('rejected')}\r\n                      className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5 ${pastSessionFilter === 'rejected'\r\n                        ? 'bg-red-500 text-white'\r\n                        : isDarkMode\r\n                          ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                          : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\r\n                        }`}\r\n                    >\r\n                      <XCircle size={14} />\r\n                      Rejected/Cancelled ({rejectedRequests.length})\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {pastSessionFilter === 'completed' && (\r\n                  <>\r\n                    {completedRequests.length === 0 ? (\r\n                      <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                        <CheckCheck className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                        <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No completed sessions yet</p>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-4\">\r\n                        {completedRequests.map(request => (\r\n                          <div\r\n                            key={request.id}\r\n                            className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-100'}`}\r\n                          >\r\n                            <div className=\"flex items-start gap-4\">\r\n                              <img\r\n                                src={request.mentorProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=mentor'}\r\n                                alt=\"Mentor\"\r\n                                className=\"w-12 h-12 rounded-full\"\r\n                              />\r\n                              <div className=\"flex-1\">\r\n                                <div className=\"flex items-start justify-between mb-2\">\r\n                                  <div>\r\n                                    <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                      {request.mentorProfile?.fullName || 'Mentor'}\r\n                                    </h3>\r\n                                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                      {request.topic}\r\n                                    </p>\r\n                                    {request.preferredDate && (\r\n                                      <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                        ðŸ“… {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                      </p>\r\n                                    )}\r\n                                  </div>\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"px-3 py-1 bg-green-500/10 text-green-500 text-xs font-medium rounded-full flex items-center gap-1\">\r\n                                      <CheckCheck size={12} />\r\n                                      Completed\r\n                                    </span>\r\n                                    <button\r\n                                      onClick={() => setShowDeletePopup({ requestId: request.id, topic: request.topic })}\r\n                                      className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-700 text-slate-400 hover:text-red-400' : 'hover:bg-slate-200 text-slate-500 hover:text-red-500'\r\n                                        }`}\r\n                                      title=\"Delete session\"\r\n                                    >\r\n                                      <Trash2 size={16} />\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                {/* Display Review if exists */}\r\n                                {request.review ? (\r\n                                  <div className={`mt-3 p-3 rounded-lg ${isDarkMode ? 'bg-slate-900/50' : 'bg-white'} border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                      <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                        Your Review:\r\n                                      </span>\r\n                                      <div className=\"flex items-center gap-0.5\">\r\n                                        {[1, 2, 3, 4, 5].map((star) => (\r\n                                          <Star\r\n                                            key={star}\r\n                                            size={16}\r\n                                            className={star <= request.review!.rating\r\n                                              ? 'text-amber-500 fill-amber-500'\r\n                                              : isDarkMode ? 'text-slate-600' : 'text-slate-300'\r\n                                            }\r\n                                          />\r\n                                        ))}\r\n                                      </div>\r\n                                      <span className={`text-sm font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                                        {request.review.rating}/5\r\n                                      </span>\r\n                                    </div>\r\n                                    {request.review.reviewText && (\r\n                                      <p className={`text-sm italic ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                        \"{request.review.reviewText}\"\r\n                                      </p>\r\n                                    )}\r\n                                  </div>\r\n                                ) : (\r\n                                  <p className={`mt-2 text-xs italic ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                                    You haven't reviewed this session yet\r\n                                  </p>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n\r\n                {pastSessionFilter === 'rejected' && (\r\n                  <>\r\n                    {rejectedRequests.length === 0 ? (\r\n                      <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                        <XCircle className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                        <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No rejected or cancelled sessions</p>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"space-y-4\">\r\n                        {rejectedRequests.map(request => (\r\n                          <div\r\n                            key={request.id}\r\n                            className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-100'}`}\r\n                          >\r\n                            <div className=\"flex items-start gap-4\">\r\n                              <img\r\n                                src={request.mentorProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=mentor'}\r\n                                alt=\"Mentor\"\r\n                                className=\"w-12 h-12 rounded-full\"\r\n                              />\r\n                              <div className=\"flex-1\">\r\n                                <div className=\"flex items-start justify-between mb-2\">\r\n                                  <div>\r\n                                    <h3 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                      {request.mentorProfile?.fullName || 'Mentor'}\r\n                                    </h3>\r\n                                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                      {request.topic}\r\n                                    </p>\r\n                                    {request.preferredDate && (\r\n                                      <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                        ðŸ“… {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                      </p>\r\n                                    )}\r\n                                    {request.mentorResponse && (\r\n                                      <p className={`text-sm mt-1 italic ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                        \"{request.mentorResponse}\"\r\n                                      </p>\r\n                                    )}\r\n                                  </div>\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <span className={`px-3 py-1 text-xs font-medium rounded-full flex items-center gap-1 ${request.status === 'cancelled'\r\n                                      ? 'bg-slate-500/10 text-slate-500'\r\n                                      : 'bg-red-500/10 text-red-500'\r\n                                      }`}>\r\n                                      <XCircle size={12} />\r\n                                      {request.status === 'cancelled' ? 'Cancelled' : 'Rejected'}\r\n                                    </span>\r\n                                    <button\r\n                                      onClick={() => setShowDeletePopup({ requestId: request.id, topic: request.topic })}\r\n                                      className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-700 text-slate-400 hover:text-red-400' : 'hover:bg-slate-200 text-slate-500 hover:text-red-500'\r\n                                        }`}\r\n                                      title=\"Delete session\"\r\n                                    >\r\n                                      <Trash2 size={16} />\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Mentor Detail Modal */}\r\n        {selectedMentor && (\r\n          <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n            <div className={`max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'\r\n              } shadow-2xl`}>\r\n              <div className=\"sticky top-0 z-10 flex justify-between items-center p-6 border-b border-slate-300 dark:border-slate-700 bg-inherit\">\r\n                <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Mentor Profile\r\n                </h2>\r\n                <button\r\n                  onClick={() => {\r\n                    setSelectedMentor(null);\r\n                    setShowRequestForm(false);\r\n                  }}\r\n                  className={`p-2 rounded-lg ${isDarkMode\r\n                    ? 'hover:bg-slate-700 text-slate-300'\r\n                    : 'hover:bg-slate-100 text-slate-600'\r\n                    } transition-colors`}\r\n                >\r\n                  <X size={24} />\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"p-6 space-y-6\">\r\n                {/* Profile Header */}\r\n                <div className=\"flex items-start gap-6\">\r\n                  <img\r\n                    src={selectedMentor.avatarUrl}\r\n                    alt={selectedMentor.name}\r\n                    className=\"w-24 h-24 rounded-full border-4 border-amber-500/30 shadow-xl\"\r\n                  />\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                      <h3 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        {selectedMentor.name}\r\n                      </h3>\r\n                      {selectedMentor.isVerified && (\r\n                        <Shield className=\"text-blue-500\" size={20} />\r\n                      )}\r\n                    </div>\r\n                    {selectedMentor.username && (\r\n                      <p className={`text-sm mb-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                        @{selectedMentor.username}\r\n                      </p>\r\n                    )}\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Star className=\"text-yellow-500\" size={18} fill=\"currentColor\" />\r\n                        <span className={`font-semibold ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          {selectedMentor.rating.toFixed(1)}\r\n                        </span>\r\n                      </div>\r\n                      <span className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                        ({selectedMentor.totalReviews} reviews)\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Quick Actions */}\r\n                    <div className=\"flex gap-2 flex-wrap\">\r\n                      <button\r\n                        onClick={() => setShowRequestForm(!showRequestForm)}\r\n                        className=\"px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white rounded-xl font-medium transition-all shadow-lg shadow-amber-500/20\"\r\n                      >\r\n                        Request Session\r\n                      </button>\r\n                      {onStartChat && (\r\n                        <button\r\n                          onClick={() => onStartChat({\r\n                            id: selectedMentor.id,\r\n                            name: selectedMentor.name,\r\n                            avatarUrl: selectedMentor.avatarUrl,\r\n                            status: 'online',\r\n                            isMentor: true\r\n                          })}\r\n                          className={`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${isDarkMode\r\n                            ? 'bg-slate-700 hover:bg-slate-600 text-white border border-slate-600'\r\n                            : 'bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200'\r\n                            }`}\r\n                        >\r\n                          <MessageCircle size={18} />\r\n                          Chat\r\n                        </button>\r\n                      )}\r\n                      {onStartVideoCall && mentorOfferings.some(o => o.mode === 'video' || o.mode === 'call') && (\r\n                        <button\r\n                          onClick={() => onStartVideoCall({\r\n                            id: selectedMentor.id,\r\n                            name: selectedMentor.name,\r\n                            avatar: selectedMentor.avatarUrl,\r\n                          })}\r\n                          className=\"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors\"\r\n                        >\r\n                          <Video size={18} />\r\n                          Call\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Request Form */}\r\n                {showRequestForm && (\r\n                  <div className={`p-6 rounded-xl border ${isDarkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <h4 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                      Request a Session\r\n                    </h4>\r\n                    <div className=\"space-y-4\">\r\n                      {selectedOfferingType && (\r\n                        <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-amber-500/10 border border-amber-500/30' : 'bg-amber-50 border border-amber-200'}`}>\r\n                          <p className={`text-sm font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-700'}`}>\r\n                            Session Type: <span className=\"font-bold\">{selectedOfferingType}</span>\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n\r\n                      <div>\r\n                        <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          Topic *\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder={selectedOfferingType ? `Specific topic for ${selectedOfferingType}` : \"e.g., DSA - Trees, Resume Review\"}\r\n                          value={requestForm.topic}\r\n                          onChange={(e) => setRequestForm({ ...requestForm, topic: e.target.value })}\r\n                          className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                            ? 'bg-slate-800 text-white border-slate-700'\r\n                            : 'bg-white text-slate-900 border-slate-300'\r\n                            } border`}\r\n                          required\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          Message\r\n                        </label>\r\n                        <textarea\r\n                          placeholder=\"Explain what you need help with...\"\r\n                          value={requestForm.message}\r\n                          onChange={(e) => setRequestForm({ ...requestForm, message: e.target.value })}\r\n                          rows={3}\r\n                          className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                            ? 'bg-slate-800 text-white border-slate-700'\r\n                            : 'bg-white text-slate-900 border-slate-300'\r\n                            } border`}\r\n                        />\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                            Preferred Date\r\n                          </label>\r\n                          <input\r\n                            type=\"date\"\r\n                            value={requestForm.preferredDate}\r\n                            onChange={(e) => setRequestForm({ ...requestForm, preferredDate: e.target.value })}\r\n                            className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                              ? 'bg-slate-800 text-white border-slate-700'\r\n                              : 'bg-white text-slate-900 border-slate-300'\r\n                              } border`}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                            Preferred Time\r\n                          </label>\r\n                          <input\r\n                            type=\"time\"\r\n                            value={requestForm.preferredTime}\r\n                            onChange={(e) => setRequestForm({ ...requestForm, preferredTime: e.target.value })}\r\n                            className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                              ? 'bg-slate-800 text-white border-slate-700'\r\n                              : 'bg-white text-slate-900 border-slate-300'\r\n                              } border`}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={handleRequestSession}\r\n                          disabled={!requestForm.topic || !requestForm.preferredDate || !requestForm.preferredTime}\r\n                          className=\"flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 disabled:bg-slate-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors\"\r\n                        >\r\n                          <Send size={18} />\r\n                          Send Request\r\n                        </button>\r\n                        <button\r\n                          onClick={() => setShowRequestForm(false)}\r\n                          className={`px-4 py-2 rounded-lg ${isDarkMode\r\n                            ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                            : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                            } transition-colors`}\r\n                        >\r\n                          Cancel\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* About Section */}\r\n                {selectedMentor.bio && (\r\n                  <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <h4 className={`font-semibold mb-3 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                      <User size={18} className=\"text-amber-500\" />\r\n                      About\r\n                    </h4>\r\n                    <p className={`text-sm leading-relaxed ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>{selectedMentor.bio}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Domain / Expertise */}\r\n                {selectedMentor.domain.length > 0 && (\r\n                  <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <GraduationCap className=\"text-amber-500\" size={20} />\r\n                      <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        Domain / Expertise\r\n                      </h4>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {selectedMentor.domain.map((d, idx) => (\r\n                        <span key={idx} className=\"px-3 py-1.5 bg-gradient-to-r from-amber-500/10 to-orange-500/10 text-amber-500 rounded-full text-sm font-medium border border-amber-500/20\">\r\n                          {d}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Experience Section */}\r\n                {(selectedMentor.experienceYears || selectedMentor.company || selectedMentor.college) && (\r\n                  <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <Briefcase className=\"text-blue-500\" size={20} />\r\n                      <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Experience</h4>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\r\n                      {selectedMentor.experienceYears && (\r\n                        <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-white'} border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                          <p className={`text-xs uppercase tracking-wider font-bold mb-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Years</p>\r\n                          <p className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{selectedMentor.experienceYears}+ years</p>\r\n                        </div>\r\n                      )}\r\n                      {selectedMentor.company && (\r\n                        <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-white'} border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                          <p className={`text-xs uppercase tracking-wider font-bold mb-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Company</p>\r\n                          <p className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{selectedMentor.company}</p>\r\n                        </div>\r\n                      )}\r\n                      {selectedMentor.college && (\r\n                        <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-white'} border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                          <p className={`text-xs uppercase tracking-wider font-bold mb-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Education</p>\r\n                          <p className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{selectedMentor.college}</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Languages */}\r\n                {selectedMentor.languages.length > 0 && (\r\n                  <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <Globe className=\"text-green-500\" size={20} />\r\n                      <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Languages</h4>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {selectedMentor.languages.map((lang, idx) => (\r\n                        <span key={idx} className=\"px-3 py-1.5 bg-green-500/10 text-green-500 rounded-full text-sm font-medium border border-green-500/20 flex items-center gap-1.5\">\r\n                          <Globe size={14} />\r\n                          {lang}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Skills */}\r\n                {selectedMentor.skills.length > 0 && (\r\n                  <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                    <h4 className={`font-semibold mb-3 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Skills</h4>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {selectedMentor.skills.map((skill, idx) => (\r\n                        <span key={idx} className=\"px-3 py-1.5 bg-blue-500/10 text-blue-500 rounded-full text-sm border border-blue-500/20\">\r\n                          {skill}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Mentorship Offerings */}\r\n                {mentorOfferings.length > 0 && (\r\n                  <div>\r\n                    <div className=\"flex items-center gap-2 mb-3\">\r\n                      <Briefcase className=\"text-purple-500\" size={20} />\r\n                      <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        Mentorship Offerings ({mentorOfferings.length})\r\n                      </h4>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      {mentorOfferings.map(offering => (\r\n                        <div\r\n                          key={offering.id}\r\n                          className={`p-4 rounded-lg border ${isDarkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}\r\n                        >\r\n                          <h5 className={`font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            {offering.title}\r\n                          </h5>\r\n                          <p className={`text-sm mb-3 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                            {offering.description}\r\n                          </p>\r\n                          <div className=\"flex items-center gap-3 text-sm flex-wrap\">\r\n                            <span className={`flex items-center gap-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                              <Clock size={14} />\r\n                              {offering.durationMinutes} min\r\n                            </span>\r\n                            <span className=\"px-2 py-1 bg-blue-500/10 text-blue-500 text-xs rounded-full\">\r\n                              {offering.mode}\r\n                            </span>\r\n                            {offering.isFree ? (\r\n                              <span className=\"px-2 py-1 bg-green-500/10 text-green-500 text-xs font-medium rounded-full\">\r\n                                Free\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-1 bg-amber-500/10 text-amber-500 text-xs font-medium rounded-full\">\r\n                                â‚¹{offering.price}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Reviews Section */}\r\n                <div className={`p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900/50 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Star className=\"text-amber-500\" size={20} />\r\n                      <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        Reviews ({mentorReviews.length})\r\n                      </h4>\r\n                    </div>\r\n                    {mentorReviews.length > 0 && (\r\n                      <div className=\"flex items-center gap-1.5 px-3 py-1 rounded-full bg-amber-500/10 border border-amber-500/20\">\r\n                        <Star size={14} className=\"text-amber-500\" fill=\"currentColor\" />\r\n                        <span className=\"text-sm font-bold text-amber-500\">{selectedMentor.rating.toFixed(1)}</span>\r\n                        <span className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>avg</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  {mentorReviews.length === 0 ? (\r\n                    <div className={`text-center py-8 rounded-lg ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                      <Star className={`mx-auto mb-2 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={32} />\r\n                      <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>\r\n                        No reviews yet\r\n                      </p>\r\n                      <p className={`text-sm ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                        Be the first to leave a review!\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-3 max-h-80 overflow-y-auto pr-1\">\r\n                      {mentorReviews.map(review => (\r\n                        <div\r\n                          key={review.id}\r\n                          className={`p-4 rounded-xl ${isDarkMode ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'} shadow-sm`}\r\n                        >\r\n                          <div className=\"flex items-start gap-3\">\r\n                            <img\r\n                              src={review.student?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student'}\r\n                              alt={review.student?.fullName || 'Student'}\r\n                              className=\"w-10 h-10 rounded-full border-2 border-amber-500/20\"\r\n                            />\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"flex items-center justify-between mb-1\">\r\n                                <span className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {review.student?.fullName || 'Anonymous'}\r\n                                </span>\r\n                                <span className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                  {new Date(review.createdAt).toLocaleDateString()}\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-1 mb-2\">\r\n                                {[1, 2, 3, 4, 5].map((star) => (\r\n                                  <Star\r\n                                    key={star}\r\n                                    size={14}\r\n                                    className={star <= review.rating\r\n                                      ? 'text-amber-500 fill-amber-500'\r\n                                      : isDarkMode ? 'text-slate-600' : 'text-slate-300'\r\n                                    }\r\n                                  />\r\n                                ))}\r\n                                <span className={`text-sm ml-1 font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                                  {review.rating}/5\r\n                                </span>\r\n                              </div>\r\n                              {review.reviewText && (\r\n                                <p className={`text-sm italic ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                  \"{review.reviewText}\"\r\n                                </p>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MentorConnect;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorConnections.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAvailableUsers' and 'loadExistingConnections'. Either include them or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [user, activeTab, loadExistingConnections, loadAvailableUsers]","fix":{"range":[1912,1929],"text":"[user, activeTab, loadExistingConnections, loadAvailableUsers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3050,3053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3050,3053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { User, MessageCircle, Video, Search, GraduationCap, Briefcase, UserPlus, Users, UserMinus, X, AlertTriangle } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\nimport { createNotification } from '../utils/supabase-queries';\r\n\r\ninterface MentorConnectionsProps {\r\n  isDarkMode: boolean;\r\n  onStartVideoCall?: (name: string, avatar: string, userId: string) => void;\r\n  onStartChat?: (participant: any) => void;\r\n  onViewProfile?: (userId: string) => void;\r\n}\r\n\r\ninterface ConnectionUser {\r\n  user_id: string;\r\n  full_name: string;\r\n  avatar_url: string;\r\n  role: 'student' | 'mentor';\r\n  username?: string;\r\n  bio?: string;\r\n  domain?: string[];\r\n  profession?: string;\r\n  experience?: string;\r\n  class?: string;\r\n  course?: string;\r\n  hasActiveSession?: boolean;\r\n  sessionTopic?: string;\r\n  sessionDate?: string;\r\n  sessionTime?: string;\r\n  sessionMode?: 'chat' | 'call' | 'video';\r\n  sessionId?: string;\r\n}\r\n\r\nconst MentorConnections: React.FC<MentorConnectionsProps> = ({ \r\n  isDarkMode, \r\n  onStartVideoCall,\r\n  onStartChat,\r\n  onViewProfile \r\n}) => {\r\n  const { user } = useAuth();\r\n  const [activeTab, setActiveTab] = useState<'students' | 'mentors' | 'all'>('students');\r\n  const [existingConnections, setExistingConnections] = useState<ConnectionUser[]>([]);\r\n  const [availableUsers, setAvailableUsers] = useState<ConnectionUser[]>([]);\r\n  const [existingSearchQuery, setExistingSearchQuery] = useState('');\r\n  const [findSearchQuery, setFindSearchQuery] = useState('');\r\n  const [showRemoveModal, setShowRemoveModal] = useState<ConnectionUser | null>(null);\r\n  const [removing, setRemoving] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadExistingConnections();\r\n      if (activeTab !== 'all') {\r\n        loadAvailableUsers();\r\n      }\r\n    }\r\n  }, [user, activeTab]);\r\n\r\n  const loadExistingConnections = async () => {\r\n    if (!user) return;\r\n    try {\r\n      if (activeTab === 'students' || activeTab === 'all') {\r\n        // Load students with accepted sessions\r\n        const { data: sessionsData, error: sessionsError } = await supabase\r\n          .from('session_requests')\r\n          .select('id, student_id, topic, preferred_date, preferred_time, status, mode')\r\n          .eq('mentor_id', user.id)\r\n          .eq('status', 'accepted');\r\n        if (sessionsError) throw sessionsError;\r\n        const studentIds = [...new Set(sessionsData?.map(s => s.student_id) || [])];\r\n        let studentConnections: ConnectionUser[] = [];\r\n        if (studentIds.length > 0) {\r\n          const { data: profilesData } = await supabase\r\n            .from('user_profiles')\r\n            .select('user_id, full_name, avatar_url, username, bio, class, course, role')\r\n            .in('user_id', studentIds);\r\n          const profileMap = new Map();\r\n          profilesData?.forEach(profile => profileMap.set(profile.user_id, profile));\r\n          studentConnections = sessionsData?.map((session: any) => {\r\n            const profile = profileMap.get(session.student_id);\r\n            return {\r\n              user_id: session.student_id,\r\n              full_name: profile?.full_name || 'Student',\r\n              avatar_url: profile?.avatar_url || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student',\r\n              role: 'student' as const,\r\n              username: profile?.username,\r\n              bio: profile?.bio,\r\n              class: profile?.class,\r\n              course: profile?.course,\r\n              hasActiveSession: true,\r\n            };\r\n          }) || [];\r\n        }\r\n\r\n        // Also load student friends (students who are friends but may not have sessions)\r\n        const { data: studentFriendsData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'accepted');\r\n        const studentFriendIds = studentFriendsData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        \r\n        if (studentFriendIds.length > 0) {\r\n          const { data: studentFriendProfiles } = await supabase\r\n            .from('user_profiles')\r\n            .select('*')\r\n            .in('user_id', studentFriendIds)\r\n            .eq('role', 'student');\r\n          \r\n          const studentFriendConnections = studentFriendProfiles?.map(profile => ({\r\n            user_id: profile.user_id,\r\n            full_name: profile.full_name,\r\n            avatar_url: profile.avatar_url,\r\n            role: 'student' as const,\r\n            username: profile.username,\r\n            bio: profile.bio,\r\n            class: profile.class,\r\n            course: profile.course,\r\n            hasActiveSession: false,\r\n          })) || [];\r\n\r\n          // Merge student connections, avoiding duplicates\r\n          const existingStudentIds = new Set(studentConnections.map(s => s.user_id));\r\n          studentFriendConnections.forEach(friend => {\r\n            if (!existingStudentIds.has(friend.user_id)) {\r\n              studentConnections.push(friend);\r\n            }\r\n          });\r\n        }\r\n\r\n        if (activeTab === 'students') {\r\n          setExistingConnections(studentConnections);\r\n          return;\r\n        }\r\n        const { data: friendsData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'accepted');\r\n        const friendIds = friendsData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        let mentorConnections: ConnectionUser[] = [];\r\n        if (friendIds.length > 0) {\r\n          const { data: mentorProfiles } = await supabase\r\n            .from('user_profiles')\r\n            .select('*')\r\n            .in('user_id', friendIds)\r\n            .eq('role', 'mentor');\r\n          mentorConnections = mentorProfiles?.map(profile => ({\r\n            user_id: profile.user_id,\r\n            full_name: profile.full_name,\r\n            avatar_url: profile.avatar_url,\r\n            role: 'mentor' as const,\r\n            username: profile.username,\r\n            bio: profile.bio,\r\n            profession: profile.profession,\r\n            experience: profile.experience,\r\n          })) || [];\r\n        }\r\n        setExistingConnections([...studentConnections, ...mentorConnections]);\r\n      } else if (activeTab === 'mentors') {\r\n        const { data: friendsData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'accepted');\r\n        const friendIds = friendsData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        if (friendIds.length === 0) {\r\n          setExistingConnections([]);\r\n          return;\r\n        }\r\n        const { data: mentorProfiles } = await supabase\r\n          .from('user_profiles')\r\n          .select('*')\r\n          .in('user_id', friendIds)\r\n          .eq('role', 'mentor');\r\n        setExistingConnections(mentorProfiles?.map(profile => ({\r\n          user_id: profile.user_id,\r\n          full_name: profile.full_name,\r\n          avatar_url: profile.avatar_url,\r\n          role: 'mentor' as const,\r\n          username: profile.username,\r\n          bio: profile.bio,\r\n          profession: profile.profession,\r\n          experience: profile.experience,\r\n        })) || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading existing connections:', error);\r\n      setExistingConnections([]);\r\n    }\r\n  };\r\n\r\n  const loadAvailableUsers = async () => {\r\n    if (!user) return;\r\n    try {\r\n      let excludeIds: string[] = [user.id];\r\n      if (activeTab === 'students') {\r\n        // Exclude students with accepted sessions\r\n        const { data: sessionsData } = await supabase\r\n          .from('session_requests')\r\n          .select('student_id')\r\n          .eq('mentor_id', user.id)\r\n          .eq('status', 'accepted');\r\n        excludeIds = [...excludeIds, ...(sessionsData?.map(s => s.student_id) || [])];\r\n\r\n        // Also exclude student friends\r\n        const { data: studentFriendsData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'accepted');\r\n        const studentFriendIds = studentFriendsData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        \r\n        if (studentFriendIds.length > 0) {\r\n          const { data: studentFriends } = await supabase\r\n            .from('user_profiles')\r\n            .select('user_id')\r\n            .in('user_id', studentFriendIds)\r\n            .eq('role', 'student');\r\n          excludeIds = [...excludeIds, ...(studentFriends?.map(s => s.user_id) || [])];\r\n        }\r\n\r\n        const { data: availableStudents } = await supabase\r\n          .from('user_profiles')\r\n          .select('*')\r\n          .eq('role', 'student')\r\n          .not('user_id', 'in', `(${excludeIds.join(',')})`)\r\n          .limit(20);\r\n        setAvailableUsers(availableStudents?.map(profile => ({\r\n          user_id: profile.user_id,\r\n          full_name: profile.full_name,\r\n          avatar_url: profile.avatar_url,\r\n          role: 'student' as const,\r\n          username: profile.username,\r\n          bio: profile.bio,\r\n          class: profile.class,\r\n          course: profile.course,\r\n        })) || []);\r\n      } else if (activeTab === 'mentors') {\r\n        const { data: friendsData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'accepted');\r\n        const friendIds = friendsData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        excludeIds = [...excludeIds, ...friendIds];\r\n        const { data: pendingData } = await supabase\r\n          .from('friends')\r\n          .select('user_id, friend_id')\r\n          .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`)\r\n          .eq('status', 'pending');\r\n        const pendingIds = pendingData?.map(f => f.user_id === user.id ? f.friend_id : f.user_id) || [];\r\n        excludeIds = [...excludeIds, ...pendingIds];\r\n        const { data: availableMentors } = await supabase\r\n          .from('user_profiles')\r\n          .select('*')\r\n          .eq('role', 'mentor')\r\n          .not('user_id', 'in', `(${excludeIds.join(',')})`)\r\n          .limit(20);\r\n        setAvailableUsers(availableMentors?.map(profile => ({\r\n          user_id: profile.user_id,\r\n          full_name: profile.full_name,\r\n          avatar_url: profile.avatar_url,\r\n          role: 'mentor' as const,\r\n          username: profile.username,\r\n          bio: profile.bio,\r\n          profession: profile.profession,\r\n          experience: profile.experience,\r\n        })) || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading available users:', error);\r\n      setAvailableUsers([]);\r\n    }\r\n  };\r\n\r\n  const sendFriendRequest = async (targetUserId: string) => {\r\n    if (!user) return;\r\n    try {\r\n      const { error } = await supabase.from('friends').insert({ user_id: user.id, friend_id: targetUserId, status: 'pending' });\r\n      if (error) throw error;\r\n      setAvailableUsers(prev => prev.filter(u => u.user_id !== targetUserId));\r\n    } catch (error) {\r\n      console.error('Error sending friend request:', error);\r\n    }\r\n  };\r\n\r\n  const removeStudent = async (studentId: string) => {\r\n    if (!user) return;\r\n    setRemoving(true);\r\n    try {\r\n      // Delete session requests between mentor and student\r\n      const { error: sessionError } = await supabase\r\n        .from('session_requests')\r\n        .delete()\r\n        .eq('mentor_id', user.id)\r\n        .eq('student_id', studentId);\r\n\r\n      if (sessionError) throw sessionError;\r\n\r\n      // Delete friend relationship in both directions\r\n      const { error: friendError } = await supabase\r\n        .from('friends')\r\n        .delete()\r\n        .or(`and(user_id.eq.${user.id},friend_id.eq.${studentId}),and(user_id.eq.${studentId},friend_id.eq.${user.id})`);\r\n\r\n      if (friendError) throw friendError;\r\n\r\n      // Send notification to student\r\n      await createNotification(studentId, user.id, 'friend_request', 'has removed you as their student. Your mentorship session has been cancelled.');\r\n\r\n      // Remove from local state\r\n      setExistingConnections(prev => prev.filter(c => c.user_id !== studentId));\r\n      setShowRemoveModal(null);\r\n    } catch (error) {\r\n      console.error('Error removing student:', error);\r\n      alert('Failed to remove student. Please try again.');\r\n    } finally {\r\n      setRemoving(false);\r\n    }\r\n  };\r\n\r\n  const filteredExisting = existingConnections.filter(conn => {\r\n    if (!existingSearchQuery) return true;\r\n    const query = existingSearchQuery.toLowerCase();\r\n    return conn.full_name?.toLowerCase().includes(query) || conn.username?.toLowerCase().includes(query) || conn.profession?.toLowerCase().includes(query) || conn.class?.toLowerCase().includes(query);\r\n  });\r\n\r\n  const filteredAvailable = availableUsers.filter(conn => {\r\n    if (!findSearchQuery) return true;\r\n    const query = findSearchQuery.toLowerCase();\r\n    return conn.full_name?.toLowerCase().includes(query) || conn.username?.toLowerCase().includes(query) || conn.profession?.toLowerCase().includes(query) || conn.class?.toLowerCase().includes(query);\r\n  });\r\n\r\n  const handleStartChat = (connection: ConnectionUser) => {\r\n    if (onStartChat) onStartChat({ id: connection.user_id, name: connection.full_name, avatar: connection.avatar_url });\r\n  };\r\n\r\n  const handleStartVideoCall = (connection: ConnectionUser) => {\r\n    if (onStartVideoCall) onStartVideoCall(connection.full_name, connection.avatar_url, connection.user_id);\r\n  };\r\n\r\n  const renderUserCard = (connection: ConnectionUser, showActions: 'chat' | 'add') => (\r\n    <div \r\n      key={connection.user_id} \r\n      onClick={showActions === 'chat' ? () => handleStartChat(connection) : undefined}\r\n      className={`p-4 flex items-center justify-between transition-colors ${showActions === 'chat' ? 'cursor-pointer' : ''} ${isDarkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-50'}`}\r\n    >\r\n      <div className=\"flex items-center gap-4\">\r\n        <div \r\n          className={`w-12 h-12 rounded-full overflow-hidden flex-shrink-0 cursor-pointer border-2 border-amber-500/20 hover:border-amber-500 transition-all ${isDarkMode ? 'bg-slate-700' : 'bg-slate-200'}`}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            onViewProfile?.(connection.user_id);\r\n          }}\r\n          title=\"View Profile\"\r\n        >\r\n          {connection.avatar_url ? (\r\n            <img src={connection.avatar_url} alt={connection.full_name} className=\"w-full h-full object-cover\" />\r\n          ) : (\r\n            <div className=\"w-full h-full flex items-center justify-center\">\r\n              <User size={20} className={isDarkMode ? 'text-slate-500' : 'text-slate-400'} />\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div>\r\n          <h3 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{connection.full_name}</h3>\r\n          {connection.username && (\r\n            <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>@{connection.username}</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n      <div className=\"flex gap-2\" onClick={(e) => e.stopPropagation()}>\r\n        {showActions === 'chat' ? (\r\n          <>\r\n            <button \r\n              onClick={() => handleStartChat(connection)} \r\n              className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`} \r\n              title=\"Chat\"\r\n            >\r\n              <MessageCircle size={18} />\r\n            </button>\r\n            <button \r\n              onClick={() => handleStartVideoCall(connection)} \r\n              className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-slate-700 text-blue-400 hover:bg-slate-600' : 'bg-blue-50 text-blue-600 hover:bg-blue-100'}`} \r\n              title=\"Video Call\"\r\n            >\r\n              <Video size={18} />\r\n            </button>\r\n            {connection.role === 'student' && activeTab === 'students' && (\r\n              <button \r\n                onClick={() => setShowRemoveModal(connection)} \r\n                className={`p-2 rounded-lg transition-all ${isDarkMode ? 'bg-red-900/30 text-red-400 hover:bg-red-900/50' : 'bg-red-50 text-red-600 hover:bg-red-100'}`} \r\n                title=\"Remove Student\"\r\n              >\r\n                <UserMinus size={18} />\r\n              </button>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <button \r\n            onClick={() => sendFriendRequest(connection.user_id)} \r\n            className=\"px-3 py-2 rounded-lg bg-gradient-to-r from-amber-500 to-orange-600 text-white text-sm font-medium hover:shadow-md transition-all flex items-center gap-1\"\r\n          >\r\n            <UserPlus size={16} />\r\n            <span>Add</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderConnectionsList = (\r\n    connections: ConnectionUser[], \r\n    searchQuery: string,\r\n    setSearchQuery: (q: string) => void,\r\n    emptyTitle: string,\r\n    emptySubtitle: string,\r\n    showActions: 'chat' | 'add',\r\n    searchPlaceholder: string,\r\n    showOnlyOnSearch: boolean = false,\r\n    isCompact: boolean = false\r\n  ) => {\r\n    const shouldShowResults = !showOnlyOnSearch || searchQuery.trim().length > 0;\r\n    return (\r\n      <div className={`rounded-xl border ${isCompact ? 'h-[300px]' : 'h-full'} ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n        <div className={`p-3 border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n          <div className=\"relative\">\r\n            <Search className={`absolute left-3 top-1/2 -translate-y-1/2 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} size={16} />\r\n            <input \r\n              type=\"text\" \r\n              value={searchQuery} \r\n              onChange={(e) => setSearchQuery(e.target.value)} \r\n              placeholder={searchPlaceholder} \r\n              className={`w-full pl-9 pr-3 py-2 text-sm rounded-lg border ${isDarkMode ? 'bg-slate-900 border-slate-600 text-white placeholder-slate-400' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder-slate-500'} focus:outline-none focus:ring-2 focus:ring-amber-500`} \r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={`${isCompact ? 'max-h-[240px]' : 'max-h-[400px]'} overflow-y-auto`}>\r\n          {!shouldShowResults ? (\r\n            <div className=\"p-6 text-center\">\r\n              <Search size={32} className={`mx-auto mb-2 ${isDarkMode ? 'text-slate-600' : 'text-slate-300'}`} />\r\n              <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Type to search {activeTab}</p>\r\n            </div>\r\n          ) : connections.length === 0 ? (\r\n            <div className=\"p-6 text-center\">\r\n              <User size={32} className={`mx-auto mb-2 ${isDarkMode ? 'text-slate-600' : 'text-slate-300'}`} />\r\n              <h3 className={`text-sm font-semibold mb-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{emptyTitle}</h3>\r\n              <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>{emptySubtitle}</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-1 p-2\">\r\n              {connections.map(conn => renderUserCard(conn, showActions))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-gradient-to-br from-slate-800 via-slate-800 to-slate-900 border-slate-700' : 'bg-gradient-to-br from-white via-amber-50/30 to-white border-slate-200'}`}>\r\n        <div className=\"flex items-center gap-3 mb-2\">\r\n          <div className={`p-3 rounded-xl ${isDarkMode ? 'bg-amber-500/10' : 'bg-amber-500/10'}`}>\r\n            <GraduationCap size={28} className=\"text-amber-500\" />\r\n          </div>\r\n          <div>\r\n            <h2 className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>My Students & Mentors</h2>\r\n            <p className={`text-sm mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Connect with your students and fellow mentors</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex gap-2\">\r\n        <button \r\n          onClick={() => setActiveTab('students')} \r\n          className={`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${activeTab === 'students' ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md' : isDarkMode ? 'bg-slate-800 text-slate-300 hover:bg-slate-700' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'}`}\r\n        >\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <GraduationCap size={18} />\r\n            <span>Students</span>\r\n          </div>\r\n        </button>\r\n        <button \r\n          onClick={() => setActiveTab('mentors')} \r\n          className={`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${activeTab === 'mentors' ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md' : isDarkMode ? 'bg-slate-800 text-slate-300 hover:bg-slate-700' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'}`}\r\n        >\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <Briefcase size={18} />\r\n            <span>Mentors</span>\r\n          </div>\r\n        </button>\r\n        <button \r\n          onClick={() => setActiveTab('all')} \r\n          className={`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${activeTab === 'all' ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md' : isDarkMode ? 'bg-slate-800 text-slate-300 hover:bg-slate-700' : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200'}`}\r\n        >\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <Users size={18} />\r\n            <span>All</span>\r\n          </div>\r\n        </button>\r\n      </div>\r\n\r\n      {activeTab === 'all' ? (\r\n        renderConnectionsList(\r\n          filteredExisting, \r\n          existingSearchQuery, \r\n          setExistingSearchQuery, \r\n          'No connections yet', \r\n          'Your students and mentor friends will appear here', \r\n          'chat', \r\n          'Search all connections...'\r\n        )\r\n      ) : (\r\n        <div className=\"grid grid-cols-3 gap-4\">\r\n          <div className=\"col-span-2\">\r\n            <h3 className={`text-lg font-semibold mb-3 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              <Users size={20} className=\"text-amber-500\" />\r\n              My {activeTab === 'students' ? 'Students' : 'Mentors'}\r\n            </h3>\r\n            {renderConnectionsList(\r\n              filteredExisting, \r\n              existingSearchQuery, \r\n              setExistingSearchQuery, \r\n              `No ${activeTab} yet`, \r\n              activeTab === 'students' ? 'Students with accepted sessions will appear here' : 'Your mentor friends will appear here', \r\n              'chat', \r\n              `Search my ${activeTab}...`\r\n            )}\r\n          </div>\r\n          <div>\r\n            <h3 className={`text-lg font-semibold mb-3 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              <UserPlus size={20} className=\"text-green-500\" />\r\n              Find {activeTab === 'students' ? 'Students' : 'Mentors'}\r\n            </h3>\r\n            {renderConnectionsList(\r\n              filteredAvailable, \r\n              findSearchQuery, \r\n              setFindSearchQuery, \r\n              `No ${activeTab} found`, \r\n              activeTab === 'students' ? 'Try a different search term' : 'Try a different search term', \r\n              'add', \r\n              `Search ${activeTab}...`,\r\n              true,\r\n              true\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Remove Student Modal */}\r\n      {showRemoveModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n          <div className={`w-full max-w-md rounded-2xl shadow-2xl border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n            <div className={`p-4 border-b flex items-center justify-between ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-red-500/10\">\r\n                  <AlertTriangle size={24} className=\"text-red-500\" />\r\n                </div>\r\n                <h3 className={`text-lg font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Remove Student</h3>\r\n              </div>\r\n              <button \r\n                onClick={() => setShowRemoveModal(null)}\r\n                className={`p-2 rounded-lg transition-all ${isDarkMode ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'}`}\r\n              >\r\n                <X size={20} />\r\n              </button>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <div className=\"flex items-center gap-4 mb-4\">\r\n                <div className={`w-14 h-14 rounded-full overflow-hidden flex-shrink-0 ${isDarkMode ? 'bg-slate-700' : 'bg-slate-200'}`}>\r\n                  {showRemoveModal.avatar_url ? (\r\n                    <img src={showRemoveModal.avatar_url} alt={showRemoveModal.full_name} className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <div className=\"w-full h-full flex items-center justify-center\">\r\n                      <User size={24} className={isDarkMode ? 'text-slate-500' : 'text-slate-400'} />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <h4 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{showRemoveModal.full_name}</h4>\r\n                  {showRemoveModal.username && (\r\n                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>@{showRemoveModal.username}</p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <p className={`text-sm mb-6 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\r\n                Are you sure you want to remove this student? This will:\r\n              </p>\r\n              <ul className={`text-sm mb-6 space-y-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                <li className=\"flex items-center gap-2\">\r\n                  <span className=\"w-1.5 h-1.5 rounded-full bg-red-500\"></span>\r\n                  Cancel their mentorship session\r\n                </li>\r\n                <li className=\"flex items-center gap-2\">\r\n                  <span className=\"w-1.5 h-1.5 rounded-full bg-red-500\"></span>\r\n                  Remove you from their Mentors list\r\n                </li>\r\n                <li className=\"flex items-center gap-2\">\r\n                  <span className=\"w-1.5 h-1.5 rounded-full bg-red-500\"></span>\r\n                  Send them a notification about this change\r\n                </li>\r\n              </ul>\r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  onClick={() => setShowRemoveModal(null)}\r\n                  disabled={removing}\r\n                  className={`flex-1 px-4 py-2.5 rounded-lg font-medium transition-all ${isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={() => removeStudent(showRemoveModal.user_id)}\r\n                  disabled={removing}\r\n                  className=\"flex-1 px-4 py-2.5 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition-all flex items-center justify-center gap-2\"\r\n                >\r\n                  {removing ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white\"></div>\r\n                      Removing...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <UserMinus size={18} />\r\n                      Remove Student\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MentorConnections;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1010,1013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1010,1013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1055,1058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1055,1058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1616,1619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1616,1619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2909,2912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2909,2912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, user]","fix":{"range":[4337,4343],"text":"[loadData, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":135,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":135,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":135,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5483,5484],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":570,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":570,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25841,25844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25841,25844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1227,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1227,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[65392,65395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[65392,65395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1360,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1360,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72457,72460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72457,72460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Plus, Trash2, Clock, Video, MessageCircle,\r\n  CheckCircle, XCircle, Calendar, Award, Briefcase,\r\n  Star, Mail, CheckCheck, Timer, Link, UserPlus, Check, X, Bell\r\n} from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport {\r\n  fetchMentorProfile,\r\n  fetchMentorOfferings,\r\n  createMentorOffering,\r\n  deleteMentorOffering,\r\n  fetchSessionRequests,\r\n  acceptSessionRequest,\r\n  rejectSessionRequest,\r\n  completeSessionRequest,\r\n  cancelSessionRequest,\r\n  subscribeToSessionRequests,\r\n  subscribeToMentorReviews,\r\n  getTimeUntilSession,\r\n  isSessionIn30Minutes,\r\n  hasSessionStarted,\r\n  updateSessionMeetingLink,\r\n  fetchPendingFriendRequests,\r\n  updateFriendRequestStatus,\r\n  isSessionStartingNow,\r\n  fetchMentorReviews\r\n} from '../utils/supabase-queries';\r\nimport { Mentor, MentorshipOffering, SessionRequest } from '../types';\r\n\r\ninterface MentorDashboardProps {\r\n  isDarkMode: boolean;\r\n  onStartVideoCall?: (participant: any) => void;\r\n  onStartChat?: (participant: any) => void;\r\n}\r\n\r\nconst MentorDashboard: React.FC<MentorDashboardProps> = ({\r\n  isDarkMode,\r\n  onStartVideoCall,\r\n  onStartChat\r\n}) => {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const [activeTab, setActiveTab] = useState<'offerings' | 'requests' | 'reviews'>('requests');\r\n  const [mentorProfile, setMentorProfile] = useState<Mentor | null>(null);\r\n  const [offerings, setOfferings] = useState<MentorshipOffering[]>([]);\r\n  const [sessionRequests, setSessionRequests] = useState<SessionRequest[]>([]);\r\n  const [reviews, setReviews] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Offering form state\r\n  const [showOfferingForm, setShowOfferingForm] = useState(false);\r\n  const [offeringForm, setOfferingForm] = useState({\r\n    title: '',\r\n    description: '',\r\n    durationMinutes: 60,\r\n    mode: 'video' as 'chat' | 'call' | 'video',\r\n    isFree: true,\r\n    price: 0,\r\n  });\r\n\r\n  // Request response state\r\n  const [responseText, setResponseText] = useState('');\r\n  const [meetingLink, setMeetingLink] = useState('');\r\n  const [activeRequestId, setActiveRequestId] = useState<string | null>(null);\r\n\r\n  // Confirmation popup states\r\n  const [showConfirmPopup, setShowConfirmPopup] = useState<{ type: 'complete' | 'cancel', requestId: string, topic: string } | null>(null);\r\n  const [showDeletePopup, setShowDeletePopup] = useState<{ offeringId: string, title: string } | null>(null);\r\n  const [showActionSuccessPopup, setShowActionSuccessPopup] = useState<{ type: 'completed' | 'cancelled' | 'deleted' } | null>(null);\r\n\r\n  // Meeting link editing state\r\n  const [editingMeetingLinkId, setEditingMeetingLinkId] = useState<string | null>(null);\r\n  const [editMeetingLinkValue, setEditMeetingLinkValue] = useState('');\r\n\r\n  // Friend requests state\r\n  const [friendRequests, setFriendRequests] = useState<any[]>([]);\r\n  const [processingFriendRequest, setProcessingFriendRequest] = useState<string | null>(null);\r\n\r\n  // Session start popup state\r\n  const [showSessionStartPopup, setShowSessionStartPopup] = useState<{ studentName: string, topic: string, mode: string, meetingLink?: string } | null>(null);\r\n  const [shownSessionStartIds, setShownSessionStartIds] = useState<Set<string>>(new Set());\r\n\r\n  // Timer state to force re-render for countdown updates\r\n  const [, setTimerTick] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      console.log('MentorDashboard: User detected, loading data for:', user.id);\r\n      loadData();\r\n\r\n      // Subscribe to real-time session request updates\r\n      const sessionSubscription = subscribeToSessionRequests(user.id, 'mentor', () => {\r\n        console.log('MentorDashboard: Real-time session update detected, reloading data');\r\n        loadData();\r\n      });\r\n\r\n      // Subscribe to real-time review updates\r\n      const reviewSubscription = subscribeToMentorReviews(user.id, (review) => {\r\n        console.log('MentorDashboard: New review received, reloading data', review);\r\n        loadData(); // Reload to get updated rating and reviews\r\n      });\r\n\r\n      return () => {\r\n        console.log('MentorDashboard: Unsubscribing from session requests and reviews');\r\n        sessionSubscription.unsubscribe();\r\n        reviewSubscription.unsubscribe();\r\n      };\r\n    }\r\n  }, [user]);\r\n\r\n  // Update timer every second to refresh countdown displays in real-time\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setTimerTick(tick => tick + 1);\r\n\r\n      // Check for sessions starting now\r\n      const acceptedRequests = sessionRequests.filter(r => r.status === 'accepted');\r\n      for (const request of acceptedRequests) {\r\n        if (request.preferredDate && request.preferredTime &&\r\n          isSessionStartingNow(request.preferredDate, request.preferredTime) &&\r\n          !shownSessionStartIds.has(request.id)) {\r\n          // Show popup for this session\r\n          setShowSessionStartPopup({\r\n            studentName: request.studentProfile?.fullName || 'Student',\r\n            topic: request.topic,\r\n            mode: request.mode || 'chat',\r\n            meetingLink: request.meetingLink\r\n          });\r\n          setShownSessionStartIds(prev => new Set([...prev, request.id]));\r\n          // Play notification sound\r\n          try {\r\n            const audio = new Audio('/notification.mp3');\r\n            audio.volume = 0.5;\r\n            audio.play().catch(() => { });\r\n          } catch (e) { }\r\n          break; // Only show one popup at a time\r\n        }\r\n      }\r\n    }, 1000); // Update every second\r\n    return () => clearInterval(interval);\r\n  }, [sessionRequests, shownSessionStartIds]);\r\n\r\n  const loadData = async () => {\r\n    if (!user) return;\r\n\r\n    console.log('MentorDashboard: Loading data for user:', user.id);\r\n    setLoading(true);\r\n    try {\r\n      const [profile, offeringsData, requestsData, friendRequestsData, reviewsData] = await Promise.all([\r\n        fetchMentorProfile(user.id).catch(err => {\r\n          console.error('Error fetching mentor profile:', err);\r\n          return null;\r\n        }),\r\n        fetchMentorOfferings(user.id).catch(err => {\r\n          console.error('Error fetching offerings:', err);\r\n          return [];\r\n        }),\r\n        fetchSessionRequests(user.id, 'mentor').catch(err => {\r\n          console.error('Error fetching requests:', err);\r\n          return [];\r\n        }),\r\n        fetchPendingFriendRequests(user.id).catch(err => {\r\n          console.error('Error fetching friend requests:', err);\r\n          return [];\r\n        }),\r\n        fetchMentorReviews(user.id).catch(err => {\r\n          console.error('Error fetching reviews:', err);\r\n          return [];\r\n        }),\r\n      ]);\r\n\r\n      if (profile) {\r\n        setMentorProfile(profile);\r\n      }\r\n\r\n      console.log('Loaded offerings data:', offeringsData); // Debug log\r\n      console.log('Loaded session requests:', requestsData); // Debug log\r\n      console.log('Loaded friend requests:', friendRequestsData); // Debug log\r\n      console.log('Loaded reviews:', reviewsData);\r\n      setOfferings(Array.isArray(offeringsData) ? offeringsData : []);\r\n      setSessionRequests(requestsData);\r\n      setFriendRequests(friendRequestsData);\r\n      setReviews(reviewsData);\r\n    } catch (error) {\r\n      console.error('Error loading mentor data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleFriendRequestAction = async (requestId: string, status: 'accepted' | 'rejected') => {\r\n    setProcessingFriendRequest(requestId);\r\n    const { error } = await updateFriendRequestStatus(requestId, status);\r\n    if (!error) {\r\n      setFriendRequests(prev => prev.filter(req => req.id !== requestId));\r\n    }\r\n    setProcessingFriendRequest(null);\r\n  };\r\n\r\n  const handleCreateOffering = async () => {\r\n    if (!user) return;\r\n\r\n    // Validate required fields\r\n    if (!offeringForm.title || !offeringForm.description) {\r\n      alert('Please fill in title and description');\r\n      return;\r\n    }\r\n\r\n    const offering = {\r\n      mentor_id: user.id,\r\n      title: offeringForm.title,\r\n      description: offeringForm.description,\r\n      duration_minutes: offeringForm.durationMinutes,\r\n      mode: offeringForm.mode,\r\n      is_free: offeringForm.isFree,\r\n      price: offeringForm.isFree ? 0 : offeringForm.price,\r\n      is_active: true,\r\n    };\r\n\r\n    console.log('Creating offering:', offering); // Debug log\r\n\r\n    const result = await createMentorOffering(offering);\r\n\r\n    if (result.error) {\r\n      console.error('Error creating offering:', result.error);\r\n      alert('Failed to create offering. Please try again.');\r\n      return;\r\n    }\r\n\r\n    if (result.data) {\r\n      console.log('Offering created successfully:', result.data);\r\n      setShowOfferingForm(false);\r\n      setOfferingForm({\r\n        title: '',\r\n        description: '',\r\n        durationMinutes: 60,\r\n        mode: 'video',\r\n        isFree: true,\r\n        price: 0,\r\n      });\r\n      loadData();\r\n    }\r\n  };\r\n\r\n  const handleDeleteOffering = async (offeringId: string) => {\r\n    await deleteMentorOffering(offeringId);\r\n    setShowDeletePopup(null);\r\n    setShowActionSuccessPopup({ type: 'deleted' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    loadData();\r\n  };\r\n\r\n  const handleAcceptRequest = async (requestId: string) => {\r\n    await acceptSessionRequest(requestId, responseText, meetingLink);\r\n    setActiveRequestId(null);\r\n    setResponseText('');\r\n    setMeetingLink('');\r\n    loadData();\r\n  };\r\n\r\n  const handleRejectRequest = async (requestId: string) => {\r\n    await rejectSessionRequest(requestId, responseText);\r\n    setActiveRequestId(null);\r\n    setResponseText('');\r\n    loadData();\r\n  };\r\n\r\n  const handleCompleteSession = async (requestId: string) => {\r\n    console.log('handleCompleteSession called with requestId:', requestId);\r\n    const result = await completeSessionRequest(requestId, 'mentor');\r\n    console.log('completeSessionRequest result:', result);\r\n    setShowConfirmPopup(null);\r\n    setShowActionSuccessPopup({ type: 'completed' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    loadData();\r\n  };\r\n\r\n  const handleCancelSession = async (requestId: string) => {\r\n    await cancelSessionRequest(requestId, 'mentor');\r\n    setShowConfirmPopup(null);\r\n    setShowActionSuccessPopup({ type: 'cancelled' });\r\n    setTimeout(() => setShowActionSuccessPopup(null), 3000);\r\n    loadData();\r\n  };\r\n\r\n  const pendingRequests = sessionRequests.filter(r => r.status === 'pending');\r\n  // Filter accepted requests: only show future/upcoming sessions, move past ones to completed\r\n  const now = new Date();\r\n  const allAccepted = sessionRequests.filter(r => r.status === 'accepted');\r\n  const acceptedRequests = allAccepted.filter(r => {\r\n    if (!r.preferredDate || !r.preferredTime) return true; // no date = keep in upcoming\r\n    const sessionDate = new Date(`${r.preferredDate}T${r.preferredTime}`);\r\n    // Keep sessions that haven't ended yet (give 2 hour buffer after start time)\r\n    return (now.getTime() - sessionDate.getTime()) < 2 * 60 * 60 * 1000;\r\n  });\r\n  const pastAccepted = allAccepted.filter(r => {\r\n    if (!r.preferredDate || !r.preferredTime) return false;\r\n    const sessionDate = new Date(`${r.preferredDate}T${r.preferredTime}`);\r\n    return (now.getTime() - sessionDate.getTime()) >= 2 * 60 * 60 * 1000;\r\n  });\r\n  const completedRequests = [...sessionRequests.filter(r => r.status === 'completed'), ...pastAccepted];\r\n\r\n  console.log('MentorDashboard - Session Requests:', sessionRequests);\r\n  console.log('MentorDashboard - Pending Requests:', pendingRequests);\r\n  console.log('MentorDashboard - Accepted Requests:', acceptedRequests);\r\n  console.log('MentorDashboard - Auth Loading:', authLoading);\r\n  console.log('MentorDashboard - User:', user?.id);\r\n\r\n  if (loading || authLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4\"></div>\r\n          <p className={isDarkMode ? 'text-slate-300' : 'text-slate-600'}>\r\n            {authLoading ? 'Authenticating...' : 'Loading...'}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`min-h-screen px-4 sm:px-6 lg:px-8 ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n      {/* Confirmation Popup */}\r\n      {showConfirmPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-md ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${showConfirmPopup.type === 'complete' ? 'bg-green-500/20' : 'bg-red-500/20'\r\n                }`}>\r\n                {showConfirmPopup.type === 'complete' ? (\r\n                  <CheckCheck className=\"w-10 h-10 text-green-500\" />\r\n                ) : (\r\n                  <XCircle className=\"w-10 h-10 text-red-500\" />\r\n                )}\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                {showConfirmPopup.type === 'complete' ? 'Mark Session Complete?' : 'Cancel Session?'}\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                {showConfirmPopup.type === 'complete'\r\n                  ? `Are you sure you want to mark \"${showConfirmPopup.topic}\" as completed?`\r\n                  : `Are you sure you want to cancel \"${showConfirmPopup.topic}\"?`\r\n                }\r\n              </p>\r\n              <p className={`text-sm mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                The student will be notified of this action.\r\n              </p>\r\n              <div className=\"flex gap-3 mt-6\">\r\n                <button\r\n                  onClick={() => setShowConfirmPopup(null)}\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${isDarkMode ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                    }`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={() => showConfirmPopup.type === 'complete'\r\n                    ? handleCompleteSession(showConfirmPopup.requestId)\r\n                    : handleCancelSession(showConfirmPopup.requestId)\r\n                  }\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${showConfirmPopup.type === 'complete'\r\n                    ? 'bg-green-500 hover:bg-green-600 text-white'\r\n                    : 'bg-red-500 hover:bg-red-600 text-white'\r\n                    }`}\r\n                >\r\n                  {showConfirmPopup.type === 'complete' ? 'Yes, Complete' : 'Yes, Cancel'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Action Success Popup */}\r\n      {showActionSuccessPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-4 ${showActionSuccessPopup.type === 'completed' ? 'bg-green-500/20' :\r\n                showActionSuccessPopup.type === 'deleted' ? 'bg-red-500/20' : 'bg-amber-500/20'\r\n                }`}>\r\n                {showActionSuccessPopup.type === 'completed' ? (\r\n                  <CheckCheck className=\"w-10 h-10 text-green-500\" />\r\n                ) : showActionSuccessPopup.type === 'deleted' ? (\r\n                  <Trash2 className=\"w-10 h-10 text-red-500\" />\r\n                ) : (\r\n                  <XCircle className=\"w-10 h-10 text-amber-500\" />\r\n                )}\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                {showActionSuccessPopup.type === 'completed' ? 'Session Completed!' :\r\n                  showActionSuccessPopup.type === 'deleted' ? 'Offering Deleted!' : 'Session Cancelled'}\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                {showActionSuccessPopup.type === 'completed'\r\n                  ? 'The session has been marked as complete. The student has been notified.'\r\n                  : showActionSuccessPopup.type === 'deleted'\r\n                    ? 'The offering has been removed from your profile.'\r\n                    : 'The session has been cancelled. The student has been notified.'\r\n                }\r\n              </p>\r\n              <button\r\n                onClick={() => setShowActionSuccessPopup(null)}\r\n                className={`mt-6 px-6 py-2 rounded-lg font-medium transition-colors ${showActionSuccessPopup.type === 'completed'\r\n                  ? 'bg-green-500 hover:bg-green-600 text-white'\r\n                  : showActionSuccessPopup.type === 'deleted'\r\n                    ? 'bg-red-500 hover:bg-red-600 text-white'\r\n                    : 'bg-amber-500 hover:bg-amber-600 text-white'\r\n                  }`}\r\n              >\r\n                Got it!\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Session Start Popup */}\r\n      {showSessionStartPopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-lg w-full mx-4 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mb-4 animate-pulse\">\r\n                <Bell className=\"w-12 h-12 text-green-500\" />\r\n              </div>\r\n              <h3 className={`text-2xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                ðŸŽ‰ Session Starting Now!\r\n              </h3>\r\n              <p className={`text-lg mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                Your session with <span className=\"font-bold text-amber-500\">{showSessionStartPopup.studentName}</span> is starting!\r\n              </p>\r\n              <p className={`text-sm mb-4 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                Topic: {showSessionStartPopup.topic}\r\n              </p>\r\n              <div className={`flex items-center gap-2 px-4 py-2 rounded-full mb-4 ${showSessionStartPopup.mode === 'video' ? 'bg-blue-500/20 text-blue-500' :\r\n                showSessionStartPopup.mode === 'call' ? 'bg-green-500/20 text-green-500' :\r\n                  'bg-amber-500/20 text-amber-500'\r\n                }`}>\r\n                {showSessionStartPopup.mode === 'video' && <><Video size={18} /> Video Call</>}\r\n                {showSessionStartPopup.mode === 'call' && <><MessageCircle size={18} /> Voice Call</>}\r\n                {showSessionStartPopup.mode === 'chat' && <><MessageCircle size={18} /> Chat</>}\r\n              </div>\r\n              {showSessionStartPopup.meetingLink && (\r\n                <a\r\n                  href={showSessionStartPopup.meetingLink}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"mb-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  Join Meeting Link\r\n                </a>\r\n              )}\r\n              <button\r\n                onClick={() => setShowSessionStartPopup(null)}\r\n                className=\"px-8 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-bold transition-colors\"\r\n              >\r\n                Got it!\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Popup */}\r\n      {showDeletePopup && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`relative p-8 rounded-2xl shadow-2xl transform max-w-md ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'\r\n            }`} style={{ animation: 'popIn 0.3s ease-out' }}>\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              <div className=\"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4\">\r\n                <Trash2 className=\"w-10 h-10 text-red-500\" />\r\n              </div>\r\n              <h3 className={`text-xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                Delete Offering?\r\n              </h3>\r\n              <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                Are you sure you want to delete \"{showDeletePopup.title}\"?\r\n              </p>\r\n              <p className={`text-sm mt-1 text-red-500 font-medium`}>\r\n                This action cannot be undone.\r\n              </p>\r\n              <div className=\"flex gap-3 mt-6\">\r\n                <button\r\n                  onClick={() => setShowDeletePopup(null)}\r\n                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${isDarkMode ? 'bg-slate-700 hover:bg-slate-600 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                    }`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDeleteOffering(showDeletePopup.offeringId)}\r\n                  className=\"px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  Yes, Delete\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <h1 className={`text-3xl font-bold mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Mentor Dashboard\r\n          </h1>\r\n          <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>\r\n            Manage your profile, offerings, and student requests\r\n          </p>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\r\n          <div className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Pending Requests</p>\r\n                <p className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {pendingRequests.length}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-amber-500/10 rounded-lg\">\r\n                <Mail className=\"text-amber-500\" size={24} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Rating</p>\r\n                <p className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {mentorProfile?.rating.toFixed(1) || '0.0'}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-yellow-500/10 rounded-lg\">\r\n                <Star className=\"text-yellow-500\" size={24} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>Total Reviews</p>\r\n                <p className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {mentorProfile?.totalReviews || 0}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-3 bg-blue-500/10 rounded-lg\">\r\n                <Award className=\"text-blue-500\" size={24} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Upcoming Sessions Quick View */}\r\n        {acceptedRequests.length > 0 && (\r\n          <div className={`mb-6 p-5 rounded-xl border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} shadow-lg`}>\r\n            <h3 className={`text-base font-bold mb-3 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              <Calendar size={18} className=\"text-green-500\" />\r\n              Upcoming Sessions ({acceptedRequests.length})\r\n            </h3>\r\n            <div className=\"space-y-2\">\r\n              {acceptedRequests.slice(0, 3).map((req: any) => {\r\n                const timeStr = req.preferredDate && req.preferredTime\r\n                  ? getTimeUntilSession(req.preferredDate, req.preferredTime)\r\n                  : null;\r\n                return (\r\n                  <div key={req.id} className={`flex items-center justify-between p-3 rounded-lg ${isDarkMode ? 'bg-slate-700/50' : 'bg-slate-50'}`}>\r\n                    <div className=\"flex items-center gap-3 min-w-0\">\r\n                      <img\r\n                        src={req.studentProfile?.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(req.studentProfile?.fullName || 'S')}&background=random&size=32`}\r\n                        alt=\"\" className=\"w-8 h-8 rounded-full object-cover shrink-0\"\r\n                      />\r\n                      <div className=\"min-w-0\">\r\n                        <p className={`text-sm font-bold truncate ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{req.studentProfile?.fullName || 'Student'}</p>\r\n                        <p className={`text-xs truncate ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>{req.topic}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 shrink-0\">\r\n                      {req.preferredDate && (\r\n                        <span className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>{req.preferredDate}</span>\r\n                      )}\r\n                      {timeStr && (\r\n                        <span className=\"text-xs font-bold text-green-500 flex items-center gap-1\"><Timer size={10} />{timeStr}</span>\r\n                      )}\r\n                      {req.meetingLink && (\r\n                        <a href={req.meetingLink} target=\"_blank\" rel=\"noopener noreferrer\"\r\n                          className=\"text-xs px-2 py-1 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-all flex items-center gap-1\"\r\n                        ><Link size={10} /> Join</a>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n              {acceptedRequests.length > 3 && (\r\n                <p className={`text-xs text-center pt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                  +{acceptedRequests.length - 3} more â€” view all in Sessions\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Tabs */}\r\n        <div className=\"flex gap-2 mb-6 border-b border-slate-300 dark:border-slate-700\">\r\n          {[\r\n            { id: 'requests' as const, label: 'Student Requests', icon: Mail },\r\n            { id: 'offerings' as const, label: 'Mentorship Offerings', icon: Briefcase },\r\n            { id: 'reviews' as const, label: 'Reviews', icon: Star },\r\n          ].map(tab => {\r\n            const Icon = tab.icon;\r\n            return (\r\n              <button\r\n                key={tab.id}\r\n                onClick={() => setActiveTab(tab.id)}\r\n                className={`flex items-center gap-2 px-4 py-3 font-medium transition-colors border-b-2 ${activeTab === tab.id\r\n                  ? 'border-amber-500 text-amber-500'\r\n                  : isDarkMode\r\n                    ? 'border-transparent text-slate-400 hover:text-slate-300'\r\n                    : 'border-transparent text-slate-600 hover:text-slate-900'\r\n                  }`}\r\n              >\r\n                <Icon size={18} />\r\n                {tab.label}\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        <div className=\"space-y-6\">\r\n          {/* Student Requests Tab */}\r\n          {activeTab === 'requests' && (\r\n            <div className=\"space-y-6\">\r\n              {/* Friend Requests Section */}\r\n              {friendRequests.length > 0 && (\r\n                <div>\r\n                  <h2 className={`text-xl font-semibold mb-4 flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    <UserPlus size={24} className=\"text-amber-500\" />\r\n                    Friend Requests ({friendRequests.length})\r\n                  </h2>\r\n                  <div className=\"space-y-3\">\r\n                    {friendRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-4 rounded-xl flex items-center justify-between ${isDarkMode ? 'bg-slate-800' : 'bg-white'\r\n                          } shadow-sm border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}\r\n                      >\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <img\r\n                            src={request.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(request.name || 'U')}&background=random`}\r\n                            alt={request.name}\r\n                            className=\"w-12 h-12 rounded-full object-cover\"\r\n                          />\r\n                          <div>\r\n                            <h3 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                              {request.name}\r\n                            </h3>\r\n                            <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                              @{request.username}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {processingFriendRequest === request.id ? (\r\n                            <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-amber-500\"></div>\r\n                          ) : (\r\n                            <>\r\n                              <button\r\n                                onClick={() => handleFriendRequestAction(request.id, 'accepted')}\r\n                                className=\"p-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors\"\r\n                                title=\"Accept\"\r\n                              >\r\n                                <Check size={18} />\r\n                              </button>\r\n                              <button\r\n                                onClick={() => handleFriendRequestAction(request.id, 'rejected')}\r\n                                className=\"p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n                                title=\"Reject\"\r\n                              >\r\n                                <X size={18} />\r\n                              </button>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Pending Requests */}\r\n              <div>\r\n                <h2 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Pending Requests ({pendingRequests.length})\r\n                </h2>\r\n                {pendingRequests.length === 0 ? (\r\n                  <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                    <Mail className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                    <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No pending requests</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-4\">\r\n                    {pendingRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}\r\n                      >\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <img\r\n                            src={request.studentProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student'}\r\n                            alt=\"Student\"\r\n                            className=\"w-16 h-16 rounded-full\"\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                              <div>\r\n                                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {request.studentProfile?.fullName || 'Student'}\r\n                                </h3>\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  {request.studentProfile?.class && `${request.studentProfile.class} â€¢ `}\r\n                                  {request.studentProfile?.course || 'Student'}\r\n                                </p>\r\n                              </div>\r\n                              <span className=\"px-3 py-1 bg-amber-500/10 text-amber-500 text-xs font-medium rounded-full\">\r\n                                Pending\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 mb-4\">\r\n                              <p className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                Topic: {request.topic}\r\n                              </p>\r\n                              {request.mode && (\r\n                                <p className={`text-sm flex items-center gap-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  <span className=\"font-medium\">Session Mode:</span>\r\n                                  {request.mode === 'video' && 'ðŸŽ¥ Video Call'}\r\n                                  {request.mode === 'call' && 'ðŸ“ž Voice Call'}\r\n                                  {request.mode === 'chat' && 'ðŸ’¬ Chat Only'}\r\n                                </p>\r\n                              )}\r\n                              {request.studentMessage && (\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  \"{request.studentMessage}\"\r\n                                </p>\r\n                              )}\r\n                              {request.preferredDate && (\r\n                                <p className={`text-sm flex items-center gap-2 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  <Calendar size={16} />\r\n                                  {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                </p>\r\n                              )}\r\n                            </div>\r\n\r\n                            {activeRequestId === request.id ? (\r\n                              <div className=\"space-y-3\">\r\n                                <input\r\n                                  type=\"text\"\r\n                                  placeholder=\"Response message (optional)\"\r\n                                  value={responseText}\r\n                                  onChange={(e) => setResponseText(e.target.value)}\r\n                                  className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                                    ? 'bg-slate-700 text-white border-slate-600'\r\n                                    : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                                    } border`}\r\n                                />\r\n                                <input\r\n                                  type=\"text\"\r\n                                  placeholder=\"Meeting link (for accepted requests)\"\r\n                                  value={meetingLink}\r\n                                  onChange={(e) => setMeetingLink(e.target.value)}\r\n                                  className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                                    ? 'bg-slate-700 text-white border-slate-600'\r\n                                    : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                                    } border`}\r\n                                />\r\n                                <div className=\"flex gap-2\">\r\n                                  <button\r\n                                    onClick={() => handleAcceptRequest(request.id)}\r\n                                    className=\"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors\"\r\n                                  >\r\n                                    <CheckCircle size={18} />\r\n                                    Accept\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => handleRejectRequest(request.id)}\r\n                                    className=\"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n                                  >\r\n                                    <XCircle size={18} />\r\n                                    Reject\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      setActiveRequestId(null);\r\n                                      setResponseText('');\r\n                                      setMeetingLink('');\r\n                                    }}\r\n                                    className={`px-4 py-2 rounded-lg ${isDarkMode\r\n                                      ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                      : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                      } transition-colors`}\r\n                                  >\r\n                                    Cancel\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            ) : (\r\n                              <div className=\"flex gap-2\">\r\n                                <button\r\n                                  onClick={() => setActiveRequestId(request.id)}\r\n                                  className=\"flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition-colors\"\r\n                                >\r\n                                  Respond\r\n                                </button>\r\n                                {onStartChat && (\r\n                                  <button\r\n                                    onClick={() => onStartChat({\r\n                                      id: request.studentId,\r\n                                      name: request.studentProfile?.fullName || 'Student',\r\n                                      avatar: request.studentProfile?.avatarUrl,\r\n                                    })}\r\n                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg ${isDarkMode\r\n                                      ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                      : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                      } transition-colors`}\r\n                                  >\r\n                                    <MessageCircle size={18} />\r\n                                    Chat\r\n                                  </button>\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Accepted Requests / Upcoming Sessions */}\r\n              {acceptedRequests.length > 0 && (\r\n                <div>\r\n                  <h2 className={`text-2xl font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Upcoming Sessions ({acceptedRequests.length})\r\n                  </h2>\r\n                  <div className=\"space-y-4\">\r\n                    {acceptedRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800 border-2 border-green-500/30' : 'bg-white border-2 border-green-200'} shadow-lg`}\r\n                      >\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <img\r\n                            src={request.studentProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student'}\r\n                            alt=\"Student\"\r\n                            className=\"w-16 h-16 rounded-full\"\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                              <div>\r\n                                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {request.studentProfile?.fullName || 'Student'}\r\n                                </h3>\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  {request.studentProfile?.class && `${request.studentProfile.class} â€¢ `}\r\n                                  {request.studentProfile?.course || 'Student'}\r\n                                </p>\r\n                              </div>\r\n                              <span className=\"px-3 py-1 bg-green-500 text-white text-xs font-medium rounded-full flex items-center gap-1\">\r\n                                <CheckCircle size={14} />\r\n                                Confirmed\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 mb-4\">\r\n                              <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-green-500/10 border border-green-500/20' : 'bg-green-50 border border-green-200'}`}>\r\n                                <p className={`font-medium ${isDarkMode ? 'text-green-400' : 'text-green-700'}`}>\r\n                                  ðŸ“š Topic: {request.topic}\r\n                                </p>\r\n                                {request.mode && (\r\n                                  <p className={`text-xs flex items-center gap-2 mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                    <span className=\"font-medium\">Mode:</span>\r\n                                    {request.mode === 'video' && 'ðŸŽ¥ Video Call'}\r\n                                    {request.mode === 'call' && 'ðŸ“ž Voice Call'}\r\n                                    {request.mode === 'chat' && 'ðŸ’¬ Chat Only'}\r\n                                  </p>\r\n                                )}\r\n                                {request.preferredDate && (\r\n                                  <p className={`text-sm flex items-center gap-2 mt-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                    <Calendar size={16} />\r\n                                    {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                  </p>\r\n                                )}\r\n                                {/* Countdown Timer */}\r\n                                {request.preferredDate && request.preferredTime && (\r\n                                  <div className={`mt-2 p-2 rounded-lg flex items-center gap-2 ${isSessionIn30Minutes(request.preferredDate, request.preferredTime)\r\n                                    ? 'bg-amber-500/20 border border-amber-500/40'\r\n                                    : isDarkMode ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-blue-50 border border-blue-200'\r\n                                    }`}>\r\n                                    <Timer size={16} className={isSessionIn30Minutes(request.preferredDate, request.preferredTime) ? 'text-amber-500 animate-pulse' : 'text-blue-500'} />\r\n                                    <span className={`text-sm font-medium ${isSessionIn30Minutes(request.preferredDate, request.preferredTime)\r\n                                      ? 'text-amber-500'\r\n                                      : isDarkMode ? 'text-blue-400' : 'text-blue-600'\r\n                                      }`}>\r\n                                      {getTimeUntilSession(request.preferredDate, request.preferredTime)}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n\r\n                              {request.mentorResponse && (\r\n                                <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n                                  <p className={`text-xs font-medium mb-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                                    Your Response:\r\n                                  </p>\r\n                                  <p className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                    {request.mentorResponse}\r\n                                  </p>\r\n                                </div>\r\n                              )}\r\n\r\n                              {request.meetingLink && (\r\n                                <a\r\n                                  href={request.meetingLink}\r\n                                  target=\"_blank\"\r\n                                  rel=\"noopener noreferrer\"\r\n                                  className=\"inline-flex items-center gap-2 text-sm text-amber-500 hover:text-amber-600 underline font-medium\"\r\n                                >\r\n                                  <Video size={16} />\r\n                                  Meeting Link\r\n                                </a>\r\n                              )}\r\n\r\n                              {/* Meeting Link Input for Video/Call Sessions */}\r\n                              {(request.mode === 'video' || request.mode === 'call') && (\r\n                                <div className={`mt-2 p-3 rounded-lg ${isDarkMode ? 'bg-slate-900/50' : 'bg-slate-50'}`}>\r\n                                  {editingMeetingLinkId === request.id ? (\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <Link size={16} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                                      <input\r\n                                        type=\"url\"\r\n                                        value={editMeetingLinkValue}\r\n                                        onChange={(e) => setEditMeetingLinkValue(e.target.value)}\r\n                                        placeholder=\"Enter meeting link (e.g., Zoom, Google Meet)\"\r\n                                        className={`flex-1 px-3 py-1 text-sm rounded-lg border ${isDarkMode\r\n                                          ? 'bg-slate-800 border-slate-600 text-white placeholder-slate-500'\r\n                                          : 'bg-white border-slate-300 text-slate-900 placeholder-slate-400'\r\n                                          }`}\r\n                                      />\r\n                                      <button\r\n                                        onClick={async () => {\r\n                                          await updateSessionMeetingLink(request.id, editMeetingLinkValue);\r\n                                          setEditingMeetingLinkId(null);\r\n                                          loadData();\r\n                                        }}\r\n                                        className=\"px-3 py-1 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg\"\r\n                                      >\r\n                                        Save\r\n                                      </button>\r\n                                      <button\r\n                                        onClick={() => {\r\n                                          setEditingMeetingLinkId(null);\r\n                                          setEditMeetingLinkValue('');\r\n                                        }}\r\n                                        className={`px-3 py-1 text-sm rounded-lg ${isDarkMode\r\n                                          ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                          : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                          }`}\r\n                                      >\r\n                                        Cancel\r\n                                      </button>\r\n                                    </div>\r\n                                  ) : (\r\n                                    <button\r\n                                      onClick={() => {\r\n                                        setEditingMeetingLinkId(request.id);\r\n                                        setEditMeetingLinkValue(request.meetingLink || '');\r\n                                      }}\r\n                                      className={`flex items-center gap-2 text-sm ${isDarkMode ? 'text-amber-400 hover:text-amber-300' : 'text-amber-600 hover:text-amber-700'\r\n                                        }`}\r\n                                    >\r\n                                      <Link size={16} />\r\n                                      {request.meetingLink ? 'Edit Meeting Link' : 'Add Meeting Link'}\r\n                                    </button>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-2 flex-wrap\">\r\n                              {/* Mentor can initiate calls based on session mode */}\r\n                              {onStartVideoCall && request.mode !== 'chat' && (\r\n                                <button\r\n                                  onClick={() => onStartVideoCall({\r\n                                    id: request.studentId,\r\n                                    name: request.studentProfile?.fullName || 'Student',\r\n                                    avatar: request.studentProfile?.avatarUrl,\r\n                                  })}\r\n                                  className=\"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors\"\r\n                                >\r\n                                  <Video size={18} />\r\n                                  {request.mode === 'call' ? 'Start Voice Call' : 'Start Video Call'}\r\n                                </button>\r\n                              )}\r\n                              {onStartChat && (\r\n                                <button\r\n                                  onClick={() => onStartChat({\r\n                                    id: request.studentId,\r\n                                    name: request.studentProfile?.fullName || 'Student',\r\n                                    avatar: request.studentProfile?.avatarUrl,\r\n                                  })}\r\n                                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium ${isDarkMode\r\n                                    ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                                    : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                                    } transition-colors`}\r\n                                >\r\n                                  <MessageCircle size={18} />\r\n                                  Chat with Student\r\n                                </button>\r\n                              )}\r\n                              <button\r\n                                onClick={() => setShowConfirmPopup({ type: 'complete', requestId: request.id, topic: request.topic })}\r\n                                disabled={!hasSessionStarted(request.preferredDate || '', request.preferredTime || '')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${hasSessionStarted(request.preferredDate || '', request.preferredTime || '')\r\n                                  ? 'bg-amber-500 hover:bg-amber-600 text-white cursor-pointer'\r\n                                  : 'bg-slate-400 text-slate-200 cursor-not-allowed opacity-60'\r\n                                  }`}\r\n                                title={!hasSessionStarted(request.preferredDate || '', request.preferredTime || '') ? 'Session has not started yet' : ''}\r\n                              >\r\n                                <CheckCheck size={18} />\r\n                                Mark Complete\r\n                              </button>\r\n                              <button\r\n                                onClick={() => setShowConfirmPopup({ type: 'cancel', requestId: request.id, topic: request.topic })}\r\n                                className=\"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors\"\r\n                              >\r\n                                <XCircle size={18} />\r\n                                Cancel Session\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Completed Sessions */}\r\n              {completedRequests.length > 0 && (\r\n                <div>\r\n                  <h2 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Past Sessions ({completedRequests.length})\r\n                  </h2>\r\n                  <div className=\"space-y-4\">\r\n                    {completedRequests.map(request => (\r\n                      <div\r\n                        key={request.id}\r\n                        className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-100'}`}\r\n                      >\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <img\r\n                            src={request.studentProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student'}\r\n                            alt=\"Student\"\r\n                            className=\"w-12 h-12 rounded-full\"\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-start justify-between mb-2\">\r\n                              <div>\r\n                                <h3 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                  {request.studentProfile?.fullName || 'Student'}\r\n                                </h3>\r\n                                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                  {request.topic}\r\n                                </p>\r\n                                {request.preferredDate && (\r\n                                  <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                    ðŸ“… {request.preferredDate} {request.preferredTime && `at ${request.preferredTime}`}\r\n                                  </p>\r\n                                )}\r\n                              </div>\r\n                              <span className=\"px-3 py-1 bg-slate-500/10 text-slate-500 text-xs font-medium rounded-full flex items-center gap-1\">\r\n                                <CheckCheck size={12} />\r\n                                Completed\r\n                              </span>\r\n                            </div>\r\n\r\n                            {/* Display Review if exists */}\r\n                            {request.review ? (\r\n                              <div className={`mt-3 p-3 rounded-lg ${isDarkMode ? 'bg-slate-900/50' : 'bg-white'} border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                                <div className=\"flex items-center gap-2 mb-2\">\r\n                                  <div className=\"flex items-center gap-0.5\">\r\n                                    {[1, 2, 3, 4, 5].map((star) => (\r\n                                      <Star\r\n                                        key={star}\r\n                                        size={16}\r\n                                        className={star <= request.review!.rating\r\n                                          ? 'text-amber-500 fill-amber-500'\r\n                                          : isDarkMode ? 'text-slate-600' : 'text-slate-300'\r\n                                        }\r\n                                      />\r\n                                    ))}\r\n                                  </div>\r\n                                  <span className={`text-sm font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                                    {request.review.rating}/5\r\n                                  </span>\r\n                                </div>\r\n                                {request.review.reviewText && (\r\n                                  <p className={`text-sm italic ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                                    \"{request.review.reviewText}\"\r\n                                  </p>\r\n                                )}\r\n                                <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                                  Review from {request.review.studentName || request.studentProfile?.fullName || 'Student'}\r\n                                </p>\r\n                              </div>\r\n                            ) : (\r\n                              <p className={`mt-2 text-xs italic ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                                No review yet\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Offerings Tab */}\r\n          {activeTab === 'offerings' && (\r\n            <div>\r\n              <div className=\"flex justify-between items-center mb-6\">\r\n                <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Mentorship Offerings\r\n                </h2>\r\n                <button\r\n                  onClick={() => setShowOfferingForm(!showOfferingForm)}\r\n                  className=\"flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition-colors\"\r\n                >\r\n                  <Plus size={18} />\r\n                  Add Offering\r\n                </button>\r\n              </div>\r\n\r\n              {showOfferingForm && (\r\n                <div className={`p-6 rounded-xl mb-6 ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}>\r\n                  <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    New Offering\r\n                  </h3>\r\n                  <div className=\"space-y-4\">\r\n                    <div>\r\n                      <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                        Title\r\n                      </label>\r\n                      <select\r\n                        value={offeringForm.title}\r\n                        onChange={(e) => setOfferingForm({ ...offeringForm, title: e.target.value })}\r\n                        className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                          ? 'bg-slate-700 text-white border-slate-600'\r\n                          : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                          } border`}\r\n                      >\r\n                        <option value=\"\">Select offering type</option>\r\n                        <option value=\"1:1 Mentorship\">1:1 Mentorship</option>\r\n                        <option value=\"Doubt Solving\">Doubt Solving</option>\r\n                        <option value=\"Resume Review\">Resume Review</option>\r\n                        <option value=\"Mock Interview\">Mock Interview</option>\r\n                        <option value=\"Project Guidance\">Project Guidance</option>\r\n                        <option value=\"Career Guidance\">Career Guidance</option>\r\n                      </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                        Description\r\n                      </label>\r\n                      <textarea\r\n                        value={offeringForm.description}\r\n                        onChange={(e) => setOfferingForm({ ...offeringForm, description: e.target.value })}\r\n                        rows={3}\r\n                        placeholder=\"Describe what you'll provide...\"\r\n                        className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                          ? 'bg-slate-700 text-white border-slate-600'\r\n                          : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                          } border`}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          Duration (minutes)\r\n                        </label>\r\n                        <select\r\n                          value={offeringForm.durationMinutes}\r\n                          onChange={(e) => setOfferingForm({ ...offeringForm, durationMinutes: parseInt(e.target.value) })}\r\n                          className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                            ? 'bg-slate-700 text-white border-slate-600'\r\n                            : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                            } border`}\r\n                        >\r\n                          <option value={30}>30 minutes</option>\r\n                          <option value={60}>1 hour</option>\r\n                          <option value={90}>1.5 hours</option>\r\n                          <option value={120}>2 hours</option>\r\n                        </select>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                          Mode\r\n                        </label>\r\n                        <select\r\n                          value={offeringForm.mode}\r\n                          onChange={(e) => setOfferingForm({ ...offeringForm, mode: e.target.value as any })}\r\n                          className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                            ? 'bg-slate-700 text-white border-slate-600'\r\n                            : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                            } border`}\r\n                        >\r\n                          <option value=\"chat\">Chat</option>\r\n                          <option value=\"call\">Audio Call</option>\r\n                          <option value=\"video\">Video Call</option>\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                      <label className=\"flex items-center gap-2\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={offeringForm.isFree}\r\n                          onChange={(e) => setOfferingForm({ ...offeringForm, isFree: e.target.checked })}\r\n                          className=\"w-4 h-4 text-amber-500 rounded\"\r\n                        />\r\n                        <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>Free</span>\r\n                      </label>\r\n                      {!offeringForm.isFree && (\r\n                        <div className=\"flex-1\">\r\n                          <input\r\n                            type=\"number\"\r\n                            value={offeringForm.price}\r\n                            onChange={(e) => setOfferingForm({ ...offeringForm, price: parseFloat(e.target.value) || 0 })}\r\n                            placeholder=\"Price\"\r\n                            className={`w-full px-4 py-2 rounded-lg ${isDarkMode\r\n                              ? 'bg-slate-700 text-white border-slate-600'\r\n                              : 'bg-slate-50 text-slate-900 border-slate-300'\r\n                              } border`}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2\">\r\n                      <button\r\n                        onClick={handleCreateOffering}\r\n                        disabled={!offeringForm.title || !offeringForm.description}\r\n                        className=\"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-slate-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors\"\r\n                      >\r\n                        Create Offering\r\n                      </button>\r\n                      <button\r\n                        onClick={() => setShowOfferingForm(false)}\r\n                        className={`px-4 py-2 rounded-lg ${isDarkMode\r\n                          ? 'bg-slate-700 hover:bg-slate-600 text-slate-300'\r\n                          : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                          } transition-colors`}\r\n                      >\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Offerings List */}\r\n              {offerings.length === 0 && !showOfferingForm ? (\r\n                <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                  <Briefcase className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                  <p className={`mb-4 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>No offerings created yet</p>\r\n                  <button\r\n                    onClick={() => setShowOfferingForm(true)}\r\n                    className=\"px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition-colors\"\r\n                  >\r\n                    Create Your First Offering\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  {offerings.map(offering => (\r\n                    <div\r\n                      key={offering.id}\r\n                      className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg`}\r\n                    >\r\n                      <div className=\"flex justify-between items-start mb-4\">\r\n                        <div>\r\n                          <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            {offering.title}\r\n                          </h3>\r\n                          <div className=\"flex items-center gap-3 mt-2\">\r\n                            <span className={`flex items-center gap-1 text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                              <Clock size={14} />\r\n                              {offering.durationMinutes} min\r\n                            </span>\r\n                            <span className=\"px-2 py-1 bg-blue-500/10 text-blue-500 text-xs rounded-full\">\r\n                              {offering.mode}\r\n                            </span>\r\n                            {offering.isFree ? (\r\n                              <span className=\"px-2 py-1 bg-green-500/10 text-green-500 text-xs font-medium rounded-full\">\r\n                                Free\r\n                              </span>\r\n                            ) : (\r\n                              <span className=\"px-2 py-1 bg-amber-500/10 text-amber-500 text-xs font-medium rounded-full\">\r\n                                â‚¹{offering.price}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <button\r\n                          onClick={() => setShowDeletePopup({ offeringId: offering.id, title: offering.title })}\r\n                          className=\"p-2 text-red-500 hover:bg-red-500/10 rounded-lg transition-colors\"\r\n                        >\r\n                          <Trash2 size={18} />\r\n                        </button>\r\n                      </div>\r\n                      <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                        {offering.description}\r\n                      </p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Reviews Tab */}\r\n          {activeTab === 'reviews' && (\r\n            <div>\r\n              <div className=\"flex justify-between items-center mb-6\">\r\n                <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Student Reviews\r\n                </h2>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"flex items-center gap-1 bg-amber-500/10 px-3 py-1 rounded-full\">\r\n                    <Star className=\"text-amber-500 fill-amber-500\" size={16} />\r\n                    <span className=\"font-bold text-amber-500\">\r\n                      {reviews.length > 0\r\n                        ? (reviews.reduce((sum: number, r: any) => sum + (r.rating || 0), 0) / reviews.length).toFixed(1)\r\n                        : mentorProfile?.rating?.toFixed(1) || '0.0'}\r\n                    </span>\r\n                  </div>\r\n                  <span className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                    ({reviews.length || mentorProfile?.totalReviews || 0} reviews)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {reviews.length === 0 ? (\r\n                <div className={`text-center py-12 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n                  <Star className={`mx-auto mb-3 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\r\n                  <p className={isDarkMode ? 'text-slate-400' : 'text-slate-600'}>No reviews yet</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  {reviews.map(review => (\r\n                    <div\r\n                      key={review.id}\r\n                      className={`p-6 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-white'} shadow-lg border ${isDarkMode ? 'border-slate-700' : 'border-slate-100'}`}\r\n                    >\r\n                      <div className=\"flex items-center gap-3 mb-4\">\r\n                        <img\r\n                          src={review.studentAvatarUrl || review.student_profile?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(review.studentName || review.student_profile?.full_name || 'U')}&background=random`}\r\n                          alt={review.studentName || review.student_profile?.full_name}\r\n                          className=\"w-10 h-10 rounded-full object-cover\"\r\n                        />\r\n                        <div className=\"flex-1\">\r\n                          <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            {review.studentName || review.student_profile?.full_name || 'Anonymous student'}\r\n                          </h4>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"flex items-center gap-0.5\">\r\n                              {[1, 2, 3, 4, 5].map((star) => (\r\n                                <Star\r\n                                  key={star}\r\n                                  size={14}\r\n                                  className={star <= review.rating\r\n                                    ? 'text-amber-500 fill-amber-500'\r\n                                    : isDarkMode ? 'text-slate-700' : 'text-slate-200'\r\n                                  }\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                            <span className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                              {new Date(review.created_at || review.createdAt).toLocaleDateString()}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      {review.topic && (\r\n                        <div className=\"mb-3\">\r\n                          <span className={`text-[10px] px-2 py-0.5 rounded-full uppercase tracking-wider font-bold ${isDarkMode ? 'bg-amber-500/10 text-amber-500' : 'bg-amber-100 text-amber-600'} border ${isDarkMode ? 'border-amber-500/20' : 'border-amber-200'}`}>\r\n                            {review.topic}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {(review.review_text || review.reviewText) && (\r\n                        <p className={`text-sm italic ${isDarkMode ? 'text-slate-300' : 'text-slate-600'} ${isDarkMode ? 'bg-slate-900/50' : 'bg-slate-50'} p-3 rounded-lg`}>\r\n                          \"{review.review_text || review.reviewText}\"\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MentorDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorOfferingsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FileText' is defined but never used.","line":4,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2656,2659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2656,2659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2779,2782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2779,2782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2910,2913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2910,2913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2964,2967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2964,2967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":101,"column":6,"nodeType":"ArrayExpression","endLine":101,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, user]","fix":{"range":[3696,3702],"text":"[loadData, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5151,5154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5151,5154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Plus, Trash2, Clock, Video, MessageCircle, Phone,\r\n  Loader2, Star, DollarSign, Tag, FileText, Zap,\r\n  ToggleLeft, ToggleRight, Users, TrendingUp, Edit3, X, Check\r\n} from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport {\r\n  fetchMentorOfferings,\r\n  createMentorOffering,\r\n  deleteMentorOffering,\r\n  updateMentorOffering,\r\n  fetchMentorReviews,\r\n  fetchSessionRequests,\r\n  subscribeToMentorReviews,\r\n  subscribeToSessionRequests,\r\n} from '../utils/supabase-queries';\r\n\r\ninterface MentorOfferingsPageProps {\r\n  isDarkMode: boolean;\r\n}\r\n\r\ninterface OfferingForm {\r\n  title: string;\r\n  description: string;\r\n  durationMinutes: number;\r\n  mode: 'chat' | 'call' | 'video';\r\n  isFree: boolean;\r\n  price: number;\r\n}\r\n\r\nconst EMPTY_FORM: OfferingForm = {\r\n  title: '',\r\n  description: '',\r\n  durationMinutes: 60,\r\n  mode: 'video',\r\n  isFree: true,\r\n  price: 0,\r\n};\r\n\r\nconst MODE_META: Record<string, { icon: React.ElementType; label: string; color: string }> = {\r\n  video: { icon: Video, label: 'Video Call', color: 'text-blue-500 bg-blue-500/10' },\r\n  call: { icon: Phone, label: 'Audio Call', color: 'text-green-500 bg-green-500/10' },\r\n  chat: { icon: MessageCircle, label: 'Chat', color: 'text-purple-500 bg-purple-500/10' },\r\n};\r\n\r\nexport const MentorOfferingsPage: React.FC<MentorOfferingsPageProps> = ({ isDarkMode }) => {\r\n  const { user } = useAuth();\r\n  const dark = isDarkMode;\r\n\r\n  const [offerings, setOfferings] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [form, setForm] = useState<OfferingForm>({ ...EMPTY_FORM });\r\n  const [saving, setSaving] = useState(false);\r\n  const [deletingId, setDeletingId] = useState<string | null>(null);\r\n  const [stats, setStats] = useState({ totalBookings: 0, avgRating: 0, totalReviews: 0, totalEarnings: 0 });\r\n  const [deleteConfirm, setDeleteConfirm] = useState<string | null>(null);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [editForm, setEditForm] = useState<OfferingForm>({ ...EMPTY_FORM });\r\n  const [togglingId, setTogglingId] = useState<string | null>(null);\r\n\r\n  const loadData = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      const [offeringsData, reviewsData, sessionsData] = await Promise.all([\r\n        fetchMentorOfferings(user.id),\r\n        fetchMentorReviews(user.id),\r\n        fetchSessionRequests(user.id, 'mentor'),\r\n      ]);\r\n      setOfferings(Array.isArray(offeringsData) ? offeringsData : []);\r\n      const completed = sessionsData.filter((s: any) => s.status === 'completed');\r\n      const avgR = reviewsData.length > 0\r\n        ? reviewsData.reduce((s: number, r: any) => s + (r.rating || 0), 0) / reviewsData.length\r\n        : 0;\r\n      const totalEarnings = completed.reduce((s: number, sess: any) => {\r\n        const off = offeringsData.find((o: any) => o.id === sess.offering_id);\r\n        return s + (off && !off.is_free ? (off.price || 0) : 0);\r\n      }, 0);\r\n      setStats({\r\n        totalBookings: sessionsData.length,\r\n        avgRating: avgR,\r\n        totalReviews: reviewsData.length,\r\n        totalEarnings,\r\n      });\r\n    } catch (err) {\r\n      console.error('Error loading offerings:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadData();\r\n      const reviewSub = subscribeToMentorReviews(user.id, () => loadData());\r\n      const sessionSub = subscribeToSessionRequests(user.id, 'mentor', () => loadData());\r\n      return () => { reviewSub.unsubscribe(); sessionSub.unsubscribe(); };\r\n    }\r\n  }, [user]);\r\n\r\n  const handleCreate = async () => {\r\n    if (!user || !form.title.trim() || !form.description.trim()) return;\r\n    setSaving(true);\r\n    try {\r\n      const result = await createMentorOffering({\r\n        mentor_id: user.id,\r\n        title: form.title.trim(),\r\n        description: form.description.trim(),\r\n        duration_minutes: form.durationMinutes,\r\n        mode: form.mode,\r\n        is_free: form.isFree,\r\n        price: form.isFree ? 0 : form.price,\r\n        is_active: true,\r\n      });\r\n      if (!result.error) {\r\n        setShowForm(false);\r\n        setForm({ ...EMPTY_FORM });\r\n        await loadData();\r\n      }\r\n    } catch (err) {\r\n      console.error('Error creating offering:', err);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    setDeletingId(id);\r\n    try {\r\n      await deleteMentorOffering(id);\r\n      await loadData();\r\n    } catch (err) {\r\n      console.error('Error deleting offering:', err);\r\n    } finally {\r\n      setDeletingId(null);\r\n      setDeleteConfirm(null);\r\n    }\r\n  };\r\n\r\n  const handleToggleActive = async (id: string, currentActive: boolean) => {\r\n    setTogglingId(id);\r\n    try {\r\n      await updateMentorOffering(id, { is_active: !currentActive });\r\n      await loadData();\r\n    } catch (err) {\r\n      console.error('Error toggling offering:', err);\r\n    } finally {\r\n      setTogglingId(null);\r\n    }\r\n  };\r\n\r\n  const startEdit = (off: any) => {\r\n    setEditingId(off.id);\r\n    setEditForm({\r\n      title: off.title || '',\r\n      description: off.description || '',\r\n      durationMinutes: off.duration_minutes || 60,\r\n      mode: off.mode || 'video',\r\n      isFree: off.is_free ?? true,\r\n      price: off.price || 0,\r\n    });\r\n  };\r\n\r\n  const handleSaveEdit = async () => {\r\n    if (!editingId || !editForm.title.trim() || !editForm.description.trim()) return;\r\n    setSaving(true);\r\n    try {\r\n      await updateMentorOffering(editingId, {\r\n        title: editForm.title.trim(),\r\n        description: editForm.description.trim(),\r\n        duration_minutes: editForm.durationMinutes,\r\n        mode: editForm.mode,\r\n        is_free: editForm.isFree,\r\n        price: editForm.isFree ? 0 : editForm.price,\r\n      });\r\n      setEditingId(null);\r\n      await loadData();\r\n    } catch (err) {\r\n      console.error('Error updating offering:', err);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-20\">\r\n        <Loader2 className=\"w-10 h-10 text-amber-500 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-4 sm:px-6 lg:px-8\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\r\n        <div>\r\n          <h2 className={`text-3xl font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>My Offerings</h2>\r\n          <p className={dark ? 'text-slate-400' : 'text-slate-600'}>Create and manage your mentorship offerings</p>\r\n        </div>\r\n        <button\r\n          onClick={() => setShowForm(!showForm)}\r\n          className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-bold text-sm transition-all shadow-md ${\r\n            showForm\r\n              ? dark ? 'bg-slate-700 text-red-400 hover:bg-slate-600' : 'bg-red-50 text-red-500 hover:bg-red-100 border border-red-200'\r\n              : 'bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700'\r\n          }`}\r\n        >\r\n          {showForm ? <X size={16} /> : <Plus size={16} />}\r\n          {showForm ? 'Cancel' : 'New Offering'}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Quick Stats */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n        {[\r\n          { label: 'Total Bookings', value: stats.totalBookings, icon: Users, color: 'from-blue-500 to-cyan-500' },\r\n          { label: 'Avg Rating', value: stats.avgRating > 0 ? stats.avgRating.toFixed(1) : 'â€”', icon: Star, color: 'from-amber-500 to-orange-500' },\r\n          { label: 'Reviews', value: stats.totalReviews, icon: TrendingUp, color: 'from-green-500 to-emerald-500' },\r\n          { label: 'Active Offerings', value: offerings.filter(o => o.is_active !== false).length, icon: Zap, color: 'from-purple-500 to-fuchsia-500' },\r\n        ].map((stat, i) => {\r\n          const Icon = stat.icon;\r\n          return (\r\n            <div key={i} className={`rounded-2xl border p-5 transition-all duration-300 hover:scale-[1.02] ${dark ? 'bg-slate-800 border-slate-700 hover:border-slate-600' : 'bg-white border-slate-200 hover:shadow-lg'}`}>\r\n              <div className={`w-10 h-10 rounded-xl flex items-center justify-center mb-3 bg-gradient-to-br ${stat.color} shadow-lg`}>\r\n                <Icon size={18} className=\"text-white\" />\r\n              </div>\r\n              <p className={`text-3xl font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>{stat.value}</p>\r\n              <p className={`text-xs mt-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>{stat.label}</p>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Create Offering Form */}\r\n      {showForm && (\r\n        <div className={`rounded-2xl border p-6 ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} shadow-lg`}>\r\n          <h3 className={`text-lg font-bold mb-4 flex items-center gap-2 ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n            <Plus size={18} className=\"text-amber-500\" />\r\n            Create New Offering\r\n          </h3>\r\n          <div className=\"space-y-4\">\r\n            {/* Title */}\r\n            <div>\r\n              <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-600'}`}>Title *</label>\r\n              <input\r\n                type=\"text\"\r\n                value={form.title}\r\n                onChange={e => setForm(f => ({ ...f, title: e.target.value }))}\r\n                placeholder=\"e.g. 1:1 Career Mentorship, Resume Review, Mock Interview...\"\r\n                className={`w-full px-4 py-2.5 rounded-xl text-sm border transition-all focus:outline-none focus:ring-2 focus:ring-amber-500/40 ${\r\n                  dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'\r\n                }`}\r\n              />\r\n            </div>\r\n            {/* Description */}\r\n            <div>\r\n              <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-600'}`}>Description *</label>\r\n              <textarea\r\n                value={form.description}\r\n                onChange={e => setForm(f => ({ ...f, description: e.target.value }))}\r\n                placeholder=\"Describe what students will get from this session...\"\r\n                rows={3}\r\n                className={`w-full px-4 py-2.5 rounded-xl text-sm border transition-all resize-none focus:outline-none focus:ring-2 focus:ring-amber-500/40 ${\r\n                  dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'\r\n                }`}\r\n              />\r\n            </div>\r\n            {/* Mode + Duration row */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-600'}`}>Session Mode</label>\r\n                <div className=\"flex gap-2\">\r\n                  {(['video', 'call', 'chat'] as const).map(m => {\r\n                    const meta = MODE_META[m];\r\n                    const Icon = meta.icon;\r\n                    return (\r\n                      <button\r\n                        key={m}\r\n                        onClick={() => setForm(f => ({ ...f, mode: m }))}\r\n                        className={`flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-xs font-bold transition-all border ${\r\n                          form.mode === m\r\n                            ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white border-transparent shadow-md'\r\n                            : dark ? 'bg-slate-700 border-slate-600 text-slate-400 hover:border-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600 hover:border-slate-300'\r\n                        }`}\r\n                      >\r\n                        <Icon size={14} />\r\n                        {meta.label}\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-600'}`}>Duration (minutes)</label>\r\n                <div className=\"flex gap-2\">\r\n                  {[30, 45, 60, 90].map(d => (\r\n                    <button\r\n                      key={d}\r\n                      onClick={() => setForm(f => ({ ...f, durationMinutes: d }))}\r\n                      className={`flex-1 px-3 py-2 rounded-xl text-xs font-bold transition-all border ${\r\n                        form.durationMinutes === d\r\n                          ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white border-transparent shadow-md'\r\n                          : dark ? 'bg-slate-700 border-slate-600 text-slate-400 hover:border-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600 hover:border-slate-300'\r\n                      }`}\r\n                    >\r\n                      {d}m\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {/* Pricing */}\r\n            <div>\r\n              <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-600'}`}>Pricing</label>\r\n              <div className=\"flex items-center gap-4\">\r\n                <button\r\n                  onClick={() => setForm(f => ({ ...f, isFree: true, price: 0 }))}\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all border ${\r\n                    form.isFree\r\n                      ? 'bg-green-500/10 text-green-500 border-green-500/30'\r\n                      : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'\r\n                  }`}\r\n                >\r\n                  <Zap size={14} /> Free\r\n                </button>\r\n                <button\r\n                  onClick={() => setForm(f => ({ ...f, isFree: false }))}\r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all border ${\r\n                    !form.isFree\r\n                      ? 'bg-amber-500/10 text-amber-500 border-amber-500/30'\r\n                      : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'\r\n                  }`}\r\n                >\r\n                  <DollarSign size={14} /> Paid\r\n                </button>\r\n                {!form.isFree && (\r\n                  <div className=\"relative flex-1 max-w-[160px]\">\r\n                    <DollarSign size={14} className={`absolute left-3 top-1/2 -translate-y-1/2 ${dark ? 'text-slate-500' : 'text-slate-400'}`} />\r\n                    <input\r\n                      type=\"number\"\r\n                      min={0}\r\n                      value={form.price}\r\n                      onChange={e => setForm(f => ({ ...f, price: parseFloat(e.target.value) || 0 }))}\r\n                      className={`w-full pl-8 pr-3 py-2 rounded-xl text-sm border transition-all focus:outline-none focus:ring-2 focus:ring-amber-500/40 ${\r\n                        dark ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'\r\n                      }`}\r\n                      placeholder=\"0.00\"\r\n                    />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {/* Submit */}\r\n            <button\r\n              onClick={handleCreate}\r\n              disabled={saving || !form.title.trim() || !form.description.trim()}\r\n              className=\"w-full py-3 rounded-xl font-bold text-sm bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n            >\r\n              {saving ? <Loader2 size={16} className=\"animate-spin\" /> : <Check size={16} />}\r\n              {saving ? 'Creating...' : 'Create Offering'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Offerings Grid */}\r\n      {offerings.length === 0 && !showForm ? (\r\n        <div className={`text-center py-20 rounded-2xl border ${dark ? 'bg-slate-800/50 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n          <Tag className={`mx-auto mb-3 ${dark ? 'text-slate-600' : 'text-slate-300'}`} size={56} />\r\n          <p className={`text-lg font-bold ${dark ? 'text-slate-400' : 'text-slate-600'}`}>No offerings yet</p>\r\n          <p className={`text-sm mt-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Create your first offering to start accepting sessions</p>\r\n          <button\r\n            onClick={() => setShowForm(true)}\r\n            className=\"mt-4 px-6 py-2.5 rounded-xl font-bold text-sm bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700 transition-all shadow-md inline-flex items-center gap-2\"\r\n          >\r\n            <Plus size={16} /> Create Offering\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5\">\r\n          {offerings.map(off => {\r\n            const meta = MODE_META[off.mode] || MODE_META.video;\r\n            const ModeIcon = meta.icon;\r\n            const isEditing = editingId === off.id;\r\n            const isActive = off.is_active !== false;\r\n\r\n            // Inline edit mode\r\n            if (isEditing) {\r\n              return (\r\n                <div key={off.id} className={`rounded-2xl border p-5 col-span-1 md:col-span-2 ${dark ? 'bg-slate-800 border-amber-500/30 ring-1 ring-amber-500/10' : 'bg-white border-amber-200 ring-1 ring-amber-100'}`}>\r\n                  <h4 className={`text-sm font-bold mb-3 flex items-center gap-2 ${dark ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                    <Edit3 size={14} /> Edit Offering\r\n                  </h4>\r\n                  <div className=\"space-y-3\">\r\n                    <input type=\"text\" value={editForm.title} onChange={e => setEditForm(f => ({ ...f, title: e.target.value }))} placeholder=\"Title\"\r\n                      className={`w-full px-4 py-2 rounded-xl text-sm border focus:outline-none focus:ring-2 focus:ring-amber-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`}\r\n                    />\r\n                    <textarea value={editForm.description} onChange={e => setEditForm(f => ({ ...f, description: e.target.value }))} rows={2} placeholder=\"Description\"\r\n                      className={`w-full px-4 py-2 rounded-xl text-sm border resize-none focus:outline-none focus:ring-2 focus:ring-amber-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`}\r\n                    />\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\r\n                      <div>\r\n                        <label className={`text-[10px] font-bold mb-1 block ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Mode</label>\r\n                        <div className=\"flex gap-1\">\r\n                          {(['video', 'call', 'chat'] as const).map(m => (\r\n                            <button key={m} onClick={() => setEditForm(f => ({ ...f, mode: m }))}\r\n                              className={`flex-1 px-2 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${editForm.mode === m ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white border-transparent' : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'}`}\r\n                            >\r\n                              {MODE_META[m].label}\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <label className={`text-[10px] font-bold mb-1 block ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Duration</label>\r\n                        <div className=\"flex gap-1\">\r\n                          {[30, 45, 60, 90].map(d => (\r\n                            <button key={d} onClick={() => setEditForm(f => ({ ...f, durationMinutes: d }))}\r\n                              className={`flex-1 px-2 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${editForm.durationMinutes === d ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white border-transparent' : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'}`}\r\n                            >\r\n                              {d}m\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <label className={`text-[10px] font-bold mb-1 block ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Pricing</label>\r\n                        <div className=\"flex gap-1\">\r\n                          <button onClick={() => setEditForm(f => ({ ...f, isFree: true, price: 0 }))}\r\n                            className={`flex-1 px-2 py-1.5 rounded-lg text-[10px] font-bold border ${editForm.isFree ? 'bg-green-500/10 text-green-500 border-green-500/30' : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'}`}\r\n                          >Free</button>\r\n                          <button onClick={() => setEditForm(f => ({ ...f, isFree: false }))}\r\n                            className={`flex-1 px-2 py-1.5 rounded-lg text-[10px] font-bold border ${!editForm.isFree ? 'bg-amber-500/10 text-amber-500 border-amber-500/30' : dark ? 'bg-slate-700 border-slate-600 text-slate-400' : 'bg-slate-50 border-slate-200 text-slate-600'}`}\r\n                          >Paid</button>\r\n                          {!editForm.isFree && (\r\n                            <input type=\"number\" min={0} value={editForm.price} onChange={e => setEditForm(f => ({ ...f, price: parseFloat(e.target.value) || 0 }))}\r\n                              className={`w-20 px-2 py-1.5 rounded-lg text-[10px] border ${dark ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`}\r\n                            />\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2 pt-1\">\r\n                      <button onClick={handleSaveEdit} disabled={saving || !editForm.title.trim() || !editForm.description.trim()}\r\n                        className=\"flex-1 py-2 rounded-xl text-xs font-bold bg-gradient-to-r from-amber-500 to-orange-600 text-white disabled:opacity-50 flex items-center justify-center gap-1\">\r\n                        {saving ? <Loader2 size={12} className=\"animate-spin\" /> : <Check size={12} />} {saving ? 'Saving...' : 'Save Changes'}\r\n                      </button>\r\n                      <button onClick={() => setEditingId(null)} className={`px-4 py-2 rounded-xl text-xs font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            }\r\n\r\n            return (\r\n              <div key={off.id} className={`rounded-2xl border p-5 transition-all duration-300 group relative ${\r\n                !isActive\r\n                  ? dark ? 'bg-slate-800/50 border-slate-700/50 opacity-60' : 'bg-slate-50 border-slate-200/50 opacity-60'\r\n                  : dark ? 'bg-slate-800 border-slate-700 hover:border-amber-500/30 hover:shadow-lg hover:shadow-amber-500/5' : 'bg-white border-slate-200 hover:border-amber-300 hover:shadow-xl hover:shadow-amber-100'\r\n              }`}>\r\n                {/* Delete Confirm overlay */}\r\n                {deleteConfirm === off.id && (\r\n                  <div className=\"absolute inset-0 z-10 rounded-2xl bg-black/60 backdrop-blur-sm flex items-center justify-center\">\r\n                    <div className={`rounded-xl p-5 text-center ${dark ? 'bg-slate-800' : 'bg-white'} shadow-2xl`}>\r\n                      <p className={`text-sm font-bold mb-3 ${dark ? 'text-white' : 'text-slate-900'}`}>Delete this offering?</p>\r\n                      <div className=\"flex gap-2\">\r\n                        <button onClick={() => setDeleteConfirm(null)} className={`flex-1 px-4 py-2 rounded-lg text-xs font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>Cancel</button>\r\n                        <button\r\n                          onClick={() => handleDelete(off.id)}\r\n                          disabled={deletingId === off.id}\r\n                          className=\"flex-1 px-4 py-2 rounded-lg text-xs font-bold bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 flex items-center justify-center gap-1\"\r\n                        >\r\n                          {deletingId === off.id ? <Loader2 size={12} className=\"animate-spin\" /> : <Trash2 size={12} />} Delete\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-start justify-between gap-3\">\r\n                  <div className=\"flex items-start gap-3 min-w-0\">\r\n                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${meta.color}`}>\r\n                      <ModeIcon size={18} />\r\n                    </div>\r\n                    <div className=\"min-w-0\">\r\n                      <h4 className={`font-bold truncate ${dark ? 'text-white' : 'text-slate-900'}`}>{off.title}</h4>\r\n                      <p className={`text-xs mt-0.5 line-clamp-2 ${dark ? 'text-slate-400' : 'text-slate-600'}`}>{off.description}</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-1 shrink-0 opacity-0 group-hover:opacity-100 transition-all\">\r\n                    <button onClick={() => startEdit(off)} className={`p-1.5 rounded-lg ${dark ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-500'}`} title=\"Edit\">\r\n                      <Edit3 size={14} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleToggleActive(off.id, isActive)}\r\n                      disabled={togglingId === off.id}\r\n                      className={`p-1.5 rounded-lg ${isActive ? (dark ? 'hover:bg-amber-500/20 text-amber-400' : 'hover:bg-amber-50 text-amber-500') : (dark ? 'hover:bg-green-500/20 text-green-400' : 'hover:bg-green-50 text-green-500')}`}\r\n                      title={isActive ? 'Deactivate' : 'Activate'}\r\n                    >\r\n                      {togglingId === off.id ? <Loader2 size={14} className=\"animate-spin\" /> : isActive ? <ToggleRight size={14} /> : <ToggleLeft size={14} />}\r\n                    </button>\r\n                    <button onClick={() => setDeleteConfirm(off.id)} className={`p-1.5 rounded-lg ${dark ? 'hover:bg-red-500/20 text-red-400' : 'hover:bg-red-50 text-red-400'}`} title=\"Delete\">\r\n                      <Trash2 size={14} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tags */}\r\n                <div className=\"flex items-center gap-2 mt-3 flex-wrap\">\r\n                  <span className={`text-[11px] px-2.5 py-1 rounded-full font-bold flex items-center gap-1 ${meta.color}`}>\r\n                    <ModeIcon size={10} /> {meta.label}\r\n                  </span>\r\n                  <span className={`text-[11px] px-2.5 py-1 rounded-full font-bold flex items-center gap-1 ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>\r\n                    <Clock size={10} /> {off.duration_minutes || 60} min\r\n                  </span>\r\n                  <span className={`text-[11px] px-2.5 py-1 rounded-full font-bold flex items-center gap-1 ${\r\n                    off.is_free\r\n                      ? 'bg-green-500/10 text-green-500'\r\n                      : 'bg-amber-500/10 text-amber-500'\r\n                  }`}>\r\n                    {off.is_free ? (\r\n                      <><Zap size={10} /> Free</>\r\n                    ) : (\r\n                      <><DollarSign size={10} /> ${off.price}</>\r\n                    )}\r\n                  </span>\r\n                  <span className={`text-[11px] px-2.5 py-1 rounded-full font-bold flex items-center gap-1 ${\r\n                    isActive ? 'bg-green-500/10 text-green-500' : 'bg-slate-500/10 text-slate-400'\r\n                  }`}>\r\n                    {isActive ? <><ToggleRight size={10} /> Active</> : <><ToggleLeft size={10} /> Paused</>}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorSessionsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[769,772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[769,772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1040,1043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1040,1043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, user]","fix":{"range":[2871,2877],"text":"[loadData, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3063,3066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3063,3066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11527,11530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11527,11530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11582,11585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11582,11585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":528,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":528,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31539,31542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31539,31542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Calendar, Star, Clock, Loader2, MessageCircle, Video,\r\n  CheckCircle, XCircle, Link2, Edit3, Copy,\r\n  ChevronDown, ChevronUp, Send, AlertCircle, Timer,\r\n  CheckCheck, Ban\r\n} from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport {\r\n  fetchSessionRequests,\r\n  fetchMentorReviews,\r\n  subscribeToSessionRequests,\r\n  subscribeToMentorReviews,\r\n  acceptSessionRequest,\r\n  rejectSessionRequest,\r\n  updateSessionMeetingLink,\r\n  completeSessionRequest,\r\n  cancelSessionRequest,\r\n} from '../utils/supabase-queries';\r\n\r\ninterface MentorSessionsPageProps {\r\n  isDarkMode: boolean;\r\n  onStartVideoCall?: (name: string, avatar?: string, friendId?: string) => void;\r\n  onStartChat?: (friend: any) => void;\r\n}\r\n\r\nexport const MentorSessionsPage: React.FC<MentorSessionsPageProps> = ({ isDarkMode, onStartVideoCall, onStartChat }) => {\r\n  const { user } = useAuth();\r\n  const [sessions, setSessions] = useState<any[]>([]);\r\n  const [reviews, setReviews] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState<'all' | 'pending' | 'accepted' | 'completed' | 'rejected' | 'cancelled'>('all');\r\n  const dark = isDarkMode;\r\n\r\n  // Accept/reject form state\r\n  const [actionId, setActionId] = useState<string | null>(null);\r\n  const [actionType, setActionType] = useState<'accept' | 'reject' | null>(null);\r\n  const [responseText, setResponseText] = useState('');\r\n  const [meetingLink, setMeetingLink] = useState('');\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  // Meeting link edit state\r\n  const [editingLinkId, setEditingLinkId] = useState<string | null>(null);\r\n  const [editLinkValue, setEditLinkValue] = useState('');\r\n  const [savingLink, setSavingLink] = useState(false);\r\n\r\n  // Expand/collapse\r\n  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n\r\n  // Complete/cancel confirm\r\n  const [confirmAction, setConfirmAction] = useState<{ id: string; type: 'complete' | 'cancel' } | null>(null);\r\n  const [actionLoading, setActionLoading] = useState(false);\r\n\r\n  const loadData = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      const [sessionsData, reviewsData] = await Promise.all([\r\n        fetchSessionRequests(user.id, 'mentor'),\r\n        fetchMentorReviews(user.id)\r\n      ]);\r\n      setSessions(sessionsData);\r\n      setReviews(reviewsData);\r\n    } catch (err) {\r\n      console.error('Error loading sessions:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadData();\r\n      const sub = subscribeToSessionRequests(user.id, 'mentor', loadData);\r\n      const reviewSub = subscribeToMentorReviews(user.id, () => loadData());\r\n      return () => { sub.unsubscribe(); reviewSub.unsubscribe(); };\r\n    }\r\n  }, [user]);\r\n\r\n  const filteredSessions = filter === 'all' ? sessions : sessions.filter(s => s.status === filter);\r\n  const avgRating = reviews.length > 0\r\n    ? (reviews.reduce((sum: number, r: any) => sum + (r.rating || 0), 0) / reviews.length).toFixed(1)\r\n    : '0.0';\r\n\r\n  const statusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'pending': return 'bg-amber-500/10 text-amber-500 border-amber-500/20';\r\n      case 'accepted': return 'bg-green-500/10 text-green-500 border-green-500/20';\r\n      case 'completed': return 'bg-blue-500/10 text-blue-500 border-blue-500/20';\r\n      case 'rejected': return 'bg-red-500/10 text-red-500 border-red-500/20';\r\n      case 'cancelled': return 'bg-slate-500/10 text-slate-500 border-slate-500/20';\r\n      default: return 'bg-slate-500/10 text-slate-500 border-slate-500/20';\r\n    }\r\n  };\r\n\r\n  // Time until session helper\r\n  const getTimeUntil = (dateStr: string, timeStr: string) => {\r\n    try {\r\n      const dt = new Date(`${dateStr}T${timeStr}`);\r\n      const now = new Date();\r\n      const diff = dt.getTime() - now.getTime();\r\n      if (diff <= 0) return null;\r\n      const hours = Math.floor(diff / (1000 * 60 * 60));\r\n      const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n      if (hours > 48) return `${Math.floor(hours / 24)}d`;\r\n      if (hours > 0) return `${hours}h ${mins}m`;\r\n      return `${mins}m`;\r\n    } catch { return null; }\r\n  };\r\n\r\n  const handleAccept = async () => {\r\n    if (!actionId) return;\r\n    setSubmitting(true);\r\n    try {\r\n      await acceptSessionRequest(actionId, responseText || 'Accepted!', meetingLink || '');\r\n      setActionId(null); setActionType(null); setResponseText(''); setMeetingLink('');\r\n      await loadData();\r\n    } catch (err) { console.error('Error accepting:', err); }\r\n    finally { setSubmitting(false); }\r\n  };\r\n\r\n  const handleReject = async () => {\r\n    if (!actionId) return;\r\n    setSubmitting(true);\r\n    try {\r\n      await rejectSessionRequest(actionId, responseText || 'Sorry, not available');\r\n      setActionId(null); setActionType(null); setResponseText('');\r\n      await loadData();\r\n    } catch (err) { console.error('Error rejecting:', err); }\r\n    finally { setSubmitting(false); }\r\n  };\r\n\r\n  const handleSaveMeetingLink = async () => {\r\n    if (!editingLinkId) return;\r\n    setSavingLink(true);\r\n    try {\r\n      await updateSessionMeetingLink(editingLinkId, editLinkValue);\r\n      setEditingLinkId(null); setEditLinkValue('');\r\n      await loadData();\r\n    } catch (err) { console.error('Error updating link:', err); }\r\n    finally { setSavingLink(false); }\r\n  };\r\n\r\n  const copyToClipboard = (text: string) => { navigator.clipboard.writeText(text).catch(() => {}); };\r\n\r\n  const handleCompleteSession = async (id: string) => {\r\n    setActionLoading(true);\r\n    try {\r\n      await completeSessionRequest(id);\r\n      setConfirmAction(null);\r\n      await loadData();\r\n    } catch (err) { console.error('Error completing session:', err); }\r\n    finally { setActionLoading(false); }\r\n  };\r\n\r\n  const handleCancelSession = async (id: string) => {\r\n    setActionLoading(true);\r\n    try {\r\n      await cancelSessionRequest(id);\r\n      setConfirmAction(null);\r\n      await loadData();\r\n    } catch (err) { console.error('Error cancelling session:', err); }\r\n    finally { setActionLoading(false); }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-20\">\r\n        <Loader2 className=\"w-10 h-10 text-amber-500 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-4 sm:px-6 lg:px-8\">\r\n      {/* Confirm Complete/Cancel Dialog */}\r\n      {confirmAction && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n          <div className={`p-6 rounded-2xl shadow-2xl max-w-sm w-full mx-4 ${dark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'}`}>\r\n            <div className=\"text-center\">\r\n              <div className={`w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-3 ${confirmAction.type === 'complete' ? 'bg-green-500/10' : 'bg-red-500/10'}`}>\r\n                {confirmAction.type === 'complete' ? <CheckCheck size={28} className=\"text-green-500\" /> : <Ban size={28} className=\"text-red-500\" />}\r\n              </div>\r\n              <h4 className={`text-lg font-bold mb-1 ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n                {confirmAction.type === 'complete' ? 'Mark as Complete?' : 'Cancel Session?'}\r\n              </h4>\r\n              <p className={`text-sm mb-4 ${dark ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                {confirmAction.type === 'complete' ? 'The student will be able to leave a review.' : 'The student will be notified of cancellation.'}\r\n              </p>\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={() => setConfirmAction(null)} className={`flex-1 py-2.5 rounded-xl text-sm font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>No, go back</button>\r\n                <button\r\n                  onClick={() => confirmAction.type === 'complete' ? handleCompleteSession(confirmAction.id) : handleCancelSession(confirmAction.id)}\r\n                  disabled={actionLoading}\r\n                  className={`flex-1 py-2.5 rounded-xl text-sm font-bold text-white disabled:opacity-50 flex items-center justify-center gap-1 ${confirmAction.type === 'complete' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'}`}\r\n                >\r\n                  {actionLoading ? <Loader2 size={14} className=\"animate-spin\" /> : null}\r\n                  {confirmAction.type === 'complete' ? 'Complete' : 'Cancel it'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\r\n        <div>\r\n          <h2 className={`text-3xl font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>My Sessions</h2>\r\n          <p className={dark ? 'text-slate-400' : 'text-slate-600'}>Manage session requests and upcoming meetings</p>\r\n        </div>\r\n        <div className=\"flex items-center gap-3\">\r\n          {sessions.filter(s => s.status === 'pending').length > 0 && (\r\n            <div className={`flex items-center gap-2 px-4 py-2 rounded-xl border ${dark ? 'bg-amber-500/10 border-amber-500/20' : 'bg-amber-50 border-amber-200'}`}>\r\n              <AlertCircle size={16} className=\"text-amber-500\" />\r\n              <span className=\"text-sm font-bold text-amber-500\">{sessions.filter(s => s.status === 'pending').length} pending</span>\r\n            </div>\r\n          )}\r\n          <div className={`flex items-center gap-3 px-4 py-2 rounded-xl border ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n            <Star size={18} className=\"text-amber-500\" fill=\"currentColor\" />\r\n            <div>\r\n              <p className={`text-lg font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>{avgRating}</p>\r\n              <p className={`text-[10px] ${dark ? 'text-slate-500' : 'text-slate-400'}`}>{reviews.length} reviews</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filter Tabs */}\r\n      <div className=\"flex gap-2 flex-wrap\">\r\n        {(['all', 'pending', 'accepted', 'completed', 'rejected', 'cancelled'] as const).map(f => (\r\n          <button\r\n            key={f}\r\n            onClick={() => setFilter(f)}\r\n            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all capitalize ${\r\n              filter === f\r\n                ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-md'\r\n                : dark ? 'bg-slate-800 text-slate-400 hover:bg-slate-700' : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'\r\n            }`}\r\n          >\r\n            {f} {f !== 'all' && `(${sessions.filter(s => s.status === f).length})`}\r\n            {f === 'all' && ` (${sessions.length})`}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Sessions List */}\r\n      <div className=\"space-y-5\">\r\n        {filteredSessions.length === 0 ? (\r\n          <div className={`text-center py-16 rounded-2xl border ${dark ? 'bg-slate-800/50 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n            <Calendar className={`mx-auto mb-3 ${dark ? 'text-slate-600' : 'text-slate-300'}`} size={48} />\r\n            <p className={dark ? 'text-slate-400' : 'text-slate-600'}>No sessions found</p>\r\n          </div>\r\n        ) : (\r\n          filteredSessions.map((session: any) => {\r\n            const review = reviews.find((r: any) => r.session_request_id === session.id);\r\n            const isExpanded = expandedId === session.id;\r\n            const isAcceptingThis = actionId === session.id && actionType === 'accept';\r\n            const isRejectingThis = actionId === session.id && actionType === 'reject';\r\n            const isEditingLink = editingLinkId === session.id;\r\n            const timeUntil = session.status === 'accepted' && session.preferredDate && session.preferredTime\r\n              ? getTimeUntil(session.preferredDate, session.preferredTime)\r\n              : null;\r\n\r\n            return (\r\n              <div key={session.id} className={`rounded-2xl border transition-all duration-300 shadow-sm hover:shadow-lg ${\r\n                session.status === 'pending'\r\n                  ? dark ? 'bg-slate-800 border-amber-500/30 ring-1 ring-amber-500/10 hover:ring-amber-500/30' : 'bg-white border-amber-200 ring-1 ring-amber-100 hover:shadow-amber-100'\r\n                  : session.status === 'accepted'\r\n                    ? dark ? 'bg-slate-800 border-green-500/20 hover:border-green-500/40' : 'bg-white border-green-200 hover:shadow-green-100'\r\n                    : session.status === 'completed'\r\n                      ? dark ? 'bg-slate-800 border-blue-500/20 hover:border-blue-500/40' : 'bg-white border-blue-200 hover:shadow-blue-100'\r\n                      : dark ? 'bg-slate-800 border-slate-700 hover:border-slate-600' : 'bg-white border-slate-200 hover:border-slate-300'\r\n              }`}>\r\n                {/* Main Row */}\r\n                <div className=\"p-6\">\r\n                  <div className=\"flex items-start justify-between gap-4\">\r\n                    <div className=\"flex items-center gap-4 min-w-0\">\r\n                      <img\r\n                        src={session.studentProfile?.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(session.studentProfile?.fullName || 'S')}&background=random`}\r\n                        alt=\"\"\r\n                        className=\"w-14 h-14 rounded-full object-cover border-2 border-amber-500/20 shrink-0 shadow-md\"\r\n                      />\r\n                      <div className=\"min-w-0\">\r\n                        <h4 className={`font-bold truncate ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n                          {session.studentProfile?.fullName || 'Student'}\r\n                        </h4>\r\n                        <p className={`text-sm truncate ${dark ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                          {session.topic}\r\n                        </p>\r\n                        <div className=\"flex items-center gap-3 mt-1 flex-wrap\">\r\n                          {session.preferredDate && (\r\n                            <span className={`text-xs flex items-center gap-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                              <Calendar size={12} /> {session.preferredDate}\r\n                            </span>\r\n                          )}\r\n                          {session.preferredTime && (\r\n                            <span className={`text-xs flex items-center gap-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                              <Clock size={12} /> {session.preferredTime}\r\n                            </span>\r\n                          )}\r\n                          {timeUntil && (\r\n                            <span className=\"text-xs flex items-center gap-1 text-green-500 font-bold\">\r\n                              <Timer size={12} /> in {timeUntil}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 shrink-0 flex-wrap\">\r\n                      <span className={`text-[11px] px-2.5 py-1 rounded-full font-bold capitalize border ${statusColor(session.status)}`}>\r\n                        {session.status}\r\n                      </span>\r\n\r\n                      {/* Accept / Reject buttons for pending */}\r\n                      {session.status === 'pending' && (\r\n                        <>\r\n                          <button\r\n                            onClick={() => { setActionId(session.id); setActionType('accept'); setResponseText(''); setMeetingLink(''); }}\r\n                            className=\"px-3 py-1.5 rounded-lg text-xs font-bold bg-green-500 text-white hover:bg-green-600 transition-all flex items-center gap-1 shadow-sm\"\r\n                          >\r\n                            <CheckCircle size={12} /> Accept\r\n                          </button>\r\n                          <button\r\n                            onClick={() => { setActionId(session.id); setActionType('reject'); setResponseText(''); }}\r\n                            className=\"px-3 py-1.5 rounded-lg text-xs font-bold bg-red-500 text-white hover:bg-red-600 transition-all flex items-center gap-1 shadow-sm\"\r\n                          >\r\n                            <XCircle size={12} /> Reject\r\n                          </button>\r\n                        </>\r\n                      )}\r\n\r\n                      {session.status !== 'pending' && session.studentId && onStartChat && (\r\n                        <button\r\n                          onClick={() => onStartChat({ id: session.studentId, name: session.studentProfile?.fullName || 'Student', avatarUrl: session.studentProfile?.avatarUrl, status: 'online' })}\r\n                          className={`p-2 rounded-lg transition-all ${dark ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}\r\n                          title=\"Chat\"\r\n                        >\r\n                          <MessageCircle size={16} />\r\n                        </button>\r\n                      )}\r\n                      {session.status === 'accepted' && session.studentId && onStartVideoCall && (\r\n                        <button\r\n                          onClick={() => onStartVideoCall(session.studentProfile?.fullName || 'Student', session.studentProfile?.avatarUrl, session.studentId)}\r\n                          className=\"p-2 rounded-lg transition-all bg-blue-500 text-white hover:bg-blue-600 shadow-sm\"\r\n                          title=\"Start Video Call\"\r\n                        >\r\n                          <Video size={16} />\r\n                        </button>\r\n                      )}\r\n                      {/* Complete / Cancel for accepted sessions */}\r\n                      {session.status === 'accepted' && (\r\n                        <>\r\n                          <button\r\n                            onClick={() => setConfirmAction({ id: session.id, type: 'complete' })}\r\n                            className=\"px-2.5 py-1.5 rounded-lg text-[11px] font-bold bg-green-500/10 text-green-500 hover:bg-green-500/20 transition-all flex items-center gap-1\"\r\n                            title=\"Mark Complete\"\r\n                          >\r\n                            <CheckCheck size={12} /> Done\r\n                          </button>\r\n                          <button\r\n                            onClick={() => setConfirmAction({ id: session.id, type: 'cancel' })}\r\n                            className={`p-1.5 rounded-lg transition-all ${dark ? 'hover:bg-red-500/20 text-red-400' : 'hover:bg-red-50 text-red-400'}`}\r\n                            title=\"Cancel Session\"\r\n                          >\r\n                            <Ban size={14} />\r\n                          </button>\r\n                        </>\r\n                      )}\r\n\r\n                      <button\r\n                        onClick={() => setExpandedId(isExpanded ? null : session.id)}\r\n                        className={`p-1.5 rounded-lg transition-all ${dark ? 'hover:bg-slate-700 text-slate-400' : 'hover:bg-slate-100 text-slate-400'}`}\r\n                      >\r\n                        {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Meeting Link for accepted sessions */}\r\n                  {session.status === 'accepted' && session.meetingLink && !isEditingLink && (\r\n                    <div className={`mt-3 flex items-center gap-2 px-4 py-2 rounded-xl ${dark ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-blue-50 border border-blue-200'}`}>\r\n                      <Link2 size={14} className=\"text-blue-500 shrink-0\" />\r\n                      <a href={session.meetingLink} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-blue-500 hover:underline truncate flex-1\">\r\n                        {session.meetingLink}\r\n                      </a>\r\n                      <button onClick={() => copyToClipboard(session.meetingLink)} className={`p-1 rounded ${dark ? 'hover:bg-slate-700' : 'hover:bg-blue-100'} transition-all`} title=\"Copy\">\r\n                        <Copy size={12} className=\"text-blue-400\" />\r\n                      </button>\r\n                      <button onClick={() => { setEditingLinkId(session.id); setEditLinkValue(session.meetingLink || ''); }} className={`p-1 rounded ${dark ? 'hover:bg-slate-700' : 'hover:bg-blue-100'} transition-all`} title=\"Edit\">\r\n                        <Edit3 size={12} className=\"text-blue-400\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                  {session.status === 'accepted' && !session.meetingLink && !isEditingLink && (\r\n                    <button\r\n                      onClick={() => { setEditingLinkId(session.id); setEditLinkValue(''); }}\r\n                      className={`mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all border border-dashed ${\r\n                        dark ? 'border-slate-600 text-slate-400 hover:border-blue-500 hover:text-blue-400' : 'border-slate-300 text-slate-500 hover:border-blue-400 hover:text-blue-500'\r\n                      }`}\r\n                    >\r\n                      <Link2 size={14} /> Add Meeting Link\r\n                    </button>\r\n                  )}\r\n                  {isEditingLink && (\r\n                    <div className=\"mt-3 flex items-center gap-2\">\r\n                      <div className=\"relative flex-1\">\r\n                        <Link2 size={14} className={`absolute left-3 top-1/2 -translate-y-1/2 ${dark ? 'text-slate-500' : 'text-slate-400'}`} />\r\n                        <input type=\"url\" value={editLinkValue} onChange={e => setEditLinkValue(e.target.value)} placeholder=\"https://meet.google.com/... or Zoom link\"\r\n                          className={`w-full pl-9 pr-3 py-2 rounded-xl text-sm border focus:outline-none focus:ring-2 focus:ring-blue-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'}`}\r\n                        />\r\n                      </div>\r\n                      <button onClick={handleSaveMeetingLink} disabled={savingLink} className=\"px-4 py-2 rounded-xl text-xs font-bold bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 flex items-center gap-1\">\r\n                        {savingLink ? <Loader2 size={12} className=\"animate-spin\" /> : <CheckCircle size={12} />} Save\r\n                      </button>\r\n                      <button onClick={() => setEditingLinkId(null)} className={`px-3 py-2 rounded-xl text-xs font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-500'}`}>Cancel</button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Accept Form */}\r\n                {isAcceptingThis && (\r\n                  <div className={`px-5 pb-5 border-t ${dark ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                    <div className=\"pt-4 space-y-3\">\r\n                      <h5 className={`text-sm font-bold flex items-center gap-2 ${dark ? 'text-green-400' : 'text-green-600'}`}>\r\n                        <CheckCircle size={14} /> Accept Session Request\r\n                      </h5>\r\n                      <div>\r\n                        <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-500'}`}>Response to student (optional)</label>\r\n                        <input type=\"text\" value={responseText} onChange={e => setResponseText(e.target.value)} placeholder=\"e.g. Looking forward to it!\"\r\n                          className={`w-full px-4 py-2 rounded-xl text-sm border focus:outline-none focus:ring-2 focus:ring-green-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'}`}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-500'}`}>Meeting Link (Google Meet / Zoom)</label>\r\n                        <div className=\"relative\">\r\n                          <Link2 size={14} className={`absolute left-3 top-1/2 -translate-y-1/2 ${dark ? 'text-slate-500' : 'text-slate-400'}`} />\r\n                          <input type=\"url\" value={meetingLink} onChange={e => setMeetingLink(e.target.value)} placeholder=\"https://meet.google.com/abc-defg-hij\"\r\n                            className={`w-full pl-9 pr-3 py-2 rounded-xl text-sm border focus:outline-none focus:ring-2 focus:ring-green-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'}`}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button onClick={handleAccept} disabled={submitting} className=\"flex-1 py-2.5 rounded-xl text-sm font-bold bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 flex items-center justify-center gap-2\">\r\n                          {submitting ? <Loader2 size={14} className=\"animate-spin\" /> : <Send size={14} />}\r\n                          {submitting ? 'Accepting...' : 'Accept & Send'}\r\n                        </button>\r\n                        <button onClick={() => { setActionId(null); setActionType(null); }} className={`px-5 py-2.5 rounded-xl text-sm font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>Cancel</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Reject Form */}\r\n                {isRejectingThis && (\r\n                  <div className={`px-5 pb-5 border-t ${dark ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                    <div className=\"pt-4 space-y-3\">\r\n                      <h5 className={`text-sm font-bold flex items-center gap-2 ${dark ? 'text-red-400' : 'text-red-600'}`}>\r\n                        <XCircle size={14} /> Reject Session Request\r\n                      </h5>\r\n                      <div>\r\n                        <label className={`text-xs font-bold mb-1 block ${dark ? 'text-slate-400' : 'text-slate-500'}`}>Reason (optional)</label>\r\n                        <input type=\"text\" value={responseText} onChange={e => setResponseText(e.target.value)} placeholder=\"e.g. Unavailable at this time\"\r\n                          className={`w-full px-4 py-2 rounded-xl text-sm border focus:outline-none focus:ring-2 focus:ring-red-500/40 ${dark ? 'bg-slate-700 border-slate-600 text-white placeholder:text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder:text-slate-400'}`}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <button onClick={handleReject} disabled={submitting} className=\"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-500 text-white hover:bg-red-600 disabled:opacity-50 flex items-center justify-center gap-2\">\r\n                          {submitting ? <Loader2 size={14} className=\"animate-spin\" /> : <XCircle size={14} />}\r\n                          {submitting ? 'Rejecting...' : 'Reject Request'}\r\n                        </button>\r\n                        <button onClick={() => { setActionId(null); setActionType(null); }} className={`px-5 py-2.5 rounded-xl text-sm font-bold ${dark ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>Cancel</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Expanded Details */}\r\n                {isExpanded && (\r\n                  <div className={`px-5 pb-5 border-t ${dark ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                    <div className=\"pt-4 space-y-3\">\r\n                      {session.studentMessage && (\r\n                        <div className={`px-4 py-2.5 rounded-xl text-sm ${dark ? 'bg-slate-700/50 text-slate-300' : 'bg-slate-50 text-slate-600'}`}>\r\n                          <span className={`text-xs font-bold block mb-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>Student's Message:</span>\r\n                          {session.studentMessage}\r\n                        </div>\r\n                      )}\r\n                      {session.mentorResponse && (\r\n                        <div className={`px-4 py-2.5 rounded-xl text-sm ${\r\n                          session.status === 'accepted'\r\n                            ? dark ? 'bg-green-500/5 text-green-300 border border-green-500/10' : 'bg-green-50 text-green-700 border border-green-200'\r\n                            : dark ? 'bg-red-500/5 text-red-300 border border-red-500/10' : 'bg-red-50 text-red-700 border border-red-200'\r\n                        }`}>\r\n                          <span className={`text-xs font-bold block mb-1 ${session.status === 'accepted' ? (dark ? 'text-green-500' : 'text-green-600') : (dark ? 'text-red-500' : 'text-red-600')}`}>Your Response:</span>\r\n                          {session.mentorResponse}\r\n                        </div>\r\n                      )}\r\n                      {review && (\r\n                        <div className={`px-4 py-2.5 rounded-xl border ${dark ? 'bg-amber-500/5 border-amber-500/10' : 'bg-amber-50/50 border-amber-200/50'}`}>\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <div className=\"flex\">\r\n                              {[1, 2, 3, 4, 5].map(i => (\r\n                                <Star key={i} size={14} className={i <= review.rating ? 'text-amber-500' : dark ? 'text-slate-600' : 'text-slate-300'} fill={i <= review.rating ? 'currentColor' : 'none'} />\r\n                              ))}\r\n                            </div>\r\n                            <span className={`text-xs font-bold ${dark ? 'text-amber-400' : 'text-amber-600'}`}>{review.rating}/5</span>\r\n                            <span className={`text-[10px] ${dark ? 'text-slate-500' : 'text-slate-400'}`}>by {review.studentName || 'Student'}</span>\r\n                          </div>\r\n                          {review.review_text && <p className={`text-xs ${dark ? 'text-slate-400' : 'text-slate-600'}`}>{review.review_text}</p>}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n      </div>\r\n\r\n      {/* All Reviews Section */}\r\n      {reviews.length > 0 && (\r\n        <div className={`rounded-2xl border p-6 shadow-sm ${dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n          <h3 className={`text-xl font-bold mb-4 flex items-center gap-2 ${dark ? 'text-white' : 'text-slate-900'}`}>\r\n            <Star size={20} className=\"text-amber-500\" fill=\"currentColor\" />\r\n            Student Reviews ({reviews.length})\r\n          </h3>\r\n          <div className=\"space-y-3\">\r\n            {reviews.map((review: any, idx: number) => (\r\n              <div key={review.id || idx} className={`flex items-start gap-3 p-3 rounded-xl ${dark ? 'bg-slate-700/50' : 'bg-slate-50'}`}>\r\n                <img\r\n                  src={review.studentAvatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(review.studentName || 'S')}&size=32`}\r\n                  alt=\"\"\r\n                  className=\"w-9 h-9 rounded-full object-cover shrink-0\"\r\n                />\r\n                <div className=\"min-w-0 flex-1\">\r\n                  <div className=\"flex items-center gap-2 mb-0.5\">\r\n                    <span className={`text-sm font-bold ${dark ? 'text-white' : 'text-slate-800'}`}>{review.studentName || 'Student'}</span>\r\n                    <div className=\"flex\">\r\n                      {[1, 2, 3, 4, 5].map(i => (\r\n                        <Star key={i} size={12} className={i <= review.rating ? 'text-amber-500' : dark ? 'text-slate-600' : 'text-slate-300'} fill={i <= review.rating ? 'currentColor' : 'none'} />\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  {review.review_text && <p className={`text-xs ${dark ? 'text-slate-400' : 'text-slate-600'}`}>{review.review_text}</p>}\r\n                  <p className={`text-[10px] mt-1 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>{new Date(review.created_at).toLocaleDateString()}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MentorStudentsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[664,667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[664,667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[728,731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[728,731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2339,2342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2339,2342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2984,2987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2984,2987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { Users, MessageCircle, Video, Search, Loader2, Calendar } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { fetchSessionRequests, fetchUnreadCounts } from '../utils/supabase-queries';\r\nimport { ChatBox } from './ChatBox';\r\n\r\ninterface MentorStudentsPageProps {\r\n  isDarkMode: boolean;\r\n  onStartVideoCall?: (name: string, avatar?: string, friendId?: string) => void;\r\n}\r\n\r\nexport const MentorStudentsPage: React.FC<MentorStudentsPageProps> = ({ isDarkMode, onStartVideoCall }) => {\r\n  const { user } = useAuth();\r\n  const [students, setStudents] = useState<any[]>([]);\r\n  const [selectedChat, setSelectedChat] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [unreadCounts, setUnreadCounts] = useState<Record<string, number>>({});\r\n  const dark = isDarkMode;\r\n\r\n  const loadStudents = useCallback(async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      const sessions = await fetchSessionRequests(user.id, 'mentor');\r\n      // Deduplicate students from sessions\r\n      const studentMap = new Map<string, any>();\r\n      for (const sess of sessions) {\r\n        if (sess.studentId && sess.studentProfile && !studentMap.has(sess.studentId)) {\r\n          studentMap.set(sess.studentId, {\r\n            id: sess.studentId,\r\n            name: sess.studentProfile.fullName || 'Student',\r\n            avatarUrl: sess.studentProfile.avatarUrl,\r\n            status: 'online',\r\n            role: 'student',\r\n            lastSession: sess.preferredDate || '',\r\n            sessionTopic: sess.topic || '',\r\n            sessionStatus: sess.status,\r\n          });\r\n        }\r\n      }\r\n      setStudents(Array.from(studentMap.values()));\r\n    } catch (err) {\r\n      console.error('Error loading students:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  const loadUnreadCounts = useCallback(async () => {\r\n    if (!user) return;\r\n    const counts = await fetchUnreadCounts(user.id);\r\n    setUnreadCounts(counts);\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadStudents();\r\n      loadUnreadCounts();\r\n    }\r\n  }, [user, loadStudents, loadUnreadCounts]);\r\n\r\n  const openChat = (student: any) => {\r\n    setUnreadCounts(prev => {\r\n      const next = { ...prev };\r\n      delete next[student.id];\r\n      return next;\r\n    });\r\n    setSelectedChat(student);\r\n  };\r\n\r\n  const filteredStudents = students.filter(s =>\r\n    s.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n    (s.sessionTopic && s.sessionTopic.toLowerCase().includes(searchQuery.toLowerCase()))\r\n  );\r\n\r\n  // If a chat is open, show ChatBox full screen\r\n  if (selectedChat) {\r\n    return (\r\n      <ChatBox\r\n        friend={selectedChat}\r\n        friends={students}\r\n        groups={[]}\r\n        onClose={() => setSelectedChat(null)}\r\n        onSelectFriend={(f: any) => openChat(f)}\r\n        onStartVideoCall={onStartVideoCall || (() => {})}\r\n        isDarkMode={isDarkMode}\r\n        unreadCounts={unreadCounts}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-20\">\r\n        <Loader2 className=\"w-10 h-10 text-amber-500 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-4 sm:px-6 lg:px-8\">\r\n      <div>\r\n        <h2 className={`text-3xl font-bold ${dark ? 'text-white' : 'text-slate-900'}`}>My Students</h2>\r\n        <p className={dark ? 'text-slate-400' : 'text-slate-600'}>Students you've connected with through sessions</p>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"relative\">\r\n        <Search className={`absolute left-3 top-1/2 -translate-y-1/2 ${dark ? 'text-slate-400' : 'text-slate-500'}`} size={18} />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search students...\"\r\n          value={searchQuery}\r\n          onChange={e => setSearchQuery(e.target.value)}\r\n          className={`w-full pl-10 pr-4 py-3 rounded-xl border transition-all ${dark ? 'bg-slate-800 border-slate-700 text-white placeholder:text-slate-500 focus:border-amber-500' : 'bg-white border-slate-200 text-slate-900 placeholder:text-slate-400 focus:border-amber-500'}`}\r\n        />\r\n      </div>\r\n\r\n      {/* Student List */}\r\n      {filteredStudents.length === 0 ? (\r\n        <div className={`text-center py-16 rounded-2xl border ${dark ? 'bg-slate-800/50 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n          <Users className={`mx-auto mb-3 ${dark ? 'text-slate-600' : 'text-slate-300'}`} size={48} />\r\n          <p className={dark ? 'text-slate-400' : 'text-slate-600'}>\r\n            {searchQuery ? 'No students match your search' : 'No students yet. Accept session requests to connect with students.'}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {filteredStudents.map(student => {\r\n            const unread = unreadCounts[student.id] || 0;\r\n            return (\r\n              <button\r\n                key={student.id}\r\n                onClick={() => openChat(student)}\r\n                className={`w-full flex items-center gap-4 p-4 rounded-2xl border transition-all text-left group ${\r\n                  unread > 0\r\n                    ? (dark\r\n                      ? 'bg-gradient-to-r from-purple-500/15 via-blue-500/10 to-transparent border-purple-500/30 shadow-sm shadow-purple-500/10'\r\n                      : 'bg-gradient-to-r from-purple-50 via-blue-50 to-transparent border-purple-300 shadow-sm')\r\n                    : dark\r\n                      ? 'bg-slate-800 border-slate-700 hover:border-amber-500/40 hover:bg-slate-750'\r\n                      : 'bg-white border-slate-200 hover:border-amber-500/40 hover:shadow-md'\r\n                }`}\r\n              >\r\n                <div className=\"relative shrink-0\">\r\n                  <img\r\n                    src={student.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(student.name)}&background=random`}\r\n                    alt={student.name}\r\n                    className=\"w-12 h-12 rounded-full object-cover border-2 border-amber-500/20\"\r\n                  />\r\n                  {unread > 0 && (\r\n                    <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center px-1 rounded-full text-[10px] font-bold bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-sm shadow-purple-500/30\">\r\n                      {unread > 99 ? '99+' : unread}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <h4 className={`font-bold truncate ${dark ? 'text-white' : 'text-slate-900'}`}>{student.name}</h4>\r\n                    <span className={`text-[11px] px-2 py-0.5 rounded-full capitalize ${\r\n                      student.sessionStatus === 'accepted' ? 'bg-green-500/10 text-green-500' :\r\n                      student.sessionStatus === 'completed' ? 'bg-blue-500/10 text-blue-500' :\r\n                      student.sessionStatus === 'pending' ? 'bg-amber-500/10 text-amber-500' :\r\n                      'bg-slate-500/10 text-slate-500'\r\n                    }`}>\r\n                      {student.sessionStatus}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3 mt-1\">\r\n                    {student.sessionTopic && (\r\n                      <p className={`text-sm truncate ${dark ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                        {student.sessionTopic}\r\n                      </p>\r\n                    )}\r\n                    {student.lastSession && (\r\n                      <span className={`text-[11px] flex items-center gap-1 shrink-0 ${dark ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                        <Calendar size={11} /> {student.lastSession}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                  <span className={`p-2 rounded-lg ${dark ? 'bg-slate-700 text-blue-400' : 'bg-blue-50 text-blue-600'}`}>\r\n                    <MessageCircle size={16} />\r\n                  </span>\r\n                  {onStartVideoCall && (\r\n                    <span\r\n                      onClick={e => { e.stopPropagation(); onStartVideoCall(student.name, student.avatarUrl, student.id); }}\r\n                      className={`p-2 rounded-lg cursor-pointer ${dark ? 'bg-slate-700 text-green-400' : 'bg-green-50 text-green-600'}`}\r\n                    >\r\n                      <Video size={16} />\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\MyProfile.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProfile'. Either include it or remove the dependency array.","line":46,"column":6,"nodeType":"ArrayExpression","endLine":46,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadProfile, user]","fix":{"range":[1166,1172],"text":"[loadProfile, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { User, Mail, Phone, GraduationCap, Briefcase, Calendar, Hash, Settings as SettingsIcon } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ninterface UserProfile {\r\n  full_name: string;\r\n  avatar_url: string;\r\n  role: 'student' | 'mentor';\r\n  phone_number: string;\r\n  gender?: 'male' | 'female' | 'other';\r\n  profession?: string;\r\n  experience?: string;\r\n  class?: string;\r\n  course?: string;\r\n  age?: number;\r\n  username?: string;\r\n}\r\n\r\ninterface MyProfileProps {\r\n  isDarkMode: boolean;\r\n  onEditClick: () => void;\r\n}\r\n\r\nexport function MyProfile({ isDarkMode, onEditClick }: MyProfileProps) {\r\n  const { user } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  const [profile, setProfile] = useState<UserProfile>({\r\n    full_name: '',\r\n    avatar_url: '',\r\n    role: 'student',\r\n    phone_number: '',\r\n    gender: undefined,\r\n    profession: '',\r\n    experience: '',\r\n    class: '',\r\n    course: '',\r\n    age: undefined,\r\n    username: '',\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadProfile();\r\n    }\r\n  }, [user]);\r\n\r\n  const loadProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .select('*')\r\n        .eq('user_id', user?.id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      if (data) {\r\n        setProfile({\r\n          full_name: data.full_name || '',\r\n          avatar_url: data.avatar_url || '',\r\n          role: data.role || 'student',\r\n          phone_number: data.phone_number || '',\r\n          gender: data.gender || undefined,\r\n          profession: data.profession || '',\r\n          experience: data.experience || '',\r\n          class: data.class || '',\r\n          course: data.course || '',\r\n          age: data.age || undefined,\r\n          username: data.username || '',\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading profile:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className={`flex items-center justify-center h-64 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header with Edit Button */}\r\n      <div className={`relative overflow-hidden rounded-2xl border ${\r\n        isDarkMode \r\n          ? 'bg-gradient-to-br from-slate-800 via-slate-800 to-slate-900 border-slate-700' \r\n          : 'bg-gradient-to-br from-white via-amber-50/30 to-white border-slate-200'\r\n      }`}>\r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl -translate-y-32 translate-x-32\"></div>\r\n        <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-amber-500/5 rounded-full blur-3xl translate-y-24 -translate-x-24\"></div>\r\n        \r\n        <div className=\"relative p-8\">\r\n          <div className=\"flex items-start justify-between mb-4\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className={`p-3 rounded-xl ${\r\n                isDarkMode ? 'bg-amber-500/10' : 'bg-amber-500/10'\r\n              }`}>\r\n                <User size={32} className=\"text-amber-500\" />\r\n              </div>\r\n              <div>\r\n                <h2 className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  My Profile\r\n                </h2>\r\n                <p className={`text-sm mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  View your account information\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onEditClick}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg font-medium hover:from-amber-600 hover:to-orange-700 transition-all shadow-md\"\r\n            >\r\n              <SettingsIcon size={18} />\r\n              Edit Profile\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Profile Picture Section */}\r\n      <div className={`rounded-2xl border p-8 ${\r\n        isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n      }`}>\r\n        <div className=\"flex flex-col items-center\">\r\n          <div className={`w-48 h-48 rounded-full overflow-hidden ${\r\n            isDarkMode ? 'bg-slate-700' : 'bg-slate-200'\r\n          } flex items-center justify-center border-4 ${\r\n            isDarkMode ? 'border-slate-600' : 'border-slate-300'\r\n          } shadow-xl`}>\r\n            {profile.avatar_url ? (\r\n              <img\r\n                src={profile.avatar_url}\r\n                alt=\"Profile\"\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            ) : (\r\n              <User size={80} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n            )}\r\n          </div>\r\n          <h3 className={`text-2xl font-bold mt-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            {profile.full_name || 'No name set'}\r\n          </h3>\r\n          {profile.username && (\r\n            <p className={`text-sm mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n              @{profile.username}\r\n            </p>\r\n          )}\r\n          <div className={`flex items-center gap-2 mt-3 px-4 py-2 rounded-full ${\r\n            isDarkMode ? 'bg-slate-700' : 'bg-slate-100'\r\n          }`}>\r\n            {profile.role === 'student' ? (\r\n              <>\r\n                <GraduationCap size={18} className=\"text-amber-500\" />\r\n                <span className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>Student</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Briefcase size={18} className=\"text-amber-500\" />\r\n                <span className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>Mentor</span>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Personal Information */}\r\n      <div className={`rounded-2xl border p-6 ${\r\n        isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n      }`}>\r\n        <h3 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n          Personal Information\r\n        </h3>\r\n        \r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <Mail size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n            <div className=\"flex-1\">\r\n              <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                Email\r\n              </p>\r\n              <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                {user?.email || 'Not set'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-start gap-3\">\r\n            <Phone size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n            <div className=\"flex-1\">\r\n              <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                Phone Number\r\n              </p>\r\n              <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                {profile.phone_number || 'Not set'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-start gap-3\">\r\n            <User size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n            <div className=\"flex-1\">\r\n              <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                Gender\r\n              </p>\r\n              <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                {profile.gender ? profile.gender.charAt(0).toUpperCase() + profile.gender.slice(1) : 'Not set'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {profile.username && (\r\n            <div className=\"flex items-start gap-3\">\r\n              <Hash size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Username\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  @{profile.username}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Role-specific Information */}\r\n      {profile.role === 'mentor' ? (\r\n        <div className={`rounded-2xl border p-6 ${\r\n          isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n        }`}>\r\n          <h3 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Professional Details\r\n          </h3>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <Briefcase size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Profession\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {profile.profession || 'Not set'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-start gap-3\">\r\n              <Calendar size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Years of Experience\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {profile.experience || 'Not set'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className={`rounded-2xl border p-6 ${\r\n          isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n        }`}>\r\n          <h3 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Academic Details\r\n          </h3>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <GraduationCap size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Class\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {profile.class || 'Not set'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-start gap-3\">\r\n              <GraduationCap size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Course\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {profile.course || 'Not set'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-start gap-3\">\r\n              <Calendar size={20} className=\"text-amber-500 mt-1 flex-shrink-0\" />\r\n              <div className=\"flex-1\">\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Age\r\n                </p>\r\n                <p className={`text-base mt-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  {profile.age ? `${profile.age} years` : 'Not set'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\NotificationCenter.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[617,620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[617,620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[864,867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[864,867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1017,1020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1017,1020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1085,1088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1085,1088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadData' and 'refreshNotifications'. Either include them or remove the dependency array.","line":56,"column":8,"nodeType":"ArrayExpression","endLine":56,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, refreshNotifications, user]","fix":{"range":[2611,2617],"text":"[loadData, refreshNotifications, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'refreshNotifications'. Either include it or remove the dependency array.","line":63,"column":8,"nodeType":"ArrayExpression","endLine":63,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [refreshNotifications, user]","fix":{"range":[2941,2947],"text":"[refreshNotifications, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6101,6104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6101,6104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { Bell, Check, X, Loader2, Inbox, MessageSquare, Phone, UserPlus, Users, Calendar, Star, CheckCircle, XCircle, Ban } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { fetchPendingFriendRequests, updateFriendRequestStatus, fetchNotifications, subscribeToNotifications, submitMentorReview } from '../utils/supabase-queries';\r\nimport { ReviewPopup } from './ReviewPopup';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ninterface NotificationCenterProps {\r\n    isDarkMode: boolean;\r\n    onNotificationClick?: (notification: any) => void;\r\n}\r\n\r\nexport function NotificationCenter({ isDarkMode, onNotificationClick }: NotificationCenterProps) {\r\n    const [showReviewPopup, setShowReviewPopup] = useState(false);\r\n    const [reviewPopupData, setReviewPopupData] = useState<any>(null);\r\n    const { user } = useAuth();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [friendRequests, setFriendRequests] = useState<any[]>([]);\r\n    const [notifications, setNotifications] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [processingId, setProcessingId] = useState<string | null>(null);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        console.log('[NotificationCenter] Mounted/User Changed. User:', user?.id);\r\n        if (user) {\r\n            loadData();\r\n\r\n            // Subscribe to new notifications\r\n            const sub = subscribeToNotifications(user.id, (newNotif) => {\r\n                console.log('[NotificationCenter] Realtime update received:', newNotif);\r\n\r\n                // Optimistically add to list (msg content/type is enough for badge)\r\n                setNotifications(prev => {\r\n                    if (prev.find(n => n.id === newNotif.id)) return prev;\r\n                    const notifWithDefaults = { ...newNotif, is_read: false };\r\n                    return [notifWithDefaults, ...prev];\r\n                });\r\n\r\n                // Auto-open the notification panel when a new notification arrives\r\n                setIsOpen(true);\r\n\r\n                // Fetch full details in background to get sender profiles\r\n                refreshNotifications();\r\n            });\r\n\r\n            // Refresh every 60 seconds as fallback\r\n            const interval = setInterval(loadData, 60000);\r\n\r\n            return () => {\r\n                console.log('[NotificationCenter] Unsubscribing/Cleaning up');\r\n                sub.unsubscribe();\r\n                clearInterval(interval);\r\n            };\r\n        }\r\n    }, [user]);\r\n\r\n    // Listen for notifications-read events from other components (e.g. ChatBox)\r\n    useEffect(() => {\r\n        const handler = () => { refreshNotifications(); };\r\n        window.addEventListener('notifications-read', handler);\r\n        return () => window.removeEventListener('notifications-read', handler);\r\n    }, [user]);\r\n\r\n    const toggleNotifications = () => {\r\n        console.log('[NotificationCenter] Toggling notifications. Current state:', isOpen);\r\n        setIsOpen(!isOpen);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n\r\n        const [requests, notifs] = await Promise.all([\r\n            fetchPendingFriendRequests(user.id),\r\n            fetchNotifications(user.id)\r\n        ]);\r\n\r\n        setFriendRequests(requests);\r\n        setNotifications(notifs);\r\n        setLoading(false);\r\n    };\r\n\r\n    const refreshNotifications = async () => {\r\n        if (!user) return;\r\n        const notifs = await fetchNotifications(user.id);\r\n        setNotifications(notifs);\r\n    };\r\n\r\n    const handleAction = async (requestId: string, status: 'accepted' | 'rejected') => {\r\n        setProcessingId(requestId);\r\n        const { error } = await updateFriendRequestStatus(requestId, status);\r\n        if (!error) {\r\n            setFriendRequests(prev => prev.filter(req => req.id !== requestId));\r\n        }\r\n        setProcessingId(null);\r\n    };\r\n\r\n    const markAsRead = async (notificationId: string) => {\r\n        const { error } = await supabase\r\n            .from('notifications')\r\n            .update({ is_read: true })\r\n            .eq('id', notificationId);\r\n\r\n        if (!error) {\r\n            setNotifications(prev => prev.filter(n => n.id !== notificationId));\r\n            window.dispatchEvent(new CustomEvent('notifications-read'));\r\n        }\r\n    };\r\n\r\n    const markAllAsRead = async () => {\r\n        if (!user) return;\r\n        const unreadIds = notifications.filter(n => !n.is_read).map(n => n.id);\r\n        if (unreadIds.length === 0) return;\r\n        const { error } = await supabase\r\n            .from('notifications')\r\n            .update({ is_read: true })\r\n            .eq('user_id', user.id)\r\n            .eq('is_read', false);\r\n        if (!error) {\r\n            setNotifications([]);\r\n            window.dispatchEvent(new CustomEvent('notifications-read'));\r\n        }\r\n    };\r\n\r\n    const unreadNotifications = (notifications || []).filter(n => !n.is_read);\r\n    const totalCount = (friendRequests || []).length + unreadNotifications.length;\r\n    // Show only unread notifications excluding call_ended\r\n    const displayNotifications = (notifications || []).filter(n => !n.is_read && n.type !== 'call_ended').slice(0, 20);\r\n\r\n    console.log('[DEBUG-NOTIF] [NotificationCenter] Rendering:', {\r\n        totalCount,\r\n        friendRequestsCount: (friendRequests || []).length,\r\n        unreadNotificationsCount: unreadNotifications.length,\r\n        isOpen,\r\n        hasUser: !!user\r\n    });\r\n\r\n    // Handler for notification click\r\n    const handleNotificationClick = (notif: any) => {\r\n        console.log('[NotificationCenter] Notification clicked:', notif);\r\n        // If it's a session_completed notification and requires review, show popup\r\n        if (notif.type === 'session_completed' && notif.metadata?.requiresReview) {\r\n            console.log('[NotificationCenter] Detected session_completed notification with requiresReview:', notif);\r\n            setReviewPopupData({\r\n                mentorId: notif.metadata.mentorId,\r\n                sessionId: notif.metadata.sessionId,\r\n                topic: notif.metadata.topic,\r\n                mentorName: notif.senderName,\r\n                notificationId: notif.id\r\n            });\r\n            setShowReviewPopup(true);\r\n        } else {\r\n            if (onNotificationClick) onNotificationClick(notif);\r\n        }\r\n    };\r\n\r\n    const handleSubmitReview = async (rating: number, review: string) => {\r\n        if (!reviewPopupData || !user) {\r\n            console.warn('[NotificationCenter] Review popup data or user missing:', { reviewPopupData, user });\r\n            return;\r\n        }\r\n        console.log('[NotificationCenter] Submitting review:', {\r\n            mentorId: reviewPopupData.mentorId,\r\n            studentId: user.id,\r\n            sessionId: reviewPopupData.sessionId,\r\n            rating,\r\n            review\r\n        });\r\n        await submitMentorReview(\r\n            reviewPopupData.mentorId,\r\n            user.id,\r\n            reviewPopupData.sessionId,\r\n            rating,\r\n            review\r\n        );\r\n        // Mark notification as read\r\n        await markAsRead(reviewPopupData.notificationId);\r\n        setShowReviewPopup(false);\r\n        setReviewPopupData(null);\r\n        // Optionally, refresh notifications\r\n        refreshNotifications();\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative\" ref={dropdownRef}>\r\n            {/* Review Popup (rendered once, outside loops) */}\r\n            <ReviewPopup\r\n                isOpen={showReviewPopup}\r\n                onClose={() => { setShowReviewPopup(false); setReviewPopupData(null); }}\r\n                onSubmit={handleSubmitReview}\r\n                mentorName={reviewPopupData?.mentorName}\r\n            />\r\n            <button\r\n                onClick={toggleNotifications}\r\n                className={`p-2 rounded-lg transition-all ${isDarkMode\r\n                    ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\r\n                    }`}\r\n                title=\"Notifications\"\r\n            >\r\n                <Bell size={20} className={totalCount > 0 ? 'animate-wiggle' : ''} />\r\n                {totalCount > 0 && (\r\n                    <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center px-1 rounded-full bg-amber-500 text-white text-[10px] font-bold leading-none shadow-lg\">\r\n                        {totalCount > 99 ? '99+' : totalCount}\r\n                    </span>\r\n                )}\r\n            </button>\r\n\r\n            {isOpen && (\r\n                <div className={`absolute right-0 mt-2 w-80 rounded-2xl shadow-2xl border overflow-hidden z-[100] animate-fade-in ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'\r\n                    }`}>\r\n                    <div className=\"p-4 border-b border-slate-800/50 bg-gradient-to-r from-amber-500/10 to-transparent flex justify-between items-center\">\r\n                        <h3 className={`font-bold flex items-center gap-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            <Inbox size={18} className=\"text-amber-500\" />\r\n                            Notifications\r\n                        </h3>\r\n                    </div>\r\n\r\n                    <div className=\"max-h-96 overflow-y-auto scrollbar-hide\">\r\n                        {loading && friendRequests.length === 0 && notifications.length === 0 ? (\r\n                            <div className=\"p-8 text-center\">\r\n                                <Loader2 className=\"w-8 h-8 text-amber-500 animate-spin mx-auto mb-2\" />\r\n                                <p className=\"text-sm text-slate-500\">Loading...</p>\r\n                            </div>\r\n                        ) : (friendRequests.length > 0 || displayNotifications.length > 0) ? (\r\n                            <div className=\"divide-y divide-slate-800/30\">\r\n                                {/* Friend Requests */}\r\n                                {friendRequests.map(req => (\r\n                                    <div key={req.id} className=\"p-4 hover:bg-slate-800/30 transition-all\">\r\n                                        <div className=\"flex items-start gap-3\">\r\n                                            <div className=\"relative\">\r\n                                                <img\r\n                                                    src={req.avatarUrl}\r\n                                                    alt=\"\"\r\n                                                    className=\"w-10 h-10 rounded-full object-cover\"\r\n                                                />\r\n                                                <div className=\"absolute -bottom-1 -right-1 bg-blue-500 rounded-full p-0.5 border-2 border-slate-900\">\r\n                                                    <UserPlus size={8} className=\"text-white\" />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className={`text-sm font-bold truncate ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                                    {req.name}\r\n                                                </p>\r\n                                                <p className=\"text-xs text-slate-500 truncate mb-3\">\r\n                                                    wants to be your friend\r\n                                                </p>\r\n                                                <div className=\"flex gap-2\">\r\n                                                    <button\r\n                                                        onClick={() => handleAction(req.id, 'accepted')}\r\n                                                        disabled={processingId === req.id}\r\n                                                        className=\"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 bg-amber-500 text-white rounded-lg text-xs font-bold hover:bg-amber-600 transition-all disabled:opacity-50\"\r\n                                                    >\r\n                                                        {processingId === req.id ? <Loader2 size={14} className=\"animate-spin\" /> : <Check size={14} />}\r\n                                                        Accept\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleAction(req.id, 'rejected')}\r\n                                                        disabled={processingId === req.id}\r\n                                                        className={`flex-1 flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg text-xs font-bold transition-all disabled:opacity-50 ${isDarkMode ? 'bg-slate-800 text-slate-300 hover:bg-slate-700' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'\r\n                                                            }`}\r\n                                                    >\r\n                                                        <X size={14} />\r\n                                                        Ignore\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n\r\n                                {/* Incoming Call Notifications (unread only) */}\r\n                                {displayNotifications.filter(n => !n.is_read && n.type === 'call').map(notif => (\r\n                                    <div\r\n                                        key={notif.id}\r\n                                        className={`p-4 border-l-4 border-green-500 bg-green-500/5 hover:bg-green-500/10 transition-all`}\r\n                                    >\r\n                                        <div className=\"flex items-start gap-3\">\r\n                                            <div className=\"relative\">\r\n                                                <img\r\n                                                    src={notif.senderAvatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'}\r\n                                                    alt=\"\"\r\n                                                    className=\"w-12 h-12 rounded-full object-cover border-2 border-green-500\"\r\n                                                />\r\n                                                <div className=\"absolute -bottom-1 -right-1 bg-green-500 p-1 rounded-full border-2 border-slate-900 animate-pulse\">\r\n                                                    <Phone size={12} className=\"text-white\" />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className={`font-bold truncate mb-1 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                                    {notif.senderName}\r\n                                                </p>\r\n                                                <p className=\"text-green-500 text-sm font-medium mb-3 flex items-center gap-1 animate-pulse\">\r\n                                                    <Phone size={14} />\r\n                                                    Incoming call...\r\n                                                </p>\r\n                                                <div className=\"flex gap-2\">\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            markAsRead(notif.id);\r\n                                                            if (onNotificationClick) onNotificationClick(notif);\r\n                                                            setIsOpen(false);\r\n                                                        }}\r\n                                                        className=\"flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-green-500 text-white rounded-lg text-xs font-bold hover:bg-green-600 transition-all\"\r\n                                                    >\r\n                                                        <Phone size={14} />\r\n                                                        Answer\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => markAsRead(notif.id)}\r\n                                                        className={`flex-1 flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-xs font-bold transition-all ${isDarkMode ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-red-100 text-red-600 hover:bg-red-200'\r\n                                                            }`}\r\n                                                    >\r\n                                                        <X size={14} />\r\n                                                        Decline\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n\r\n                                {/* All Notifications (excluding active calls) */}\r\n                                {displayNotifications.filter(n => n.type !== 'call').map(notif => (\r\n                                    <div\r\n                                        key={notif.id}\r\n                                        className={`p-4 transition-all cursor-pointer ${!notif.is_read\r\n                                            ? (isDarkMode ? 'bg-amber-500/10 hover:bg-amber-500/15' : 'bg-amber-50 hover:bg-amber-100/80')\r\n                                            : (isDarkMode ? 'hover:bg-slate-800/30 opacity-70' : 'hover:bg-slate-50 opacity-70')}`}\r\n                                        onClick={() => {\r\n                                            if (!notif.is_read) markAsRead(notif.id);\r\n                                            handleNotificationClick(notif);\r\n                                            setIsOpen(false);\r\n                                        }}\r\n                                    >\r\n                                        <div className=\"flex items-start gap-3\">\r\n                                            <div className=\"relative\">\r\n                                                <img\r\n                                                    src={notif.senderAvatar}\r\n                                                    alt=\"\"\r\n                                                    className=\"w-10 h-10 rounded-full object-cover\"\r\n                                                />\r\n                                                <div className={`absolute -bottom-1 -right-1 rounded-full p-0.5 border-2 border-slate-900 ${\r\n                                                    notif.type === 'message' ? 'bg-green-500' :\r\n                                                    notif.type === 'group_added' ? 'bg-purple-500' :\r\n                                                    notif.type === 'session_accepted' ? 'bg-green-500' :\r\n                                                    notif.type === 'session_rejected' ? 'bg-red-500' :\r\n                                                    notif.type === 'session_completed' ? 'bg-blue-500' :\r\n                                                    notif.type === 'session_cancelled' ? 'bg-slate-500' :\r\n                                                    notif.type === 'session_request' ? 'bg-amber-500' :\r\n                                                    notif.type === 'new_review' ? 'bg-yellow-500' :\r\n                                                    'bg-amber-500'\r\n                                                    }`}>\r\n                                                    {notif.type === 'message' ? (\r\n                                                        <MessageSquare size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'group_added' ? (\r\n                                                        <Users size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'session_accepted' ? (\r\n                                                        <CheckCircle size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'session_rejected' ? (\r\n                                                        <XCircle size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'session_completed' ? (\r\n                                                        <Check size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'session_cancelled' ? (\r\n                                                        <Ban size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'session_request' ? (\r\n                                                        <Calendar size={8} className=\"text-white\" />\r\n                                                    ) : notif.type === 'new_review' ? (\r\n                                                        <Star size={8} className=\"text-white\" />\r\n                                                    ) : (\r\n                                                        <Phone size={8} className=\"text-white\" />\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"flex justify-between items-start gap-2\">\r\n                                                    <p className={`text-sm font-bold truncate ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                                                        {notif.senderName}\r\n                                                    </p>\r\n                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                        {!notif.is_read && (\r\n                                                            <span className=\"w-2 h-2 rounded-full bg-amber-500 flex-shrink-0\"></span>\r\n                                                        )}\r\n                                                        <span className=\"text-[10px] text-slate-500 whitespace-nowrap\">\r\n                                                            {new Date(notif.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <p className={`text-xs mt-1 line-clamp-2 ${!notif.is_read ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-slate-500'}`}>\r\n                                                    {notif.type === 'group_added' && notif.metadata ? (\r\n                                                        <>\r\n                                                            Added you to <span className=\"font-bold text-amber-500\">{notif.metadata.groupName}</span>\r\n                                                        </>\r\n                                                    ) : notif.type === 'message' ? (\r\n                                                        <span className=\"flex items-center gap-1\">\r\n                                                            <MessageSquare size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'Sent you a message'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'session_accepted' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-green-500\">\r\n                                                            <CheckCircle size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'Session accepted!'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'session_rejected' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-red-400\">\r\n                                                            <XCircle size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'Session declined'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'session_completed' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-blue-400\">\r\n                                                            <Check size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'Session completed'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'session_cancelled' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-slate-400\">\r\n                                                            <Ban size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'Session cancelled'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'session_request' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-amber-400\">\r\n                                                            <Calendar size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'New session request'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'new_review' ? (\r\n                                                        <span className=\"flex items-center gap-1 text-yellow-400\">\r\n                                                            <Star size={10} className=\"flex-shrink-0\" />\r\n                                                            {notif.content || 'You received a new review!'}\r\n                                                        </span>\r\n                                                    ) : notif.type === 'friend_request' ? (\r\n                                                        'Wants to be your friend'\r\n                                                    ) : (notif.metadata?.message || notif.content || 'New notification')}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-8 text-center\">\r\n                                <div className=\"w-12 h-12 bg-slate-800/50 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <Bell className=\"text-slate-600\" size={24} />\r\n                                </div>\r\n                                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                                    No new notifications\r\n                                </p>\r\n                                <p className=\"text-xs text-slate-500 mt-1\">\r\n                                    You're all caught up!\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {totalCount > 0 && (\r\n                        <div className=\"p-3 bg-slate-800/30 text-center border-t border-slate-800/50\">\r\n                            <button onClick={markAllAsRead} className=\"text-xs font-bold text-amber-500 hover:text-amber-400 transition-all\">\r\n                                Mark all as read\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\Reminder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ReportModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ReviewPopup.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":35,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\n\r\ninterface ReviewPopupProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSubmit: (rating: number, review: string) => Promise<void>;\r\n  mentorName?: string;\r\n}\r\n\r\nexport const ReviewPopup: React.FC<ReviewPopupProps> = ({ isOpen, onClose, onSubmit, mentorName }) => {\r\n  const [rating, setRating] = useState(0);\r\n  const [review, setReview] = useState('');\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleStarClick = (star: number) => {\r\n    setRating(star);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (rating === 0) {\r\n      setError('Please select a rating.');\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    setError('');\r\n    try {\r\n      await onSubmit(rating, review);\r\n      setReview('');\r\n      setRating(0);\r\n      onClose();\r\n    } catch (err) {\r\n      setError('Failed to submit review.');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40\">\r\n      <div className=\"bg-white rounded-xl shadow-xl p-6 w-full max-w-md\">\r\n        <h2 className=\"text-xl font-bold mb-2\">Rate your Mentor</h2>\r\n        {mentorName && <p className=\"mb-2 text-slate-600\">{mentorName}</p>}\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"flex items-center gap-1 mb-4\">\r\n            {[1,2,3,4,5].map(star => (\r\n              <button\r\n                key={star}\r\n                type=\"button\"\r\n                className={star <= rating ? 'text-amber-500' : 'text-slate-300'}\r\n                onClick={() => handleStarClick(star)}\r\n                aria-label={`Rate ${star} star${star > 1 ? 's' : ''}`}\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 20 20\" width={28} height={28}>\r\n                  <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.175c.969 0 1.371 1.24.588 1.81l-3.38 2.455a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.38-2.454a1 1 0 00-1.175 0l-3.38 2.454c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118L2.05 9.394c-.783-.57-.38-1.81.588-1.81h4.175a1 1 0 00.95-.69l1.286-3.967z\" />\r\n                </svg>\r\n              </button>\r\n            ))}\r\n          </div>\r\n          <textarea\r\n            className=\"w-full border rounded-lg p-2 mb-3 text-slate-700\"\r\n            rows={3}\r\n            placeholder=\"Write a review (optional)\"\r\n            value={review}\r\n            onChange={e => setReview(e.target.value)}\r\n            disabled={submitting}\r\n          />\r\n          {error && <p className=\"text-red-500 text-sm mb-2\">{error}</p>}\r\n          <div className=\"flex justify-end gap-2\">\r\n            <button type=\"button\" className=\"px-4 py-2 rounded-lg bg-slate-200 text-slate-700\" onClick={onClose} disabled={submitting}>Cancel</button>\r\n            <button type=\"submit\" className=\"px-4 py-2 rounded-lg bg-amber-500 text-white font-bold hover:bg-amber-600\" disabled={submitting}>\r\n              {submitting ? 'Submitting...' : 'Submit'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\SessionHistory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\SessionReminders.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[507,510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[507,510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserRole'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserRole, user]","fix":{"range":[1932,1938],"text":"[loadUserRole, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUpcomingSessions'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [loadUpcomingSessions, user, userRole]","fix":{"range":[2199,2215],"text":"[loadUpcomingSessions, user, userRole]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { Clock, Video, MessageCircle, Calendar, X, AlertCircle } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { fetchUpcomingSessions, isSessionSoon, getUserProfile, isSessionIn30Minutes, isSessionIn10Minutes, sendSessionReminderNotification, isSessionWithin30Minutes, getTimeUntilSession } from '../utils/supabase-queries';\r\n\r\ninterface SessionRemindersProps {\r\n  isDarkMode: boolean;\r\n  onStartChat?: (participant: any) => void;\r\n  onStartVideoCall?: (name: string, avatar: string, userId: string) => void;\r\n}\r\n\r\ninterface UpcomingSession {\r\n  id: string;\r\n  mentorId: string;\r\n  studentId: string;\r\n  topic: string;\r\n  preferredDate: string;\r\n  preferredTime: string;\r\n  mode: 'chat' | 'call' | 'video';\r\n  studentProfile?: {\r\n    fullName: string;\r\n    avatarUrl: string;\r\n    username: string;\r\n  };\r\n  mentorProfile?: {\r\n    fullName: string;\r\n    avatarUrl: string;\r\n    username: string;\r\n  };\r\n}\r\n\r\nexport function SessionReminders({ isDarkMode, onStartChat, onStartVideoCall }: SessionRemindersProps) {\r\n  const { user } = useAuth();\r\n  const [upcomingSessions, setUpcomingSessions] = useState<UpcomingSession[]>([]);\r\n  const [userRole, setUserRole] = useState<'student' | 'mentor'>('student');\r\n  const [dismissedSessions, setDismissedSessions] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Track sessions that already had reminders sent (separate for 30 and 10 minute)\r\n  const sent30MinReminders = useRef<Set<string>>(new Set());\r\n  const sent10MinReminders = useRef<Set<string>>(new Set());\r\n  \r\n  // Show popup for sessions within 30 minutes on page load\r\n  const [upcomingSessionPopup, setUpcomingSessionPopup] = useState<UpcomingSession | null>(null);\r\n  const hasShownPopup = useRef<Set<string>>(new Set());\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadUserRole();\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    if (user && userRole) {\r\n      loadUpcomingSessions();\r\n      // Check every minute for upcoming sessions\r\n      const interval = setInterval(loadUpcomingSessions, 60000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [user, userRole]);\r\n  \r\n  // Check for reminder notifications (30-minute and 10-minute) and show popup\r\n  useEffect(() => {\r\n    const checkAndSendReminders = async () => {\r\n      for (const session of upcomingSessions) {\r\n        // 30-minute reminder\r\n        if (\r\n          isSessionIn30Minutes(session.preferredDate, session.preferredTime) &&\r\n          !sent30MinReminders.current.has(session.id)\r\n        ) {\r\n          sent30MinReminders.current.add(session.id);\r\n          await sendSessionReminderNotification(\r\n            session.id,\r\n            session.mentorId,\r\n            session.studentId,\r\n            session.topic,\r\n            30\r\n          );\r\n          console.log(`30-minute reminder sent for session: ${session.topic}`);\r\n        }\r\n        \r\n        // 10-minute reminder\r\n        if (\r\n          isSessionIn10Minutes(session.preferredDate, session.preferredTime) &&\r\n          !sent10MinReminders.current.has(session.id)\r\n        ) {\r\n          sent10MinReminders.current.add(session.id);\r\n          await sendSessionReminderNotification(\r\n            session.id,\r\n            session.mentorId,\r\n            session.studentId,\r\n            session.topic,\r\n            10\r\n          );\r\n          console.log(`10-minute reminder sent for session: ${session.topic}`);\r\n        }\r\n        \r\n        // Show popup for session within 30 minutes on fresh page load\r\n        if (\r\n          isSessionWithin30Minutes(session.preferredDate, session.preferredTime) &&\r\n          !hasShownPopup.current.has(session.id)\r\n        ) {\r\n          hasShownPopup.current.add(session.id);\r\n          setUpcomingSessionPopup(session);\r\n        }\r\n      }\r\n    };\r\n    \r\n    if (upcomingSessions.length > 0) {\r\n      checkAndSendReminders();\r\n    }\r\n  }, [upcomingSessions]);\r\n\r\n  const loadUserRole = async () => {\r\n    if (!user) return;\r\n    const profile = await getUserProfile(user.id);\r\n    setUserRole(profile?.role || 'student');\r\n  };\r\n\r\n  const loadUpcomingSessions = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      const sessions = await fetchUpcomingSessions(user.id, userRole);\r\n      setUpcomingSessions(sessions);\r\n    } catch (error) {\r\n      console.error('Error loading upcoming sessions:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const dismissSession = (sessionId: string) => {\r\n    setDismissedSessions(prev => [...prev, sessionId]);\r\n  };\r\n\r\n  const getOtherParticipant = (session: UpcomingSession) => {\r\n    if (userRole === 'mentor') {\r\n      return {\r\n        id: session.studentId,\r\n        name: session.studentProfile?.fullName || 'Student',\r\n        avatar: session.studentProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=student',\r\n      };\r\n    } else {\r\n      return {\r\n        id: session.mentorId,\r\n        name: session.mentorProfile?.fullName || 'Mentor',\r\n        avatar: session.mentorProfile?.avatarUrl || 'https://api.dicebear.com/7.x/avataaars/svg?seed=mentor',\r\n      };\r\n    }\r\n  };\r\n\r\n  const formatTime = (time: string) => {\r\n    if (!time) return '';\r\n    const [hours, minutes] = time.split(':');\r\n    const hour = parseInt(hours);\r\n    const ampm = hour >= 12 ? 'PM' : 'AM';\r\n    const hour12 = hour % 12 || 12;\r\n    return `${hour12}:${minutes} ${ampm}`;\r\n  };\r\n\r\n  // Filter out dismissed sessions and get sessions happening soon (within 1 hour)\r\n  const sessionsToShow = upcomingSessions.filter(session => \r\n    !dismissedSessions.includes(session.id) && \r\n    isSessionSoon(session.preferredDate, session.preferredTime)\r\n  );\r\n\r\n  // Also show today's sessions that haven't started yet\r\n  const todaysSessions = upcomingSessions.filter(session => {\r\n    if (dismissedSessions.includes(session.id)) return false;\r\n    if (sessionsToShow.some(s => s.id === session.id)) return false;\r\n    \r\n    const sessionDateTime = new Date(`${session.preferredDate}T${session.preferredTime}`);\r\n    return sessionDateTime > new Date();\r\n  });\r\n\r\n  if (loading || (sessionsToShow.length === 0 && todaysSessions.length === 0 && !upcomingSessionPopup)) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Popup for session within 30 minutes on page load */}\r\n      {upcomingSessionPopup && (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n          <div className={`max-w-md w-full rounded-2xl shadow-2xl overflow-hidden animate-popIn ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n            <div className=\"bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4\">\r\n              <div className=\"flex items-center gap-3 text-white\">\r\n                <AlertCircle size={28} className=\"animate-pulse\" />\r\n                <div>\r\n                  <h3 className=\"font-bold text-lg\">Session Starting Soon!</h3>\r\n                  <p className=\"text-sm opacity-90\">Don't miss your upcoming session</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <div className=\"text-center mb-4\">\r\n                <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-full ${isDarkMode ? 'bg-amber-500/20' : 'bg-amber-100'}`}>\r\n                  <Clock size={20} className=\"text-amber-500\" />\r\n                  <span className={`text-lg font-bold ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                    {getTimeUntilSession(upcomingSessionPopup.preferredDate, upcomingSessionPopup.preferredTime)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className={`p-4 rounded-xl mb-4 ${isDarkMode ? 'bg-slate-700' : 'bg-slate-100'}`}>\r\n                <h4 className={`font-bold text-lg mb-2 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  ðŸ“š {upcomingSessionPopup.topic}\r\n                </h4>\r\n                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  with {userRole === 'mentor' \r\n                    ? upcomingSessionPopup.studentProfile?.fullName || 'Student'\r\n                    : upcomingSessionPopup.mentorProfile?.fullName || 'Mentor'}\r\n                </p>\r\n                <div className=\"flex items-center gap-2 mt-2\">\r\n                  <Calendar size={14} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                  <span className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                    {upcomingSessionPopup.preferredDate} at {formatTime(upcomingSessionPopup.preferredTime)}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 mt-1\">\r\n                  {upcomingSessionPopup.mode === 'video' && <Video size={14} className=\"text-blue-500\" />}\r\n                  {upcomingSessionPopup.mode === 'call' && <MessageCircle size={14} className=\"text-green-500\" />}\r\n                  {upcomingSessionPopup.mode === 'chat' && <MessageCircle size={14} className=\"text-purple-500\" />}\r\n                  <span className={`text-sm capitalize ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                    {upcomingSessionPopup.mode === 'video' ? 'Video Call' : upcomingSessionPopup.mode === 'call' ? 'Voice Call' : 'Chat'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  onClick={() => setUpcomingSessionPopup(null)}\r\n                  className={`flex-1 py-3 rounded-xl font-medium transition-colors ${\r\n                    isDarkMode \r\n                      ? 'bg-slate-700 hover:bg-slate-600 text-slate-300' \r\n                      : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                  }`}\r\n                >\r\n                  Dismiss\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    setUpcomingSessionPopup(null);\r\n                    // Navigate to sessions - can be enhanced to actually navigate\r\n                  }}\r\n                  className=\"flex-1 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-medium transition-colors\"\r\n                >\r\n                  Go to Session\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n    <div className=\"space-y-4\">\r\n      {/* Urgent reminders - sessions starting within 1 hour */}\r\n      {sessionsToShow.length > 0 && (\r\n        <div className={`rounded-xl border-2 border-amber-500 overflow-hidden ${isDarkMode ? 'bg-slate-800' : 'bg-white'}`}>\r\n          <div className=\"bg-gradient-to-r from-amber-500 to-orange-600 px-4 py-3\">\r\n            <div className=\"flex items-center gap-2 text-white\">\r\n              <AlertCircle size={20} className=\"animate-pulse\" />\r\n              <span className=\"font-bold\">Session Starting Soon!</span>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4 space-y-3\">\r\n            {sessionsToShow.map(session => {\r\n              const participant = getOtherParticipant(session);\r\n              return (\r\n                <div \r\n                  key={session.id}\r\n                  className={`flex items-center justify-between p-4 rounded-lg ${isDarkMode ? 'bg-slate-700/50' : 'bg-amber-50'}`}\r\n                >\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <img \r\n                      src={participant.avatar} \r\n                      alt={participant.name}\r\n                      className=\"w-12 h-12 rounded-full border-2 border-amber-500\"\r\n                    />\r\n                    <div>\r\n                      <h4 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        {session.topic}\r\n                      </h4>\r\n                      <p className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\r\n                        with {participant.name}\r\n                      </p>\r\n                      <div className=\"flex items-center gap-2 mt-1\">\r\n                        <Clock size={14} className=\"text-amber-500\" />\r\n                        <span className={`text-sm font-medium ${isDarkMode ? 'text-amber-400' : 'text-amber-600'}`}>\r\n                          {formatTime(session.preferredTime)}\r\n                        </span>\r\n                        <span className={`text-xs px-2 py-0.5 rounded-full ${\r\n                          session.mode === 'video' ? 'bg-blue-500/10 text-blue-500' :\r\n                          session.mode === 'call' ? 'bg-green-500/10 text-green-500' :\r\n                          'bg-purple-500/10 text-purple-500'\r\n                        }`}>\r\n                          {session.mode === 'video' ? 'ðŸŽ¥ Video' : session.mode === 'call' ? 'ðŸ“ž Call' : 'ðŸ’¬ Chat'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {session.mode !== 'chat' && userRole === 'mentor' && onStartVideoCall && (\r\n                      <button\r\n                        onClick={() => onStartVideoCall(participant.name, participant.avatar, participant.id)}\r\n                        className=\"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2\"\r\n                      >\r\n                        <Video size={16} />\r\n                        Start Call\r\n                      </button>\r\n                    )}\r\n                    {onStartChat && (\r\n                      <button\r\n                        onClick={() => onStartChat(participant)}\r\n                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${\r\n                          isDarkMode ? 'bg-slate-600 hover:bg-slate-500 text-white' : 'bg-slate-200 hover:bg-slate-300 text-slate-700'\r\n                        }`}\r\n                      >\r\n                        <MessageCircle size={16} />\r\n                        Chat\r\n                      </button>\r\n                    )}\r\n                    <button\r\n                      onClick={() => dismissSession(session.id)}\r\n                      className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-600 text-slate-400' : 'hover:bg-slate-200 text-slate-500'}`}\r\n                    >\r\n                      <X size={16} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Today's upcoming sessions */}\r\n      {todaysSessions.length > 0 && (\r\n        <div className={`rounded-xl border overflow-hidden ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\r\n          <div className={`px-4 py-3 border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Calendar size={18} className=\"text-amber-500\" />\r\n              <span className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Today's Sessions</span>\r\n              <span className={`text-xs px-2 py-0.5 rounded-full ${isDarkMode ? 'bg-amber-500/20 text-amber-400' : 'bg-amber-100 text-amber-600'}`}>\r\n                {todaysSessions.length}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4 space-y-3\">\r\n            {todaysSessions.map(session => {\r\n              const participant = getOtherParticipant(session);\r\n              return (\r\n                <div \r\n                  key={session.id}\r\n                  className={`flex items-center justify-between p-3 rounded-lg ${isDarkMode ? 'bg-slate-700/30' : 'bg-slate-50'}`}\r\n                >\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <img \r\n                      src={participant.avatar} \r\n                      alt={participant.name}\r\n                      className=\"w-10 h-10 rounded-full\"\r\n                    />\r\n                    <div>\r\n                      <h4 className={`font-medium text-sm ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                        {session.topic}\r\n                      </h4>\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                        with {participant.name} at {formatTime(session.preferredTime)}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => dismissSession(session.id)}\r\n                    className={`p-1.5 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-600 text-slate-400' : 'hover:bg-slate-200 text-slate-500'}`}\r\n                  >\r\n                    <X size={14} />\r\n                  </button>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default SessionReminders;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":72,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":72,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":72,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2699,2699],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":74,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":74,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":74,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2730,2730],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":93,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":93,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":93,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3573,3573],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":95,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":95,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":95,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3604,3604],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":113,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":113,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":113,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4390,4390],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":115,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":115,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":115,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4421,4421],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProfile'. Either include it or remove the dependency array.","line":168,"column":6,"nodeType":"ArrayExpression","endLine":168,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadProfile, user]","fix":{"range":[5599,5605],"text":"[loadProfile, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8513,8516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8513,8516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":300,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9799,9802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9799,9802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10515,10518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10515,10518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12242,12245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12242,12245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { User, Mail, Phone, GraduationCap, Briefcase, Calendar, Hash, Save, Volume2, VolumeX, Trash2, Upload, LogOut, Send, Loader2 } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ninterface UserProfile {\r\n  full_name: string;\r\n  avatar_url: string;\r\n  role: 'student' | 'mentor';\r\n  phone_number: string;\r\n  gender?: 'male' | 'female' | 'other';\r\n  profession?: string;\r\n  experience?: string;\r\n  class?: string;\r\n  course?: string;\r\n  age?: number;\r\n  username?: string;\r\n}\r\n\r\ninterface SettingsProps {\r\n  isDarkMode: boolean;\r\n  onClose: () => void;\r\n  soundEnabled: boolean;\r\n  setSoundEnabled: (enabled: boolean) => void;\r\n  soundVolume: number;\r\n  setSoundVolume: (volume: number) => void;\r\n  incomingCallSoundEnabled: boolean;\r\n  setIncomingCallSoundEnabled: (enabled: boolean) => void;\r\n  receiveMsgSoundEnabled: boolean;\r\n  setReceiveMsgSoundEnabled: (enabled: boolean) => void;\r\n  sendMsgSoundEnabled: boolean;\r\n  setSendMsgSoundEnabled: (enabled: boolean) => void;\r\n}\r\n\r\nexport function Settings({\r\n  isDarkMode,\r\n  onClose,\r\n  soundEnabled,\r\n  setSoundEnabled,\r\n  soundVolume,\r\n  setSoundVolume,\r\n  incomingCallSoundEnabled,\r\n  setIncomingCallSoundEnabled,\r\n  receiveMsgSoundEnabled,\r\n  setReceiveMsgSoundEnabled,\r\n  sendMsgSoundEnabled,\r\n  setSendMsgSoundEnabled\r\n}: SettingsProps) {\r\n  const { user, signOut } = useAuth();\r\n  const [loading, setLoading] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  // Sound preview functions using real audio files with Web Audio API fallback\r\n  const playPreviewSound = () => {\r\n    try {\r\n      const a = new Audio('https://cdn.pixabay.com/audio/2024/11/04/audio_4956b4edd2.mp3');\r\n      a.volume = soundVolume;\r\n      a.play().catch(() => {\r\n        try {\r\n          const ctx = new AudioContext();\r\n          const o1 = ctx.createOscillator(); const o2 = ctx.createOscillator();\r\n          const g = ctx.createGain();\r\n          o1.connect(g); o2.connect(g); g.connect(ctx.destination);\r\n          o1.frequency.setValueAtTime(587, ctx.currentTime);\r\n          o2.frequency.setValueAtTime(784, ctx.currentTime + 0.08);\r\n          g.gain.setValueAtTime(soundVolume * 0.3, ctx.currentTime);\r\n          g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);\r\n          o1.start(); o1.stop(ctx.currentTime + 0.12);\r\n          o2.start(ctx.currentTime + 0.08); o2.stop(ctx.currentTime + 0.3);\r\n        } catch (_) {}\r\n      });\r\n    } catch (_) {}\r\n  };\r\n\r\n  const playRingtonePreview = () => {\r\n    try {\r\n      const a = new Audio('https://cdn.pixabay.com/audio/2022/10/30/audio_f3f8e5a830.mp3');\r\n      a.volume = soundVolume;\r\n      a.play().catch(() => {\r\n        try {\r\n          const ctx = new AudioContext();\r\n          const osc = ctx.createOscillator();\r\n          const g = ctx.createGain();\r\n          osc.connect(g); g.connect(ctx.destination);\r\n          osc.frequency.setValueAtTime(440, ctx.currentTime);\r\n          osc.frequency.setValueAtTime(520, ctx.currentTime + 0.15);\r\n          osc.frequency.setValueAtTime(440, ctx.currentTime + 0.30);\r\n          g.gain.setValueAtTime(soundVolume * 0.4, ctx.currentTime);\r\n          g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);\r\n          osc.start(); osc.stop(ctx.currentTime + 0.5);\r\n        } catch (_) {}\r\n      });\r\n    } catch (_) {}\r\n  };\r\n\r\n  const playSendPreview = () => {\r\n    try {\r\n      const a = new Audio('https://cdn.pixabay.com/audio/2022/03/24/audio_4193bac9f8.mp3');\r\n      a.volume = soundVolume;\r\n      a.play().catch(() => {\r\n        try {\r\n          const ctx = new AudioContext();\r\n          const osc = ctx.createOscillator();\r\n          const g = ctx.createGain();\r\n          osc.connect(g); g.connect(ctx.destination);\r\n          osc.frequency.setValueAtTime(880, ctx.currentTime);\r\n          osc.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.08);\r\n          g.gain.setValueAtTime(soundVolume * 0.3, ctx.currentTime);\r\n          g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);\r\n          osc.start(); osc.stop(ctx.currentTime + 0.15);\r\n        } catch (_) {}\r\n      });\r\n    } catch (_) {}\r\n  };\r\n\r\n  const handleMasterSoundToggle = () => {\r\n    const newValue = !soundEnabled;\r\n    setSoundEnabled(newValue);\r\n    if (newValue) {\r\n      playPreviewSound();\r\n    }\r\n  };\r\n\r\n  const handleIncomingCallToggle = () => {\r\n    const newValue = !incomingCallSoundEnabled;\r\n    setIncomingCallSoundEnabled(newValue);\r\n    if (newValue && soundEnabled) {\r\n      playRingtonePreview();\r\n    }\r\n  };\r\n\r\n  const handleReceiveMsgToggle = () => {\r\n    const newValue = !receiveMsgSoundEnabled;\r\n    setReceiveMsgSoundEnabled(newValue);\r\n    if (newValue && soundEnabled) {\r\n      playPreviewSound();\r\n    }\r\n  };\r\n\r\n  const handleSendMsgToggle = () => {\r\n    const newValue = !sendMsgSoundEnabled;\r\n    setSendMsgSoundEnabled(newValue);\r\n    if (newValue && soundEnabled) {\r\n      playSendPreview();\r\n    }\r\n  };\r\n\r\n  const [profile, setProfile] = useState<UserProfile>({\r\n    full_name: '',\r\n    avatar_url: '',\r\n    role: 'student',\r\n    phone_number: '',\r\n    gender: undefined,\r\n    profession: '',\r\n    experience: '',\r\n    class: '',\r\n    course: '',\r\n    age: undefined,\r\n    username: '',\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadProfile();\r\n    }\r\n  }, [user]);\r\n\r\n  const loadProfile = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .select('*')\r\n        .eq('user_id', user?.id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      if (data) {\r\n        setProfile({\r\n          full_name: data.full_name || '',\r\n          avatar_url: data.avatar_url || '',\r\n          role: data.role || 'student',\r\n          phone_number: data.phone_number || '',\r\n          gender: data.gender || undefined,\r\n          profession: data.profession || '',\r\n          experience: data.experience || '',\r\n          class: data.class || '',\r\n          course: data.course || '',\r\n          age: data.age || undefined,\r\n          username: data.username || '',\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading profile:', error);\r\n      setMessage({ type: 'error', text: 'Failed to load profile' });\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    try {\r\n      setUploading(true);\r\n      setMessage(null);\r\n\r\n      if (!event.target.files || event.target.files.length === 0) {\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      const file = event.target.files[0];\r\n\r\n      if (!file.type.startsWith('image/')) {\r\n        setMessage({ type: 'error', text: 'Please upload an image file' });\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      if (file.size > 2 * 1024 * 1024) {\r\n        setMessage({ type: 'error', text: 'Image size should be less than 2MB' });\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      // Delete old image if exists\r\n      if (profile.avatar_url) {\r\n        try {\r\n          const oldPath = profile.avatar_url.split('/').slice(-2).join('/');\r\n          await supabase.storage.from('profiles').remove([oldPath]);\r\n        } catch (err) {\r\n          console.log('Could not delete old image:', err);\r\n        }\r\n      }\r\n\r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `avatars/${fileName}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('profiles')\r\n        .upload(filePath, file, { upsert: true });\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from('profiles')\r\n        .getPublicUrl(filePath);\r\n\r\n      // Update database with new avatar URL\r\n      const { error: updateError } = await supabase\r\n        .from('user_profiles')\r\n        .update({ avatar_url: publicUrl })\r\n        .eq('user_id', user?.id);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      setProfile(prev => ({ ...prev, avatar_url: publicUrl }));\r\n      setMessage({ type: 'success', text: 'Image uploaded successfully!' });\r\n      setTimeout(() => setMessage(null), 3000);\r\n    } catch (error: any) {\r\n      console.error('Error uploading image:', error);\r\n      setMessage({ type: 'error', text: error.message || 'Failed to upload image' });\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteImage = async () => {\r\n    try {\r\n      setUploading(true);\r\n      setMessage(null);\r\n\r\n      if (!profile.avatar_url) {\r\n        setMessage({ type: 'error', text: 'No image to delete' });\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      // Extract the file path from the URL\r\n      const urlParts = profile.avatar_url.split('/');\r\n      const filePath = urlParts.slice(-2).join('/'); // Gets \"avatars/filename.ext\"\r\n\r\n      const { error: deleteError } = await supabase.storage\r\n        .from('profiles')\r\n        .remove([filePath]);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      // Update profile to remove avatar_url\r\n      const { error: updateError } = await supabase\r\n        .from('user_profiles')\r\n        .update({ avatar_url: null })\r\n        .eq('user_id', user?.id);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      setProfile(prev => ({ ...prev, avatar_url: '' }));\r\n      setMessage({ type: 'success', text: 'Image deleted successfully!' });\r\n      setTimeout(() => setMessage(null), 3000);\r\n    } catch (error: any) {\r\n      console.error('Error deleting image:', error);\r\n      setMessage({ type: 'error', text: error.message || 'Failed to delete image' });\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n  const handleDeleteAccount = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setMessage(null);\r\n\r\n      // Delete user's data from user_profiles\r\n      const { error: profileError } = await supabase\r\n        .from('user_profiles')\r\n        .delete()\r\n        .eq('user_id', user?.id);\r\n\r\n      if (profileError) throw profileError;\r\n\r\n      // Sign out and delete auth user\r\n      await signOut();\r\n\r\n      setMessage({ type: 'success', text: 'Account deleted successfully' });\r\n    } catch (error: any) {\r\n      console.error('Error deleting account:', error);\r\n      setMessage({ type: 'error', text: error.message || 'Failed to delete account' });\r\n    } finally {\r\n      setLoading(false);\r\n      setShowDeleteConfirm(false);\r\n    }\r\n  };\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      // Check if username is unique before updating (for both students and mentors)\r\n      if (profile.username) {\r\n        const { data: existingUsers, error: checkError } = await supabase\r\n          .from('user_profiles')\r\n          .select('user_id, username')\r\n          .eq('username', profile.username)\r\n          .neq('user_id', user!.id);\r\n\r\n        if (checkError) throw checkError;\r\n\r\n        if (existingUsers && existingUsers.length > 0) {\r\n          setMessage({ type: 'error', text: 'This username is already taken. Please choose another one.' });\r\n          setLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('user_profiles')\r\n        .update({\r\n          full_name: profile.full_name,\r\n          phone_number: profile.phone_number,\r\n          gender: profile.gender,\r\n          ...(profile.role === 'mentor'\r\n            ? { profession: profile.profession, experience: profile.experience, username: profile.username }\r\n            : { class: profile.class, course: profile.course, age: profile.age, username: profile.username }),\r\n        })\r\n        .eq('user_id', user!.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setMessage({ type: 'success', text: 'Profile updated successfully!' });\r\n      setTimeout(() => setMessage(null), 3000);\r\n    } catch (error: any) {\r\n      setMessage({ type: 'error', text: error.message || 'Failed to update profile' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`min-h-screen ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`}>\r\n      <div className={`relative overflow-hidden ${isDarkMode\r\n        ? 'bg-gradient-to-br from-slate-800 via-slate-800 to-slate-900 border-b border-slate-700'\r\n        : 'bg-gradient-to-br from-white via-amber-50/30 to-white border-b border-slate-200'\r\n        }`}>\r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl -translate-y-32 translate-x-32\"></div>\r\n        <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-amber-500/5 rounded-full blur-3xl translate-y-24 -translate-x-24\"></div>\r\n\r\n        <div className=\"relative max-w-4xl mx-auto px-6 py-5\">\r\n          <div className=\"flex items-center gap-3 mb-1.5\">\r\n            <div className={`p-2.5 rounded-xl ${isDarkMode ? 'bg-amber-500/10' : 'bg-amber-500/10'\r\n              }`}>\r\n              <User size={24} className=\"text-amber-500\" />\r\n            </div>\r\n            <h2 className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              Profile Settings\r\n            </h2>\r\n          </div>\r\n          <p className={`text-sm ml-14 ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n            Manage your account information and preferences\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"max-w-4xl mx-auto p-6 space-y-6\">\r\n        {message && (\r\n          <div className={`p-4 rounded-lg border ${message.type === 'success'\r\n            ? 'bg-green-500/10 border-green-500/20 text-green-400'\r\n            : 'bg-red-500/10 border-red-500/20 text-red-400'\r\n            }`}>\r\n            {message.text}\r\n          </div>\r\n        )}\r\n\r\n        {/* Profile Picture Section */}\r\n        <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n          }`}>\r\n          <div className=\"flex flex-col items-center gap-6\">\r\n            {/* Large Profile Picture - Centered */}\r\n            <div className=\"relative\">\r\n              <div className={`w-64 h-64 rounded-full overflow-hidden ${isDarkMode ? 'bg-slate-700' : 'bg-slate-200'\r\n                } flex items-center justify-center border-4 ${isDarkMode ? 'border-slate-600' : 'border-slate-300'\r\n                }`}>\r\n                {profile.avatar_url ? (\r\n                  <img\r\n                    src={profile.avatar_url}\r\n                    alt=\"Profile\"\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <User size={100} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                )}\r\n              </div>\r\n              {uploading && (\r\n                <div className=\"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center\">\r\n                  <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-white\"></div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Action Buttons Below Picture */}\r\n            <div className=\"flex flex-wrap justify-center gap-3\">\r\n              <label className={`flex items-center justify-center gap-2 px-6 py-3 rounded-lg cursor-pointer transition-all ${uploading ? 'opacity-50 cursor-not-allowed' : ''\r\n                } ${isDarkMode\r\n                  ? 'bg-amber-500 hover:bg-amber-600 text-white'\r\n                  : 'bg-amber-500 hover:bg-amber-600 text-white'\r\n                }`}>\r\n                <Upload size={18} />\r\n                <span className=\"font-medium\">Change Picture</span>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={handleImageUpload}\r\n                  className=\"hidden\"\r\n                  disabled={uploading}\r\n                />\r\n              </label>\r\n\r\n              {profile.avatar_url && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleDeleteImage}\r\n                  disabled={uploading}\r\n                  className={`flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${uploading ? 'opacity-50 cursor-not-allowed' : ''\r\n                    } ${isDarkMode\r\n                      ? 'bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30'\r\n                      : 'bg-red-50 hover:bg-red-100 text-red-600 border border-red-200'\r\n                    }`}\r\n                >\r\n                  <Trash2 size={18} />\r\n                  <span className=\"font-medium\">Delete Picture</span>\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Personal Information Section */}\r\n        <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n          }`}>\r\n          <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Personal Information\r\n          </h3>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                <User size={16} className=\"inline mr-2\" />\r\n                Full Name\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={profile.full_name}\r\n                onChange={(e) => setProfile(prev => ({ ...prev, full_name: e.target.value }))}\r\n                className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                  ? 'bg-slate-700 border-slate-600 text-white'\r\n                  : 'bg-white border-slate-300 text-slate-900'\r\n                  } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                <Mail size={16} className=\"inline mr-2\" />\r\n                Email\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={user?.email || ''}\r\n                disabled\r\n                className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                  ? 'bg-slate-700/50 border-slate-600 text-slate-400'\r\n                  : 'bg-slate-100 border-slate-300 text-slate-500'\r\n                  } cursor-not-allowed`}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                <Phone size={16} className=\"inline mr-2\" />\r\n                Phone Number\r\n              </label>\r\n              <input\r\n                type=\"tel\"\r\n                value={profile.phone_number}\r\n                onChange={(e) => setProfile(prev => ({ ...prev, phone_number: e.target.value }))}\r\n                className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                  ? 'bg-slate-700 border-slate-600 text-white'\r\n                  : 'bg-white border-slate-300 text-slate-900'\r\n                  } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                <User size={16} className=\"inline mr-2\" />\r\n                Gender\r\n              </label>\r\n              <select\r\n                value={profile.gender || ''}\r\n                onChange={(e) => setProfile(prev => ({ ...prev, gender: e.target.value as 'male' | 'female' | 'other' | undefined }))}\r\n                className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                  ? 'bg-slate-700 border-slate-600 text-white'\r\n                  : 'bg-white border-slate-300 text-slate-900'\r\n                  } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                required\r\n              >\r\n                <option value=\"\">Select Gender</option>\r\n                <option value=\"male\">Male</option>\r\n                <option value=\"female\">Female</option>\r\n                <option value=\"other\">Other</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                Role\r\n              </label>\r\n              <div className={`flex items-center gap-2 px-4 py-2 rounded-lg border ${isDarkMode ? 'bg-slate-700/50 border-slate-600' : 'bg-slate-100 border-slate-300'}`}>\r\n                {profile.role === 'student' ? (\r\n                  <>\r\n                    <GraduationCap size={18} className=\"text-amber-500\" />\r\n                    <span className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>Student</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Briefcase size={18} className=\"text-amber-500\" />\r\n                    <span className={`font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>Mentor</span>\r\n                  </>\r\n                )}\r\n                <span className={`ml-auto text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>Cannot be changed</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Role-specific fields */}\r\n        {profile.role === 'mentor' ? (\r\n          <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n            }`}>\r\n            <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              Professional Details\r\n            </h3>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <Briefcase size={16} className=\"inline mr-2\" />\r\n                  Profession\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.profession || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, profession: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <Calendar size={16} className=\"inline mr-2\" />\r\n                  Years of Experience\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.experience || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, experience: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <Hash size={16} className=\"inline mr-2\" />\r\n                  Username\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.username || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, username: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                  placeholder=\"Choose a unique username\"\r\n                />\r\n                <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                  Usernames must be unique across all accounts\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n            }`}>\r\n            <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n              Academic Details\r\n            </h3>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <GraduationCap size={16} className=\"inline mr-2\" />\r\n                  Class\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.class || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, class: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  Course\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.course || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, course: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <Calendar size={16} className=\"inline mr-2\" />\r\n                  Age\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={profile.age || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, age: parseInt(e.target.value) || undefined }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                  min=\"1\"\r\n                  max=\"120\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                  <Hash size={16} className=\"inline mr-2\" />\r\n                  Username\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={profile.username || ''}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, username: e.target.value }))}\r\n                  className={`w-full px-4 py-2 rounded-lg border ${isDarkMode\r\n                    ? 'bg-slate-700 border-slate-600 text-white'\r\n                    : 'bg-white border-slate-300 text-slate-900'\r\n                    } focus:outline-none focus:ring-2 focus:ring-amber-500`}\r\n                  required\r\n                  placeholder=\"Choose a unique username\"\r\n                />\r\n                <p className={`text-xs mt-1 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                  Usernames must be unique across all accounts\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex gap-4\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className={`flex-1 px-6 py-3 rounded-lg font-medium transition-colors ${isDarkMode\r\n              ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n              : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\r\n              }`}\r\n          >\r\n            Back to Dashboard\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || uploading}\r\n            className=\"flex-1 px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg font-medium hover:from-amber-600 hover:to-orange-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2\"\r\n          >\r\n            <Save size={20} />\r\n            {loading ? 'Saving...' : 'Save Changes'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Notification Settings */}\r\n        <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n          }`}>\r\n          <h3 className={`text-lg font-semibold mb-6 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Notification Settings\r\n          </h3>\r\n\r\n          {/* Master Sound Toggle */}\r\n          <div className=\"flex items-center justify-between mb-6 pb-6 border-b border-slate-200 dark:border-slate-700\">\r\n            <div className=\"flex items-center gap-3\">\r\n              {soundEnabled ? (\r\n                <Volume2 size={20} className=\"text-amber-500\" />\r\n              ) : (\r\n                <VolumeX size={20} className=\"text-slate-500\" />\r\n              )}\r\n              <div>\r\n                <p className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                  Master Sound Control\r\n                </p>\r\n                <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                  Enable/disable all sounds globally\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleMasterSoundToggle}\r\n              className={`relative w-14 h-7 rounded-full transition-colors ${soundEnabled ? 'bg-amber-500' : 'bg-slate-600'\r\n                }`}\r\n            >\r\n              <span\r\n                className={`absolute top-1 left-1 w-5 h-5 bg-white rounded-full transition-transform ${soundEnabled ? 'translate-x-7' : ''\r\n                  }`}\r\n              />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Volume Control */}\r\n          {soundEnabled && (\r\n            <div className=\"mb-6 pb-6 border-b border-slate-200 dark:border-slate-700\">\r\n              <label className={`block text-sm font-medium mb-3 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                Volume Level: {Math.round(soundVolume * 100)}%\r\n              </label>\r\n              <div className=\"flex items-center gap-3\">\r\n                <VolumeX size={16} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                <input\r\n                  type=\"range\"\r\n                  min=\"0\"\r\n                  max=\"1\"\r\n                  step=\"0.01\"\r\n                  value={soundVolume}\r\n                  onChange={(e) => setSoundVolume(parseFloat(e.target.value))}\r\n                  className=\"flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-amber-500\"\r\n                  style={{\r\n                    background: `linear-gradient(to right, rgb(245, 158, 11) 0%, rgb(245, 158, 11) ${soundVolume * 100}%, rgb(71, 85, 105) ${soundVolume * 100}%, rgb(71, 85, 105) 100%)`\r\n                  }}\r\n                />\r\n                <Volume2 size={16} className={isDarkMode ? 'text-slate-400' : 'text-slate-500'} />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={playPreviewSound}\r\n                  className=\"ml-2 px-3 py-1 text-xs font-medium rounded-md bg-amber-500 text-white hover:bg-amber-600 transition-colors\"\r\n                >\r\n                  Test Sound\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Individual Sound Controls */}\r\n          <div className={`space-y-4 transition-opacity ${soundEnabled ? 'opacity-100' : 'opacity-50 pointer-events-none'}`}>\r\n            {/* Incoming Call Sound */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Phone size={18} className={incomingCallSoundEnabled ? 'text-green-500' : 'text-slate-400'} />\r\n                <div>\r\n                  <p className={`font-medium text-sm ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Incoming Call Ringtone\r\n                  </p>\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                    Play ringtone for incoming video calls\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleIncomingCallToggle}\r\n                disabled={!soundEnabled}\r\n                className={`relative w-12 h-6 rounded-full transition-colors ${incomingCallSoundEnabled ? 'bg-green-500' : 'bg-slate-600'\r\n                  }`}\r\n              >\r\n                <span\r\n                  className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ${incomingCallSoundEnabled ? 'translate-x-6' : ''\r\n                    }`}\r\n                />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Receive Message Sound */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Volume2 size={18} className={receiveMsgSoundEnabled ? 'text-blue-500' : 'text-slate-400'} />\r\n                <div>\r\n                  <p className={`font-medium text-sm ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Receive Message Sound\r\n                  </p>\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                    Play sound when receiving messages\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleReceiveMsgToggle}\r\n                disabled={!soundEnabled}\r\n                className={`relative w-12 h-6 rounded-full transition-colors ${receiveMsgSoundEnabled ? 'bg-blue-500' : 'bg-slate-600'\r\n                  }`}\r\n              >\r\n                <span\r\n                  className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ${receiveMsgSoundEnabled ? 'translate-x-6' : ''\r\n                    }`}\r\n                />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Send Message Sound */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Send size={18} className={sendMsgSoundEnabled ? 'text-purple-500' : 'text-slate-400'} />\r\n                <div>\r\n                  <p className={`font-medium text-sm ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    Send Message Sound\r\n                  </p>\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                    Play sound when sending messages\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleSendMsgToggle}\r\n                disabled={!soundEnabled}\r\n                className={`relative w-12 h-6 rounded-full transition-colors ${sendMsgSoundEnabled ? 'bg-purple-500' : 'bg-slate-600'\r\n                  }`}\r\n              >\r\n                <span\r\n                  className={`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ${sendMsgSoundEnabled ? 'translate-x-6' : ''\r\n                    }`}\r\n                />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Account Management */}\r\n        <div className={`rounded-2xl border p-6 ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\r\n          }`}>\r\n          <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n            Account Management\r\n          </h3>\r\n\r\n          <div className=\"flex gap-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={signOut}\r\n              className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${isDarkMode\r\n                ? 'bg-slate-700 text-slate-300 hover:bg-slate-600'\r\n                : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\r\n                }`}\r\n            >\r\n              <LogOut size={18} />\r\n              Sign Out\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowDeleteConfirm(true)}\r\n              className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors bg-red-500/10 text-red-500 hover:bg-red-500/20 border border-red-500/20\"\r\n            >\r\n              <Trash2 size={18} />\r\n              Delete Account\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Delete Account Confirmation Modal */}\r\n        {showDeleteConfirm && (\r\n          <div className=\"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4 animate-fade-in\">\r\n            <div className={`w-full max-w-md rounded-3xl shadow-2xl overflow-hidden transform transition-all ${isDarkMode ? 'bg-gradient-to-br from-slate-800 to-slate-900' : 'bg-gradient-to-br from-white to-slate-50'\r\n              }`}>\r\n              {/* Header with gradient */}\r\n              <div className=\"bg-gradient-to-r from-red-500 to-orange-500 p-6 text-center\">\r\n                <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm mb-3\">\r\n                  <Trash2 size={32} className=\"text-white\" />\r\n                </div>\r\n                <h3 className=\"text-2xl font-bold text-white mb-2\">\r\n                  Delete Account?\r\n                </h3>\r\n                <p className=\"text-white/90 text-sm\">\r\n                  This action is permanent and cannot be undone\r\n                </p>\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div className=\"p-6\">\r\n                <p className={`text-center mb-6 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\r\n                  All your data, including study sessions, goals, and connections will be permanently removed from our system.\r\n                </p>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowDeleteConfirm(false)}\r\n                    disabled={loading}\r\n                    className={`flex-1 px-6 py-3 rounded-xl font-semibold transition-all ${isDarkMode\r\n                      ? 'bg-slate-700 text-white hover:bg-slate-600'\r\n                      : 'bg-slate-200 text-slate-900 hover:bg-slate-300'\r\n                      } disabled:opacity-50`}\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleDeleteAccount}\r\n                    disabled={loading}\r\n                    className=\"flex-1 px-6 py-3 rounded-xl font-semibold bg-gradient-to-r from-red-500 to-orange-500 text-white hover:from-red-600 hover:to-orange-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg shadow-red-500/30\"\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <Loader2 size={18} className=\"animate-spin\" />\r\n                        Deleting...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Trash2 size={18} />\r\n                        Delete Forever\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\SmartNotifications.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'scheduleNotifications'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [settings, subjects, sessions, goals, scheduleNotifications]","fix":{"range":[1921,1958],"text":"[settings, subjects, sessions, goals, scheduleNotifications]"}}]},{"ruleId":"prefer-const","severity":2,"message":"'currentDate' is never reassigned. Use 'const' instead.","line":237,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":237,"endColumn":20,"fix":{"range":[7711,7745],"text":"const currentDate = new Date(today);"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Bell, BellOff, Clock, Target, Flame, Settings } from 'lucide-react';\nimport { Subject, StudySession, StudyGoal } from '../types';\n\ninterface SmartNotificationsProps {\n  subjects: Subject[];\n  sessions: StudySession[];\n  goals: StudyGoal[];\n  isDarkMode: boolean;\n}\n\ninterface NotificationSettings {\n  enabled: boolean;\n  studyReminders: boolean;\n  goalDeadlines: boolean;\n  streakReminders: boolean;\n  breakReminders: boolean;\n  dailyTargetReminders: boolean;\n  reminderTime: string;\n  breakInterval: number; // minutes\n}\n\ninterface NotificationData {\n  id: string;\n  title: string;\n  message: string;\n  type: 'reminder' | 'goal' | 'streak' | 'break' | 'target';\n  scheduledFor: Date;\n  sent: boolean;\n}\n\nexport function SmartNotifications({ subjects, sessions, goals, isDarkMode }: SmartNotificationsProps) {\n  const [settings, setSettings] = useState<NotificationSettings>({\n    enabled: false,\n    studyReminders: true,\n    goalDeadlines: true,\n    streakReminders: true,\n    breakReminders: true,\n    dailyTargetReminders: true,\n    reminderTime: '09:00',\n    breakInterval: 25\n  });\n  const [showSettings, setShowSettings] = useState(false);\n  const [notifications, setNotifications] = useState<NotificationData[]>([]);\n  const [permission, setPermission] = useState<NotificationPermission>('default');\n\n  useEffect(() => {\n    // Load settings from localStorage\n    const stored = localStorage.getItem('grind_clock_notification_settings');\n    if (stored) {\n      setSettings(JSON.parse(stored));\n    }\n\n    // Check notification permission\n    if ('Notification' in window) {\n      setPermission(Notification.permission);\n    }\n  }, []);\n\n  useEffect(() => {\n    // Save settings to localStorage\n    localStorage.setItem('grind_clock_notification_settings', JSON.stringify(settings));\n    \n    if (settings.enabled) {\n      scheduleNotifications();\n    }\n  }, [settings, subjects, sessions, goals]);\n\n  const requestPermission = async () => {\n    if ('Notification' in window) {\n      const result = await Notification.requestPermission();\n      setPermission(result);\n      if (result === 'granted') {\n        setSettings(prev => ({ ...prev, enabled: true }));\n      }\n    }\n  };\n\n  const scheduleNotifications = () => {\n    const newNotifications: NotificationData[] = [];\n    const now = new Date();\n\n    // Daily study reminders\n    if (settings.studyReminders) {\n      const today = new Date();\n      const [hours, minutes] = settings.reminderTime.split(':').map(Number);\n      const reminderTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hours, minutes);\n      \n      if (reminderTime > now) {\n        const todaySessions = sessions.filter(s => \n          s.startTime.toDateString() === today.toDateString()\n        );\n        \n        if (todaySessions.length === 0) {\n          newNotifications.push({\n            id: `daily-reminder-${today.toDateString()}`,\n            title: 'ðŸ“š Time to Study!',\n            message: 'Start your daily study session to maintain your streak.',\n            type: 'reminder',\n            scheduledFor: reminderTime,\n            sent: false\n          });\n        }\n      }\n    }\n\n    // Goal deadline reminders\n    if (settings.goalDeadlines) {\n      goals.forEach(goal => {\n        if (goal.targetDate && !goal.completed) {\n          const daysUntilDeadline = Math.ceil(\n            (goal.targetDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)\n          );\n          \n          if (daysUntilDeadline <= 3 && daysUntilDeadline > 0) {\n            newNotifications.push({\n              id: `goal-deadline-${goal.id}`,\n              title: 'ðŸŽ¯ Goal Deadline Approaching',\n              message: `\"${goal.title}\" is due in ${daysUntilDeadline} day${daysUntilDeadline > 1 ? 's' : ''}!`,\n              type: 'goal',\n              scheduledFor: new Date(now.getTime() + 5000), // 5 seconds from now for immediate notification\n              sent: false\n            });\n          }\n        }\n        \n        if (goal.examDate) {\n          const daysUntilExam = Math.ceil(\n            (goal.examDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)\n          );\n          \n          if ([7, 3, 1].includes(daysUntilExam)) {\n            newNotifications.push({\n              id: `exam-reminder-${goal.id}-${daysUntilExam}`,\n              title: 'ðŸŽ“ Exam Reminder',\n              message: `${goal.title} exam is in ${daysUntilExam} day${daysUntilExam > 1 ? 's' : ''}!`,\n              type: 'goal',\n              scheduledFor: new Date(now.getTime() + 5000),\n              sent: false\n            });\n          }\n        }\n      });\n    }\n\n    // Streak reminders\n    if (settings.streakReminders) {\n      const currentStreak = calculateStreak(sessions);\n      const today = new Date();\n      const todaySessions = sessions.filter(s => \n        s.startTime.toDateString() === today.toDateString()\n      );\n      \n      if (currentStreak > 0 && todaySessions.length === 0) {\n        const reminderTime = new Date();\n        reminderTime.setHours(20, 0, 0, 0); // 8 PM reminder\n        \n        if (reminderTime > now) {\n          newNotifications.push({\n            id: `streak-reminder-${today.toDateString()}`,\n            title: 'ðŸ”¥ Don\\'t Break Your Streak!',\n            message: `You have a ${currentStreak}-day streak. Study today to keep it going!`,\n            type: 'streak',\n            scheduledFor: reminderTime,\n            sent: false\n          });\n        }\n      }\n    }\n\n    // Daily target reminders\n    if (settings.dailyTargetReminders) {\n      const totalDailyTarget = subjects.reduce((sum, subject) => \n        sum + (subject.targetHoursPerDay || 0), 0\n      );\n      \n      if (totalDailyTarget > 0) {\n        const today = new Date();\n        const todaySessions = sessions.filter(s => \n          s.startTime.toDateString() === today.toDateString()\n        );\n        const todayMinutes = todaySessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n        const todayHours = todayMinutes / 60;\n        \n        if (todayHours < totalDailyTarget * 0.5) { // Less than 50% of target\n          const reminderTime = new Date();\n          reminderTime.setHours(18, 0, 0, 0); // 6 PM reminder\n          \n          if (reminderTime > now) {\n            newNotifications.push({\n              id: `target-reminder-${today.toDateString()}`,\n              title: 'ðŸ“Š Daily Target Check',\n              message: `You're ${Math.round((totalDailyTarget - todayHours) * 10) / 10}h behind your daily target. Time to catch up!`,\n              type: 'target',\n              scheduledFor: reminderTime,\n              sent: false\n            });\n          }\n        }\n      }\n    }\n\n    setNotifications(newNotifications);\n    \n    // Schedule actual browser notifications\n    newNotifications.forEach(notification => {\n      const timeUntilNotification = notification.scheduledFor.getTime() - now.getTime();\n      if (timeUntilNotification > 0) {\n        setTimeout(() => {\n          if (settings.enabled && permission === 'granted') {\n            new Notification(notification.title, {\n              body: notification.message,\n              icon: '/favicon.ico',\n              badge: '/favicon.ico'\n            });\n          }\n        }, timeUntilNotification);\n      }\n    });\n  };\n\n  const calculateStreak = (sessions: StudySession[]): number => {\n    if (sessions.length === 0) return 0;\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const sessionDates = new Set(\n      sessions.map(s => {\n        const date = new Date(s.startTime);\n        date.setHours(0, 0, 0, 0);\n        return date.getTime();\n      })\n    );\n\n    let streak = 0;\n    let currentDate = new Date(today);\n\n    if (!sessionDates.has(currentDate.getTime())) {\n      currentDate.setDate(currentDate.getDate() - 1);\n      if (!sessionDates.has(currentDate.getTime())) {\n        return 0;\n      }\n    }\n\n    while (sessionDates.has(currentDate.getTime())) {\n      streak++;\n      currentDate.setDate(currentDate.getDate() - 1);\n    }\n\n    return streak;\n  };\n\n  return (\n    <div className={`rounded-xl p-6 shadow-md border transition-colors ${\n      isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\n    }`}>\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-3\">\n          {settings.enabled ? (\n            <Bell className={`${isDarkMode ? 'text-green-400' : 'text-green-600'}`} size={24} />\n          ) : (\n            <BellOff className={`${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`} size={24} />\n          )}\n          <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            Smart Notifications\n          </h3>\n        </div>\n        <button\n          onClick={() => setShowSettings(!showSettings)}\n          className={`p-2 rounded-lg transition-colors ${\n            isDarkMode ? 'hover:bg-slate-700 text-slate-300' : 'hover:bg-slate-100 text-slate-600'\n          }`}\n        >\n          <Settings size={20} />\n        </button>\n      </div>\n\n      {permission === 'default' && (\n        <div className={`p-4 rounded-lg border mb-4 ${\n          isDarkMode \n            ? 'bg-blue-900/20 border-blue-700 text-blue-200' \n            : 'bg-blue-50 border-blue-200 text-blue-800'\n        }`}>\n          <p className=\"mb-3\">Enable notifications to get smart study reminders!</p>\n          <button\n            onClick={requestPermission}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            Enable Notifications\n          </button>\n        </div>\n      )}\n\n      {permission === 'denied' && (\n        <div className={`p-4 rounded-lg border mb-4 ${\n          isDarkMode \n            ? 'bg-red-900/20 border-red-700 text-red-200' \n            : 'bg-red-50 border-red-200 text-red-800'\n        }`}>\n          <p>Notifications are blocked. Please enable them in your browser settings to receive study reminders.</p>\n        </div>\n      )}\n\n      {showSettings && (\n        <div className={`p-4 rounded-lg border mb-4 ${\n          isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'\n        }`}>\n          <h4 className={`font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            Notification Settings\n          </h4>\n          \n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Enable Notifications\n              </span>\n              <button\n                onClick={() => setSettings(prev => ({ ...prev, enabled: !prev.enabled }))}\n                className={`w-12 h-6 rounded-full transition-colors ${\n                  settings.enabled ? 'bg-green-500' : isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                }`}\n                disabled={permission !== 'granted'}\n              >\n                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${\n                  settings.enabled ? 'translate-x-6' : 'translate-x-0.5'\n                }`} />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Daily Study Reminders\n              </span>\n              <button\n                onClick={() => setSettings(prev => ({ ...prev, studyReminders: !prev.studyReminders }))}\n                className={`w-12 h-6 rounded-full transition-colors ${\n                  settings.studyReminders ? 'bg-green-500' : isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                }`}\n              >\n                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${\n                  settings.studyReminders ? 'translate-x-6' : 'translate-x-0.5'\n                }`} />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Goal Deadline Alerts\n              </span>\n              <button\n                onClick={() => setSettings(prev => ({ ...prev, goalDeadlines: !prev.goalDeadlines }))}\n                className={`w-12 h-6 rounded-full transition-colors ${\n                  settings.goalDeadlines ? 'bg-green-500' : isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                }`}\n              >\n                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${\n                  settings.goalDeadlines ? 'translate-x-6' : 'translate-x-0.5'\n                }`} />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Streak Reminders\n              </span>\n              <button\n                onClick={() => setSettings(prev => ({ ...prev, streakReminders: !prev.streakReminders }))}\n                className={`w-12 h-6 rounded-full transition-colors ${\n                  settings.streakReminders ? 'bg-green-500' : isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                }`}\n              >\n                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${\n                  settings.streakReminders ? 'translate-x-6' : 'translate-x-0.5'\n                }`} />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <span className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Daily Target Reminders\n              </span>\n              <button\n                onClick={() => setSettings(prev => ({ ...prev, dailyTargetReminders: !prev.dailyTargetReminders }))}\n                className={`w-12 h-6 rounded-full transition-colors ${\n                  settings.dailyTargetReminders ? 'bg-green-500' : isDarkMode ? 'bg-slate-600' : 'bg-slate-300'\n                }`}\n              >\n                <div className={`w-5 h-5 bg-white rounded-full transition-transform ${\n                  settings.dailyTargetReminders ? 'translate-x-6' : 'translate-x-0.5'\n                }`} />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <label className={isDarkMode ? 'text-slate-300' : 'text-slate-700'}>\n                Daily Reminder Time\n              </label>\n              <input\n                type=\"time\"\n                value={settings.reminderTime}\n                onChange={(e) => setSettings(prev => ({ ...prev, reminderTime: e.target.value }))}\n                className={`px-3 py-1 rounded border ${\n                  isDarkMode \n                    ? 'bg-slate-600 border-slate-500 text-white' \n                    : 'bg-white border-slate-300 text-slate-900'\n                }`}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Upcoming Notifications */}\n      <div>\n        <h4 className={`font-semibold mb-3 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n          Upcoming Reminders\n        </h4>\n        \n        {notifications.length === 0 ? (\n          <p className={`text-center py-4 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n            {settings.enabled ? 'No upcoming reminders' : 'Enable notifications to see reminders'}\n          </p>\n        ) : (\n          <div className=\"space-y-2\">\n            {notifications.slice(0, 5).map(notification => (\n              <div\n                key={notification.id}\n                className={`flex items-center gap-3 p-3 rounded-lg ${\n                  isDarkMode ? 'bg-slate-700' : 'bg-slate-50'\n                }`}\n              >\n                <div className={`p-2 rounded-full ${\n                  notification.type === 'reminder' ? 'bg-blue-500/20 text-blue-500' :\n                  notification.type === 'goal' ? 'bg-red-500/20 text-red-500' :\n                  notification.type === 'streak' ? 'bg-orange-500/20 text-orange-500' :\n                  'bg-green-500/20 text-green-500'\n                }`}>\n                  {notification.type === 'reminder' ? <Clock size={16} /> :\n                   notification.type === 'goal' ? <Target size={16} /> :\n                   notification.type === 'streak' ? <Flame size={16} /> :\n                   <Bell size={16} />}\n                </div>\n                <div className=\"flex-1\">\n                  <div className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                    {notification.title}\n                  </div>\n                  <div className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                    {notification.message}\n                  </div>\n                </div>\n                <div className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                  {notification.scheduledFor.toLocaleTimeString('en-US', { \n                    hour: '2-digit', \n                    minute: '2-digit' \n                  })}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\StudyCalendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":2,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used.","line":2,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onScheduleSession' is defined but never used.","line":31,"column":72,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":89},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1338,1341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1338,1341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'date' is defined but never used.","line":364,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":364,"endColumn":30}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { ChevronLeft, ChevronRight, Plus, Clock, Target } from 'lucide-react';\nimport { Subject, StudySession, StudyGoal } from '../types';\n\ninterface StudyCalendarProps {\n  subjects: Subject[];\n  sessions: StudySession[];\n  goals: StudyGoal[];\n  isDarkMode: boolean;\n  onScheduleSession?: (date: Date, subjectId: string, duration: number) => void;\n}\n\ninterface CalendarEvent {\n  id: string;\n  title: string;\n  date: Date;\n  duration: number;\n  type: 'session' | 'goal' | 'scheduled';\n  subjectId?: string;\n  color: string;\n}\n\ninterface ScheduledSession {\n  id: string;\n  date: Date;\n  subjectId: string;\n  duration: number;\n  title: string;\n}\n\nexport function StudyCalendar({ subjects, sessions, goals, isDarkMode, onScheduleSession }: StudyCalendarProps) {\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [scheduledSessions, setScheduledSessions] = useState<ScheduledSession[]>([]);\n  const [showScheduleModal, setShowScheduleModal] = useState(false);\n\n  useEffect(() => {\n    // Load scheduled sessions from localStorage\n    const stored = localStorage.getItem('grind_clock_scheduled_sessions');\n    if (stored) {\n      const parsed = JSON.parse(stored);\n      setScheduledSessions(parsed.map((s: any) => ({\n        ...s,\n        date: new Date(s.date)\n      })));\n    }\n  }, []);\n\n  const saveScheduledSessions = (sessions: ScheduledSession[]) => {\n    setScheduledSessions(sessions);\n    localStorage.setItem('grind_clock_scheduled_sessions', JSON.stringify(sessions));\n  };\n\n  const getDaysInMonth = (date: Date) => {\n    const year = date.getFullYear();\n    const month = date.getMonth();\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n    const daysInMonth = lastDay.getDate();\n    const startingDayOfWeek = firstDay.getDay();\n\n    const days = [];\n    \n    // Add empty cells for days before the first day of the month\n    for (let i = 0; i < startingDayOfWeek; i++) {\n      days.push(null);\n    }\n    \n    // Add all days of the month\n    for (let day = 1; day <= daysInMonth; day++) {\n      days.push(new Date(year, month, day));\n    }\n    \n    return days;\n  };\n\n  const getEventsForDate = (date: Date): CalendarEvent[] => {\n    const events: CalendarEvent[] = [];\n    const dateStr = date.toDateString();\n\n    // Add completed sessions\n    sessions.forEach(session => {\n      if (session.startTime.toDateString() === dateStr) {\n        const subject = subjects.find(s => s.id === session.subjectId);\n        events.push({\n          id: session.id,\n          title: `${subject?.name || 'Unknown'} (${session.durationMinutes}m)`,\n          date: session.startTime,\n          duration: session.durationMinutes || 0,\n          type: 'session',\n          subjectId: session.subjectId,\n          color: subject?.color || '#6b7280'\n        });\n      }\n    });\n\n    // Add goal deadlines\n    goals.forEach(goal => {\n      if (goal.targetDate && goal.targetDate.toDateString() === dateStr && !goal.completed) {\n        events.push({\n          id: goal.id,\n          title: `ðŸ“‹ ${goal.title}`,\n          date: goal.targetDate,\n          duration: 0,\n          type: 'goal',\n          color: '#ef4444'\n        });\n      }\n      \n      if (goal.examDate && goal.examDate.toDateString() === dateStr) {\n        events.push({\n          id: `${goal.id}-exam`,\n          title: `ðŸŽ“ ${goal.title}`,\n          date: goal.examDate,\n          duration: 0,\n          type: 'goal',\n          color: '#8b5cf6'\n        });\n      }\n    });\n\n    // Add scheduled sessions\n    scheduledSessions.forEach(scheduled => {\n      if (scheduled.date.toDateString() === dateStr) {\n        const subject = subjects.find(s => s.id === scheduled.subjectId);\n        events.push({\n          id: scheduled.id,\n          title: `ðŸ“… ${scheduled.title}`,\n          date: scheduled.date,\n          duration: scheduled.duration,\n          type: 'scheduled',\n          subjectId: scheduled.subjectId,\n          color: subject?.color || '#6b7280'\n        });\n      }\n    });\n\n    return events.sort((a, b) => a.date.getTime() - b.date.getTime());\n  };\n\n  const navigateMonth = (direction: 'prev' | 'next') => {\n    setCurrentDate(prev => {\n      const newDate = new Date(prev);\n      if (direction === 'prev') {\n        newDate.setMonth(prev.getMonth() - 1);\n      } else {\n        newDate.setMonth(prev.getMonth() + 1);\n      }\n      return newDate;\n    });\n  };\n\n  const isToday = (date: Date) => {\n    const today = new Date();\n    return date.toDateString() === today.toDateString();\n  };\n\n  const days = getDaysInMonth(currentDate);\n  const monthNames = [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December'\n  ];\n  const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\n  return (\n    <div className={`rounded-xl p-6 shadow-md border transition-colors ${\n      isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\n    }`}>\n      {/* Calendar Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n          Study Calendar\n        </h3>\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={() => navigateMonth('prev')}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-slate-700 text-slate-300' : 'hover:bg-slate-100 text-slate-600'\n            }`}\n          >\n            <ChevronLeft size={20} />\n          </button>\n          <h4 className={`text-lg font-semibold min-w-[200px] text-center ${\n            isDarkMode ? 'text-white' : 'text-slate-900'\n          }`}>\n            {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}\n          </h4>\n          <button\n            onClick={() => navigateMonth('next')}\n            className={`p-2 rounded-lg transition-colors ${\n              isDarkMode ? 'hover:bg-slate-700 text-slate-300' : 'hover:bg-slate-100 text-slate-600'\n            }`}\n          >\n            <ChevronRight size={20} />\n          </button>\n        </div>\n      </div>\n\n      {/* Day Names */}\n      <div className=\"grid grid-cols-7 gap-1 mb-2\">\n        {dayNames.map(day => (\n          <div\n            key={day}\n            className={`text-center text-sm font-medium py-2 ${\n              isDarkMode ? 'text-slate-400' : 'text-slate-600'\n            }`}\n          >\n            {day}\n          </div>\n        ))}\n      </div>\n\n      {/* Calendar Grid */}\n      <div className=\"grid grid-cols-7 gap-1\">\n        {days.map((date, index) => {\n          if (!date) {\n            return <div key={index} className=\"h-24\" />;\n          }\n\n          const events = getEventsForDate(date);\n          const isSelected = selectedDate?.toDateString() === date.toDateString();\n\n          return (\n            <div\n              key={date.toDateString()}\n              onClick={() => setSelectedDate(date)}\n              className={`h-24 p-1 border rounded-lg cursor-pointer transition-all ${\n                isToday(date)\n                  ? isDarkMode\n                    ? 'bg-amber-900/30 border-amber-600'\n                    : 'bg-amber-50 border-amber-300'\n                  : isSelected\n                  ? isDarkMode\n                    ? 'bg-blue-900/30 border-blue-600'\n                    : 'bg-blue-50 border-blue-300'\n                  : isDarkMode\n                  ? 'bg-slate-700 border-slate-600 hover:bg-slate-600'\n                  : 'bg-white border-slate-200 hover:bg-slate-50'\n              }`}\n            >\n              <div className={`text-sm font-medium mb-1 ${\n                isToday(date)\n                  ? 'text-amber-600'\n                  : isDarkMode ? 'text-white' : 'text-slate-900'\n              }`}>\n                {date.getDate()}\n              </div>\n              \n              <div className=\"space-y-1 overflow-hidden\">\n                {events.slice(0, 2).map(event => (\n                  <div\n                    key={event.id}\n                    className=\"text-xs px-1 py-0.5 rounded truncate\"\n                    style={{ backgroundColor: event.color + '20', color: event.color }}\n                    title={event.title}\n                  >\n                    {event.title}\n                  </div>\n                ))}\n                {events.length > 2 && (\n                  <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                    +{events.length - 2} more\n                  </div>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Selected Date Details */}\n      {selectedDate && (\n        <div className={`mt-6 p-4 rounded-lg border ${\n          isDarkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'\n        }`}>\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n              {selectedDate.toLocaleDateString('en-US', { \n                weekday: 'long', \n                year: 'numeric', \n                month: 'long', \n                day: 'numeric' \n              })}\n            </h4>\n            <button\n              onClick={() => setShowScheduleModal(true)}\n              className=\"flex items-center gap-2 px-3 py-1 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-colors text-sm\"\n            >\n              <Plus size={16} />\n              Schedule\n            </button>\n          </div>\n\n          <div className=\"space-y-2\">\n            {getEventsForDate(selectedDate).map(event => (\n              <div\n                key={event.id}\n                className={`flex items-center gap-3 p-2 rounded ${\n                  isDarkMode ? 'bg-slate-600' : 'bg-white'\n                }`}\n              >\n                <div\n                  className=\"w-3 h-3 rounded-full\"\n                  style={{ backgroundColor: event.color }}\n                />\n                <div className=\"flex-1\">\n                  <div className={`font-medium ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n                    {event.title}\n                  </div>\n                  {event.duration > 0 && (\n                    <div className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                      {event.duration} minutes\n                    </div>\n                  )}\n                </div>\n                <div className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                  {event.type === 'session' ? 'âœ“ Completed' : \n                   event.type === 'goal' ? 'ðŸŽ¯ Deadline' : 'ðŸ“… Scheduled'}\n                </div>\n              </div>\n            ))}\n            \n            {getEventsForDate(selectedDate).length === 0 && (\n              <div className={`text-center py-4 ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                No events scheduled for this day\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Schedule Modal */}\n      {showScheduleModal && selectedDate && (\n        <ScheduleModal\n          date={selectedDate}\n          subjects={subjects}\n          isDarkMode={isDarkMode}\n          onClose={() => setShowScheduleModal(false)}\n          onSchedule={(subjectId, duration, title) => {\n            const newSession: ScheduledSession = {\n              id: crypto.randomUUID(),\n              date: selectedDate,\n              subjectId,\n              duration,\n              title\n            };\n            saveScheduledSessions([...scheduledSessions, newSession]);\n            setShowScheduleModal(false);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\ninterface ScheduleModalProps {\n  date: Date;\n  subjects: Subject[];\n  isDarkMode: boolean;\n  onClose: () => void;\n  onSchedule: (subjectId: string, duration: number, title: string) => void;\n}\n\nfunction ScheduleModal({ date, subjects, isDarkMode, onClose, onSchedule }: ScheduleModalProps) {\n  const [selectedSubject, setSelectedSubject] = useState('');\n  const [duration, setDuration] = useState(25);\n  const [title, setTitle] = useState('');\n  const [time, setTime] = useState('09:00');\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (selectedSubject && title) {\n      onSchedule(selectedSubject, duration, title);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className={`rounded-xl p-6 max-w-md w-full ${\n        isDarkMode ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'\n      }`}>\n        <h3 className={`text-lg font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n          Schedule Study Session\n        </h3>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n              Subject\n            </label>\n            <select\n              value={selectedSubject}\n              onChange={(e) => setSelectedSubject(e.target.value)}\n              className={`w-full px-3 py-2 rounded-lg border ${\n                isDarkMode \n                  ? 'bg-slate-700 border-slate-600 text-white' \n                  : 'bg-white border-slate-300 text-slate-900'\n              }`}\n              required\n            >\n              <option value=\"\">Select a subject</option>\n              {subjects.map(subject => (\n                <option key={subject.id} value={subject.id}>\n                  {subject.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n              Session Title\n            </label>\n            <input\n              type=\"text\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              placeholder=\"e.g., Chapter 5 Review\"\n              className={`w-full px-3 py-2 rounded-lg border ${\n                isDarkMode \n                  ? 'bg-slate-700 border-slate-600 text-white placeholder-slate-400' \n                  : 'bg-white border-slate-300 text-slate-900 placeholder-slate-500'\n              }`}\n              required\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                Duration (minutes)\n              </label>\n              <input\n                type=\"number\"\n                value={duration}\n                onChange={(e) => setDuration(parseInt(e.target.value))}\n                min=\"5\"\n                max=\"480\"\n                className={`w-full px-3 py-2 rounded-lg border ${\n                  isDarkMode \n                    ? 'bg-slate-700 border-slate-600 text-white' \n                    : 'bg-white border-slate-300 text-slate-900'\n                }`}\n                required\n              />\n            </div>\n\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                Time\n              </label>\n              <input\n                type=\"time\"\n                value={time}\n                onChange={(e) => setTime(e.target.value)}\n                className={`w-full px-3 py-2 rounded-lg border ${\n                  isDarkMode \n                    ? 'bg-slate-700 border-slate-600 text-white' \n                    : 'bg-white border-slate-300 text-slate-900'\n                }`}\n              />\n            </div>\n          </div>\n\n          <div className=\"flex gap-3 pt-4\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className={`flex-1 px-4 py-2 rounded-lg border transition-colors ${\n                isDarkMode \n                  ? 'border-slate-600 text-slate-300 hover:bg-slate-700' \n                  : 'border-slate-300 text-slate-700 hover:bg-slate-50'\n              }`}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-colors\"\n            >\n              Schedule\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\StudyStreaks.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2526,2529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2526,2529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4083,4086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4083,4086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4575,4578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4575,4578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Flame, Trophy, Target, Calendar, Clock, Brain } from 'lucide-react';\nimport { StudySession } from '../types';\n\ninterface StudyStreaksProps {\n  sessions: StudySession[];\n  isDarkMode: boolean;\n}\n\ninterface Achievement {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ComponentType<{ size?: number; className?: string }>;\n  condition: (sessions: StudySession[]) => boolean;\n  progress?: (sessions: StudySession[]) => { current: number; target: number };\n  unlocked: boolean;\n  unlockedAt?: Date;\n}\n\nconst achievements: Achievement[] = [\n  {\n    id: 'first_session',\n    title: 'Getting Started',\n    description: 'Complete your first study session',\n    icon: Target,\n    condition: (sessions) => sessions.length >= 1,\n    unlocked: false\n  },\n  {\n    id: 'week_warrior',\n    title: 'Week Warrior',\n    description: 'Study for 7 consecutive days',\n    icon: Calendar,\n    condition: (sessions) => calculateStreak(sessions) >= 7,\n    progress: (sessions) => ({ current: Math.min(calculateStreak(sessions), 7), target: 7 }),\n    unlocked: false\n  },\n  {\n    id: 'focus_master',\n    title: 'Focus Master',\n    description: 'Achieve 5-star focus rating 10 times',\n    icon: Brain,\n    condition: (sessions) => sessions.filter(s => s.focusRating === 5).length >= 10,\n    progress: (sessions) => ({ current: Math.min(sessions.filter(s => s.focusRating === 5).length, 10), target: 10 }),\n    unlocked: false\n  },\n  {\n    id: 'marathon_runner',\n    title: 'Marathon Runner',\n    description: 'Complete a 4+ hour study session',\n    icon: Clock,\n    condition: (sessions) => sessions.some(s => (s.durationMinutes || 0) >= 240),\n    unlocked: false\n  },\n  {\n    id: 'consistency_king',\n    title: 'Consistency King',\n    description: 'Study for 30 consecutive days',\n    icon: Flame,\n    condition: (sessions) => calculateStreak(sessions) >= 30,\n    progress: (sessions) => ({ current: Math.min(calculateStreak(sessions), 30), target: 30 }),\n    unlocked: false\n  },\n  {\n    id: 'century_club',\n    title: 'Century Club',\n    description: 'Complete 100 study sessions',\n    icon: Trophy,\n    condition: (sessions) => sessions.length >= 100,\n    progress: (sessions) => ({ current: Math.min(sessions.length, 100), target: 100 }),\n    unlocked: false\n  }\n];\n\nfunction calculateStreak(sessions: StudySession[]): number {\n  if (sessions.length === 0) return 0;\n\n  const sessionDates = new Set(\n    sessions.map(s => {\n      const date = new Date(s.startTime || (s as any).created_at);\n      date.setHours(0, 0, 0, 0);\n      return date.getTime();\n    })\n  );\n\n  let streak = 0;\n  const checkDate = new Date();\n  checkDate.setHours(0, 0, 0, 0);\n\n  // If there's a session today, streak starts at 1 and we check yesterday\n  if (sessionDates.has(checkDate.getTime())) {\n    streak = 1;\n    checkDate.setDate(checkDate.getDate() - 1);\n  } else {\n    // If no session today, check if there was one yesterday to keep streak alive\n    checkDate.setDate(checkDate.getDate() - 1);\n    if (!sessionDates.has(checkDate.getTime())) {\n      return 0;\n    }\n    streak = 1;\n    checkDate.setDate(checkDate.getDate() - 1);\n  }\n\n  // Count backwards from yesterday (or day before yesterday)\n  while (sessionDates.has(checkDate.getTime())) {\n    streak++;\n    checkDate.setDate(checkDate.getDate() - 1);\n  }\n\n  return streak;\n}\n\nexport function StudyStreaks({ sessions, isDarkMode }: StudyStreaksProps) {\n  const [unlockedAchievements, setUnlockedAchievements] = useState<Achievement[]>([]);\n  const [newlyUnlocked, setNewlyUnlocked] = useState<Achievement[]>([]);\n\n  const currentStreak = calculateStreak(sessions);\n  const longestStreak = calculateLongestStreak(sessions);\n\n  useEffect(() => {\n    // Load previously unlocked achievements\n    const stored = localStorage.getItem('grind_clock_achievements');\n    const storedAchievements = stored ? JSON.parse(stored) : [];\n\n    // Check for newly unlocked achievements\n    const updatedAchievements = achievements.map(achievement => {\n      const wasUnlocked = storedAchievements.find((a: any) => a.id === achievement.id);\n      const isNowUnlocked = achievement.condition(sessions);\n\n      if (isNowUnlocked && !wasUnlocked) {\n        return { ...achievement, unlocked: true, unlockedAt: new Date() };\n      } else if (wasUnlocked) {\n        return { ...achievement, unlocked: true, unlockedAt: new Date(wasUnlocked.unlockedAt) };\n      }\n\n      return achievement;\n    });\n\n    const newUnlocked = updatedAchievements.filter(a =>\n      a.unlocked && !storedAchievements.find((s: any) => s.id === a.id)\n    );\n\n    if (newUnlocked.length > 0) {\n      setNewlyUnlocked(newUnlocked);\n      setTimeout(() => setNewlyUnlocked([]), 5000);\n    }\n\n    setUnlockedAchievements(updatedAchievements.filter(a => a.unlocked));\n\n    // Save updated achievements\n    localStorage.setItem('grind_clock_achievements', JSON.stringify(\n      updatedAchievements.filter(a => a.unlocked).map(a => ({ id: a.id, unlockedAt: a.unlockedAt }))\n    ));\n  }, [sessions]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Streak Display */}\n      <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode\n          ? 'bg-gradient-to-br from-orange-900 to-red-900 border-orange-700'\n          : 'bg-gradient-to-br from-orange-50 to-red-50 border-orange-200'\n        }`}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <Flame className={`${isDarkMode ? 'text-orange-400' : 'text-orange-600'}`} size={32} />\n            <div>\n              <h3 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-orange-900'}`}>\n                {currentStreak} Day Streak\n              </h3>\n              <p className={`text-sm ${isDarkMode ? 'text-orange-200' : 'text-orange-700'}`}>\n                Longest: {longestStreak} days\n              </p>\n            </div>\n          </div>\n          <div className={`text-right ${isDarkMode ? 'text-orange-200' : 'text-orange-700'}`}>\n            <div className=\"text-sm\">Keep it going!</div>\n            <div className=\"text-xs\">Study today to maintain your streak</div>\n          </div>\n        </div>\n\n        {/* Streak Visualization */}\n        <div className=\"flex gap-1 overflow-x-auto pb-2\">\n          {Array.from({ length: Math.min(currentStreak, 30) }, (_, i) => (\n            <div\n              key={i}\n              className={`w-3 h-8 rounded-sm ${isDarkMode ? 'bg-orange-500' : 'bg-orange-400'\n                }`}\n              title={`Day ${currentStreak - i}`}\n            />\n          ))}\n          {currentStreak > 30 && (\n            <div className={`px-2 py-1 rounded text-xs ${isDarkMode ? 'bg-orange-700 text-orange-200' : 'bg-orange-200 text-orange-800'}`}>\n              +{currentStreak - 30} more\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Achievements */}\n      <div className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'\n        }`}>\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Trophy className={`${isDarkMode ? 'text-yellow-400' : 'text-yellow-600'}`} size={24} />\n          <h3 className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            Achievements ({unlockedAchievements.length}/{achievements.length})\n          </h3>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {achievements.map((achievement) => {\n            const Icon = achievement.icon;\n            const isUnlocked = unlockedAchievements.some(a => a.id === achievement.id);\n            const progress = achievement.progress ? achievement.progress(sessions) : null;\n\n            return (\n              <div\n                key={achievement.id}\n                className={`p-4 rounded-lg border transition-all ${isUnlocked\n                    ? isDarkMode\n                      ? 'bg-gradient-to-br from-yellow-900/30 to-amber-900/30 border-yellow-600'\n                      : 'bg-gradient-to-br from-yellow-50 to-amber-50 border-yellow-300'\n                    : isDarkMode\n                      ? 'bg-slate-700 border-slate-600 opacity-60'\n                      : 'bg-slate-50 border-slate-200 opacity-60'\n                  }`}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <Icon\n                    size={24}\n                    className={\n                      isUnlocked\n                        ? isDarkMode ? 'text-yellow-400' : 'text-yellow-600'\n                        : isDarkMode ? 'text-slate-500' : 'text-slate-400'\n                    }\n                  />\n                  <div className=\"flex-1\">\n                    <h4 className={`font-semibold ${isUnlocked\n                        ? isDarkMode ? 'text-yellow-200' : 'text-yellow-800'\n                        : isDarkMode ? 'text-slate-400' : 'text-slate-600'\n                      }`}>\n                      {achievement.title}\n                    </h4>\n                    <p className={`text-sm ${isUnlocked\n                        ? isDarkMode ? 'text-yellow-300' : 'text-yellow-700'\n                        : isDarkMode ? 'text-slate-500' : 'text-slate-500'\n                      }`}>\n                      {achievement.description}\n                    </p>\n\n                    {progress && !isUnlocked && (\n                      <div className=\"mt-2\">\n                        <div className=\"flex justify-between text-xs mb-1\">\n                          <span>Progress</span>\n                          <span>{progress.current}/{progress.target}</span>\n                        </div>\n                        <div className={`w-full rounded-full h-2 ${isDarkMode ? 'bg-slate-600' : 'bg-slate-200'}`}>\n                          <div\n                            className=\"bg-gradient-to-r from-amber-500 to-orange-600 h-2 rounded-full transition-all\"\n                            style={{ width: `${(progress.current / progress.target) * 100}%` }}\n                          />\n                        </div>\n                      </div>\n                    )}\n\n                    {isUnlocked && (\n                      <div className={`text-xs mt-1 ${isDarkMode ? 'text-yellow-400' : 'text-yellow-600'}`}>\n                        âœ“ Unlocked\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* New Achievement Notifications */}\n      {newlyUnlocked.map((achievement, index) => (\n        <div\n          key={achievement.id}\n          className=\"fixed top-20 right-6 bg-gradient-to-r from-yellow-500 to-amber-600 text-white px-6 py-4 rounded-xl shadow-2xl animate-bounce z-50 max-w-sm\"\n          style={{ top: `${5 + index * 5}rem` }}\n        >\n          <div className=\"flex items-center gap-3\">\n            <Trophy size={24} />\n            <div>\n              <h3 className=\"font-bold\">Achievement Unlocked!</h3>\n              <p className=\"text-sm text-yellow-100\">{achievement.title}</p>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction calculateLongestStreak(sessions: StudySession[]): number {\n  if (sessions.length === 0) return 0;\n\n  const sessionDates = new Set(\n    sessions.map(s => {\n      const date = new Date(s.startTime);\n      date.setHours(0, 0, 0, 0);\n      return date.getTime();\n    })\n  );\n\n  const sortedDates = Array.from(sessionDates).sort((a, b) => a - b);\n  let maxStreak = 1;\n  let currentStreak = 1;\n\n  for (let i = 1; i < sortedDates.length; i++) {\n    const prevDate = new Date(sortedDates[i - 1]);\n    const currentDate = new Date(sortedDates[i]);\n\n    prevDate.setDate(prevDate.getDate() + 1);\n\n    if (prevDate.getTime() === currentDate.getTime()) {\n      currentStreak++;\n      maxStreak = Math.max(maxStreak, currentStreak);\n    } else {\n      currentStreak = 1;\n    }\n  }\n\n  return maxStreak;\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\StudyTechniques.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Zap' is defined but never used.","line":2,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[585,588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[585,588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[684,687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[684,687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'recommendedTechniques' is never reassigned. Use 'const' instead.","line":336,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":336,"endColumn":30,"fix":{"range":[11609,11729],"text":"const recommendedTechniques = studyTechniques.filter(technique => \n      category.techniques.includes(technique.id)\n    );"}}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { BookOpen, Brain, Clock, Target, Lightbulb, Zap, Users, FileText, Calculator, Beaker, Globe, Palette, Music } from 'lucide-react';\nimport { Subject, StudySession } from '../types';\n\ninterface StudyTechniquesProps {\n  subjects: Subject[];\n  sessions: StudySession[];\n  isDarkMode: boolean;\n}\n\ninterface StudyTechnique {\n  id: string;\n  name: string;\n  description: string;\n  bestFor: string[];\n  timeRequired: string;\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  effectiveness: number;\n  steps: string[];\n  tips: string[];\n  icon: any;\n  color: string;\n}\n\ninterface SubjectCategory {\n  name: string;\n  keywords: string[];\n  icon: any;\n  color: string;\n  techniques: string[];\n}\n\nexport function StudyTechniques({ subjects, sessions, isDarkMode }: StudyTechniquesProps) {\n  const [selectedSubject, setSelectedSubject] = useState<string>('all');\n  const [selectedDifficulty, setSelectedDifficulty] = useState<string>('all');\n\n  const subjectCategories: SubjectCategory[] = [\n    {\n      name: 'Mathematics',\n      keywords: ['math', 'calculus', 'algebra', 'geometry', 'statistics', 'physics'],\n      icon: Calculator,\n      color: 'text-blue-500',\n      techniques: ['practice-problems', 'spaced-repetition', 'concept-mapping', 'peer-teaching']\n    },\n    {\n      name: 'Sciences',\n      keywords: ['biology', 'chemistry', 'physics', 'science', 'lab', 'experiment'],\n      icon: Beaker,\n      color: 'text-green-500',\n      techniques: ['active-recall', 'visual-learning', 'concept-mapping', 'case-studies']\n    },\n    {\n      name: 'Languages',\n      keywords: ['english', 'spanish', 'french', 'language', 'literature', 'writing'],\n      icon: Globe,\n      color: 'text-purple-500',\n      techniques: ['immersion', 'spaced-repetition', 'active-recall', 'peer-teaching']\n    },\n    {\n      name: 'Arts & Humanities',\n      keywords: ['art', 'history', 'philosophy', 'literature', 'music', 'culture'],\n      icon: Palette,\n      color: 'text-pink-500',\n      techniques: ['visual-learning', 'storytelling', 'concept-mapping', 'case-studies']\n    },\n    {\n      name: 'General',\n      keywords: [],\n      icon: BookOpen,\n      color: 'text-gray-500',\n      techniques: ['pomodoro', 'active-recall', 'spaced-repetition', 'concept-mapping']\n    }\n  ];\n\n  const studyTechniques: StudyTechnique[] = [\n    {\n      id: 'pomodoro',\n      name: 'Pomodoro Technique',\n      description: 'Work in focused 25-minute intervals with 5-minute breaks',\n      bestFor: ['Focus improvement', 'Time management', 'Avoiding burnout'],\n      timeRequired: '25-50 minutes',\n      difficulty: 'beginner',\n      effectiveness: 85,\n      steps: [\n        'Choose a task to work on',\n        'Set a timer for 25 minutes',\n        'Work on the task until the timer rings',\n        'Take a 5-minute break',\n        'Repeat 3-4 times, then take a longer 15-30 minute break'\n      ],\n      tips: [\n        'Turn off all distractions during the 25-minute work period',\n        'Use the breaks to stretch, hydrate, or do light movement',\n        'Track how many pomodoros you complete each day'\n      ],\n      icon: Clock,\n      color: 'text-red-500'\n    },\n    {\n      id: 'active-recall',\n      name: 'Active Recall',\n      description: 'Test yourself on material without looking at notes',\n      bestFor: ['Memory retention', 'Exam preparation', 'Long-term learning'],\n      timeRequired: '20-45 minutes',\n      difficulty: 'intermediate',\n      effectiveness: 92,\n      steps: [\n        'Study material for 10-15 minutes',\n        'Close your books and notes',\n        'Write down everything you remember',\n        'Check your notes to see what you missed',\n        'Focus extra attention on forgotten material',\n        'Repeat the process'\n      ],\n      tips: [\n        'Use flashcards or practice questions',\n        'Explain concepts out loud as if teaching someone',\n        'Focus on understanding, not just memorization'\n      ],\n      icon: Brain,\n      color: 'text-purple-500'\n    },\n    {\n      id: 'spaced-repetition',\n      name: 'Spaced Repetition',\n      description: 'Review material at increasing intervals over time',\n      bestFor: ['Long-term retention', 'Vocabulary', 'Facts and formulas'],\n      timeRequired: '15-30 minutes daily',\n      difficulty: 'intermediate',\n      effectiveness: 88,\n      steps: [\n        'Learn new material thoroughly',\n        'Review after 1 day',\n        'Review after 3 days',\n        'Review after 1 week',\n        'Review after 2 weeks',\n        'Continue with increasing intervals'\n      ],\n      tips: [\n        'Use apps like Anki or create a simple schedule',\n        'Focus more time on difficult concepts',\n        'Be consistent with daily reviews'\n      ],\n      icon: Target,\n      color: 'text-green-500'\n    },\n    {\n      id: 'concept-mapping',\n      name: 'Concept Mapping',\n      description: 'Create visual diagrams showing relationships between ideas',\n      bestFor: ['Complex topics', 'Visual learners', 'Understanding connections'],\n      timeRequired: '30-60 minutes',\n      difficulty: 'intermediate',\n      effectiveness: 78,\n      steps: [\n        'Identify the main concept or topic',\n        'List related subtopics and concepts',\n        'Draw connections between related ideas',\n        'Use colors and symbols to categorize',\n        'Add examples and details to each concept',\n        'Review and refine the map'\n      ],\n      tips: [\n        'Start with pen and paper, then digitize if needed',\n        'Use different colors for different types of relationships',\n        'Keep it simple and avoid overcrowding'\n      ],\n      icon: Lightbulb,\n      color: 'text-yellow-500'\n    },\n    {\n      id: 'practice-problems',\n      name: 'Practice Problems',\n      description: 'Solve problems similar to those you\\'ll encounter on exams',\n      bestFor: ['Math and sciences', 'Skill development', 'Exam preparation'],\n      timeRequired: '45-90 minutes',\n      difficulty: 'beginner',\n      effectiveness: 90,\n      steps: [\n        'Start with easier problems to build confidence',\n        'Work through problems step-by-step',\n        'Check your answers and understand mistakes',\n        'Gradually increase difficulty',\n        'Time yourself on practice exams',\n        'Focus on problem-solving strategies'\n      ],\n      tips: [\n        'Don\\'t just memorize solutions, understand the process',\n        'Create a problem bank for regular practice',\n        'Explain your solution process out loud'\n      ],\n      icon: Calculator,\n      color: 'text-blue-500'\n    },\n    {\n      id: 'peer-teaching',\n      name: 'Peer Teaching',\n      description: 'Explain concepts to others or study in groups',\n      bestFor: ['Deep understanding', 'Communication skills', 'Social learners'],\n      timeRequired: '60-120 minutes',\n      difficulty: 'advanced',\n      effectiveness: 85,\n      steps: [\n        'Form a study group with 2-4 people',\n        'Assign different topics to each person',\n        'Prepare to teach your assigned topic',\n        'Take turns explaining concepts to the group',\n        'Ask questions and discuss difficult points',\n        'Quiz each other on the material'\n      ],\n      tips: [\n        'Choose study partners who are committed',\n        'Prepare thoroughly before group sessions',\n        'Don\\'t let social time dominate study time'\n      ],\n      icon: Users,\n      color: 'text-indigo-500'\n    },\n    {\n      id: 'visual-learning',\n      name: 'Visual Learning',\n      description: 'Use diagrams, charts, and visual aids to understand concepts',\n      bestFor: ['Visual learners', 'Complex processes', 'Data interpretation'],\n      timeRequired: '30-60 minutes',\n      difficulty: 'beginner',\n      effectiveness: 75,\n      steps: [\n        'Convert text information into visual formats',\n        'Create flowcharts for processes',\n        'Use colors and symbols consistently',\n        'Draw diagrams and illustrations',\n        'Make infographics or posters',\n        'Use visual mnemonics for memory'\n      ],\n      tips: [\n        'Don\\'t worry about artistic quality, focus on clarity',\n        'Use online tools for digital visual aids',\n        'Combine visuals with other study methods'\n      ],\n      icon: Palette,\n      color: 'text-pink-500'\n    },\n    {\n      id: 'case-studies',\n      name: 'Case Study Analysis',\n      description: 'Apply theoretical knowledge to real-world scenarios',\n      bestFor: ['Applied learning', 'Critical thinking', 'Professional subjects'],\n      timeRequired: '60-90 minutes',\n      difficulty: 'advanced',\n      effectiveness: 82,\n      steps: [\n        'Read the case study thoroughly',\n        'Identify key issues and problems',\n        'Apply relevant theories and concepts',\n        'Analyze different perspectives',\n        'Develop solutions or recommendations',\n        'Present your analysis clearly'\n      ],\n      tips: [\n        'Look for patterns across different cases',\n        'Connect theory to practical applications',\n        'Consider multiple solutions and their trade-offs'\n      ],\n      icon: FileText,\n      color: 'text-orange-500'\n    },\n    {\n      id: 'immersion',\n      name: 'Immersion Learning',\n      description: 'Surround yourself with the subject matter in daily life',\n      bestFor: ['Languages', 'Cultural studies', 'Skill development'],\n      timeRequired: 'Throughout the day',\n      difficulty: 'advanced',\n      effectiveness: 88,\n      steps: [\n        'Change device languages to target language',\n        'Watch movies/shows in the subject area',\n        'Listen to podcasts or music related to the topic',\n        'Join online communities or forums',\n        'Practice thinking in the target language/subject',\n        'Use the subject in daily conversations'\n      ],\n      tips: [\n        'Start gradually and increase exposure over time',\n        'Keep a vocabulary journal for new terms',\n        'Don\\'t be afraid to make mistakes'\n      ],\n      icon: Globe,\n      color: 'text-teal-500'\n    },\n    {\n      id: 'storytelling',\n      name: 'Storytelling Method',\n      description: 'Create narratives to remember facts and concepts',\n      bestFor: ['History', 'Literature', 'Sequential information'],\n      timeRequired: '30-45 minutes',\n      difficulty: 'intermediate',\n      effectiveness: 73,\n      steps: [\n        'Identify key facts or events to remember',\n        'Create a logical sequence or timeline',\n        'Add characters, emotions, and vivid details',\n        'Connect events with cause and effect',\n        'Practice telling the story out loud',\n        'Refine and embellish the narrative'\n      ],\n      tips: [\n        'Make stories personal and emotionally engaging',\n        'Use humor and unusual details for better recall',\n        'Create visual scenes in your mind'\n      ],\n      icon: Music,\n      color: 'text-rose-500'\n    }\n  ];\n\n  const getSubjectCategory = (subject: Subject): SubjectCategory => {\n    const subjectName = subject.name.toLowerCase();\n    \n    for (const category of subjectCategories) {\n      if (category.keywords.some(keyword => subjectName.includes(keyword))) {\n        return category;\n      }\n    }\n    \n    return subjectCategories[subjectCategories.length - 1]; // Return 'General' as default\n  };\n\n  const getRecommendedTechniques = (subject?: Subject): StudyTechnique[] => {\n    if (!subject) return studyTechniques;\n    \n    const category = getSubjectCategory(subject);\n    const subjectSessions = sessions.filter(s => s.subjectId === subject.id);\n    \n    // Get base techniques for the subject category\n    let recommendedTechniques = studyTechniques.filter(technique => \n      category.techniques.includes(technique.id)\n    );\n\n    // Add performance-based recommendations\n    if (subjectSessions.length > 0) {\n      const avgFocus = subjectSessions.filter(s => s.focusRating).length > 0\n        ? subjectSessions.reduce((sum, s) => sum + (s.focusRating || 0), 0) / subjectSessions.filter(s => s.focusRating).length\n        : 0;\n      \n      const avgSessionLength = subjectSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0) / subjectSessions.length;\n\n      // If focus is low, recommend Pomodoro\n      if (avgFocus < 3 && !recommendedTechniques.find(t => t.id === 'pomodoro')) {\n        recommendedTechniques.unshift(studyTechniques.find(t => t.id === 'pomodoro')!);\n      }\n\n      // If sessions are very long, recommend active recall\n      if (avgSessionLength > 90 && !recommendedTechniques.find(t => t.id === 'active-recall')) {\n        recommendedTechniques.push(studyTechniques.find(t => t.id === 'active-recall')!);\n      }\n    }\n\n    // Add difficulty-based recommendations\n    if (subject.difficulty >= 4) {\n      // High difficulty subjects benefit from spaced repetition and active recall\n      ['spaced-repetition', 'active-recall'].forEach(techniqueId => {\n        if (!recommendedTechniques.find(t => t.id === techniqueId)) {\n          const technique = studyTechniques.find(t => t.id === techniqueId);\n          if (technique) recommendedTechniques.push(technique);\n        }\n      });\n    }\n\n    return recommendedTechniques.slice(0, 6); // Limit to 6 recommendations\n  };\n\n  const filteredSubjects = selectedSubject === 'all' ? subjects : subjects.filter(s => s.id === selectedSubject);\n  const filteredTechniques = selectedDifficulty === 'all' \n    ? studyTechniques \n    : studyTechniques.filter(t => t.difficulty === selectedDifficulty);\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case 'beginner': return 'text-green-500 bg-green-100 dark:bg-green-900/20';\n      case 'intermediate': return 'text-yellow-500 bg-yellow-100 dark:bg-yellow-900/20';\n      case 'advanced': return 'text-red-500 bg-red-100 dark:bg-red-900/20';\n      default: return 'text-gray-500 bg-gray-100 dark:bg-gray-900/20';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center space-x-3\">\n        <Lightbulb className=\"w-8 h-8 text-yellow-500\" />\n        <div>\n          <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n            Study Techniques\n          </h2>\n          <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n            Discover effective study methods tailored to your subjects\n          </p>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n            Filter by Subject\n          </label>\n          <select\n            value={selectedSubject}\n            onChange={(e) => setSelectedSubject(e.target.value)}\n            className={`w-full px-3 py-2 rounded-lg border ${\n              isDarkMode \n                ? 'bg-gray-700 border-gray-600 text-white' \n                : 'bg-white border-gray-300 text-gray-900'\n            } focus:ring-2 focus:ring-blue-500 focus:border-transparent`}\n          >\n            <option value=\"all\">All Subjects</option>\n            {subjects.map(subject => (\n              <option key={subject.id} value={subject.id}>\n                {subject.name}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div className=\"flex-1\">\n          <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n            Filter by Difficulty\n          </label>\n          <select\n            value={selectedDifficulty}\n            onChange={(e) => setSelectedDifficulty(e.target.value)}\n            className={`w-full px-3 py-2 rounded-lg border ${\n              isDarkMode \n                ? 'bg-gray-700 border-gray-600 text-white' \n                : 'bg-white border-gray-300 text-gray-900'\n            } focus:ring-2 focus:ring-blue-500 focus:border-transparent`}\n          >\n            <option value=\"all\">All Levels</option>\n            <option value=\"beginner\">Beginner</option>\n            <option value=\"intermediate\">Intermediate</option>\n            <option value=\"advanced\">Advanced</option>\n          </select>\n        </div>\n      </div>\n\n      {/* Subject-Specific Recommendations */}\n      {selectedSubject !== 'all' && (\n        <div className={`p-6 rounded-lg ${isDarkMode ? 'bg-gray-800' : 'bg-blue-50'} border ${isDarkMode ? 'border-gray-700' : 'border-blue-200'}`}>\n          {filteredSubjects.map(subject => {\n            const category = getSubjectCategory(subject);\n            const recommendedTechniques = getRecommendedTechniques(subject);\n            const IconComponent = category.icon;\n\n            return (\n              <div key={subject.id}>\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <IconComponent className={`w-6 h-6 ${category.color}`} />\n                  <div>\n                    <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n                      Recommended for {subject.name}\n                    </h3>\n                    <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                      Category: {category.name} â€¢ Difficulty: {subject.difficulty}/5\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {recommendedTechniques.slice(0, 6).map(technique => {\n                    const TechniqueIcon = technique.icon;\n                    return (\n                      <div\n                        key={technique.id}\n                        className={`p-4 rounded-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-200'}`}\n                      >\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <TechniqueIcon className={`w-5 h-5 ${technique.color}`} />\n                          <h4 className={`font-medium ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n                            {technique.name}\n                          </h4>\n                        </div>\n                        <p className={`text-sm mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                          {technique.description}\n                        </p>\n                        <div className=\"flex items-center justify-between\">\n                          <span className={`text-xs px-2 py-1 rounded-full ${getDifficultyColor(technique.difficulty)}`}>\n                            {technique.difficulty}\n                          </span>\n                          <span className={`text-xs ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                            {technique.effectiveness}% effective\n                          </span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* All Techniques */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {filteredTechniques.map(technique => {\n          const IconComponent = technique.icon;\n          return (\n            <div\n              key={technique.id}\n              className={`p-6 rounded-lg border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} hover:shadow-lg transition-shadow`}\n            >\n              {/* Header */}\n              <div className=\"flex items-start justify-between mb-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <IconComponent className={`w-6 h-6 ${technique.color}`} />\n                  <div>\n                    <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n                      {technique.name}\n                    </h3>\n                    <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n                      {technique.timeRequired}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <span className={`text-xs px-2 py-1 rounded-full ${getDifficultyColor(technique.difficulty)}`}>\n                    {technique.difficulty}\n                  </span>\n                  <div className={`text-sm font-medium ${isDarkMode ? 'text-green-400' : 'text-green-600'}`}>\n                    {technique.effectiveness}%\n                  </div>\n                </div>\n              </div>\n\n              {/* Description */}\n              <p className={`mb-4 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                {technique.description}\n              </p>\n\n              {/* Best For */}\n              <div className=\"mb-4\">\n                <h4 className={`text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  Best for:\n                </h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {technique.bestFor.map((item, index) => (\n                    <span\n                      key={index}\n                      className={`text-xs px-2 py-1 rounded-full ${isDarkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'}`}\n                    >\n                      {item}\n                    </span>\n                  ))}\n                </div>\n              </div>\n\n              {/* Steps */}\n              <div className=\"mb-4\">\n                <h4 className={`text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  How to do it:\n                </h4>\n                <ol className=\"space-y-1\">\n                  {technique.steps.map((step, index) => (\n                    <li key={index} className={`text-sm flex ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                      <span className={`mr-2 font-medium ${technique.color}`}>\n                        {index + 1}.\n                      </span>\n                      {step}\n                    </li>\n                  ))}\n                </ol>\n              </div>\n\n              {/* Tips */}\n              <div>\n                <h4 className={`text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>\n                  ðŸ’¡ Pro Tips:\n                </h4>\n                <ul className=\"space-y-1\">\n                  {technique.tips.map((tip, index) => (\n                    <li key={index} className={`text-sm flex ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                      <span className=\"mr-2\">â€¢</span>\n                      {tip}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {filteredTechniques.length === 0 && (\n        <div className={`p-8 rounded-lg text-center ${isDarkMode ? 'bg-gray-800' : 'bg-white'} border ${isDarkMode ? 'border-gray-700' : 'border-gray-200'}`}>\n          <BookOpen className={`w-16 h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`} />\n          <h3 className={`text-xl font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n            No techniques found\n          </h3>\n          <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>\n            Try adjusting your filters to see more study techniques.\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\StudyTimer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\SubjectManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":2,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":58}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Plus, BookOpen, Trash2, Edit2, Clock, TrendingUp } from 'lucide-react';\nimport { Subject, StudySession } from '../types';\n\ninterface SubjectManagerProps {\n  subjects: Subject[];\n  sessions: StudySession[];\n  onAddSubject: (subject: Omit<Subject, 'id'>) => void;\n  onUpdateSubject: (id: string, subject: Partial<Subject>) => void;\n  onDeleteSubject: (id: string) => void;\n  isDarkMode: boolean;\n}\n\nconst COLORS = [\n  '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',\n  '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1'\n];\n\nexport function SubjectManager({\n  subjects,\n  sessions,\n  onAddSubject,\n  onUpdateSubject,\n  onDeleteSubject,\n  isDarkMode,\n}: SubjectManagerProps) {\n  const [isAdding, setIsAdding] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [formData, setFormData] = useState({\n    name: '',\n    color: COLORS[0],\n    difficulty: 3,\n    priority: 3,\n    targetHoursPerWeek: 5,\n    targetHoursPerDay: 1,\n  });\n\n  // Calculate time spent for each subject\n  const getSubjectStats = (subjectId: string) => {\n    const subjectSessions = sessions.filter(session => \n      session.subjectId === subjectId && session.completed\n    );\n    \n    const totalMinutes = subjectSessions.reduce((total, session) => \n      total + (session.durationMinutes || 0), 0\n    );\n    \n    const totalHours = Math.round(totalMinutes / 60 * 10) / 10;\n    const sessionCount = subjectSessions.length;\n    \n    // Calculate this week's hours\n    const oneWeekAgo = new Date();\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n    \n    const thisWeekMinutes = subjectSessions\n      .filter(session => new Date(session.startTime) >= oneWeekAgo)\n      .reduce((total, session) => total + (session.durationMinutes || 0), 0);\n    \n    const thisWeekHours = Math.round(thisWeekMinutes / 60 * 10) / 10;\n    \n    return {\n      totalHours,\n      sessionCount,\n      thisWeekHours,\n    };\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingId) {\n      onUpdateSubject(editingId, formData);\n      setEditingId(null);\n    } else {\n      onAddSubject(formData);\n    }\n    setFormData({\n      name: '',\n      color: COLORS[0],\n      difficulty: 3,\n      priority: 3,\n      targetHoursPerWeek: 5,\n      targetHoursPerDay: 1,\n    });\n    setIsAdding(false);\n  };\n\n  const handleEdit = (subject: Subject) => {\n    setFormData({\n      name: subject.name,\n      color: subject.color,\n      difficulty: subject.difficulty,\n      priority: subject.priority,\n      targetHoursPerWeek: subject.targetHoursPerWeek,\n      targetHoursPerDay: subject.targetHoursPerDay || 1,\n    });\n    setEditingId(subject.id);\n    setIsAdding(true);\n  };\n\n  const handleCancel = () => {\n    setIsAdding(false);\n    setEditingId(null);\n    setFormData({\n      name: '',\n      color: COLORS[0],\n      difficulty: 3,\n      priority: 3,\n      targetHoursPerWeek: 5,\n      targetHoursPerDay: 1,\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>My Subjects</h2>\n        {!isAdding && (\n          <button\n            onClick={() => setIsAdding(true)}\n            className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-colors\"\n          >\n            <Plus size={20} />\n            Add Subject\n          </button>\n        )}\n      </div>\n\n      {isAdding && (\n        <form onSubmit={handleSubmit} className={`rounded-xl p-6 shadow-md border transition-colors ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\n            {editingId ? 'Edit Subject' : 'New Subject'}\n          </h3>\n          <div className=\"space-y-4\">\n            <div>\n              <label className={`block text-sm font-medium mb-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                Subject Name\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${isDarkMode ? 'bg-slate-700 border-slate-600 text-white placeholder-slate-400' : 'border-slate-300'}`}\n                placeholder=\"e.g., Mathematics\"\n              />\n            </div>\n\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                Color\n              </label>\n              <div className=\"flex gap-2 flex-wrap\">\n                {COLORS.map((color) => (\n                  <button\n                    key={color}\n                    type=\"button\"\n                    onClick={() => setFormData({ ...formData, color })}\n                    className={`w-10 h-10 rounded-lg transition-all ${\n                      formData.color === color ? 'ring-2 ring-offset-2 ring-slate-400 scale-110' : ''\n                    }`}\n                    style={{ backgroundColor: color }}\n                  />\n                ))}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <label className={`block text-sm font-medium mb-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                  Difficulty (1-5)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"5\"\n                  required\n                  value={formData.difficulty}\n                  onChange={(e) => setFormData({ ...formData, difficulty: parseInt(e.target.value) })}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${isDarkMode ? 'bg-slate-700 border-slate-600 text-white' : 'border-slate-300'}`}\n                />\n              </div>\n\n              <div>\n                <label className={`block text-sm font-medium mb-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                  Priority (1-5)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"5\"\n                  required\n                  value={formData.priority}\n                  onChange={(e) => setFormData({ ...formData, priority: parseInt(e.target.value) })}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${isDarkMode ? 'bg-slate-700 border-slate-600 text-white' : 'border-slate-300'}`}\n                />\n              </div>\n\n              <div>\n                <label className={`block text-sm font-medium mb-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                  Target hrs/week\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  required\n                  value={formData.targetHoursPerWeek}\n                  onChange={(e) => setFormData({ ...formData, targetHoursPerWeek: parseInt(e.target.value) })}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${isDarkMode ? 'bg-slate-700 border-slate-600 text-white' : 'border-slate-300'}`}\n                />\n              </div>\n\n              <div>\n                <label className={`block text-sm font-medium mb-1 ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                  Target hrs/day\n                </label>\n                <select\n                  value={formData.targetHoursPerDay}\n                  onChange={(e) => setFormData({ ...formData, targetHoursPerDay: parseFloat(e.target.value) })}\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent ${isDarkMode ? 'bg-slate-700 border-slate-600 text-white' : 'border-slate-300'}`}\n                >\n                  <option value={0.5}>30 min</option>\n                  <option value={1}>1 hour</option>\n                  <option value={1.5}>1.5 hours</option>\n                  <option value={2}>2 hours</option>\n                  <option value={2.5}>2.5 hours</option>\n                  <option value={3}>3 hours</option>\n                  <option value={3.5}>3.5 hours</option>\n                  <option value={4}>4 hours</option>\n                  <option value={4.5}>4.5 hours</option>\n                  <option value={5}>5 hours</option>\n                  <option value={6}>6 hours</option>\n                  <option value={8}>8 hours</option>\n                </select>\n              </div>\n            </div>\n\n            <div className=\"flex gap-2\">\n              <button\n                type=\"submit\"\n                className=\"flex-1 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-colors\"\n              >\n                {editingId ? 'Update' : 'Add'} Subject\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                className={`px-4 py-2 rounded-lg transition-colors ${isDarkMode ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'}`}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </form>\n      )}\n\n      {subjects.length === 0 ? (\n        <div className={`rounded-xl p-12 shadow-md border text-center ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>\n          <BookOpen className={`mx-auto mb-4 ${isDarkMode ? 'text-slate-600' : 'text-slate-400'}`} size={48} />\n          <p className={`${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>No subjects yet. Add your first subject to get started!</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {subjects.map((subject) => (\n            <div\n              key={subject.id}\n              className={`rounded-xl p-6 shadow-md border hover:shadow-lg transition-all ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex items-center gap-2\">\n                  <div\n                    className=\"w-4 h-4 rounded-full\"\n                    style={{ backgroundColor: subject.color }}\n                  />\n                  <h3 className={`font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>{subject.name}</h3>\n                </div>\n                <div className=\"flex gap-1\">\n                  <button\n                    onClick={() => handleEdit(subject)}\n                    className={`p-1 transition-colors ${isDarkMode ? 'text-slate-500 hover:text-amber-400' : 'text-slate-400 hover:text-blue-600'}`}\n                  >\n                    <Edit2 size={16} />\n                  </button>\n                  <button\n                    onClick={() => onDeleteSubject(subject.id)}\n                    className={`p-1 transition-colors ${isDarkMode ? 'text-slate-500 hover:text-red-400' : 'text-slate-400 hover:text-red-600'}`}\n                  >\n                    <Trash2 size={16} />\n                  </button>\n                </div>\n              </div>\n              {(() => {\n                const stats = getSubjectStats(subject.id);\n                const weeklyProgress = subject.targetHoursPerWeek > 0 \n                  ? Math.min((stats.thisWeekHours / subject.targetHoursPerWeek) * 100, 100)\n                  : 0;\n                \n                return (\n                  <div className=\"space-y-3\">\n                    {/* Time Spent Section */}\n                    <div className={`p-3 rounded-lg ${isDarkMode ? 'bg-slate-700' : 'bg-slate-50'}`}>\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <Clock className=\"text-amber-500\" size={16} />\n                        <span className={`text-sm font-medium ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                          Time Spent\n                        </span>\n                      </div>\n                      <div className={`space-y-1 text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                        <div className=\"flex justify-between\">\n                          <span>Total:</span>\n                          <span className=\"font-medium\">{stats.totalHours}h ({stats.sessionCount} sessions)</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span>This week:</span>\n                          <span className=\"font-medium\">{stats.thisWeekHours}h</span>\n                        </div>\n                      </div>\n                      \n                      {/* Weekly Progress Bar */}\n                      <div className=\"mt-2\">\n                        <div className=\"flex justify-between items-center mb-1\">\n                          <span className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                            Weekly Goal\n                          </span>\n                          <span className={`text-xs font-medium ${\n                            weeklyProgress >= 100 \n                              ? 'text-green-500' \n                              : weeklyProgress >= 75 \n                                ? 'text-amber-500' \n                                : 'text-slate-500'\n                          }`}>\n                            {Math.round(weeklyProgress)}%\n                          </span>\n                        </div>\n                        <div className={`w-full rounded-full h-2 ${isDarkMode ? 'bg-slate-600' : 'bg-slate-200'}`}>\n                          <div\n                            className={`h-full rounded-full transition-all duration-300 ${\n                              weeklyProgress >= 100 \n                                ? 'bg-gradient-to-r from-green-500 to-emerald-600' \n                                : 'bg-gradient-to-r from-amber-500 to-orange-600'\n                            }`}\n                            style={{ width: `${weeklyProgress}%` }}\n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Subject Details */}\n                    <div className={`space-y-2 text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                      <div className=\"flex justify-between\">\n                        <span>Difficulty:</span>\n                        <span className=\"font-medium\">{'â­'.repeat(subject.difficulty)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Priority:</span>\n                        <span className=\"font-medium\">{'ðŸ”¥'.repeat(subject.priority)}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>Target:</span>\n                        <span className=\"font-medium\">{subject.targetHoursPerWeek}h/week</span>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })()}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ToastNotification.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\UserProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronDown' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle' is defined but never used.","line":2,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'variant' is assigned a value but never used.","line":26,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":50},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserProfile'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserProfile, user]","fix":{"range":[986,992],"text":"[loadUserProfile, user]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { User, ChevronDown, Mail, Phone, Settings, CheckCircle, AlertCircle } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ninterface UserProfileProps {\r\n  isDarkMode: boolean;\r\n  variant?: 'sidebar' | 'header';\r\n  onSettingsClick?: () => void;\r\n}\r\n\r\ninterface ProfileData {\r\n  full_name?: string;\r\n  avatar_url?: string;\r\n  phone_number?: string;\r\n  gender?: string;\r\n  role?: 'student' | 'mentor';\r\n  profession?: string;\r\n  experience?: string;\r\n  class?: string;\r\n  course?: string;\r\n  age?: number;\r\n  username?: string;\r\n}\r\n\r\nexport function UserProfile({ isDarkMode, variant = 'header', onSettingsClick }: UserProfileProps) {\r\n  const { user } = useAuth();\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const [profile, setProfile] = useState<ProfileData>({});\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadUserProfile();\r\n    }\r\n  }, [user]);\r\n\r\n  const loadUserProfile = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .select('*')\r\n        .eq('user_id', user?.id)\r\n        .single();\r\n\r\n      if (!error && data) {\r\n        setProfile(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading user profile:', error);\r\n    }\r\n  };\r\n\r\n  const displayName = profile.full_name || user?.email?.split('@')[0] || 'User';\r\n\r\n  // Check if profile is complete\r\n  const getIncompleteFields = () => {\r\n    const incomplete: string[] = [];\r\n    if (!profile.full_name) incomplete.push('Full Name');\r\n    if (!profile.phone_number) incomplete.push('Phone Number');\r\n    if (!profile.gender) incomplete.push('Gender');\r\n    \r\n    if (profile.role === 'mentor') {\r\n      if (!profile.profession) incomplete.push('Profession');\r\n      if (!profile.experience) incomplete.push('Experience');\r\n    } else {\r\n      if (!profile.class) incomplete.push('Class');\r\n      if (!profile.course) incomplete.push('Course');\r\n      if (!profile.age) incomplete.push('Age');\r\n    }\r\n    \r\n    return incomplete;\r\n  };\r\n\r\n  const incompleteFields = getIncompleteFields();\r\n  const isComplete = incompleteFields.length === 0;\r\n\r\n  // Header variant - profile icon with detailed dropdown\r\n  return (\r\n    <div className=\"relative\">\r\n      <button\r\n        onClick={() => setShowDropdown(!showDropdown)}\r\n        className={`p-2 rounded-lg transition-all relative ${\r\n          isDarkMode \r\n            ? 'text-slate-300 hover:bg-slate-700' \r\n            : 'text-slate-600 hover:bg-slate-100'\r\n        }`}\r\n        title={displayName}\r\n      >\r\n        <div className={`w-12 h-12 rounded-full overflow-hidden flex items-center justify-center ${\r\n          isDarkMode ? 'bg-slate-700' : 'bg-slate-200'\r\n        }`}>\r\n          {profile.avatar_url ? (\r\n            <img src={profile.avatar_url} alt={displayName} className=\"w-full h-full object-cover\" />\r\n          ) : (\r\n            <User size={26} />\r\n          )}\r\n        </div>\r\n        {!isComplete && (\r\n          <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-800\">\r\n            <span className=\"text-white text-xs font-bold\">!</span>\r\n          </div>\r\n        )}\r\n      </button>\r\n\r\n      {showDropdown && (\r\n        <>\r\n          <div \r\n            className=\"fixed inset-0 z-10\" \r\n            onClick={() => setShowDropdown(false)}\r\n          />\r\n          <div className={`absolute right-0 top-full mt-2 w-80 rounded-xl shadow-2xl border z-20 ${\r\n            isDarkMode \r\n              ? 'bg-slate-800 border-slate-700' \r\n              : 'bg-white border-slate-200'\r\n          }`}>\r\n            {/* Header */}\r\n            <div className={`p-4 border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className={`w-16 h-16 rounded-full overflow-hidden flex items-center justify-center ${\r\n                  isDarkMode ? 'bg-slate-700' : 'bg-slate-200'\r\n                }`}>\r\n                  {profile.avatar_url ? (\r\n                    <img src={profile.avatar_url} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <User size={32} />\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <p className={`text-base font-bold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                    {displayName}\r\n                  </p>\r\n                  {profile.username && (\r\n                    <p className={`text-sm ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                      @{profile.username}\r\n                    </p>\r\n                  )}\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>\r\n                    {user?.email}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Profile Status - Only show if incomplete */}\r\n            {!isComplete && (\r\n              <div className={`p-4 border-b ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n                <div>\r\n                  <div className=\"flex items-center gap-2 text-amber-500 mb-2\">\r\n                    <AlertCircle size={18} />\r\n                    <span className=\"text-sm font-medium\">Profile Incomplete</span>\r\n                  </div>\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`}>\r\n                    Missing: {incompleteFields.join(', ')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Profile Details */}\r\n            <div className=\"p-4 space-y-3\">\r\n              <div className=\"flex items-start gap-3\">\r\n                <Mail size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                <div className=\"flex-1\">\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Email</p>\r\n                  <p className={`text-sm ${isDarkMode ? 'text-slate-300' : 'text-slate-700'}`}>\r\n                    {user?.email || 'Not set'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-start gap-3\">\r\n                <Phone size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                <div className=\"flex-1\">\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Phone</p>\r\n                  <p className={`text-sm ${profile.phone_number ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                    {profile.phone_number || 'Not set'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-start gap-3\">\r\n                <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                <div className=\"flex-1\">\r\n                  <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Gender</p>\r\n                  <p className={`text-sm ${profile.gender ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                    {profile.gender ? profile.gender.charAt(0).toUpperCase() + profile.gender.slice(1) : 'Not set'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {profile.role === 'mentor' ? (\r\n                <>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                    <div className=\"flex-1\">\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Profession</p>\r\n                      <p className={`text-sm ${profile.profession ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                        {profile.profession || 'Not set'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                    <div className=\"flex-1\">\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Experience</p>\r\n                      <p className={`text-sm ${profile.experience ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                        {profile.experience || 'Not set'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                    <div className=\"flex-1\">\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Class</p>\r\n                      <p className={`text-sm ${profile.class ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                        {profile.class || 'Not set'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                    <div className=\"flex-1\">\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Course</p>\r\n                      <p className={`text-sm ${profile.course ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                        {profile.course || 'Not set'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <User size={16} className={`mt-0.5 ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`} />\r\n                    <div className=\"flex-1\">\r\n                      <p className={`text-xs ${isDarkMode ? 'text-slate-500' : 'text-slate-500'}`}>Age</p>\r\n                      <p className={`text-sm ${profile.age ? (isDarkMode ? 'text-slate-300' : 'text-slate-700') : 'text-amber-500'}`}>\r\n                        {profile.age ? `${profile.age} years` : 'Not set'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n            {/* Action Button */}\r\n            <div className={`p-4 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n              <button\r\n                onClick={() => {\r\n                  setShowDropdown(false);\r\n                  if (onSettingsClick) onSettingsClick();\r\n                }}\r\n                className=\"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg font-medium hover:from-amber-600 hover:to-orange-700 transition-all\"\r\n              >\r\n                <Settings size={16} />\r\n                {isComplete ? 'Edit Profile' : 'Complete Profile'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\VideoCall.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'cleanupCall' and 'initializeCall'. Either include them or remove the dependency array.","line":57,"column":8,"nodeType":"ArrayExpression","endLine":57,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [cleanupCall, initializeCall]","fix":{"range":[2360,2362],"text":"[cleanupCall, initializeCall]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3974,3977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3974,3977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5509,5512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5509,5512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'videoErr' is defined but never used.","line":150,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":150,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'audioErr' is defined but never used.","line":155,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":312,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13538,13541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13538,13541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Maximize2, Minimize2, Settings, User, Loader2, RefreshCw, UserPlus } from 'lucide-react';\r\nimport { WebRTCSignaling } from '../utils/webrtc-signaling';\r\n\r\ninterface VideoCallProps {\r\n    participantName: string;\r\n    participantAvatar?: string;\r\n    onClose: () => void;\r\n    isDarkMode: boolean;\r\n    currentUserId: string;\r\n    callId: string;\r\n    participantId: string;\r\n    isInitiator: boolean;\r\n}\r\n\r\nexport function VideoCall({\r\n    participantName,\r\n    participantAvatar,\r\n    onClose,\r\n    isDarkMode,\r\n    currentUserId,\r\n    callId,\r\n    participantId,\r\n    isInitiator\r\n}: VideoCallProps) {\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [isVideoOff, setIsVideoOff] = useState(false);\r\n    const [isFullScreen, setIsFullScreen] = useState(false);\r\n    const [callDuration, setCallDuration] = useState(0);\r\n    const [callStartTime, setCallStartTime] = useState<number | null>(null);\r\n    const [localStream, setLocalStream] = useState<MediaStream | null>(null);\r\n    const [remoteStream, setRemoteStream] = useState<MediaStream | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [connectionState, setConnectionState] = useState<string>('connecting');\r\n    const [signalingStatus, setSignalingStatus] = useState<string>('IDLE');\r\n    const [isSwapped, setIsSwapped] = useState(false);\r\n    const [showAddFriend, setShowAddFriend] = useState(false);\r\n    const [connectionQuality, setConnectionQuality] = useState<'excellent' | 'good' | 'poor' | 'unknown'>('unknown');\r\n\r\n    const localVideoRef = useRef<HTMLVideoElement>(null);\r\n    const remoteVideoRef = useRef<HTMLVideoElement>(null);\r\n    const peerConnection = useRef<RTCPeerConnection | null>(null);\r\n    const signaling = useRef<WebRTCSignaling | null>(null);\r\n    const reconnectTimer = useRef<NodeJS.Timeout | null>(null);\r\n    const statsTimer = useRef<NodeJS.Timeout | null>(null);\r\n    const reconnectAttempts = useRef(0);\r\n    const maxReconnect = 5;\r\n\r\n    useEffect(() => {\r\n        initializeCall();\r\n\r\n        return () => {\r\n            if (reconnectTimer.current) clearTimeout(reconnectTimer.current);\r\n            if (statsTimer.current) clearInterval(statsTimer.current);\r\n            cleanupCall();\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let timer: NodeJS.Timeout | null = null;\r\n\r\n        // Only start timer when connection is established\r\n        if (connectionState === 'connected' && !callStartTime) {\r\n            setCallStartTime(Date.now());\r\n        }\r\n\r\n        if (connectionState === 'connected' && callStartTime) {\r\n            timer = setInterval(() => {\r\n                const elapsed = Math.floor((Date.now() - callStartTime) / 1000);\r\n                setCallDuration(elapsed);\r\n            }, 1000);\r\n        }\r\n\r\n        return () => {\r\n            if (timer) clearInterval(timer);\r\n        };\r\n    }, [connectionState, callStartTime]);\r\n\r\n    useEffect(() => {\r\n        if (localVideoRef.current && localStream) {\r\n            localVideoRef.current.srcObject = localStream;\r\n        }\r\n    }, [localStream]);\r\n\r\n    useEffect(() => {\r\n        if (remoteVideoRef.current && remoteStream) {\r\n            remoteVideoRef.current.srcObject = remoteStream;\r\n        }\r\n    }, [remoteStream]);\r\n\r\n    // Monitor connection quality via WebRTC stats\r\n    useEffect(() => {\r\n        if (connectionState !== 'connected' || !peerConnection.current) {\r\n            setConnectionQuality('unknown');\r\n            return;\r\n        }\r\n\r\n        statsTimer.current = setInterval(async () => {\r\n            try {\r\n                const pc = peerConnection.current;\r\n                if (!pc) return;\r\n                const stats = await pc.getStats();\r\n                let roundTripTime = 0;\r\n                let packetsLost = 0;\r\n                let packetsReceived = 0;\r\n\r\n                stats.forEach((report: any) => {\r\n                    if (report.type === 'candidate-pair' && report.state === 'succeeded') {\r\n                        roundTripTime = report.currentRoundTripTime || 0;\r\n                    }\r\n                    if (report.type === 'inbound-rtp' && report.kind === 'video') {\r\n                        packetsLost = report.packetsLost || 0;\r\n                        packetsReceived = report.packetsReceived || 0;\r\n                    }\r\n                });\r\n\r\n                const lossRate = packetsReceived > 0 ? packetsLost / (packetsReceived + packetsLost) : 0;\r\n\r\n                if (roundTripTime < 0.1 && lossRate < 0.01) {\r\n                    setConnectionQuality('excellent');\r\n                } else if (roundTripTime < 0.3 && lossRate < 0.05) {\r\n                    setConnectionQuality('good');\r\n                } else {\r\n                    setConnectionQuality('poor');\r\n                }\r\n            } catch {\r\n                // Stats not available\r\n            }\r\n        }, 3000);\r\n\r\n        return () => {\r\n            if (statsTimer.current) clearInterval(statsTimer.current);\r\n        };\r\n    }, [connectionState]);\r\n\r\n    const initializeCall = async () => {\r\n        try {\r\n            setConnectionState('connecting');\r\n            // 1. Get Local Stream with Fallbacks\r\n            let stream: MediaStream | null = null;\r\n            try {\r\n                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                setError(null);\r\n            } catch (err: any) {\r\n                console.warn('Failed to get video+audio:', err);\r\n                // Try video only\r\n                try {\r\n                    stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n                    setError('Microphone access failed. Video only mode.');\r\n                } catch (videoErr) {\r\n                    // Try audio only\r\n                    try {\r\n                        stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n                        setError('Camera access failed. Audio only mode.');\r\n                    } catch (audioErr) {\r\n                        throw err; // Throw the original error if everything fails\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!stream) throw new Error('No stream obtained');\r\n            setLocalStream(stream);\r\n\r\n            // 2. Initialize Signaling\r\n            if (!callId || !currentUserId || !participantId) {\r\n                setError('Missing call details');\r\n                return;\r\n            }\r\n\r\n            signaling.current = new WebRTCSignaling(callId, currentUserId, {\r\n                onSignalingStatusChange: (status) => {\r\n                    console.log('ðŸ“¡ Signaling Status:', status);\r\n                    setSignalingStatus(status);\r\n                    if (status === 'SUBSCRIBED') {\r\n                        setError(null);\r\n                    } else if (status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') {\r\n                        setError(`Signaling ${status.toLowerCase().replace('_', ' ')}. Retrying...`);\r\n                    }\r\n                },\r\n                onError: (err) => {\r\n                    console.error('Signaling error:', err);\r\n                    setError(err.message || 'Signaling connection error.');\r\n                }\r\n            });\r\n\r\n            const joined = await signaling.current.join();\r\n            if (!joined) {\r\n                // If it fails after all retries or timeout\r\n                setError('Failed to establish signaling connection. Please check your network and try again.');\r\n                setConnectionState('failed');\r\n                return;\r\n            }\r\n\r\n            // 3. Initialize Peer Connection\r\n            const pc = new RTCPeerConnection({\r\n                iceServers: [\r\n                    { urls: 'stun:stun.l.google.com:19302' },\r\n                    { urls: 'stun:stun1.l.google.com:19302' },\r\n                    { urls: 'stun:stun2.l.google.com:19302' },\r\n                    { urls: 'stun:stun3.l.google.com:19302' },\r\n                    { urls: 'stun:stun4.l.google.com:19302' },\r\n                    { urls: 'turn:openrelay.metered.ca:80', username: 'openrelayproject', credential: 'openrelayproject' },\r\n                    { urls: 'turn:openrelay.metered.ca:443', username: 'openrelayproject', credential: 'openrelayproject' },\r\n                    { urls: 'turn:openrelay.metered.ca:443?transport=tcp', username: 'openrelayproject', credential: 'openrelayproject' },\r\n                ],\r\n                iceCandidatePoolSize: 10,\r\n                bundlePolicy: 'max-bundle',\r\n                rtcpMuxPolicy: 'require',\r\n            });\r\n            peerConnection.current = pc;\r\n\r\n            // Monitor connection state\r\n            pc.onconnectionstatechange = () => {\r\n                console.log('RTCPeerConnection state:', pc.connectionState);\r\n                if (pc.connectionState === 'connected') {\r\n                    setConnectionState('connected');\r\n                    setError(null);\r\n                    reconnectAttempts.current = 0;\r\n                } else if (pc.connectionState === 'failed') {\r\n                    if (reconnectAttempts.current < maxReconnect) {\r\n                        reconnectAttempts.current++;\r\n                        setConnectionState('connecting');\r\n                        setError(`Connection lost. Reconnecting (${reconnectAttempts.current}/${maxReconnect})...`);\r\n                        reconnectTimer.current = setTimeout(() => {\r\n                            cleanupCall();\r\n                            initializeCall();\r\n                        }, 2000);\r\n                    } else {\r\n                        setConnectionState('failed');\r\n                        setError('Connection failed after multiple attempts. Please try again.');\r\n                    }\r\n                } else if (pc.connectionState === 'disconnected') {\r\n                    setError('Connection interrupted. Attempting to recover...');\r\n                }\r\n            };\r\n\r\n            // Monitor ICE connection state for faster detection\r\n            pc.oniceconnectionstatechange = () => {\r\n                console.log('ICE connection state:', pc.iceConnectionState);\r\n                if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\r\n                    setConnectionState('connected');\r\n                    setError(null);\r\n                } else if (pc.iceConnectionState === 'disconnected') {\r\n                    setError('Connection interrupted. Waiting to recover...');\r\n                } else if (pc.iceConnectionState === 'failed') {\r\n                    // Force an ICE restart\r\n                    console.log('ICE failed, attempting ICE restart...');\r\n                    pc.restartIce();\r\n                }\r\n            };\r\n\r\n            // Add local tracks\r\n            stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n            // Handle remote tracks\r\n            pc.ontrack = (event) => {\r\n                console.log('Received remote track');\r\n                if (event.streams && event.streams[0]) {\r\n                    setRemoteStream(event.streams[0]);\r\n                }\r\n            };\r\n\r\n            // Handle ICE candidates\r\n            pc.onicecandidate = (event) => {\r\n                if (event.candidate) {\r\n                    signaling.current?.sendSignal('ice-candidate', event.candidate, participantId);\r\n                }\r\n            };\r\n\r\n            // Handle Signaling Events\r\n            signaling.current.onSignal(async (payload) => {\r\n                try {\r\n                    if (payload.type === 'offer') {\r\n                        await pc.setRemoteDescription(new RTCSessionDescription(payload.data));\r\n                        const answer = await pc.createAnswer();\r\n                        await pc.setLocalDescription(answer);\r\n                        signaling.current?.sendSignal('answer', answer, participantId);\r\n                    } else if (payload.type === 'answer') {\r\n                        if (pc.signalingState !== 'stable') {\r\n                            await pc.setRemoteDescription(new RTCSessionDescription(payload.data));\r\n                        }\r\n                    } else if (payload.type === 'ice-candidate') {\r\n                        await pc.addIceCandidate(new RTCIceCandidate(payload.data));\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Error handling signal:', err);\r\n                }\r\n            });\r\n\r\n            // 4. Create Offer if Initiator\r\n            if (isInitiator) {\r\n                const offer = await pc.createOffer({\r\n                    offerToReceiveAudio: true,\r\n                    offerToReceiveVideo: true\r\n                });\r\n                await pc.setLocalDescription(offer);\r\n\r\n                // Ensure we have a small delay or check status before sending\r\n                const sendOffer = async (retries = 3) => {\r\n                    if (signaling.current?.getConnectionStatus()) {\r\n                        signaling.current?.sendSignal('offer', offer, participantId);\r\n                    } else if (retries > 0) {\r\n                        setTimeout(() => sendOffer(retries - 1), 1000);\r\n                    } else {\r\n                        setError('Signaling timed out. Please refresh.');\r\n                    }\r\n                };\r\n\r\n                sendOffer();\r\n            }\r\n\r\n        } catch (err: any) {\r\n            console.error('Error initializing call:', err);\r\n            let errorMessage = 'Failed to access camera/microphone';\r\n            if (err.name === 'NotAllowedError') errorMessage = 'Permission denied. Please allow camera/mic access.';\r\n            if (err.name === 'NotFoundError') errorMessage = 'No camera or microphone found.';\r\n            if (err.name === 'NotReadableError') errorMessage = 'Camera/Mic is in use by another app.';\r\n            setError(errorMessage);\r\n            setConnectionState('failed');\r\n        }\r\n    };\r\n\r\n    const cleanupCall = () => {\r\n        localStream?.getTracks().forEach(track => track.stop());\r\n        peerConnection.current?.close();\r\n        signaling.current?.leave();\r\n    };\r\n\r\n    const toggleMute = () => {\r\n        if (localStream) {\r\n            localStream.getAudioTracks().forEach(track => {\r\n                track.enabled = isMuted;\r\n            });\r\n            setIsMuted(!isMuted);\r\n        }\r\n    };\r\n\r\n    const toggleVideo = () => {\r\n        if (localStream) {\r\n            localStream.getVideoTracks().forEach(track => {\r\n                track.enabled = isVideoOff;\r\n            });\r\n            setIsVideoOff(!isVideoOff);\r\n        }\r\n    };\r\n\r\n    const formatDuration = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    return (\r\n        <div className={`fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 ${isDarkMode ? 'bg-slate-950/90' : 'bg-slate-900/80'\r\n            } backdrop-blur-md`}>\r\n            <div className={`relative w-full max-w-5xl aspect-video rounded-3xl overflow-hidden shadow-2xl border ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-800 border-slate-700'\r\n                }`}>\r\n                {/* Main Video Area */}\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-slate-800 to-slate-900\">\r\n                    {!isSwapped ? (\r\n                        // Remote video in main view\r\n                        remoteStream && remoteStream.getVideoTracks().length > 0 ? (\r\n                            <video\r\n                                ref={remoteVideoRef}\r\n                                autoPlay\r\n                                playsInline\r\n                                className=\"w-full h-full object-cover\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"flex flex-col items-center justify-center text-center p-6\">\r\n                                <div className=\"relative mb-6\">\r\n                                    <img\r\n                                        src={participantAvatar || 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop'}\r\n                                        alt={participantName}\r\n                                        className=\"w-32 h-32 rounded-full border-4 border-amber-500 shadow-2xl object-cover opacity-50\"\r\n                                    />\r\n                                    <div className=\"absolute -bottom-2 -right-2 bg-amber-500 w-6 h-6 rounded-full border-4 border-slate-900 animate-pulse\" />\r\n                                </div>\r\n                                <h2 className=\"text-3xl font-bold text-white mb-2\">{participantName}</h2>\r\n                                <p className=\"text-amber-400 font-mono text-lg mb-4\">{formatDuration(callDuration)}</p>\r\n                                <div className=\"flex items-center gap-2 text-slate-400 text-sm\">\r\n                                    {remoteStream ? (\r\n                                        <>\r\n                                            <Mic size={16} className=\"animate-pulse text-green-500\" />\r\n                                            Audio Only\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Loader2 size={16} className=\"animate-spin\" />\r\n                                            {connectionState === 'connecting' ? 'Connecting...' : 'Waiting for video...'}\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                                {error && (\r\n                                    <div className=\"mt-4 flex flex-col items-center gap-3\">\r\n                                        <p className=\"text-red-400 text-sm bg-red-500/10 px-4 py-2 rounded-lg border border-red-500/20\">\r\n                                            {error}\r\n                                        </p>\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                cleanupCall();\r\n                                                initializeCall();\r\n                                            }}\r\n                                            className=\"flex items-center gap-2 px-6 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-bold transition-all shadow-lg shadow-amber-500/20 hover:scale-105 active:scale-95\"\r\n                                        >\r\n                                            <RefreshCw size={18} className={connectionState === 'connecting' ? 'animate-spin' : ''} />\r\n                                            Reconnect\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    ) : (\r\n                        // Local video in main view when swapped\r\n                        isVideoOff ? (\r\n                            <div className=\"flex flex-col items-center gap-2\">\r\n                                <User size={64} className=\"text-slate-500\" />\r\n                                <span className=\"text-xl text-slate-500 font-bold uppercase\">Camera Off</span>\r\n                            </div>\r\n                        ) : (\r\n                            localStream && (\r\n                                <video\r\n                                    ref={localVideoRef}\r\n                                    autoPlay\r\n                                    playsInline\r\n                                    muted\r\n                                    className=\"w-full h-full object-cover scale-x-[-1]\"\r\n                                />\r\n                            )\r\n                        )\r\n                    )}\r\n                </div>\r\n\r\n                {/* Thumbnail Video (Swappable) */}\r\n                <div\r\n                    className=\"absolute top-6 right-6 w-32 md:w-48 aspect-video bg-slate-800 rounded-2xl border-2 border-white/20 shadow-xl overflow-hidden z-10 cursor-pointer hover:scale-105 transition-transform\"\r\n                    onClick={() => setIsSwapped(!isSwapped)}\r\n                    title=\"Click to swap\"\r\n                >\r\n                    <div className=\"w-full h-full flex items-center justify-center bg-slate-700\">\r\n                        {!isSwapped ? (\r\n                            // Local video in thumbnail by default\r\n                            isVideoOff ? (\r\n                                <div className=\"flex flex-col items-center gap-2\">\r\n                                    <User size={32} className=\"text-slate-500\" />\r\n                                    <span className=\"text-[10px] text-slate-500 font-bold uppercase\">Camera Off</span>\r\n                                </div>\r\n                            ) : localStream ? (\r\n                                <video\r\n                                    ref={localVideoRef}\r\n                                    autoPlay\r\n                                    playsInline\r\n                                    muted\r\n                                    className=\"w-full h-full object-cover scale-x-[-1]\"\r\n                                />\r\n                            ) : (\r\n                                <Loader2 size={24} className=\"text-amber-500 animate-spin\" />\r\n                            )\r\n                        ) : (\r\n                            // Remote video in thumbnail when swapped\r\n                            remoteStream && remoteStream.getVideoTracks().length > 0 ? (\r\n                                <video\r\n                                    ref={remoteVideoRef}\r\n                                    autoPlay\r\n                                    playsInline\r\n                                    className=\"w-full h-full object-cover\"\r\n                                />\r\n                            ) : (\r\n                                <div className=\"flex items-center justify-center\">\r\n                                    <img\r\n                                        src={participantAvatar || 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop'}\r\n                                        alt={participantName}\r\n                                        className=\"w-16 h-16 rounded-full opacity-50\"\r\n                                    />\r\n                                </div>\r\n                            )\r\n                        )}\r\n                    </div>\r\n                    <div className=\"absolute bottom-2 left-2 px-2 py-0.5 bg-black/40 backdrop-blur-md rounded text-[10px] font-bold text-white uppercase tracking-widest\">\r\n                        {!isSwapped ? 'You' : participantName.split(' ')[0]}\r\n                    </div>\r\n                    <div className=\"absolute top-2 right-2 p-1 bg-amber-500 rounded-full\">\r\n                        <RefreshCw size={12} className=\"text-white\" />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Top Controls */}\r\n                <div className=\"absolute top-6 left-6 flex items-center gap-3 z-10\">\r\n                    {connectionState === 'connected' && (\r\n                        <div className=\"px-4 py-2 rounded-xl bg-black/40 backdrop-blur-md border border-white/10\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-red-500 animate-pulse\"></div>\r\n                                <span className=\"text-white font-mono text-sm font-bold\">{formatDuration(callDuration)}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <button\r\n                        onClick={() => setShowAddFriend(!showAddFriend)}\r\n                        className=\"p-2 rounded-xl bg-amber-500 hover:bg-amber-600 text-white backdrop-blur-md transition-all\"\r\n                        title=\"Add friend to call\"\r\n                    >\r\n                        <UserPlus size={20} />\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setIsFullScreen(!isFullScreen)}\r\n                        className=\"p-2 rounded-xl bg-black/20 hover:bg-black/40 text-white backdrop-blur-md transition-all\"\r\n                    >\r\n                        {isFullScreen ? <Minimize2 size={20} /> : <Maximize2 size={20} />}\r\n                    </button>\r\n                    <button className=\"p-2 rounded-xl bg-black/20 hover:bg-black/40 text-white backdrop-blur-md transition-all\">\r\n                        <Settings size={20} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Add Friend Dropdown */}\r\n                {showAddFriend && (\r\n                    <div className=\"absolute top-20 left-6 w-64 bg-slate-900 rounded-xl border border-slate-700 shadow-2xl z-20 overflow-hidden\">\r\n                        <div className=\"p-3 bg-amber-500/10 border-b border-slate-700\">\r\n                            <h4 className=\"font-bold text-sm text-white\">Add to Call</h4>\r\n                            <p className=\"text-xs text-slate-400 mt-1\">Feature coming soon - Group video calls</p>\r\n                        </div>\r\n                        <div className=\"p-3 text-center text-slate-500 text-sm\">\r\n                            Multi-party video calls will be available in the next update\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Bottom Controls */}\r\n                <div className=\"absolute bottom-10 left-1/2 -translate-x-1/2 flex items-center gap-4 md:gap-6 px-8 py-4 rounded-3xl bg-black/40 backdrop-blur-xl border border-white/10 z-10\">\r\n                    <button\r\n                        onClick={toggleMute}\r\n                        className={`p-4 rounded-2xl transition-all ${isMuted ? 'bg-red-500 text-white' : 'bg-white/10 hover:bg-white/20 text-white'\r\n                            }`}\r\n                    >\r\n                        {isMuted ? <MicOff size={24} /> : <Mic size={24} />}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={toggleVideo}\r\n                        className={`p-4 rounded-2xl transition-all ${isVideoOff ? 'bg-red-500 text-white' : 'bg-white/10 hover:bg-white/20 text-white'\r\n                            }`}\r\n                    >\r\n                        {isVideoOff ? <VideoOff size={24} /> : <Video size={24} />}\r\n                    </button>\r\n\r\n                    <div className=\"w-px h-10 bg-white/10 mx-2\" />\r\n\r\n                    <button\r\n                        onClick={async () => {\r\n                            // Always send call ended notification to other side\r\n                            try {\r\n                                const { createNotification, supabase } = await import('../utils/supabase-queries');\r\n\r\n                                // Calculate duration if call was connected\r\n                                const duration = (connectionState === 'connected' && callStartTime)\r\n                                    ? Math.floor((Date.now() - callStartTime) / 1000)\r\n                                    : 0;\r\n\r\n                                // Save call history only if call was connected and had duration\r\n                                if (isInitiator && duration > 0) {\r\n                                    const { error: historyError } = await supabase\r\n                                        .from('call_history')\r\n                                        .insert({\r\n                                            caller_id: currentUserId,\r\n                                            receiver_id: participantId,\r\n                                            duration_seconds: duration\r\n                                        });\r\n\r\n                                    if (historyError) {\r\n                                        console.error('Error saving call history:', historyError);\r\n                                    }\r\n                                }\r\n\r\n                                // Always notify other side that call ended\r\n                                await createNotification(participantId, currentUserId, 'call_ended', {\r\n                                    duration,\r\n                                    senderName: 'User'\r\n                                });\r\n                                console.log('Call ended notification sent to:', participantId);\r\n                            } catch (error) {\r\n                                console.error('Error ending call:', error);\r\n                            }\r\n                            onClose();\r\n                        }}\r\n                        className=\"p-4 rounded-2xl bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/30 transition-all transform hover:scale-110 active:scale-95\"\r\n                    >\r\n                        <PhoneOff size={28} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Status Indicators */}\r\n                <div className=\"absolute bottom-6 left-6 text-white/60 text-xs font-medium z-10 flex flex-col gap-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className={`w-2 h-2 rounded-full ${connectionState === 'connected' ? 'bg-green-500' : 'bg-amber-500'} animate-pulse`} />\r\n                        {connectionState === 'connected' ? (\r\n                            <span className=\"flex items-center gap-1.5\">\r\n                                {connectionQuality === 'excellent' ? 'HD Connection' : connectionQuality === 'good' ? 'Good Connection' : connectionQuality === 'poor' ? 'Weak Connection' : 'Connected'}\r\n                                {' â€¢ Secured'}\r\n                                <span className=\"flex gap-0.5 ml-1\">\r\n                                    {['excellent', 'good', 'poor'].map((q, i) => (\r\n                                        <div key={i} className={`w-1 rounded-full ${\r\n                                            (connectionQuality === 'excellent' && i <= 2) ||\r\n                                            (connectionQuality === 'good' && i <= 1) ||\r\n                                            (connectionQuality === 'poor' && i === 0)\r\n                                                ? 'bg-green-500'\r\n                                                : 'bg-white/20'\r\n                                        }`} style={{ height: `${8 + i * 4}px` }} />\r\n                                    ))}\r\n                                </span>\r\n                            </span>\r\n                        ) : 'Establishing Connection...'}\r\n                    </div>\r\n                    {signalingStatus !== 'SUBSCRIBED' && (\r\n                        <div className=\"flex items-center gap-2 text-white/40 italic\">\r\n                            <Loader2 size={10} className=\"animate-spin\" />\r\n                            Signaling: {signalingStatus || 'INITIALIZING'}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <style>{`\r\n                .mirror {\r\n                    transform: scaleX(-1);\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\components\\ViewProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[508,511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[508,511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1762,1765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1762,1765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkFriendship', 'loadMentorReviews', 'loadProfile', and 'loadStudyStats'. Either include them or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [checkFriendship, loadMentorReviews, loadProfile, loadStudyStats, userId]","fix":{"range":[1930,1938],"text":"[checkFriendship, loadMentorReviews, loadProfile, loadStudyStats, userId]"}}]},{"ruleId":"prefer-const","severity":2,"message":"'checkDate' is never reassigned. Use 'const' instead.","line":150,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":150,"endColumn":24,"fix":{"range":[5062,5094],"text":"const checkDate = new Date(today);"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { User, Calendar, ArrowLeft, MessageCircle, Video, UserPlus, UserCheck, Clock, X, GraduationCap, BookOpen, Briefcase, Award, Flame, Heart, Star } from 'lucide-react';\r\nimport { supabase } from '../utils/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { fetchMentorReviews } from '../utils/supabase-queries';\r\n\r\ninterface ViewProfileProps {\r\n  userId: string;\r\n  isDarkMode: boolean;\r\n  onBack: () => void;\r\n  onStartChat?: (friend: any) => void;\r\n  onStartVideoCall?: (name: string, avatar: string, friendId: string) => void;\r\n}\r\n\r\ninterface ProfileData {\r\n  user_id: string;\r\n  full_name: string;\r\n  username: string;\r\n  avatar_url: string;\r\n  created_at: string;\r\n  bio?: string;\r\n  class?: string;\r\n  course?: string;\r\n  age?: number;\r\n  phone_number?: string;\r\n  role?: string;\r\n  profession?: string;\r\n  experience?: string;\r\n  academic_info?: {\r\n    school?: string;\r\n    university?: string;\r\n    major?: string;\r\n    graduation_year?: string;\r\n  };\r\n}\r\n\r\nexport function ViewProfile({ userId, isDarkMode, onBack, onStartChat, onStartVideoCall }: ViewProfileProps) {\r\n  const { user } = useAuth();\r\n  const [profile, setProfile] = useState<ProfileData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [friendshipStatus, setFriendshipStatus] = useState<'none' | 'pending' | 'friends'>('none');\r\n  const [totalStudyTime, setTotalStudyTime] = useState(0);\r\n  const [showLargePhoto, setShowLargePhoto] = useState(false);\r\n  const [totalSessions, setTotalSessions] = useState(0);\r\n  const [studyStreak, setStudyStreak] = useState(0);\r\n  const [friendsSince, setFriendsSince] = useState<Date | null>(null);\r\n  const [mentorReviews, setMentorReviews] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (userId) {\r\n      loadProfile();\r\n      checkFriendship();\r\n      loadStudyStats();\r\n      loadMentorReviews();\r\n    }\r\n  }, [userId]);\r\n\r\n  const loadProfile = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      setProfile(data);\r\n    } catch (error) {\r\n      console.error('Error loading profile:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const checkFriendship = async () => {\r\n    if (!user) return;\r\n\r\n    try {\r\n      // Check if they are friends - using 'friends' table (not 'friendships')\r\n      const { data: friendships, error } = await supabase\r\n        .from('friends')\r\n        .select('status, created_at')\r\n        .or(`and(user_id.eq.${user.id},friend_id.eq.${userId}),and(user_id.eq.${userId},friend_id.eq.${user.id})`);\r\n\r\n      if (error) {\r\n        console.error('Error checking friendship:', error);\r\n        setFriendshipStatus('none');\r\n        return;\r\n      }\r\n\r\n      console.log('Friendship check result:', friendships);\r\n\r\n      if (friendships && friendships.length > 0) {\r\n        const friendship = friendships[0];\r\n        if (friendship.status === 'accepted') {\r\n          setFriendshipStatus('friends');\r\n          if (friendship.created_at) {\r\n            setFriendsSince(new Date(friendship.created_at));\r\n          }\r\n        } else if (friendship.status === 'pending') {\r\n          setFriendshipStatus('pending');\r\n        } else {\r\n          setFriendshipStatus('none');\r\n        }\r\n      } else {\r\n        setFriendshipStatus('none');\r\n      }\r\n    } catch (error) {\r\n      console.error('Friendship check error:', error);\r\n      setFriendshipStatus('none');\r\n    }\r\n  };\r\n  const loadMentorReviews = async () => {\r\n    try {\r\n      const reviews = await fetchMentorReviews(userId);\r\n      setMentorReviews(reviews || []);\r\n    } catch (error) {\r\n      console.error('Error loading mentor reviews:', error);\r\n    }\r\n  };\r\n  const loadStudyStats = async () => {\r\n    try {\r\n      const { data } = await supabase\r\n        .from('study_sessions')\r\n        .select('duration_minutes, start_time, created_at, focus_rating')\r\n        .eq('user_id', userId)\r\n        .order('start_time', { ascending: false });\r\n\r\n      if (data) {\r\n        const total = data.reduce((sum, session) => sum + (session.duration_minutes || 0), 0);\r\n        setTotalStudyTime(total);\r\n        setTotalSessions(data.length);\r\n\r\n        // Calculate streak - consecutive days with study sessions (same as Dashboard's calculateStreak, using getTime for local timezone)\r\n        if (data.length > 0) {\r\n          const today = new Date();\r\n          today.setHours(0, 0, 0, 0);\r\n\r\n          // Get unique study dates using getTime() for local timezone comparison\r\n          const sessionDates = new Set<number>();\r\n          data.forEach(session => {\r\n            const date = new Date(session.start_time || session.created_at);\r\n            date.setHours(0, 0, 0, 0);\r\n            sessionDates.add(date.getTime());\r\n          });\r\n\r\n          // Count streak starting from today or yesterday\r\n          let streak = 0;\r\n          let checkDate = new Date(today);\r\n\r\n          // Check if studied today\r\n          if (sessionDates.has(checkDate.getTime())) {\r\n            streak = 1;\r\n            checkDate.setDate(checkDate.getDate() - 1);\r\n          } else {\r\n            // Check yesterday\r\n            checkDate.setDate(checkDate.getDate() - 1);\r\n            if (!sessionDates.has(checkDate.getTime())) {\r\n              setStudyStreak(0);\r\n              return;\r\n            }\r\n            streak = 1;\r\n            checkDate.setDate(checkDate.getDate() - 1);\r\n          }\r\n\r\n          // Count consecutive days\r\n          while (sessionDates.has(checkDate.getTime())) {\r\n            streak++;\r\n            checkDate.setDate(checkDate.getDate() - 1);\r\n          }\r\n\r\n          setStudyStreak(streak);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading study stats:', error);\r\n    }\r\n  };\r\n\r\n  const sendFriendRequest = async () => {\r\n    if (!user) return;\r\n\r\n    try {\r\n      await supabase.from('friends').insert({\r\n        user_id: user.id,\r\n        friend_id: userId,\r\n        status: 'pending'\r\n      });\r\n      setFriendshipStatus('pending');\r\n    } catch (error) {\r\n      console.error('Error sending friend request:', error);\r\n    }\r\n  };\r\n\r\n  const formatStudyTime = (minutes: number) => {\r\n    const hours = Math.floor(minutes / 60);\r\n    const mins = minutes % 60;\r\n    if (hours > 0) {\r\n      return `${hours}h ${mins}m`;\r\n    }\r\n    return `${mins}m`;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className={`flex items-center justify-center h-64 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-amber-500\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!profile) {\r\n    return (\r\n      <div className={`flex flex-col items-center justify-center h-64 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n        <User size={48} className=\"opacity-50 mb-4\" />\r\n        <p>User not found</p>\r\n        <button\r\n          onClick={onBack}\r\n          className=\"mt-4 px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors\"\r\n        >\r\n          Go Back\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isOwnProfile = user?.id === userId;\r\n  const avatarUrl = profile.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(profile.full_name || 'U')}&background=random&size=400`;\r\n\r\n  return (\r\n    <div className={`max-w-2xl mx-auto ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n      {/* Large Photo Modal */}\r\n      {showLargePhoto && (\r\n        <div\r\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm\"\r\n          onClick={() => setShowLargePhoto(false)}\r\n        >\r\n          <div className=\"relative max-w-md w-full mx-4 flex flex-col items-center\">\r\n            <button\r\n              onClick={() => setShowLargePhoto(false)}\r\n              className=\"absolute -top-14 right-0 p-2.5 bg-white/10 hover:bg-white/20 rounded-full transition-colors border border-white/20\"\r\n            >\r\n              <X size={24} className=\"text-white\" />\r\n            </button>\r\n            <img\r\n              src={avatarUrl}\r\n              alt={profile.full_name}\r\n              className=\"w-96 h-96 rounded-full object-cover shadow-2xl ring-4 ring-white/20\"\r\n            />\r\n            {/* Name and username below picture */}\r\n            <div className=\"mt-6 text-center\">\r\n              <h3 className=\"text-white font-bold text-2xl\">{profile.full_name}</h3>\r\n              <p className=\"text-white/60 text-base mt-1\">@{profile.username || 'user'}</p>\r\n              {friendshipStatus === 'friends' && (\r\n                <div className=\"flex items-center justify-center gap-2 mt-3 text-green-400\">\r\n                  <Heart size={16} className=\"fill-current\" />\r\n                  <span className=\"text-sm font-medium\">Friends</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <div className=\"flex items-center gap-4 mb-6\">\r\n        <button\r\n          onClick={onBack}\r\n          className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'hover:bg-slate-800' : 'hover:bg-slate-100'}`}\r\n        >\r\n          <ArrowLeft size={24} />\r\n        </button>\r\n        <h1 className=\"text-2xl font-bold\">Profile</h1>\r\n      </div>\r\n\r\n      {/* Profile Card */}\r\n      <div className={`rounded-2xl overflow-hidden ${isDarkMode ? 'bg-slate-900/50 border border-slate-800' : 'bg-white border border-slate-200 shadow-lg'}`}>\r\n        {/* Banner/Cover with Name and Avatar */}\r\n        <div className=\"h-48 bg-gradient-to-r from-amber-500 via-orange-500 to-pink-500 relative flex items-center py-4\">\r\n          {/* Avatar - vertically centered in banner */}\r\n          <div className=\"absolute left-6 top-1/2 -translate-y-1/2\">\r\n            <button\r\n              onClick={() => setShowLargePhoto(true)}\r\n              className=\"relative group\"\r\n            >\r\n              <img\r\n                src={avatarUrl}\r\n                alt={profile.full_name}\r\n                className=\"w-36 h-36 rounded-full object-cover border-4 border-white/30 shadow-xl cursor-pointer transition-transform group-hover:scale-105\"\r\n              />\r\n              <div className=\"absolute inset-0 rounded-full bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity\">\r\n                <span className=\"text-white text-xs font-bold\">VIEW</span>\r\n              </div>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Text vertically centered */}\r\n          <div className=\"ml-48 sm:ml-52\">\r\n            <h2 className=\"text-4xl font-extrabold text-slate-900 drop-shadow-sm\">\r\n              {profile.full_name}\r\n            </h2>\r\n            <p className=\"text-slate-800/80 text-lg font-semibold mt-1\">\r\n              @{profile.username || 'user'}\r\n            </p>\r\n            {profile.role && (\r\n              <span className={`inline-flex items-center gap-1 text-sm px-3 py-1.5 rounded-full font-bold mt-2 ${profile.role === 'mentor'\r\n                  ? 'bg-white/30 text-slate-900 border border-white/40'\r\n                  : 'bg-white/30 text-slate-900 border border-white/40'\r\n                }`}>\r\n                {profile.role === 'mentor' ? 'ðŸŽ“ Mentor' : 'ðŸ“š Student'}\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content below banner */}\r\n        <div className=\"px-6 pb-6 pt-4\">\r\n          <div className=\"flex flex-col sm:flex-row items-center sm:items-start gap-4\">\r\n            {/* Mobile only: Name shown below since banner shows on desktop */}\r\n            <div className=\"flex-1 text-center sm:text-left sm:hidden\">\r\n              {/* Name shown on mobile only since it's in banner on desktop */}\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <h2 className=\"text-2xl font-extrabold text-amber-500\">\r\n                  {profile.full_name}\r\n                </h2>\r\n                <p className={`text-sm font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>\r\n                  @{profile.username || 'user'}\r\n                </p>\r\n                {profile.role && (\r\n                  <span className={`inline-flex items-center gap-1 text-xs px-2.5 py-1 rounded-full font-bold ${profile.role === 'mentor'\r\n                      ? 'bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 border border-purple-500/30'\r\n                      : 'bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-400 border border-blue-500/30'\r\n                    }`}>\r\n                    {profile.role === 'mentor' ? 'ðŸŽ“ Mentor' : 'ðŸ“š Student'}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Friend Status Badge */}\r\n            {!isOwnProfile && friendshipStatus === 'friends' && (\r\n              <div className=\"flex items-center gap-1.5 px-3 py-1.5 bg-green-500/20 text-green-500 rounded-full text-sm font-bold sm:mt-0 mt-2\">\r\n                <UserCheck size={16} />\r\n                Friends\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Bio */}\r\n          {profile.bio && (\r\n            <p className={`mt-4 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'}`}>\r\n              {profile.bio}\r\n            </p>\r\n          )}\r\n\r\n          {/* Stats Row */}\r\n          <div className=\"flex flex-wrap gap-3 mt-4\">\r\n            <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n              <Clock size={16} className=\"text-amber-500\" />\r\n              <div>\r\n                <p className=\"text-xs opacity-70\">Study Time</p>\r\n                <p className=\"text-sm font-bold\">{formatStudyTime(totalStudyTime)}</p>\r\n              </div>\r\n            </div>\r\n            <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n              <BookOpen size={16} className=\"text-blue-500\" />\r\n              <div>\r\n                <p className=\"text-xs opacity-70\">Sessions</p>\r\n                <p className=\"text-sm font-bold\">{totalSessions}</p>\r\n              </div>\r\n            </div>\r\n            <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${studyStreak > 0 ? 'bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/30' : isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n              <Flame size={16} className={studyStreak > 0 ? 'text-orange-500' : 'text-slate-400'} />\r\n              <div>\r\n                <p className=\"text-xs opacity-70\">Streak</p>\r\n                <p className={`text-sm font-bold ${studyStreak > 0 ? 'text-orange-500' : ''}`}>\r\n                  {studyStreak} {studyStreak === 1 ? 'day' : 'days'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${isDarkMode ? 'bg-slate-800' : 'bg-slate-100'}`}>\r\n              <Calendar size={16} className=\"text-purple-500\" />\r\n              <div>\r\n                <p className=\"text-xs opacity-70\">Joined</p>\r\n                <p className=\"text-sm font-bold\">\r\n                  {new Date(profile.created_at).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {!isOwnProfile && friendsSince && friendshipStatus === 'friends' && (\r\n              <div className={`flex items-center gap-2 px-3 py-2 rounded-xl bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30`}>\r\n                <Heart size={16} className=\"text-green-500\" />\r\n                <div>\r\n                  <p className=\"text-xs opacity-70\">Friends Since</p>\r\n                  <p className=\"text-sm font-bold text-green-500\">\r\n                    {friendsSince.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Details Section */}\r\n          <div className={`mt-6 pt-6 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n            <h3 className=\"text-lg font-bold mb-4 flex items-center gap-2\">\r\n              <User size={18} className=\"text-amber-500\" />\r\n              Details\r\n            </h3>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n              {profile.class && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <GraduationCap size={20} className=\"text-blue-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">Class</p>\r\n                    <p className=\"font-semibold\">{profile.class}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.course && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <BookOpen size={20} className=\"text-green-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">Course</p>\r\n                    <p className=\"font-semibold\">{profile.course}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.age && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <Calendar size={20} className=\"text-purple-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">Age</p>\r\n                    <p className=\"font-semibold\">{profile.age} years</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.profession && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <Briefcase size={20} className=\"text-amber-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">Profession</p>\r\n                    <p className=\"font-semibold\">{profile.profession}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.experience && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <Award size={20} className=\"text-pink-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">Experience</p>\r\n                    <p className=\"font-semibold\">{profile.experience}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.academic_info?.school && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <GraduationCap size={20} className=\"text-indigo-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">School</p>\r\n                    <p className=\"font-semibold\">{profile.academic_info.school}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {profile.academic_info?.university && (\r\n                <div className={`flex items-center gap-3 p-3 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}>\r\n                  <GraduationCap size={20} className=\"text-teal-500\" />\r\n                  <div>\r\n                    <p className=\"text-xs opacity-70\">University</p>\r\n                    <p className=\"font-semibold\">{profile.academic_info.university}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Mentor Reviews Section */}\r\n          {profile?.role === 'mentor' && mentorReviews.length > 0 && (\r\n            <div className={`mt-6 pt-6 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n              <h3 className={`text-lg font-bold mb-4 ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                Reviews ({mentorReviews.length})\r\n              </h3>\r\n              <div className=\"max-h-96 overflow-y-auto space-y-4 pr-2\">\r\n                {mentorReviews.map((review) => (\r\n                  <div\r\n                    key={review.id}\r\n                    className={`p-4 rounded-xl ${isDarkMode ? 'bg-slate-800/50' : 'bg-slate-50'}`}\r\n                  >\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <img\r\n                        src={review.studentAvatarUrl || review.student_profile?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(review.studentName || review.student_profile?.full_name || 'U')}&background=random`}\r\n                        alt={review.studentName || review.student_profile?.full_name}\r\n                        className=\"w-10 h-10 rounded-full object-cover\"\r\n                      />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center justify-between mb-1\">\r\n                          <span className={`font-semibold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>\r\n                            {review.studentName || review.student_profile?.full_name || 'Anonymous student'}\r\n                          </span>\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {[...Array(5)].map((_, i) => (\r\n                              <Star\r\n                                key={i}\r\n                                className={`w-4 h-4 ${i < review.rating\r\n                                    ? 'fill-amber-500 text-amber-500'\r\n                                    : isDarkMode\r\n                                      ? 'text-slate-600'\r\n                                      : 'text-slate-300'\r\n                                  }`}\r\n                              />\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                        {(review.review_text || review.reviewText) && (\r\n                          <p className={`text-sm mt-2 ${isDarkMode ? 'text-slate-300' : 'text-slate-600'} italic ${isDarkMode ? 'bg-slate-900/40' : 'bg-white'} p-2 rounded-lg`}>\r\n                            \"{review.review_text || review.reviewText}\"\r\n                          </p>\r\n                        )}\r\n                        <p className={`text-xs mt-2 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>\r\n                          {new Date(review.created_at || review.createdAt).toLocaleDateString()}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Action Buttons */}\r\n          {!isOwnProfile && (\r\n            <div className={`flex flex-wrap gap-3 mt-6 pt-6 border-t ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>\r\n              {friendshipStatus === 'friends' ? (\r\n                <>\r\n                  <button\r\n                    onClick={() => onStartChat?.({\r\n                      id: userId,\r\n                      name: profile.full_name,\r\n                      avatarUrl: profile.avatar_url,\r\n                      status: 'online',\r\n                      isMentor: profile.role === 'mentor'\r\n                    })}\r\n                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:opacity-90 transition-opacity font-bold\"\r\n                  >\r\n                    <MessageCircle size={18} />\r\n                    Send Message\r\n                  </button>\r\n                  <button\r\n                    onClick={() => onStartVideoCall?.(profile.full_name, profile.avatar_url || '', userId)}\r\n                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:opacity-90 transition-opacity font-bold\"\r\n                  >\r\n                    <Video size={18} />\r\n                    Video Call\r\n                  </button>\r\n                </>\r\n              ) : profile.role === 'mentor' ? (\r\n                <>\r\n                  <button\r\n                    onClick={() => onStartChat?.({\r\n                      id: userId,\r\n                      name: profile.full_name,\r\n                      avatarUrl: profile.avatar_url,\r\n                      status: 'online',\r\n                      isMentor: true\r\n                    })}\r\n                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:opacity-90 transition-opacity font-bold\"\r\n                  >\r\n                    <MessageCircle size={18} />\r\n                    Chat with Mentor\r\n                  </button>\r\n                </>\r\n              ) : friendshipStatus === 'pending' ? (\r\n                <div className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-amber-500/20 text-amber-500 rounded-xl font-bold\">\r\n                  <Clock size={18} />\r\n                  Friend Request Pending\r\n                </div>\r\n              ) : (\r\n                <button\r\n                  onClick={sendFriendRequest}\r\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:opacity-90 transition-opacity font-bold\"\r\n                >\r\n                  <UserPlus size={18} />\r\n                  Add Friend\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[342,345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[342,345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407,410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407,410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[432,435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[432,435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2004,2007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2004,2007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":99,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":99,"endColumn":24}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState } from 'react';\nimport { User, Session } from '@supabase/supabase-js';\nimport { supabase } from '../utils/supabase';\n\ninterface AuthContextType {\n    user: User | null;\n    session: Session | null;\n    loading: boolean;\n    signIn: (email: string, password: string) => Promise<{ error: any }>;\n    signUp: (email: string, password: string, metadata?: any) => Promise<{ error: any }>;\n    signOut: () => Promise<void>;\n    continueAsGuest: () => void;\n    isGuest: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n    const [user, setUser] = useState<User | null>(null);\n    const [session, setSession] = useState<Session | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [isGuest, setIsGuest] = useState(false);\n\n    useEffect(() => {\n        // Get initial session\n        supabase.auth.getSession().then(({ data: { session }, error }) => {\n            if (error) {\n                console.error('Error getting session:', error);\n            }\n            setSession(session);\n            setUser(session?.user ?? null);\n            setLoading(false);\n        }).catch((err) => {\n            console.error('Failed to get session:', err);\n            setLoading(false);\n        });\n\n        // Listen for auth changes\n        const {\n            data: { subscription },\n        } = supabase.auth.onAuthStateChange((_event, session) => {\n            setSession(session);\n            setUser(session?.user ?? null);\n            setLoading(false);\n        });\n\n        return () => subscription.unsubscribe();\n    }, []);\n\n    const signIn = async (email: string, password: string) => {\n        const { error } = await supabase.auth.signInWithPassword({\n            email,\n            password,\n        });\n        return { error };\n    };\n\n    const signUp = async (email: string, password: string, metadata?: any) => {\n        const { error } = await supabase.auth.signUp({\n            email,\n            password,\n            options: {\n                data: metadata\n            }\n        });\n        return { error };\n    };\n\n    // Sign out user\n    // NOTE: This only clears the authentication session\n    // User data (subjects, sessions, goals) persists in:\n    // 1. localStorage with user-specific keys (study_planner_subjects_${userId})\n    // 2. Supabase database (synced automatically)\n    // Data will be restored when user logs back in\n    const signOut = async () => {\n        setIsGuest(false);\n        await supabase.auth.signOut();\n    };\n\n    const continueAsGuest = () => {\n        setIsGuest(true);\n        setUser({ id: 'guest', email: 'guest@example.com' } as User);\n    };\n\n    const value = {\n        user,\n        session,\n        loading,\n        signIn,\n        signUp,\n        signOut,\n        continueAsGuest,\n        isGuest,\n    };\n\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n    const context = useContext(AuthContext);\n    if (context === undefined) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\hooks\\useCallState.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'callState'. Either include it or remove the dependency array.","line":71,"column":8,"nodeType":"ArrayExpression","endLine":71,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [callState, userId]","fix":{"range":[3086,3094],"text":"[callState, userId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react';\r\nimport { CallData, CallNotificationManager } from '../utils/call-notifications';\r\n\r\nexport type CallState = 'idle' | 'calling' | 'ringing' | 'connecting' | 'connected' | 'ended' | 'failed';\r\n\r\nexport interface UseCallStateReturn {\r\n    callState: CallState;\r\n    currentCall: CallData | null;\r\n    incomingCall: CallData | null;\r\n    error: string | null;\r\n    rejectionFeedback: string | null;\r\n\r\n    initiateCall: (receiverId: string, receiverName: string, receiverAvatar?: string, type?: 'video' | 'audio') => Promise<string>;\r\n    acceptCall: () => void;\r\n    rejectCall: () => void;\r\n    endCall: () => void;\r\n    setCallState: (state: CallState) => void;\r\n    setError: (error: string | null) => void;\r\n    clearIncomingCall: () => void;\r\n}\r\n\r\nexport function useCallState(userId: string): UseCallStateReturn {\r\n    const [callState, setCallState] = useState<CallState>('idle');\r\n    const [currentCall, setCurrentCall] = useState<CallData | null>(null);\r\n    const [incomingCall, setIncomingCall] = useState<CallData | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [rejectionFeedback, setRejectionFeedback] = useState<string | null>(null);\r\n\r\n    // Subscribe to call notifications\r\n    useEffect(() => {\r\n        if (!userId) return;\r\n\r\n        console.log('Subscribing to call notifications for user:', userId);\r\n        const manager = new CallNotificationManager(userId);\r\n\r\n        manager.subscribe({\r\n            onIncomingCall: (call) => {\r\n                console.log('Incoming call notification received:', call);\r\n                setIncomingCall(call);\r\n                setCallState('ringing');\r\n            },\r\n            onCallCancelled: (callId) => {\r\n                console.log('Call cancelled notification received:', callId, 'Current call State:', callState);\r\n                setIncomingCall((prev) => (prev?.callId === callId ? null : prev));\r\n                setCurrentCall((prev) => (prev?.callId === callId ? null : prev));\r\n                setCallState((prev) => {\r\n                    console.log(`Transitioning state from ${prev} to idle due to cancellation`);\r\n                    if (prev === 'ringing' || prev === 'calling' || prev === 'connected' || prev === 'connecting') {\r\n                        return 'idle';\r\n                    }\r\n                    return prev;\r\n                });\r\n            },\r\n            onCallRejected: (callId) => {\r\n                console.log('Call rejected notification received:', callId);\r\n                setCallState((prev) => {\r\n                    if (prev === 'calling' || prev === 'ringing') {\r\n                        setRejectionFeedback(`Call rejected`);\r\n                        setTimeout(() => setRejectionFeedback(null), 3000);\r\n                        return 'idle';\r\n                    }\r\n                    return prev;\r\n                });\r\n                setCurrentCall(null);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            manager.unsubscribe();\r\n        };\r\n    }, [userId]);\r\n\r\n    /**\r\n     * Initiate an outgoing call\r\n     */\r\n    const initiateCall = useCallback(async (\r\n        receiverId: string,\r\n        receiverName: string,\r\n        receiverAvatar?: string,\r\n        type: 'video' | 'audio' = 'video'\r\n    ): Promise<string> => {\r\n        try {\r\n            const callId = `call_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n            const callData: CallData = {\r\n                callId,\r\n                callerId: userId,\r\n                callerName: 'You', // This will be replaced with actual user name\r\n                callerAvatar: undefined, // This will be replaced with actual user avatar\r\n                receiverId,\r\n                type,\r\n                timestamp: Date.now()\r\n            };\r\n\r\n            console.log(`ðŸ“ž Calling ${receiverName}...`);\r\n            if (receiverAvatar) console.log(`Avatar: ${receiverAvatar}`);\r\n\r\n            setCurrentCall(callData);\r\n            setCallState('calling');\r\n            setError(null);\r\n            setRejectionFeedback(null);\r\n\r\n            // Send call notification to receiver\r\n            await CallNotificationManager.sendCallNotification(callData);\r\n\r\n            console.log('ðŸ“ž Call initiated:', callId);\r\n            return callId;\r\n        } catch (err) {\r\n            console.error('Error initiating call:', err);\r\n            setError('Failed to initiate call');\r\n            setCallState('failed');\r\n            throw err;\r\n        }\r\n    }, [userId]);\r\n\r\n    /**\r\n     * Accept an incoming call\r\n     */\r\n    const acceptCall = useCallback(() => {\r\n        if (!incomingCall) {\r\n            console.warn('No incoming call to accept');\r\n            return;\r\n        }\r\n\r\n        console.log('âœ… Accepting call:', incomingCall.callId);\r\n        setCurrentCall(incomingCall);\r\n        setCallState('connecting');\r\n        setError(null);\r\n        // Don't clear incomingCall yet - let the component handle it\r\n    }, [incomingCall]);\r\n\r\n    /**\r\n     * Reject an incoming call\r\n     */\r\n    const rejectCall = useCallback(() => {\r\n        if (!incomingCall) {\r\n            console.warn('No incoming call to reject');\r\n            return;\r\n        }\r\n\r\n        console.log('âŒ Rejecting call:', incomingCall.callId);\r\n\r\n        // Send rejection notification to caller\r\n        CallNotificationManager.rejectCallNotification(incomingCall.callId, incomingCall.callerId);\r\n\r\n        setIncomingCall(null);\r\n        setCallState('idle');\r\n        setError(null);\r\n    }, [incomingCall]);\r\n\r\n    /**\r\n     * End the current call\r\n     */\r\n    const endCall = useCallback(() => {\r\n        const idToEnd = currentCall?.callId || incomingCall?.callId;\r\n        console.log('ðŸ“ž Ending call:', idToEnd, 'State:', callState);\r\n\r\n        if (idToEnd) {\r\n            CallNotificationManager.cancelCallNotification(idToEnd,\r\n                currentCall ? currentCall.receiverId : incomingCall!.callerId);\r\n        }\r\n\r\n        setCallState('ended');\r\n        setCurrentCall(null);\r\n        setIncomingCall(null);\r\n        setError(null);\r\n\r\n        // Reset to idle after a short delay\r\n        setTimeout(() => setCallState('idle'), 1000);\r\n    }, [currentCall, incomingCall, callState]);\r\n\r\n    /**\r\n     * Clear incoming call (used after accepting)\r\n     */\r\n    const clearIncomingCall = useCallback(() => {\r\n        setIncomingCall(null);\r\n    }, []);\r\n\r\n    return {\r\n        callState,\r\n        currentCall,\r\n        incomingCall,\r\n        error,\r\n        rejectionFeedback,\r\n        initiateCall,\r\n        acceptCall,\r\n        rejectCall,\r\n        endCall,\r\n        setCallState,\r\n        setError,\r\n        clearIncomingCall\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\test-auth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1035,1038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1035,1038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface Subject {\n  id: string;\n  name: string;\n  color: string;\n  difficulty: number;\n  priority: number;\n  targetHoursPerWeek: number;\n  targetHoursPerDay?: number;\n}\n\nexport interface StudySession {\n  id: string;\n  subjectId: string;\n  startTime: Date;\n  endTime?: Date;\n  durationMinutes?: number;\n  focusRating?: number;\n  notes: string;\n  completed: boolean;\n}\n\nexport interface StudyGoal {\n  id: string;\n  subjectId?: string;\n  subjectIds?: string[]; // For exams with multiple subjects\n  title: string;\n  description: string;\n  targetDate?: Date;\n  completed: boolean;\n  completedAt?: Date;\n  isExam?: boolean;\n  examDate?: Date;\n  examTime?: string;\n  examLocation?: string;\n  studyHoursTarget?: number;\n}\n\nexport interface ScheduleSlot {\n  id: string;\n  subjectId: string;\n  dayOfWeek: number;\n  startTime: string;\n  endTime: string;\n  isActive: boolean;\n}\n\nexport interface ProductivityInsight {\n  type: 'peak_hours' | 'weak_subjects' | 'streak' | 'recommendation';\n  title: string;\n  description: string;\n  data?: any;\n}\n\nexport interface Mentor {\n  id: string;\n  name: string;\n  username?: string;\n  avatarUrl: string;\n  domain: string[]; // e.g., ['Web Dev', 'DSA', 'AI/ML']\n  experienceYears?: number;\n  company?: string;\n  college?: string;\n  bio: string;\n  skills: string[];\n  languages: string[];\n  rating: number;\n  totalReviews: number;\n  isVerified: boolean;\n  offerings?: MentorshipOffering[];\n  reviews?: SessionReview[];\n}\n\nexport interface MentorshipOffering {\n  id: string;\n  mentorId: string;\n  title: string; // '1:1 Mentorship', 'Doubt Solving', etc.\n  description: string;\n  durationMinutes: number;\n  mode: 'chat' | 'call' | 'video';\n  isFree: boolean;\n  price: number;\n  isActive: boolean;\n}\n\nexport interface SessionReview {\n  id: string;\n  rating: number;\n  reviewText?: string;\n  createdAt: Date;\n  studentId: string;\n  studentName?: string;\n  studentAvatarUrl?: string;\n  studentUsername?: string;\n}\n\nexport interface SessionRequest {\n  id: string;\n  mentorId: string;\n  studentId: string;\n  offeringId?: string;\n  topic: string;\n  studentMessage: string;\n  preferredDate?: string;\n  preferredTime?: string;\n  status: 'pending' | 'accepted' | 'rejected' | 'completed' | 'cancelled';\n  mentorResponse?: string;\n  meetingLink?: string;\n  mode?: 'chat' | 'call' | 'video'; // Session mode set by mentor\n  createdAt: Date;\n  studentProfile?: UserProfile;\n  mentorProfile?: UserProfile;\n  offering?: MentorshipOffering; // Include offering details\n  review?: SessionReview; // Review for this session\n}\n\nexport interface Friend {\n  id: string;\n  name: string;\n  username?: string;\n  status: 'online' | 'offline' | 'studying';\n  currentSubject?: string;\n  studyStreak: number;\n  avatarUrl: string;\n  profilePicture?: string; // Real-time profile picture from database\n  lastActive?: Date;\n  role?: 'student' | 'mentor';\n  isActive?: boolean;\n}\n\nexport interface MentorSession {\n  id: string;\n  mentorId: string;\n  userId: string;\n  startTime: Date;\n  durationMinutes: number;\n  status: 'scheduled' | 'completed' | 'cancelled';\n  topic: string;\n}\n\nexport interface FriendRequest {\n  id: string;\n  senderId: string;\n  receiverId: string;\n  status: 'pending' | 'accepted' | 'rejected';\n  createdAt: Date;\n}\nexport interface UserProfile {\n  id: string;\n  userId: string;\n  fullName: string;\n  avatarUrl?: string;\n  role: 'student' | 'mentor';\n  phoneNumber?: string;\n  // Mentor specific\n  profession?: string;\n  experience?: string;\n  // Student specific\n  class?: string;\n  course?: string;\n  age?: number;\n  username?: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport interface Group {\n  id: string;\n  name: string;\n  avatarUrl?: string;\n  createdBy: string;\n  createdAt: Date;\n}\n\nexport interface GroupMember {\n  groupId: string;\n  userId: string;\n  role: 'admin' | 'member';\n  joinedAt: Date;\n  profile?: UserProfile; // Optional joined profile data\n}\n\nexport interface Message {\n  id: string;\n  senderId: string;\n  receiverId?: string;\n  groupId?: string;\n  content: string;\n  isRead: boolean;\n  createdAt: Date;\n  senderName?: string; // For UI convenience\n  senderAvatar?: string; // For UI convenience\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\analytics.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'currentDate' is never reassigned. Use 'const' instead.","line":193,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":193,"endColumn":18,"fix":{"range":[6594,6628],"text":"const currentDate = new Date(today);"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { StudySession, Subject, ProductivityInsight } from '../types';\n\nexport const calculateStudyStats = (sessions: StudySession[], subjects: Subject[]) => {\n  const totalMinutes = sessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n  const totalHours = Math.round((totalMinutes / 60) * 10) / 10;\n\n  const completedSessions = sessions.filter(s => s.completed).length;\n  const completionRate = sessions.length > 0\n    ? Math.round((completedSessions / sessions.length) * 100)\n    : 0;\n\n  const avgFocusRating = sessions.filter(s => s.focusRating).length > 0\n    ? Math.round(\n        sessions\n          .filter(s => s.focusRating)\n          .reduce((sum, s) => sum + (s.focusRating || 0), 0) /\n        sessions.filter(s => s.focusRating).length * 10\n      ) / 10\n    : 0;\n\n  const subjectBreakdown = subjects.map(subject => {\n    const subjectSessions = sessions.filter(s => s.subjectId === subject.id);\n    const subjectMinutes = subjectSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n    return {\n      subject: subject.name,\n      color: subject.color,\n      hours: Math.round((subjectMinutes / 60) * 10) / 10,\n      sessions: subjectSessions.length,\n    };\n  }).filter(s => s.hours > 0);\n\n  return {\n    totalHours,\n    totalSessions: sessions.length,\n    completionRate,\n    avgFocusRating,\n    subjectBreakdown,\n  };\n};\n\nexport const calculateDailyCompletionRate = (sessions: StudySession[], subjects: Subject[]) => {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  const todaySessions = sessions.filter(s => {\n    const sessionDate = new Date(s.startTime);\n    sessionDate.setHours(0, 0, 0, 0);\n    return sessionDate.getTime() === today.getTime();\n  });\n\n  const todayMinutes = todaySessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n  const todayHours = todayMinutes / 60;\n\n  const totalDailyTarget = subjects.reduce((sum, subject) => {\n    return sum + (subject.targetHoursPerDay || 0);\n  }, 0);\n\n  const dailyCompletionRate = totalDailyTarget > 0 \n    ? Math.round((todayHours / totalDailyTarget) * 100)\n    : 0;\n\n  const subjectProgress = subjects.map(subject => {\n    const subjectTodaySessions = todaySessions.filter(s => s.subjectId === subject.id);\n    const subjectTodayMinutes = subjectTodaySessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n    const subjectTodayHours = subjectTodayMinutes / 60;\n    const subjectTarget = subject.targetHoursPerDay || 0;\n    const subjectCompletion = subjectTarget > 0 ? Math.round((subjectTodayHours / subjectTarget) * 100) : 0;\n\n    return {\n      subject: subject.name,\n      color: subject.color,\n      hoursStudied: Math.round(subjectTodayHours * 10) / 10,\n      targetHours: subjectTarget,\n      completionRate: Math.min(subjectCompletion, 100),\n    };\n  }).filter(s => s.targetHours > 0);\n\n  return {\n    todayHours: Math.round(todayHours * 10) / 10,\n    totalDailyTarget,\n    dailyCompletionRate: Math.min(dailyCompletionRate, 100),\n    subjectProgress,\n  };\n};\n\nexport const generateInsights = (\n  sessions: StudySession[],\n  subjects: Subject[]\n): ProductivityInsight[] => {\n  const insights: ProductivityInsight[] = [];\n\n  if (sessions.length === 0) {\n    insights.push({\n      type: 'recommendation',\n      title: 'Start Your Study Journey',\n      description: 'Add your subjects and start your first study session to get personalized insights.',\n    });\n    return insights;\n  }\n\n  const hourCounts = new Array(24).fill(0);\n  sessions.forEach(session => {\n    const hour = new Date(session.startTime).getHours();\n    hourCounts[hour]++;\n  });\n\n  const peakHour = hourCounts.indexOf(Math.max(...hourCounts));\n  if (sessions.length >= 5) {\n    insights.push({\n      type: 'peak_hours',\n      title: 'Peak Productivity Hour',\n      description: `You're most productive at ${peakHour}:00. Consider scheduling important subjects during this time.`,\n      data: { hour: peakHour },\n    });\n  }\n\n  const recentSessions = sessions.slice(-7);\n  const consecutiveDays = new Set(\n    recentSessions.map(s => new Date(s.startTime).toDateString())\n  ).size;\n\n  if (consecutiveDays >= 3) {\n    insights.push({\n      type: 'streak',\n      title: `${consecutiveDays}-Day Streak!`,\n      description: `You've studied for ${consecutiveDays} days. Keep the momentum going!`,\n      data: { days: consecutiveDays },\n    });\n  }\n\n  const subjectPerformance = subjects.map(subject => {\n    const subjectSessions = sessions.filter(s => s.subjectId === subject.id);\n    const avgFocus = subjectSessions.filter(s => s.focusRating).length > 0\n      ? subjectSessions.reduce((sum, s) => sum + (s.focusRating || 0), 0) /\n        subjectSessions.filter(s => s.focusRating).length\n      : 0;\n    return { subject, avgFocus, sessionCount: subjectSessions.length };\n  });\n\n  const weakSubject = subjectPerformance\n    .filter(s => s.sessionCount >= 2)\n    .sort((a, b) => a.avgFocus - b.avgFocus)[0];\n\n  if (weakSubject && weakSubject.avgFocus < 3) {\n    insights.push({\n      type: 'weak_subjects',\n      title: 'Focus Improvement Needed',\n      description: `Your focus rating for ${weakSubject.subject.name} is below average. Try shorter sessions or different study techniques.`,\n      data: { subject: weakSubject.subject.name },\n    });\n  }\n\n  const now = new Date();\n  const thisWeek = sessions.filter(s => {\n    const sessionDate = new Date(s.startTime);\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    return sessionDate >= weekAgo;\n  });\n\n  subjects.forEach(subject => {\n    const subjectWeekSessions = thisWeek.filter(s => s.subjectId === subject.id);\n    const weekMinutes = subjectWeekSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n    const weekHours = weekMinutes / 60;\n\n    if (weekHours < subject.targetHoursPerWeek * 0.7 && subject.targetHoursPerWeek > 0) {\n      insights.push({\n        type: 'recommendation',\n        title: `Behind Schedule: ${subject.name}`,\n        description: `You've studied ${Math.round(weekHours * 10) / 10}h this week. Target is ${subject.targetHoursPerWeek}h. Consider adding more sessions.`,\n        data: { subject: subject.name, current: weekHours, target: subject.targetHoursPerWeek },\n      });\n    }\n  });\n\n  return insights;\n};\n\nexport const calculateStreak = (sessions: StudySession[]): number => {\n  if (sessions.length === 0) return 0;\n\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  const sessionDates = new Set(\n    sessions.map(s => {\n      const date = new Date(s.startTime);\n      date.setHours(0, 0, 0, 0);\n      return date.getTime();\n    })\n  );\n\n  let streak = 0;\n  let currentDate = new Date(today);\n\n  // Check if there's a session today or yesterday (to account for ongoing streaks)\n  if (!sessionDates.has(currentDate.getTime())) {\n    currentDate.setDate(currentDate.getDate() - 1);\n    if (!sessionDates.has(currentDate.getTime())) {\n      return 0;\n    }\n  }\n\n  // Count consecutive days backwards\n  while (sessionDates.has(currentDate.getTime())) {\n    streak++;\n    currentDate.setDate(currentDate.getDate() - 1);\n  }\n\n  return streak;\n};\n\nexport const getWeeklyProgress = (sessions: StudySession[], subjects: Subject[] = []) => {\n  const now = new Date();\n  \n  // Calculate the start of the current week (Sunday)\n  const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.\n  const startOfWeek = new Date(now);\n  startOfWeek.setDate(now.getDate() - currentDay);\n  startOfWeek.setHours(0, 0, 0, 0);\n\n  const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n  const dayAbbreviations = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  \n  // Calculate total daily target from all subjects\n  const totalDailyTarget = subjects.reduce((sum, subject) => {\n    return sum + (subject.targetHoursPerDay || 0);\n  }, 0);\n  \n  const dailyData = days.map((dayName, index) => {\n    const targetDate = new Date(startOfWeek);\n    targetDate.setDate(startOfWeek.getDate() + index);\n\n    const daySessions = sessions.filter(s => {\n      const sessionDate = new Date(s.startTime);\n      sessionDate.setHours(0, 0, 0, 0);\n      return sessionDate.getTime() === targetDate.getTime();\n    });\n\n    const minutes = daySessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n    const hours = Math.round((minutes / 60) * 10) / 10;\n\n    // Calculate completion rate based on daily target\n    const completionRate = totalDailyTarget > 0 \n      ? Math.min(Math.round((hours / totalDailyTarget) * 100), 100)\n      : 0;\n\n    // Check if this day is today\n    const isToday = targetDate.toDateString() === now.toDateString();\n    \n    // Check if this day is in the future\n    const isFuture = targetDate > now;\n\n    return {\n      day: dayAbbreviations[index],\n      fullDay: dayName,\n      date: targetDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\n      hours,\n      completionRate,\n      isToday,\n      isFuture,\n    };\n  });\n\n  return dailyData;\n};\n\nexport const calculateWeeklySubjectProgress = (sessions: StudySession[], subjects: Subject[]) => {\n  const now = new Date();\n  const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n  const thisWeekSessions = sessions.filter(s => {\n    const sessionDate = new Date(s.startTime);\n    return sessionDate >= weekAgo && sessionDate <= now;\n  });\n\n  const subjectProgress = subjects.map(subject => {\n    const subjectWeekSessions = thisWeekSessions.filter(s => s.subjectId === subject.id);\n    const weekMinutes = subjectWeekSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0);\n    const weekHours = weekMinutes / 60;\n    const weeklyTarget = subject.targetHoursPerWeek || 0;\n    const completionRate = weeklyTarget > 0 ? Math.round((weekHours / weeklyTarget) * 100) : 0;\n\n    return {\n      subject: subject.name,\n      color: subject.color,\n      hoursStudied: Math.round(weekHours * 10) / 10,\n      targetHours: weeklyTarget,\n      completionRate: Math.min(completionRate, 100),\n    };\n  }).filter(s => s.targetHours > 0);\n\n  const totalWeeklyTarget = subjects.reduce((sum, subject) => sum + (subject.targetHoursPerWeek || 0), 0);\n  const totalWeekHours = thisWeekSessions.reduce((sum, s) => sum + (s.durationMinutes || 0), 0) / 60;\n  const overallWeeklyCompletion = totalWeeklyTarget > 0 ? Math.round((totalWeekHours / totalWeeklyTarget) * 100) : 0;\n\n  return {\n    subjectProgress,\n    totalWeekHours: Math.round(totalWeekHours * 10) / 10,\n    totalWeeklyTarget,\n    overallWeeklyCompletion: Math.min(overallWeeklyCompletion, 100),\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\call-notifications.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1231,1234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1231,1234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1563,1566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1563,1566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1889,1892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1889,1892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabase';\r\n\r\nexport interface CallData {\r\n    callId: string;\r\n    callerId: string;\r\n    callerName: string;\r\n    callerAvatar?: string;\r\n    receiverId: string;\r\n    type: 'video' | 'audio';\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CallNotificationCallback {\r\n    onIncomingCall: (call: CallData) => void;\r\n    onCallCancelled: (callId: string) => void;\r\n    onCallRejected: (callId: string) => void;\r\n}\r\n\r\nexport class CallNotificationManager {\r\n    private channel: any = null;\r\n    private userId: string;\r\n    private callbacks: CallNotificationCallback | null = null;\r\n\r\n    constructor(userId: string) {\r\n        this.userId = userId;\r\n    }\r\n\r\n    /**\r\n     * Subscribe to incoming call notifications\r\n     */\r\n    public subscribe(callbacks: CallNotificationCallback): void {\r\n        this.callbacks = callbacks;\r\n\r\n        // Remove existing channel if any\r\n        if (this.channel) {\r\n            supabase.removeChannel(this.channel);\r\n        }\r\n\r\n        // Create a channel for this user's call notifications\r\n        this.channel = supabase.channel(`call-notifications:${this.userId}`);\r\n\r\n        this.channel\r\n            .on('broadcast', { event: 'incoming-call' }, (payload: any) => {\r\n                console.log('ðŸ“ž Incoming call notification:', payload.payload);\r\n                if (payload.payload.receiverId === this.userId) {\r\n                    this.callbacks?.onIncomingCall(payload.payload);\r\n                }\r\n            })\r\n            .on('broadcast', { event: 'call-cancelled' }, (payload: any) => {\r\n                console.log('âŒ Call cancelled:', payload.payload);\r\n                if (payload.payload.receiverId === this.userId) {\r\n                    this.callbacks?.onCallCancelled(payload.payload.callId);\r\n                }\r\n            })\r\n            .on('broadcast', { event: 'call-rejected' }, (payload: any) => {\r\n                console.log('ðŸš« Call rejected:', payload.payload);\r\n                if (payload.payload.receiverId === this.userId) {\r\n                    this.callbacks?.onCallRejected(payload.payload.callId);\r\n                }\r\n            })\r\n            .subscribe((status: string) => {\r\n                console.log(`Call notification channel status: ${status}`);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Unsubscribe from call notifications\r\n     */\r\n    public unsubscribe(): void {\r\n        if (this.channel) {\r\n            supabase.removeChannel(this.channel);\r\n            this.channel = null;\r\n        }\r\n        this.callbacks = null;\r\n    }\r\n\r\n    /**\r\n     * Send a call notification to a specific user\r\n     */\r\n    public static async sendCallNotification(callData: CallData): Promise<void> {\r\n        const channel = supabase.channel(`call-notifications:${callData.receiverId}`);\r\n\r\n        try {\r\n            await channel.subscribe();\r\n\r\n            await channel.send({\r\n                type: 'broadcast',\r\n                event: 'incoming-call',\r\n                payload: callData\r\n            });\r\n\r\n            console.log('ðŸ“¤ Call notification sent to:', callData.receiverId);\r\n\r\n            // Keep channel open briefly to ensure delivery\r\n            setTimeout(() => {\r\n                supabase.removeChannel(channel);\r\n            }, 1000);\r\n        } catch (error) {\r\n            console.error('Error sending call notification:', error);\r\n            supabase.removeChannel(channel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send a call cancellation notification\r\n     */\r\n    public static async cancelCallNotification(callId: string, receiverId: string): Promise<void> {\r\n        const channel = supabase.channel(`call-notifications:${receiverId}`);\r\n\r\n        try {\r\n            await channel.subscribe();\r\n\r\n            await channel.send({\r\n                type: 'broadcast',\r\n                event: 'call-cancelled',\r\n                payload: { callId, receiverId }\r\n            });\r\n\r\n            console.log('ðŸ“¤ Call cancellation sent to:', receiverId);\r\n\r\n            setTimeout(() => {\r\n                supabase.removeChannel(channel);\r\n            }, 1000);\r\n        } catch (error) {\r\n            console.error('Error sending call cancellation:', error);\r\n            supabase.removeChannel(channel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send a call rejection notification\r\n     */\r\n    public static async rejectCallNotification(callId: string, receiverId: string): Promise<void> {\r\n        const channel = supabase.channel(`call-notifications:${receiverId}`);\r\n\r\n        try {\r\n            await channel.subscribe();\r\n\r\n            await channel.send({\r\n                type: 'broadcast',\r\n                event: 'call-rejected',\r\n                payload: { callId, receiverId }\r\n            });\r\n\r\n            console.log('ðŸ“¤ Call rejection sent to:', receiverId);\r\n\r\n            setTimeout(() => {\r\n                supabase.removeChannel(channel);\r\n            }, 1000);\r\n        } catch (error) {\r\n            console.error('Error sending call rejection:', error);\r\n            supabase.removeChannel(channel);\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\database.ts","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected keyword or identifier.","line":138,"column":0}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabase';\nimport { Subject, StudySession, StudyGoal, ScheduleSlot } from '../types';\n\n// User Profile Data\nexport interface UserProfile {\n  id: string;\n  user_id: string;\n  full_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  study_preferences?: {\n    defaultSessionDuration: number;\n    reminderEnabled: boolean;\n    reminderTime: string;\n    darkMode: boolean;\n    focusMode: boolean;\n  };\n  academic_info?: {\n    institution?: string;\n    degree?: string;\n    year?: string;\n    gpa?: number;\n  };\n  created_at: string;\n  updated_at: string;\n}\n\n// Database operations for user profiles\nexport const userProfileService = {\n  // Get user profile\n  async getProfile(userId: string): Promise<UserProfile | null> {\n    const { data, error } = await supabase\n      .from('user_profiles')\n      .select('*')\n      .eq('user_id', userId)\n      .single();\n\n    if (error && error.code !== 'PGRST116') {\n      console.error('Error fetching profile:', error);\n      return null;\n    }\n\n    return data;\n  },\n\n  // Create or update user profile\n  async upsertProfile(profile: Partial<UserProfile>): Promise<UserProfile | null> {\n    const { data, error } = await supabase\n      .from('user_profiles')\n      .upsert(profile, { onConflict: 'user_id' })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error upserting profile:', error);\n      return null;\n    }\n\n    return data;\n  },\n\n  // Update specific profile fields\n  async updateProfile(userId: string, updates: Partial<UserProfile>): Promise<boolean> {\n    const { error } = await supabase\n      .from('user_profiles')\n      .update({ ...updates, updated_at: new Date().toISOString() })\n      .eq('user_id', userId);\n\n    if (error) {\n      console.error('Error updating profile:', error);\n      return false;\n    }\n\n    return true;\n  }\n};\n\n// Database operations for subjects\nexport const subjectService = {\n  async getSubjects(userId: string): Promise<Subject[]> {\n    const { data, error } = await supabase\n      .from('subjects')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: true });\n\n    if (error) {\n      console.error('Error fetching subjects:', error);\n      return [];\n    }\n\n    return data || [];\n  },\n\n  async createSubject(userId: string, subject: Omit<Subject, 'id'>): Promise<Subject | null> {\n    const { data, error } = await supabase\n      .from('subjects')\n      .insert({ ...subject, user_id: userId })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating subject:', error);\n      return null;\n    }\n\n    return data;\n  },\n\n  async updateSubject(subjectId: string, updates: Partial<Subject>): Promise<boolean> {\n    const { error } = await supabase\n      .from('subjects')\n      .update(updates)\n      .eq('id', subjectId);\n\n    if (error) {\n      console.error('Error updating subject:', error);\n      return false;\n    }\n\n    return true;\n  },\n\n  async deleteSubject(subjectId: string): Promise<boolean> {\n    const { error } = await supabase\n      .from('subjects')\n      .delete()\n      .eq('id', subjectId);\n\n    if (error) {\n      console.error('Error deleting subject:', error);\n      return false;\n    }\n\n    return true;\n  }\n};// Databa\nse operations for study sessions\nexport const studySessionService = {\n  async getSessions(userId: string, limit?: number): Promise<StudySession[]> {\n    let query = supabase\n      .from('study_sessions')\n      .select('*')\n      .eq('user_id', userId)\n      .order('start_time', { ascending: false });\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    const { data, error } = await query;\n\n    if (error) {\n      console.error('Error fetching study sessions:', error);\n      return [];\n    }\n\n    return data?.map(session => ({\n      ...session,\n      startTime: new Date(session.start_time),\n      endTime: session.end_time ? new Date(session.end_time) : undefined\n    })) || [];\n  },\n\n  async createSession(userId: string, session: Omit<StudySession, 'id'>): Promise<StudySession | null> {\n    const { data, error } = await supabase\n      .from('study_sessions')\n      .insert({\n        ...session,\n        user_id: userId,\n        start_time: session.startTime.toISOString(),\n        end_time: session.endTime?.toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating study session:', error);\n      return null;\n    }\n\n    return {\n      ...data,\n      startTime: new Date(data.start_time),\n      endTime: data.end_time ? new Date(data.end_time) : undefined\n    };\n  },\n\n  async updateSession(sessionId: string, updates: Partial<StudySession>): Promise<boolean> {\n    const dbUpdates: any = { ...updates };\n    \n    if (updates.startTime) {\n      dbUpdates.start_time = updates.startTime.toISOString();\n      delete dbUpdates.startTime;\n    }\n    \n    if (updates.endTime) {\n      dbUpdates.end_time = updates.endTime.toISOString();\n      delete dbUpdates.endTime;\n    }\n\n    const { error } = await supabase\n      .from('study_sessions')\n      .update(dbUpdates)\n      .eq('id', sessionId);\n\n    if (error) {\n      console.error('Error updating study session:', error);\n      return false;\n    }\n\n    return true;\n  }\n};\n\n// Database operations for study goals\nexport const studyGoalService = {\n  async getGoals(userId: string): Promise<StudyGoal[]> {\n    const { data, error } = await supabase\n      .from('study_goals')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching study goals:', error);\n      return [];\n    }\n\n    return data?.map(goal => ({\n      ...goal,\n      targetDate: goal.target_date ? new Date(goal.target_date) : undefined,\n      completedAt: goal.completed_at ? new Date(goal.completed_at) : undefined,\n      examDate: goal.exam_date ? new Date(goal.exam_date) : undefined\n    })) || [];\n  },\n\n  async createGoal(userId: string, goal: Omit<StudyGoal, 'id'>): Promise<StudyGoal | null> {\n    const { data, error } = await supabase\n      .from('study_goals')\n      .insert({\n        ...goal,\n        user_id: userId,\n        target_date: goal.targetDate?.toISOString(),\n        completed_at: goal.completedAt?.toISOString(),\n        exam_date: goal.examDate?.toISOString(),\n        subject_ids: goal.subjectIds\n      })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error creating study goal:', error);\n      return null;\n    }\n\n    return {\n      ...data,\n      targetDate: data.target_date ? new Date(data.target_date) : undefined,\n      completedAt: data.completed_at ? new Date(data.completed_at) : undefined,\n      examDate: data.exam_date ? new Date(data.exam_date) : undefined,\n      subjectIds: data.subject_ids\n    };\n  },\n\n  async updateGoal(goalId: string, updates: Partial<StudyGoal>): Promise<boolean> {\n    const dbUpdates: any = { ...updates };\n    \n    if (updates.targetDate) {\n      dbUpdates.target_date = updates.targetDate.toISOString();\n      delete dbUpdates.targetDate;\n    }\n    \n    if (updates.completedAt) {\n      dbUpdates.completed_at = updates.completedAt.toISOString();\n      delete dbUpdates.completedAt;\n    }\n    \n    if (updates.examDate) {\n      dbUpdates.exam_date = updates.examDate.toISOString();\n      delete dbUpdates.examDate;\n    }\n\n    if (updates.subjectIds) {\n      dbUpdates.subject_ids = updates.subjectIds;\n      delete dbUpdates.subjectIds;\n    }\n\n    const { error } = await supabase\n      .from('study_goals')\n      .update(dbUpdates)\n      .eq('id', goalId);\n\n    if (error) {\n      console.error('Error updating study goal:', error);\n      return false;\n    }\n\n    return true;\n  }\n};","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[582,585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[582,585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[905,908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[905,908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1237,1240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1237,1240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1513,1516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1513,1516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1803,1806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1803,1806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2318,2321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2318,2321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2930,2933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2930,2933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":183,"column":17,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":183,"endColumn":92,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5301,5617],"text":"{ const durationStr = entry.duration ? `${entry.duration.toFixed(2)}ms` : '';\r\n                console.log(\r\n                    `%c${prefix} ${entry.message} ${durationStr}`,\r\n                    'color: #10b981; font-weight: bold',\r\n                    entry.context || ''\r\n                );\r\n                break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6245,6248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6245,6248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Structured Logger for Production-Grade Observability\r\n * \r\n * Features:\r\n * - Multiple log levels (debug, info, warn, error)\r\n * - Performance tracking\r\n * - Contextual metadata\r\n * - Console formatting with colors\r\n * - Future: Can be extended to send to external services (Sentry, LogRocket, etc.)\r\n */\r\n\r\nexport enum LogLevel {\r\n    DEBUG = 'DEBUG',\r\n    INFO = 'INFO',\r\n    WARN = 'WARN',\r\n    ERROR = 'ERROR',\r\n    PERFORMANCE = 'PERFORMANCE',\r\n}\r\n\r\ninterface LogEntry {\r\n    level: LogLevel;\r\n    message: string;\r\n    timestamp: string;\r\n    context?: Record<string, any>;\r\n    error?: Error;\r\n    duration?: number;\r\n}\r\n\r\nclass Logger {\r\n    private isDevelopment = import.meta.env.DEV;\r\n    private logHistory: LogEntry[] = [];\r\n    private maxHistorySize = 100;\r\n\r\n    /**\r\n     * Log debug information (only in development)\r\n     */\r\n    debug(message: string, context?: Record<string, any>): void {\r\n        if (!this.isDevelopment) return;\r\n\r\n        this.log({\r\n            level: LogLevel.DEBUG,\r\n            message,\r\n            timestamp: new Date().toISOString(),\r\n            context,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Log general information\r\n     */\r\n    info(message: string, context?: Record<string, any>): void {\r\n        this.log({\r\n            level: LogLevel.INFO,\r\n            message,\r\n            timestamp: new Date().toISOString(),\r\n            context,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Log warnings\r\n     */\r\n    warn(message: string, context?: Record<string, any>): void {\r\n        this.log({\r\n            level: LogLevel.WARN,\r\n            message,\r\n            timestamp: new Date().toISOString(),\r\n            context,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Log errors\r\n     */\r\n    error(message: string, error?: Error, context?: Record<string, any>): void {\r\n        this.log({\r\n            level: LogLevel.ERROR,\r\n            message,\r\n            timestamp: new Date().toISOString(),\r\n            context,\r\n            error,\r\n        });\r\n\r\n        // In production, send to error tracking service\r\n        if (!this.isDevelopment && error) {\r\n            this.sendToErrorTracking(message, error, context);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Log performance metrics\r\n     */\r\n    performance(operation: string, duration: number, context?: Record<string, any>): void {\r\n        this.log({\r\n            level: LogLevel.PERFORMANCE,\r\n            message: `${operation} completed`,\r\n            timestamp: new Date().toISOString(),\r\n            duration,\r\n            context,\r\n        });\r\n\r\n        // Warn if operation is slow\r\n        if (duration > 1000) {\r\n            this.warn(`Slow operation detected: ${operation}`, { duration, ...context });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Measure and log performance of an async operation\r\n     */\r\n    async measureAsync<T>(\r\n        operation: string,\r\n        fn: () => Promise<T>,\r\n        context?: Record<string, any>\r\n    ): Promise<T> {\r\n        const startTime = performance.now();\r\n\r\n        try {\r\n            const result = await fn();\r\n            const duration = performance.now() - startTime;\r\n            this.performance(operation, duration, context);\r\n            return result;\r\n        } catch (error) {\r\n            const duration = performance.now() - startTime;\r\n            this.error(`${operation} failed`, error as Error, { duration, ...context });\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Measure and log performance of a sync operation\r\n     */\r\n    measure<T>(\r\n        operation: string,\r\n        fn: () => T,\r\n        context?: Record<string, any>\r\n    ): T {\r\n        const startTime = performance.now();\r\n\r\n        try {\r\n            const result = fn();\r\n            const duration = performance.now() - startTime;\r\n            this.performance(operation, duration, context);\r\n            return result;\r\n        } catch (error) {\r\n            const duration = performance.now() - startTime;\r\n            this.error(`${operation} failed`, error as Error, { duration, ...context });\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internal logging method\r\n     */\r\n    private log(entry: LogEntry): void {\r\n        // Add to history\r\n        this.logHistory.push(entry);\r\n        if (this.logHistory.length > this.maxHistorySize) {\r\n            this.logHistory.shift();\r\n        }\r\n\r\n        // Console output with formatting\r\n        const timestamp = new Date(entry.timestamp).toLocaleTimeString();\r\n        const prefix = `[${timestamp}] [${entry.level}]`;\r\n\r\n        switch (entry.level) {\r\n            case LogLevel.DEBUG:\r\n                console.debug(prefix, entry.message, entry.context || '');\r\n                break;\r\n            case LogLevel.INFO:\r\n                console.info(prefix, entry.message, entry.context || '');\r\n                break;\r\n            case LogLevel.WARN:\r\n                console.warn(prefix, entry.message, entry.context || '');\r\n                break;\r\n            case LogLevel.ERROR:\r\n                console.error(prefix, entry.message, entry.error || '', entry.context || '');\r\n                if (entry.error?.stack) {\r\n                    console.error(entry.error.stack);\r\n                }\r\n                break;\r\n            case LogLevel.PERFORMANCE:\r\n                const durationStr = entry.duration ? `${entry.duration.toFixed(2)}ms` : '';\r\n                console.log(\r\n                    `%c${prefix} ${entry.message} ${durationStr}`,\r\n                    'color: #10b981; font-weight: bold',\r\n                    entry.context || ''\r\n                );\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get recent log history\r\n     */\r\n    getHistory(level?: LogLevel): LogEntry[] {\r\n        if (level) {\r\n            return this.logHistory.filter(entry => entry.level === level);\r\n        }\r\n        return [...this.logHistory];\r\n    }\r\n\r\n    /**\r\n     * Clear log history\r\n     */\r\n    clearHistory(): void {\r\n        this.logHistory = [];\r\n    }\r\n\r\n    /**\r\n     * Send error to external tracking service\r\n     * TODO: Integrate with Sentry, LogRocket, or similar\r\n     */\r\n    private sendToErrorTracking(\r\n        message: string,\r\n        error: Error,\r\n        context?: Record<string, any>\r\n    ): void {\r\n        // Placeholder for external error tracking\r\n        // Example: Sentry.captureException(error, { extra: context });\r\n        console.log('ðŸ“¤ Would send to error tracking:', { message, error, context });\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const logger = new Logger();\r\n\r\n// Convenience exports\r\nexport const logDebug = logger.debug.bind(logger);\r\nexport const logInfo = logger.info.bind(logger);\r\nexport const logWarn = logger.warn.bind(logger);\r\nexport const logError = logger.error.bind(logger);\r\nexport const logPerformance = logger.performance.bind(logger);\r\nexport const measureAsync = logger.measureAsync.bind(logger);\r\nexport const measure = logger.measure.bind(logger);\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\matching-algorithm.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7333,7336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7333,7336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7418,7421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7418,7421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10997,11000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10997,11000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11094,11097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11094,11097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Intelligent Mentor-Student Matching Algorithm\r\n * \r\n * This algorithm matches students with the most suitable mentors based on:\r\n * - Skill/expertise alignment (50% weight)\r\n * - Availability overlap (20% weight)\r\n * - Mentor rating (20% weight)\r\n * - Past success with similar students (10% weight)\r\n * \r\n * FAANG-Level Features:\r\n * - Weighted scoring system\r\n * - Fuzzy skill matching\r\n * - Time zone aware availability\r\n * - Performance optimized with caching\r\n * - Comprehensive logging\r\n */\r\n\r\nimport { supabase } from './supabase';\r\n\r\nexport interface MatchingCriteria {\r\n    studentId: string;\r\n    studentNeeds: string[];      // Topics/skills needed (e.g., ['React', 'TypeScript', 'Web Dev'])\r\n    urgency: 'low' | 'medium' | 'high';\r\n    preferredMode: 'chat' | 'call' | 'video';\r\n    studentLevel: 'beginner' | 'intermediate' | 'advanced';\r\n    preferredDays?: string[];    // e.g., ['Monday', 'Wednesday']\r\n    preferredTimeSlots?: { start: string; end: string }[]; // e.g., [{ start: '14:00', end: '16:00' }]\r\n}\r\n\r\nexport interface MatchScore {\r\n    mentorId: string;\r\n    mentorName: string;\r\n    mentorAvatar?: string;\r\n    totalScore: number;\r\n    breakdown: {\r\n        skillMatch: number;        // 0-50 points\r\n        availability: number;      // 0-20 points\r\n        rating: number;            // 0-20 points\r\n        pastSuccess: number;       // 0-10 points\r\n    };\r\n    matchPercentage: number;     // 0-100%\r\n    reasoning: string[];         // Human-readable reasons for the match\r\n}\r\n\r\ninterface MentorProfile {\r\n    user_id: string;\r\n    full_name: string;\r\n    avatar_url?: string;\r\n    domain: string[];\r\n    skills: string[];\r\n    rating: number;\r\n    total_reviews: number;\r\n    total_sessions: number;\r\n    status: 'available' | 'in_session' | 'offline';\r\n    available_days: string[];\r\n    is_verified: boolean;\r\n}\r\n\r\n/**\r\n * Calculate skill match score (0-50 points)\r\n * Uses fuzzy matching to find skill overlap\r\n */\r\nfunction calculateSkillMatchScore(\r\n    studentNeeds: string[],\r\n    mentorSkills: string[],\r\n    mentorDomain: string[]\r\n): { score: number; matches: string[] } {\r\n    const normalizeSkill = (skill: string) => skill.toLowerCase().trim();\r\n\r\n    const normalizedNeeds = studentNeeds.map(normalizeSkill);\r\n    const normalizedMentorSkills = [...mentorSkills, ...mentorDomain].map(normalizeSkill);\r\n\r\n    let matchCount = 0;\r\n    const matches: string[] = [];\r\n\r\n    for (const need of normalizedNeeds) {\r\n        // Exact match\r\n        if (normalizedMentorSkills.includes(need)) {\r\n            matchCount++;\r\n            matches.push(need);\r\n            continue;\r\n        }\r\n\r\n        // Fuzzy match (partial string matching)\r\n        const fuzzyMatch = normalizedMentorSkills.find(skill =>\r\n            skill.includes(need) || need.includes(skill)\r\n        );\r\n\r\n        if (fuzzyMatch) {\r\n            matchCount += 0.7; // Partial credit for fuzzy match\r\n            matches.push(need);\r\n        }\r\n    }\r\n\r\n    // Calculate score: perfect match = 50 points\r\n    const matchRatio = studentNeeds.length > 0 ? matchCount / studentNeeds.length : 0;\r\n    const score = Math.min(50, matchRatio * 50);\r\n\r\n    return { score, matches };\r\n}\r\n\r\n/**\r\n * Calculate availability score (0-20 points)\r\n * Checks if mentor is available when student needs help\r\n */\r\nfunction calculateAvailabilityScore(\r\n    criteria: MatchingCriteria,\r\n    mentor: MentorProfile\r\n): { score: number; reason: string } {\r\n    let score = 0;\r\n    let reason = '';\r\n\r\n    // Check current status (10 points for available)\r\n    if (mentor.status === 'available') {\r\n        score += 10;\r\n        reason = 'Currently available';\r\n    } else if (mentor.status === 'offline') {\r\n        reason = 'Currently offline';\r\n    } else {\r\n        reason = 'Currently in session';\r\n    }\r\n\r\n    // Check day availability (10 points for matching days)\r\n    if (criteria.preferredDays && criteria.preferredDays.length > 0) {\r\n        const dayOverlap = criteria.preferredDays.filter(day =>\r\n            mentor.available_days.includes(day)\r\n        );\r\n\r\n        if (dayOverlap.length > 0) {\r\n            const dayMatchRatio = dayOverlap.length / criteria.preferredDays.length;\r\n            score += dayMatchRatio * 10;\r\n            reason += `, Available on ${dayOverlap.join(', ')}`;\r\n        }\r\n    } else {\r\n        // No preference specified, give partial credit\r\n        score += 5;\r\n    }\r\n\r\n    return { score, reason };\r\n}\r\n\r\n/**\r\n * Calculate rating score (0-20 points)\r\n * Higher rated mentors get more points\r\n */\r\nfunction calculateRatingScore(mentor: MentorProfile): { score: number; reason: string } {\r\n    // Rating is 0-5, normalize to 0-20\r\n    const score = (mentor.rating / 5) * 20;\r\n\r\n    let reason = `${mentor.rating.toFixed(1)} â­`;\r\n    if (mentor.total_reviews > 0) {\r\n        reason += ` (${mentor.total_reviews} reviews)`;\r\n    }\r\n    if (mentor.is_verified) {\r\n        reason += ' â€¢ Verified âœ“';\r\n    }\r\n\r\n    return { score, reason };\r\n}\r\n\r\n/**\r\n * Calculate past success score (0-10 points)\r\n * Based on total sessions and completion rate\r\n */\r\nfunction calculatePastSuccessScore(mentor: MentorProfile): { score: number; reason: string } {\r\n    // More sessions = more experience\r\n    const sessionScore = Math.min(5, (mentor.total_sessions / 20) * 5);\r\n\r\n    // High rating with many reviews = proven success\r\n    const successScore = mentor.total_reviews > 10 && mentor.rating >= 4.5 ? 5 : 0;\r\n\r\n    const score = sessionScore + successScore;\r\n    const reason = `${mentor.total_sessions} sessions completed`;\r\n\r\n    return { score, reason };\r\n}\r\n\r\n/**\r\n * Main matching function\r\n * Returns top N mentors ranked by match score\r\n */\r\nexport async function findBestMentors(\r\n    criteria: MatchingCriteria,\r\n    limit: number = 10\r\n): Promise<MatchScore[]> {\r\n    console.log('ðŸ” Starting mentor matching with criteria:', criteria);\r\n\r\n    try {\r\n        // Check cache first\r\n        const cachedScores = await getCachedMatchingScores(criteria.studentId);\r\n        if (cachedScores.length > 0) {\r\n            console.log('âœ… Using cached matching scores');\r\n            return cachedScores.slice(0, limit);\r\n        }\r\n\r\n        // Fetch all active mentors\r\n        const { data: mentorProfiles, error: mentorError } = await supabase\r\n            .from('mentor_profiles')\r\n            .select(`\r\n        user_id,\r\n        domain,\r\n        skills,\r\n        rating,\r\n        total_reviews,\r\n        total_sessions,\r\n        status,\r\n        available_days,\r\n        is_verified,\r\n        user_profiles!inner (\r\n          full_name,\r\n          avatar_url\r\n        )\r\n      `)\r\n            .is('deleted_at', null)\r\n            .order('rating', { ascending: false });\r\n\r\n        if (mentorError) {\r\n            console.error('Error fetching mentors:', mentorError);\r\n            throw mentorError;\r\n        }\r\n\r\n        if (!mentorProfiles || mentorProfiles.length === 0) {\r\n            console.log('âš ï¸ No mentors found');\r\n            return [];\r\n        }\r\n\r\n        console.log(`ðŸ“Š Evaluating ${mentorProfiles.length} mentors`);\r\n\r\n        // Calculate scores for each mentor\r\n        const scores: MatchScore[] = mentorProfiles.map(profile => {\r\n            const mentor: MentorProfile = {\r\n                user_id: profile.user_id,\r\n                full_name: (profile.user_profiles as any)?.full_name || 'Unknown',\r\n                avatar_url: (profile.user_profiles as any)?.avatar_url,\r\n                domain: profile.domain || [],\r\n                skills: profile.skills || [],\r\n                rating: profile.rating || 0,\r\n                total_reviews: profile.total_reviews || 0,\r\n                total_sessions: profile.total_sessions || 0,\r\n                status: profile.status || 'offline',\r\n                available_days: profile.available_days || [],\r\n                is_verified: profile.is_verified || false,\r\n            };\r\n\r\n            // Calculate individual scores\r\n            const skillResult = calculateSkillMatchScore(criteria.studentNeeds, mentor.skills, mentor.domain);\r\n            const availabilityResult = calculateAvailabilityScore(criteria, mentor);\r\n            const ratingResult = calculateRatingScore(mentor);\r\n            const successResult = calculatePastSuccessScore(mentor);\r\n\r\n            const totalScore =\r\n                skillResult.score +\r\n                availabilityResult.score +\r\n                ratingResult.score +\r\n                successResult.score;\r\n\r\n            // Build reasoning\r\n            const reasoning: string[] = [];\r\n            if (skillResult.matches.length > 0) {\r\n                reasoning.push(`Expertise in ${skillResult.matches.join(', ')}`);\r\n            }\r\n            if (availabilityResult.reason) {\r\n                reasoning.push(availabilityResult.reason);\r\n            }\r\n            reasoning.push(ratingResult.reason);\r\n            if (mentor.total_sessions > 0) {\r\n                reasoning.push(successResult.reason);\r\n            }\r\n\r\n            return {\r\n                mentorId: mentor.user_id,\r\n                mentorName: mentor.full_name,\r\n                mentorAvatar: mentor.avatar_url,\r\n                totalScore,\r\n                breakdown: {\r\n                    skillMatch: skillResult.score,\r\n                    availability: availabilityResult.score,\r\n                    rating: ratingResult.score,\r\n                    pastSuccess: successResult.score,\r\n                },\r\n                matchPercentage: Math.round((totalScore / 100) * 100),\r\n                reasoning,\r\n            };\r\n        });\r\n\r\n        // Sort by total score (descending)\r\n        scores.sort((a, b) => b.totalScore - a.totalScore);\r\n\r\n        // Cache the results\r\n        await cacheMatchingScores(criteria.studentId, scores);\r\n\r\n        console.log(`âœ… Matching complete. Top match: ${scores[0]?.mentorName} (${scores[0]?.matchPercentage}%)`);\r\n\r\n        return scores.slice(0, limit);\r\n\r\n    } catch (error) {\r\n        console.error('âŒ Error in matching algorithm:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Get cached matching scores if available and not expired\r\n */\r\nasync function getCachedMatchingScores(studentId: string): Promise<MatchScore[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('matching_scores')\r\n            .select(`\r\n        mentor_id,\r\n        total_score,\r\n        skill_match_score,\r\n        availability_score,\r\n        rating_score,\r\n        past_success_score,\r\n        mentor_profiles!inner (\r\n          user_profiles!inner (\r\n            full_name,\r\n            avatar_url\r\n          )\r\n        )\r\n      `)\r\n            .eq('student_id', studentId)\r\n            .gt('expires_at', new Date().toISOString())\r\n            .order('total_score', { ascending: false });\r\n\r\n        if (error || !data || data.length === 0) {\r\n            return [];\r\n        }\r\n\r\n        return data.map(item => ({\r\n            mentorId: item.mentor_id,\r\n            mentorName: (item.mentor_profiles as any)?.user_profiles?.full_name || 'Unknown',\r\n            mentorAvatar: (item.mentor_profiles as any)?.user_profiles?.avatar_url,\r\n            totalScore: item.total_score,\r\n            breakdown: {\r\n                skillMatch: item.skill_match_score,\r\n                availability: item.availability_score,\r\n                rating: item.rating_score,\r\n                pastSuccess: item.past_success_score,\r\n            },\r\n            matchPercentage: Math.round((item.total_score / 100) * 100),\r\n            reasoning: [], // Not cached\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching cached scores:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Cache matching scores for 1 hour\r\n */\r\nasync function cacheMatchingScores(studentId: string, scores: MatchScore[]): Promise<void> {\r\n    try {\r\n        const expiresAt = new Date();\r\n        expiresAt.setHours(expiresAt.getHours() + 1);\r\n\r\n        const cacheData = scores.map(score => ({\r\n            student_id: studentId,\r\n            mentor_id: score.mentorId,\r\n            total_score: score.totalScore,\r\n            skill_match_score: score.breakdown.skillMatch,\r\n            availability_score: score.breakdown.availability,\r\n            rating_score: score.breakdown.rating,\r\n            past_success_score: score.breakdown.pastSuccess,\r\n            expires_at: expiresAt.toISOString(),\r\n        }));\r\n\r\n        // Upsert cache data\r\n        const { error } = await supabase\r\n            .from('matching_scores')\r\n            .upsert(cacheData, {\r\n                onConflict: 'student_id,mentor_id',\r\n            });\r\n\r\n        if (error) {\r\n            console.error('Error caching scores:', error);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error in cacheMatchingScores:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Utility: Clear expired cache entries\r\n * Should be called periodically (e.g., daily cron job)\r\n */\r\nexport async function cleanupExpiredCache(): Promise<void> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('matching_scores')\r\n            .delete()\r\n            .lt('expires_at', new Date().toISOString());\r\n\r\n        if (error) {\r\n            console.error('Error cleaning up cache:', error);\r\n        } else {\r\n            console.log('âœ… Expired cache entries cleaned up');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error in cleanupExpiredCache:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Get recommended mentors for a student based on their past sessions\r\n */\r\nexport async function getRecommendedMentors(\r\n    studentId: string,\r\n    limit: number = 5\r\n): Promise<MatchScore[]> {\r\n    try {\r\n        // Get student's past session topics\r\n        const { data: pastSessions } = await supabase\r\n            .from('session_requests')\r\n            .select('topic, mentor_id')\r\n            .eq('student_id', studentId)\r\n            .eq('status', 'completed')\r\n            .order('created_at', { ascending: false })\r\n            .limit(10);\r\n\r\n        if (!pastSessions || pastSessions.length === 0) {\r\n            // No history, return top-rated mentors\r\n            return findBestMentors({\r\n                studentId,\r\n                studentNeeds: [],\r\n                urgency: 'low',\r\n                preferredMode: 'chat',\r\n                studentLevel: 'beginner',\r\n            }, limit);\r\n        }\r\n\r\n        // Extract topics/skills from past sessions\r\n        const topics = pastSessions\r\n            .map(s => s.topic)\r\n            .join(' ')\r\n            .split(/[\\s,]+/)\r\n            .filter(word => word.length > 3); // Filter out short words\r\n\r\n        // Use matching algorithm with inferred needs\r\n        return findBestMentors({\r\n            studentId,\r\n            studentNeeds: [...new Set(topics)], // Unique topics\r\n            urgency: 'low',\r\n            preferredMode: 'chat',\r\n            studentLevel: 'intermediate',\r\n        }, limit);\r\n\r\n    } catch (error) {\r\n        console.error('Error getting recommended mentors:', error);\r\n        return [];\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\realtime.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3128,3131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3128,3131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3888,3891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3888,3891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5802,5805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5802,5805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6461,6464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6461,6464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Real-Time Utilities for Mentor-Student Platform\r\n * \r\n * Provides real-time features using Supabase Realtime:\r\n * - Mentor status updates (available/in_session/offline)\r\n * - Typing indicators in chat\r\n * - Session request notifications\r\n * - Presence tracking\r\n */\r\n\r\nimport { supabase } from './supabase';\r\nimport { logger } from './logger';\r\n\r\n/**\r\n * Subscribe to mentor status changes\r\n */\r\nexport function subscribeMentorStatus(\r\n    onStatusChange: (mentorId: string, status: 'available' | 'in_session' | 'offline') => void\r\n) {\r\n    logger.info('Subscribing to mentor status updates');\r\n\r\n    return supabase\r\n        .channel('mentor-status-changes')\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'UPDATE',\r\n                schema: 'public',\r\n                table: 'mentor_profiles',\r\n                filter: 'deleted_at=is.null',\r\n            },\r\n            (payload) => {\r\n                const mentorId = payload.new.user_id;\r\n                const status = payload.new.status;\r\n                logger.debug('Mentor status changed', { mentorId, status });\r\n                onStatusChange(mentorId, status);\r\n            }\r\n        )\r\n        .subscribe();\r\n}\r\n\r\n/**\r\n * Update mentor status\r\n */\r\nexport async function updateMentorStatus(\r\n    mentorId: string,\r\n    status: 'available' | 'in_session' | 'offline'\r\n): Promise<void> {\r\n    logger.info('Updating mentor status', { mentorId, status });\r\n\r\n    const { error } = await supabase\r\n        .from('mentor_profiles')\r\n        .update({ status, updated_at: new Date().toISOString() })\r\n        .eq('user_id', mentorId);\r\n\r\n    if (error) {\r\n        logger.error('Failed to update mentor status', error, { mentorId, status });\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Typing indicator channel\r\n */\r\ninterface TypingState {\r\n    userId: string;\r\n    userName: string;\r\n    isTyping: boolean;\r\n    chatId: string; // Can be friendId or groupId\r\n}\r\n\r\nexport function subscribeTypingIndicators(\r\n    chatId: string,\r\n    onTypingChange: (state: TypingState) => void\r\n) {\r\n    logger.debug('Subscribing to typing indicators', { chatId });\r\n\r\n    const channel = supabase.channel(`typing:${chatId}`);\r\n\r\n    channel\r\n        .on('broadcast', { event: 'typing' }, (payload) => {\r\n            logger.debug('Typing indicator received', payload);\r\n            onTypingChange(payload.payload as TypingState);\r\n        })\r\n        .subscribe();\r\n\r\n    return channel;\r\n}\r\n\r\n/**\r\n * Broadcast typing status\r\n */\r\nexport async function broadcastTyping(\r\n    chatId: string,\r\n    userId: string,\r\n    userName: string,\r\n    isTyping: boolean\r\n): Promise<void> {\r\n    const channel = supabase.channel(`typing:${chatId}`);\r\n\r\n    await channel.subscribe();\r\n\r\n    await channel.send({\r\n        type: 'broadcast',\r\n        event: 'typing',\r\n        payload: {\r\n            userId,\r\n            userName,\r\n            isTyping,\r\n            chatId,\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Subscribe to session requests (for mentors)\r\n */\r\nexport function subscribeSessionRequests(\r\n    mentorId: string,\r\n    onNewRequest: (request: any) => void\r\n) {\r\n    logger.info('Subscribing to session requests', { mentorId });\r\n\r\n    return supabase\r\n        .channel(`session-requests:${mentorId}`)\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'INSERT',\r\n                schema: 'public',\r\n                table: 'session_requests',\r\n                filter: `mentor_id=eq.${mentorId}`,\r\n            },\r\n            (payload) => {\r\n                logger.info('New session request received', payload.new);\r\n                onNewRequest(payload.new);\r\n            }\r\n        )\r\n        .subscribe();\r\n}\r\n\r\n/**\r\n * Subscribe to session request updates (for students)\r\n */\r\nexport function subscribeSessionUpdates(\r\n    studentId: string,\r\n    onUpdate: (request: any) => void\r\n) {\r\n    logger.info('Subscribing to session updates', { studentId });\r\n\r\n    return supabase\r\n        .channel(`session-updates:${studentId}`)\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'UPDATE',\r\n                schema: 'public',\r\n                table: 'session_requests',\r\n                filter: `student_id=eq.${studentId}`,\r\n            },\r\n            (payload) => {\r\n                logger.info('Session request updated', payload.new);\r\n                onUpdate(payload.new);\r\n            }\r\n        )\r\n        .subscribe();\r\n}\r\n\r\n/**\r\n * Presence tracking for online users\r\n */\r\nexport function trackUserPresence(userId: string, userName: string) {\r\n    logger.info('Starting presence tracking', { userId, userName });\r\n\r\n    const channel = supabase.channel('online-users', {\r\n        config: {\r\n            presence: {\r\n                key: userId,\r\n            },\r\n        },\r\n    });\r\n\r\n    channel\r\n        .on('presence', { event: 'sync' }, () => {\r\n            const state = channel.presenceState();\r\n            logger.debug('Presence synced', { onlineUsers: Object.keys(state).length });\r\n        })\r\n        .on('presence', { event: 'join' }, ({ key, newPresences }) => {\r\n            logger.debug('User joined', { userId: key, presences: newPresences });\r\n        })\r\n        .on('presence', { event: 'leave' }, ({ key, leftPresences }) => {\r\n            logger.debug('User left', { userId: key, presences: leftPresences });\r\n        })\r\n        .subscribe(async (status) => {\r\n            if (status === 'SUBSCRIBED') {\r\n                await channel.track({\r\n                    userId,\r\n                    userName,\r\n                    onlineAt: new Date().toISOString(),\r\n                });\r\n            }\r\n        });\r\n\r\n    return channel;\r\n}\r\n\r\n/**\r\n * Get currently online users\r\n */\r\nexport function getOnlineUsers(channel: any): Array<{ userId: string; userName: string }> {\r\n    const state = channel.presenceState();\r\n    const users: Array<{ userId: string; userName: string }> = [];\r\n\r\n    Object.keys(state).forEach((key) => {\r\n        const presences = state[key];\r\n        if (presences && presences.length > 0) {\r\n            const presence = presences[0];\r\n            users.push({\r\n                userId: presence.userId,\r\n                userName: presence.userName,\r\n            });\r\n        }\r\n    });\r\n\r\n    return users;\r\n}\r\n\r\n/**\r\n * Subscribe to new reviews (for mentors)\r\n */\r\nexport function subscribeToReviews(\r\n    mentorId: string,\r\n    onNewReview: (review: any) => void\r\n) {\r\n    logger.info('Subscribing to new reviews', { mentorId });\r\n\r\n    return supabase\r\n        .channel(`reviews:${mentorId}`)\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'INSERT',\r\n                schema: 'public',\r\n                table: 'session_reviews',\r\n                filter: `mentor_id=eq.${mentorId}`,\r\n            },\r\n            (payload) => {\r\n                logger.info('New review received', payload.new);\r\n                onNewReview(payload.new);\r\n            }\r\n        )\r\n        .subscribe();\r\n}\r\n\r\n/**\r\n * Cleanup: Unsubscribe from all channels\r\n */\r\nexport async function cleanupRealtimeSubscriptions(): Promise<void> {\r\n    logger.info('Cleaning up realtime subscriptions');\r\n    await supabase.removeAllChannels();\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\safety-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\storage.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'localSubjects' is never reassigned. Use 'const' instead.","line":48,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":48,"endColumn":22,"fix":{"range":[1930,1989],"text":"const localSubjects = localData ? JSON.parse(localData) : [];"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6169,6172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6169,6172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13723,13726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13723,13726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { Subject, StudySession, StudyGoal, ScheduleSlot } from '../types';\nimport { supabase } from './supabase';\n\nconst STORAGE_KEYS = {\n  SUBJECTS: 'study_planner_subjects',\n  SESSIONS: 'study_planner_sessions',\n  GOALS: 'study_planner_goals',\n  SCHEDULE: 'study_planner_schedule',\n};\n\n// Get user-specific storage key to keep data separate per user\n// IMPORTANT: Data persists across logout/login cycles\n// - Each user has their own localStorage keys (e.g., study_planner_subjects_abc123)\n// - Data is synced to Supabase database for cross-device access\n// - Logout only clears auth session, NOT user data\n// - On login, data is loaded from database and cached in localStorage\nconst getUserStorageKey = (baseKey: string, userId: string | null): string => {\n  // Use a guest key for unauthenticated users, user-specific key for authenticated\n  return userId ? `${baseKey}_${userId}` : `${baseKey}_guest`;\n};\n\n// Helper to get current user ID - uses getSession which is more reliable\nconst getCurrentUserId = async (): Promise<string | null> => {\n  try {\n    const { data: { session }, error } = await supabase.auth.getSession();\n    if (error) {\n      console.error('Error getting session:', error);\n      return null;\n    }\n    return session?.user?.id || null;\n  } catch (err) {\n    console.error('Failed to get current user ID:', err);\n    return null;\n  }\n};\n\n// Hybrid storage: Use database if user is authenticated, fallback to localStorage\n// Data persists across sign-outs and syncs across devices\nexport const storage = {\n  getSubjects: async (): Promise<Subject[]> => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.SUBJECTS, userId);\n\n    console.log(`Getting subjects - User ID: ${userId || 'guest'}, Storage key: ${storageKey}`);\n\n    // ALWAYS try to load from localStorage first for immediate access\n    const localData = localStorage.getItem(storageKey);\n    let localSubjects = localData ? JSON.parse(localData) : [];\n    console.log(`Found ${localSubjects.length} subjects in localStorage`);\n\n    if (userId) {\n      // If authenticated, try to sync with database\n      const { data, error } = await supabase\n        .from('subjects')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: true });\n\n      if (error) {\n        console.error('Error fetching subjects from database:', error);\n        // Return localStorage data as fallback\n        console.log(`Using localStorage fallback: ${localSubjects.length} subjects`);\n        return localSubjects;\n      }\n\n      const dbSubjects = data?.map(subject => ({\n        id: subject.id,\n        name: subject.name,\n        color: subject.color,\n        difficulty: subject.difficulty,\n        priority: subject.priority,\n        targetHoursPerWeek: subject.target_hours_per_week,\n        targetHoursPerDay: subject.target_hours_per_day\n      })) || [];\n\n      console.log(`Found ${dbSubjects.length} subjects in database`);\n\n      // Use database data if available, otherwise use localStorage\n      const subjects = dbSubjects.length > 0 ? dbSubjects : localSubjects;\n\n      // Always update localStorage cache\n      localStorage.setItem(storageKey, JSON.stringify(subjects));\n      console.log(`Using ${subjects.length} subjects (from ${dbSubjects.length > 0 ? 'database' : 'localStorage'})`);\n\n      return subjects;\n    } else {\n      // Use guest-specific localStorage for unauthenticated users\n      console.log(`Using guest localStorage: ${localSubjects.length} subjects`);\n      return localSubjects;\n    }\n  },\n\n  saveSubjects: async (subjects: Subject[]) => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.SUBJECTS, userId);\n\n    console.log(`Saving ${subjects.length} subjects with key: ${storageKey}`);\n    console.log('Subjects to save:', subjects);\n\n    // ALWAYS save to user-specific localStorage first for immediate persistence\n    localStorage.setItem(storageKey, JSON.stringify(subjects));\n\n    // Verify it was saved\n    const verification = localStorage.getItem(storageKey);\n    const verified = verification ? JSON.parse(verification) : [];\n    console.log(`âœ“ Verified: ${verified.length} subjects saved to localStorage (${userId ? 'user ' + userId : 'guest'})`);\n\n    if (userId) {\n      try {\n        // Also save to database for cross-device sync\n        // First, delete existing subjects for this user\n        const { error: deleteError } = await supabase\n          .from('subjects')\n          .delete()\n          .eq('user_id', userId);\n\n        if (deleteError) {\n          console.error('Error deleting old subjects from database:', deleteError);\n        }\n\n        // Then insert new subjects\n        if (subjects.length > 0) {\n          const { error: insertError } = await supabase\n            .from('subjects')\n            .insert(subjects.map(subject => ({\n              id: subject.id,\n              user_id: userId,\n              name: subject.name,\n              color: subject.color,\n              difficulty: subject.difficulty,\n              priority: subject.priority,\n              target_hours_per_week: subject.targetHoursPerWeek,\n              target_hours_per_day: subject.targetHoursPerDay\n            })));\n\n          if (insertError) {\n            console.error('Error saving subjects to database:', insertError);\n          } else {\n            console.log(`Successfully saved ${subjects.length} subjects to database`);\n          }\n        }\n      } catch (error) {\n        console.error('Error in saveSubjects database operation:', error);\n      }\n    }\n  },\n\n  getSessions: async (): Promise<StudySession[]> => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.SESSIONS, userId);\n\n    console.log(`Getting sessions - User ID: ${userId || 'guest'}, Storage key: ${storageKey}`);\n\n    // ALWAYS try to load from localStorage first for immediate access\n    const localData = localStorage.getItem(storageKey);\n    let localSessions: StudySession[] = [];\n    if (localData) {\n      const parsed = JSON.parse(localData);\n      localSessions = parsed.map((s: any) => ({\n        ...s,\n        startTime: new Date(s.startTime),\n        endTime: s.endTime ? new Date(s.endTime) : undefined,\n      }));\n    }\n    console.log(`Found ${localSessions.length} sessions in localStorage`);\n\n    if (userId) {\n      // If authenticated, try to sync with database\n      const { data, error } = await supabase\n        .from('study_sessions')\n        .select('*')\n        .eq('user_id', userId)\n        .order('start_time', { ascending: false });\n\n      if (error) {\n        console.error('Error fetching sessions from database:', error);\n        // Return localStorage data as fallback\n        console.log(`Using localStorage fallback: ${localSessions.length} sessions`);\n        return localSessions;\n      }\n\n      const dbSessions = data?.map(session => {\n        // Try to recover subjectId from local storage if missing in DB (legacy fix)\n        let subjectId = session.subject_id;\n        if (!subjectId) {\n          const localMatch = localSessions.find(ls => ls.id === session.id);\n          if (localMatch && localMatch.subjectId) {\n            subjectId = localMatch.subjectId;\n          }\n        }\n\n        return {\n          id: session.id,\n          subjectId: subjectId || '', // Fallback to empty string if absolutely not found\n          startTime: new Date(session.start_time),\n          endTime: session.end_time ? new Date(session.end_time) : undefined,\n          durationMinutes: session.duration_minutes,\n          focusRating: session.focus_rating,\n          notes: session.notes || '',\n          completed: session.completed\n        };\n      }) || [];\n\n      console.log(`Found ${dbSessions.length} sessions in database`);\n\n      // AUTO-SYNC: If we have local sessions but none in database, push them to database\n      if (dbSessions.length === 0 && localSessions.length > 0) {\n        console.log('ðŸ”„ Auto-syncing localStorage sessions to database...');\n        try {\n          const sessionsToInsert = localSessions.map(session => ({\n            id: session.id,\n            user_id: userId,\n            subject_id: session.subjectId, // Try to keep the subject link\n            start_time: session.startTime instanceof Date ? session.startTime.toISOString() : new Date(session.startTime).toISOString(),\n            end_time: session.endTime ? (session.endTime instanceof Date ? session.endTime.toISOString() : new Date(session.endTime).toISOString()) : null,\n            duration_minutes: session.durationMinutes,\n            focus_rating: session.focusRating,\n            notes: session.notes || '',\n            completed: session.completed\n          }));\n\n          const { error: insertError, data: insertedData } = await supabase\n            .from('study_sessions')\n            .insert(sessionsToInsert)\n            .select();\n\n          if (insertError) {\n            console.error('âŒ Auto-sync failed:', insertError.message);\n          } else {\n            console.log(`âœ… Auto-synced ${insertedData?.length || 0} sessions to database!`);\n          }\n        } catch (err) {\n          console.error('âŒ Auto-sync exception:', err);\n        }\n\n        // Return local sessions (they're now in DB too)\n        return localSessions;\n      }\n\n      // Merge sessions from both sources, preferring localStorage for conflicts\n      // This ensures newly saved sessions from the timer aren't lost if DB save fails\n      const sessionMap = new Map<string, StudySession>();\n      dbSessions.forEach(s => sessionMap.set(s.id, s));\n      localSessions.forEach(s => sessionMap.set(s.id, s));\n      const sessions = Array.from(sessionMap.values()).sort(\n        (a, b) => new Date(b.startTime).getTime() - new Date(a.startTime).getTime()\n      );\n\n      // Always update localStorage cache\n      localStorage.setItem(storageKey, JSON.stringify(sessions));\n      console.log(`Using ${sessions.length} sessions (merged from ${dbSessions.length} DB + ${localSessions.length} local)`);\n\n      return sessions;\n    } else {\n      // Use guest-specific localStorage for unauthenticated users\n      console.log(`Using guest localStorage: ${localSessions.length} sessions`);\n      return localSessions;\n    }\n  },\n\n  saveSessions: async (sessions: StudySession[]) => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.SESSIONS, userId);\n\n    console.log(`Saving ${sessions.length} sessions with key: ${storageKey}`);\n\n    // ALWAYS save to user-specific localStorage first for immediate persistence\n    localStorage.setItem(storageKey, JSON.stringify(sessions));\n\n    // Verify it was saved\n    const verification = localStorage.getItem(storageKey);\n    const verified = verification ? JSON.parse(verification) : [];\n    console.log(`âœ“ Verified: ${verified.length} sessions saved to localStorage (${userId ? 'user ' + userId : 'guest'})`);\n\n    if (userId) {\n      try {\n        // Also save to database for cross-device sync\n        console.log('ðŸ”„ Syncing sessions to database for user:', userId);\n\n        // First, delete existing sessions for this user\n        // Note: DELETE then INSERT is inefficient but simple for sync. \n        // Ideally we should upsert, but this ensures deleted sessions in local are reflected (if we were full syncing).\n        // Actually, here we are saving *all* sessions from state.\n        const { error: deleteError } = await supabase.from('study_sessions').delete().eq('user_id', userId);\n        if (deleteError) {\n          console.error('âŒ Error deleting old sessions from database:', deleteError);\n        } else {\n          console.log('âœ“ Deleted old sessions from database');\n        }\n\n        // Then insert new sessions\n        if (sessions.length > 0) {\n          const sessionsToInsert = sessions.map(session => ({\n            id: session.id,\n            user_id: userId,\n            subject_id: session.subjectId, // Keep the subject link!\n            start_time: session.startTime instanceof Date ? session.startTime.toISOString() : new Date(session.startTime).toISOString(),\n            end_time: session.endTime ? (session.endTime instanceof Date ? session.endTime.toISOString() : new Date(session.endTime).toISOString()) : null,\n            duration_minutes: session.durationMinutes,\n            focus_rating: session.focusRating,\n            notes: session.notes || '',\n            completed: session.completed\n          }));\n\n          console.log('ðŸ“¤ Inserting sessions to database:', sessionsToInsert);\n\n          const { error, data } = await supabase\n            .from('study_sessions')\n            .insert(sessionsToInsert)\n            .select();\n\n          if (error) {\n            console.error('âŒ Error saving sessions to database:', error);\n            console.error('Error details:', error.message, error.details, error.hint);\n          } else {\n            console.log('âœ… Successfully saved', data?.length || 0, 'sessions to database');\n          }\n        }\n      } catch (err) {\n        console.error('âŒ Exception in saveSessions database sync:', err);\n      }\n    }\n  },\n\n  getGoals: async (): Promise<StudyGoal[]> => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.GOALS, userId);\n\n    console.log(`Getting goals - User ID: ${userId || 'guest'}, Storage key: ${storageKey}`);\n\n    // ALWAYS try to load from localStorage first for immediate access\n    const localData = localStorage.getItem(storageKey);\n    let localGoals: StudyGoal[] = [];\n    if (localData) {\n      const parsed = JSON.parse(localData);\n      localGoals = parsed.map((g: any) => ({\n        ...g,\n        targetDate: g.targetDate ? new Date(g.targetDate) : undefined,\n        completedAt: g.completedAt ? new Date(g.completedAt) : undefined,\n        examDate: g.examDate ? new Date(g.examDate) : undefined,\n      }));\n    }\n    console.log(`Found ${localGoals.length} goals in localStorage`);\n\n    if (userId) {\n      // If authenticated, try to sync with database\n      const { data, error } = await supabase\n        .from('study_goals')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false });\n\n      if (error) {\n        console.error('Error fetching goals from database:', error);\n        // Return localStorage data as fallback\n        console.log(`Using localStorage fallback: ${localGoals.length} goals`);\n        return localGoals;\n      }\n\n      const dbGoals = data?.map(goal => ({\n        ...goal,\n        subjectId: goal.subject_id,\n        subjectIds: goal.subject_ids,\n        targetDate: goal.target_date ? new Date(goal.target_date) : undefined,\n        completedAt: goal.completed_at ? new Date(goal.completed_at) : undefined,\n        examDate: goal.exam_date ? new Date(goal.exam_date) : undefined,\n        examTime: goal.exam_time,\n        examLocation: goal.exam_location,\n        studyHoursTarget: goal.study_hours_target,\n        isExam: goal.is_exam\n      })) || [];\n\n      console.log(`Found ${dbGoals.length} goals in database`);\n\n      // Use database data if available, otherwise use localStorage\n      const goals = dbGoals.length > 0 ? dbGoals : localGoals;\n\n      // Always update localStorage cache\n      localStorage.setItem(storageKey, JSON.stringify(goals));\n      console.log(`Using ${goals.length} goals (from ${dbGoals.length > 0 ? 'database' : 'localStorage'})`);\n\n      return goals;\n    } else {\n      // Use guest-specific localStorage for unauthenticated users\n      console.log(`Using guest localStorage: ${localGoals.length} goals`);\n      return localGoals;\n    }\n  },\n\n  saveGoals: async (goals: StudyGoal[]) => {\n    const userId = await getCurrentUserId();\n    const storageKey = getUserStorageKey(STORAGE_KEYS.GOALS, userId);\n\n    console.log(`Saving ${goals.length} goals with key: ${storageKey}`);\n\n    // ALWAYS save to user-specific localStorage first for immediate persistence\n    localStorage.setItem(storageKey, JSON.stringify(goals));\n\n    // Verify it was saved\n    const verification = localStorage.getItem(storageKey);\n    const verified = verification ? JSON.parse(verification) : [];\n    console.log(`âœ“ Verified: ${verified.length} goals saved to localStorage (${userId ? 'user ' + userId : 'guest'})`);\n\n    if (userId) {\n      // Also save to database for cross-device sync\n      // First, delete existing goals for this user\n      await supabase.from('study_goals').delete().eq('user_id', userId);\n\n      // Then insert new goals\n      if (goals.length > 0) {\n        const { error } = await supabase\n          .from('study_goals')\n          .insert(goals.map(goal => ({\n            id: goal.id,\n            user_id: userId,\n            subject_id: goal.subjectId,\n            subject_ids: goal.subjectIds,\n            title: goal.title,\n            description: goal.description,\n            target_date: goal.targetDate?.toISOString(),\n            completed: goal.completed,\n            completed_at: goal.completedAt?.toISOString(),\n            is_exam: goal.isExam,\n            exam_date: goal.examDate?.toISOString(),\n            exam_time: goal.examTime,\n            exam_location: goal.examLocation,\n            study_hours_target: goal.studyHoursTarget\n          })));\n\n        if (error) {\n          console.error('Error saving goals to database:', error);\n        }\n      }\n    }\n  },\n\n  getSchedule: (): ScheduleSlot[] => {\n    const data = localStorage.getItem(STORAGE_KEYS.SCHEDULE);\n    return data ? JSON.parse(data) : [];\n  },\n\n  saveSchedule: (schedule: ScheduleSlot[]) => {\n    localStorage.setItem(STORAGE_KEYS.SCHEDULE, JSON.stringify(schedule));\n  },\n};\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\supabase-queries.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2972,2975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2972,2975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7142,7145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7142,7145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8008,8011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8008,8011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10463,10466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10463,10466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10735,10738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10735,10738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11437,11440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11437,11440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11471,11474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11471,11474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":369,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12559,12562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12559,12562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13145,13148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13145,13148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":498,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":498,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16150,16153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16150,16153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":542,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17201,17204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17201,17204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":601,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":601,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18738,18741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18738,18741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":732,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":732,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22820,22823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22820,22823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":751,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":751,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23487,23490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23487,23490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":770,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":770,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24023,24026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24023,24026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":848,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":848,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26596,26599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26596,26599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":856,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":856,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26904,26907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26904,26907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":868,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":868,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27161,27164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27161,27164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":882,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":882,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27536,27539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27536,27539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":883,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":883,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27590,27593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27590,27593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":897,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":897,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27977,27980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27977,27980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":906,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":906,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28251,28254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28251,28254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":908,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":908,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28357,28360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28357,28360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":909,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":909,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28393,28396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28393,28396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":944,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":944,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29519,29522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29519,29522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":950,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":950,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29866,29869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29866,29869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":951,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":951,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29924,29927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29924,29927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":974,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":974,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30650,30653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30650,30653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":978,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":978,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30779,30782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30779,30782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":979,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":979,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30815,30818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30815,30818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1013,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1013,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31853,31856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31853,31856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1014,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1014,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31935,31938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31935,31938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1020,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1020,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32243,32246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32243,32246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1023,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1023,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32305,32308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32305,32308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1056,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1056,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33435,33438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33435,33438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1076,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1076,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34017,34020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34017,34020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1294,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1294,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41447,41450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41447,41450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":37,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabase';\nimport { Mentor, Friend, UserProfile } from '../types';\n\nexport const fetchMentors = async (): Promise<Mentor[]> => {\n    const { data, error } = await supabase\n        .from('mentors')\n        .select('*');\n\n    if (error) {\n        console.error('Error fetching mentors:', error);\n        return [];\n    }\n\n    return data.map(m => ({\n        id: m.id,\n        name: m.name,\n        avatarUrl: m.avatar_url || 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop',\n        domain: m.expertise || [],\n        bio: m.bio || '',\n        skills: [],\n        languages: ['English'],\n        rating: m.rating || 0,\n        totalReviews: 0,\n        isVerified: false,\n        pricePerHour: m.price_per_hour,\n        availability: m.availability || ''\n    }));\n};\n\n/* Helper: compute study streak (consecutive days) from study_sessions rows.\n   Uses start_time (matching Dashboard's calculateStreak) with created_at fallback.\n   Uses date.getTime() for comparison (local timezone, same as Dashboard). */\nconst computeStreak = (sessions: { start_time?: string; created_at: string }[]): number => {\n    if (!sessions || sessions.length === 0) return 0;\n    const sessionDates = new Set<number>();\n    sessions.forEach(s => {\n        const d = new Date(s.start_time || s.created_at);\n        d.setHours(0, 0, 0, 0);\n        sessionDates.add(d.getTime());\n    });\n    let streak = 0;\n    const check = new Date();\n    check.setHours(0, 0, 0, 0);\n    // Check today\n    if (sessionDates.has(check.getTime())) {\n        streak = 1;\n        check.setDate(check.getDate() - 1);\n    } else {\n        check.setDate(check.getDate() - 1);\n        if (!sessionDates.has(check.getTime())) return 0;\n        streak = 1;\n        check.setDate(check.getDate() - 1);\n    }\n    while (sessionDates.has(check.getTime())) {\n        streak++;\n        check.setDate(check.getDate() - 1);\n    }\n    return streak;\n};\n\nexport const fetchFriends = async (userId: string): Promise<Friend[]> => {\n    // Fetch accepted friendships\n    const { data, error } = await supabase\n        .from('friends')\n        .select(`\n            friend_id,\n            user_id,\n            status,\n            friend_profile:user_profiles!friends_friend_id_fkey (\n                user_id,\n                full_name,\n                avatar_url,\n                username,\n                role\n            ),\n            user_profile:user_profiles!friends_user_id_fkey (\n                user_id,\n                full_name,\n                avatar_url,\n                username,\n                role\n            )\n        `)\n        .or(`user_id.eq.${userId},friend_id.eq.${userId}`)\n        .eq('status', 'accepted');\n\n    if (error) {\n        console.error('Error fetching friends:', error);\n        return [];\n    }\n\n    // Build friend list\n    const friendsList = data.map(f => {\n        const isUserSender = f.user_id === userId;\n        const profile: any = isUserSender ? f.friend_profile : f.user_profile;\n        return {\n            id: isUserSender ? f.friend_id : f.user_id,\n            name: profile?.full_name || 'Unknown User',\n            username: profile?.username || 'unknown',\n            status: 'offline' as const,\n            studyStreak: 0,\n            avatarUrl: profile?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(profile?.full_name || 'U')}&background=random`,\n            role: profile?.role || 'student',\n        };\n    });\n\n    // Always compute streaks from study_sessions (same algorithm as Dashboard's calculateStreak)\n    const friendIds = friendsList.map(f => f.id);\n    if (friendIds.length > 0) {\n        // Compute streaks from study_sessions for ALL friends (ignore stale study_streak column)\n        const zeroIds = friendIds;\n        if (zeroIds.length > 0) {\n            try {\n                const ninetyDaysAgo = new Date();\n                ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);\n                const { data: sessionRows, error: sessErr } = await supabase\n                    .from('study_sessions')\n                    .select('user_id, start_time, created_at')\n                    .in('user_id', zeroIds)\n                    .gte('created_at', ninetyDaysAgo.toISOString())\n                    .order('start_time', { ascending: false });\n\n                if (!sessErr && sessionRows && sessionRows.length > 0) {\n                    const grouped: Record<string, { created_at: string }[]> = {};\n                    sessionRows.forEach(row => {\n                        if (!grouped[row.user_id]) grouped[row.user_id] = [];\n                        grouped[row.user_id].push(row);\n                    });\n                    friendsList.forEach(f => {\n                        if (grouped[f.id]) {\n                            f.studyStreak = computeStreak(grouped[f.id]);\n                        }\n                    });\n                }\n            } catch (err) {\n                console.warn('[fetchFriends] Could not compute streaks from study_sessions (RLS may be blocking). Run fix-friend-streaks.sql to fix.', err);\n            }\n        }\n    }\n\n    return friendsList;\n};\n\nexport const searchUsers = async (query: string, currentUserId: string): Promise<UserProfile[]> => {\n    const { data, error } = await supabase\n        .from('user_profiles')\n        .select('*')\n        .neq('user_id', currentUserId)\n        .or(`username.ilike.%${query}%,full_name.ilike.%${query}%`)\n        .limit(10);\n\n    if (error) {\n        console.error('Error searching users:', error);\n        return [];\n    }\n\n    return data.map(p => ({\n        id: p.id,\n        userId: p.user_id,\n        fullName: p.full_name,\n        avatarUrl: p.avatar_url,\n        role: p.role,\n        username: p.username,\n        createdAt: new Date(p.created_at),\n        updatedAt: new Date(p.updated_at)\n    }));\n};\n\nexport const sendFriendRequest = async (userId: string, friendId: string) => {\n    // Let's use a simpler approach: fetch all relationships for the user and check in JS.\n    const { data: allRels, error: fetchError } = await supabase\n        .from('friends')\n        .select('user_id, friend_id')\n        .or(`user_id.eq.${userId},friend_id.eq.${userId}`);\n\n    if (fetchError) {\n        console.error('Error checking existing friend request:', fetchError);\n        return { error: fetchError };\n    }\n\n    const alreadyExists = allRels?.some(r =>\n        (r.user_id === userId && r.friend_id === friendId) ||\n        (r.user_id === friendId && r.friend_id === userId)\n    );\n\n    if (alreadyExists) {\n        return { error: { message: 'A friend request or friendship already exists.' } };\n    }\n\n    const { error } = await supabase\n        .from('friends')\n        .insert({\n            user_id: userId,\n            friend_id: friendId,\n            status: 'pending'\n        });\n\n    if (!error) {\n        // Create notification for the receiver\n        await createNotification(friendId, userId, 'friend_request', 'wants to be your friend');\n    }\n\n    return { error };\n};\n\nexport const fetchPendingFriendRequests = async (userId: string): Promise<any[]> => {\n    const { data, error } = await supabase\n        .from('friends')\n        .select(`\n            id,\n            user_id,\n            friend_id,\n            status,\n            sender_profile:user_profiles!friends_user_id_fkey (\n                full_name,\n                avatar_url,\n                username\n            )\n        `)\n        .eq('friend_id', userId)\n        .eq('status', 'pending');\n\n    if (error) {\n        console.error('Error fetching pending friend requests:', error);\n        return [];\n    }\n\n    console.log('Pending requests raw data:', data);\n\n    // If join failed but rows exist, log it\n    if (data && data.length > 0 && !data[0].sender_profile) {\n        console.warn('Friend request rows found, but sender_profile join failed. Check foreign key constraints.');\n    }\n\n    return data.map(req => {\n        const profile: any = Array.isArray(req.sender_profile) ? req.sender_profile[0] : req.sender_profile;\n        return {\n            id: req.id,\n            userId: req.user_id,\n            name: profile?.full_name || 'Unknown User',\n            username: profile?.username || 'unknown',\n            avatarUrl: profile?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(profile?.full_name || 'U')}&background=random`,\n            status: req.status\n        };\n    });\n};\n\nexport const updateFriendRequestStatus = async (requestId: string, status: 'accepted' | 'rejected') => {\n    const { error } = await supabase\n        .from('friends')\n        .update({ status })\n        .eq('id', requestId);\n\n    return { error };\n};\n\nexport const sendMessage = async (senderId: string, receiverId: string, content: string) => {\n    const { error } = await supabase\n        .from('messages')\n        .insert({\n            sender_id: senderId,\n            receiver_id: receiverId,\n            content\n        });\n\n    if (!error) {\n        // Create notification for receiver so it shows in NotificationCenter\n        await createNotification(receiverId, senderId, 'message', content.length > 80 ? content.substring(0, 80) + '...' : content);\n    }\n\n    return { error };\n};\n\nexport const fetchMessages = async (userId: string, friendId: string) => {\n    const { data, error } = await supabase\n        .from('messages')\n        .select(`\n            *,\n            sender:user_profiles!messages_sender_id_fkey (\n                full_name,\n                username,\n                avatar_url\n            )\n        `)\n        .or(`and(sender_id.eq.${userId},receiver_id.eq.${friendId}),and(sender_id.eq.${friendId},receiver_id.eq.${userId})`)\n        .order('created_at', { ascending: true });\n\n    if (error) {\n        console.error('Error fetching messages:', error);\n        // Fallback: try without join in case FK doesn't exist\n        const { data: fallbackData, error: fallbackError } = await supabase\n            .from('messages')\n            .select('*')\n            .or(`and(sender_id.eq.${userId},receiver_id.eq.${friendId}),and(sender_id.eq.${friendId},receiver_id.eq.${userId})`)\n            .order('created_at', { ascending: true });\n        if (fallbackError) {\n            console.error('Error fetching messages (fallback):', fallbackError);\n            return [];\n        }\n        return fallbackData || [];\n    }\n\n    return (data || []).map((msg: any) => ({\n        ...msg,\n        senderName: msg.sender?.full_name || null,\n        senderUsername: msg.sender?.username || null,\n        senderAvatar: msg.sender?.avatar_url || null,\n    }));\n};\n\nexport const subscribeToMessages = (userId: string, onMessage: (message: any) => void) => {\n    return supabase\n        .channel('public:messages')\n        .on('postgres_changes', {\n            event: 'INSERT',\n            schema: 'public',\n            table: 'messages',\n            filter: `receiver_id=eq.${userId}`\n        }, (payload) => {\n            onMessage(payload.new);\n        })\n        .subscribe();\n};\n\nexport const createNotification = async (\n    userId: string,\n    senderId: string,\n    type: 'friend_request' | 'message' | 'call' | 'call_ended' | 'group_added' | 'session_request' | 'session_accepted' | 'session_rejected' | 'session_completed' | 'session_cancelled' | 'session_reminder' | 'new_review',\n    content: string,\n    metadata?: Record<string, any>\n) => {\n    const insertData: any = {\n        user_id: userId,\n        sender_id: senderId,\n        type,\n        content\n    };\n    if (metadata) insertData.metadata = metadata;\n\n    const { error } = await supabase\n        .from('notifications')\n        .insert(insertData);\n\n    return { error };\n};\n\nexport const fetchNotifications = async (userId: string) => {\n    // Fetch notifications without FK joins (FK may point to auth.users, not user_profiles)\n    const { data, error } = await supabase\n        .from('notifications')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false });\n\n    if (error) {\n        console.error('Error fetching notifications:', error);\n        return [];\n    }\n\n    if (!data || data.length === 0) return [];\n\n    // Batch-fetch sender profiles\n    const senderIds = [...new Set(data.map(n => n.sender_id).filter(Boolean))];\n    const { data: profiles } = await supabase\n        .from('user_profiles')\n        .select('user_id, full_name, avatar_url, username')\n        .in('user_id', senderIds);\n\n    const profileMap = new Map<string, any>();\n    if (profiles) profiles.forEach(p => profileMap.set(p.user_id, p));\n\n    return data.map(notif => {\n        const sender = profileMap.get(notif.sender_id);\n        return {\n            ...notif,\n            senderName: sender?.full_name || 'Unknown User',\n            senderAvatar: sender?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(sender?.full_name || 'U')}&background=random`,\n            senderUsername: sender?.username || 'unknown'\n        };\n    });\n};\n\nexport const subscribeToNotifications = (userId: string, onNotification: (notification: any) => void) => {\n    return supabase\n        .channel(`public:notifications:${userId}`)\n        .on('postgres_changes', {\n            event: 'INSERT',\n            schema: 'public',\n            table: 'notifications',\n            filter: `user_id=eq.${userId}`\n        }, (payload) => {\n            onNotification(payload.new);\n        })\n        .subscribe();\n};\n\nexport const fetchUnreadCounts = async (userId: string) => {\n    const { data, error } = await supabase\n        .from('notifications')\n        .select('sender_id, type')\n        .eq('user_id', userId)\n        .eq('is_read', false);\n\n    if (error) {\n        console.error('Error fetching unread counts:', error);\n        return {};\n    }\n\n    const counts: Record<string, number> = {};\n    data.forEach(notif => {\n        if (notif.type === 'message') {\n            counts[notif.sender_id] = (counts[notif.sender_id] || 0) + 1;\n        }\n    });\n\n    return counts;\n};\n\nexport const markNotificationsAsRead = async (userId: string, senderId: string, type?: string, groupId?: string) => {\n    let query = supabase\n        .from('notifications')\n        .update({ is_read: true })\n        .eq('user_id', userId);\n\n    if (senderId) {\n        query = query.eq('sender_id', senderId);\n    }\n\n    if (groupId) {\n        // Assume group_id is in metadata for notifications\n        query = query.filter('metadata->>group_id', 'eq', groupId);\n    }\n\n    if (type) {\n        query = query.eq('type', type);\n    }\n\n    const { error } = await query;\n    return { error };\n};\n\n// Group Functions\n\nexport const createGroup = async (name: string, avatarUrl: string, creatorId: string) => {\n    const { data, error } = await supabase\n        .from('groups')\n        .insert({\n            name,\n            avatar_url: avatarUrl,\n            created_by: creatorId\n        })\n        .select()\n        .single();\n\n    if (error) return { error };\n\n    // Add creator as admin\n    const { error: memberError } = await supabase\n        .from('group_members')\n        .insert({\n            group_id: data.id,\n            user_id: creatorId,\n            role: 'admin'\n        });\n\n    return { data, error: memberError };\n};\n\nexport const fetchUserGroups = async (userId: string) => {\n    // This query is being replaced by the better approach below\n    await supabase\n        .from('groups')\n        .select(`\n            *,\n            members:group_members(count)\n        `)\n        .eq('group_members.user_id', userId);\n\n    // Better approach: query group_members then join groups\n    const { data: memberData, error: memberError } = await supabase\n        .from('group_members')\n        .select(`\n            group:groups (\n                id,\n                name,\n                avatar_url,\n                created_by,\n                created_at\n            )\n        `)\n        .eq('user_id', userId);\n\n    if (memberError) {\n        console.error('Error fetching user groups:', memberError);\n        return [];\n    }\n\n    return memberData.map((m: any) => {\n        const g = m.group;\n        return {\n            id: g.id,\n            name: g.name,\n            avatarUrl: g.avatar_url || '',\n            createdBy: g.created_by,\n            createdAt: g.created_at,\n        };\n    });\n};\n\nexport const addGroupMember = async (groupId: string, userId: string) => {\n    const { error } = await supabase\n        .from('group_members')\n        .insert({\n            group_id: groupId,\n            user_id: userId,\n            role: 'member'\n        });\n\n    return { error };\n};\n\nexport const fetchGroupMembers = async (groupId: string) => {\n    const { data, error } = await supabase\n        .from('group_members')\n        .select(`\n            user_id,\n            role,\n            joined_at,\n            profile:user_profiles (\n                full_name,\n                avatar_url,\n                username\n            )\n        `)\n        .eq('group_id', groupId);\n\n    if (error) {\n        console.error('Error fetching group members:', error);\n        return [];\n    }\n\n    return data.map((m: any) => ({\n        groupId,\n        userId: m.user_id,\n        role: m.role,\n        joinedAt: new Date(m.joined_at),\n        profile: m.profile\n    }));\n};\n\nexport const removeGroupMember = async (groupId: string, userId: string) => {\n    const { error } = await supabase\n        .from('group_members')\n        .delete()\n        .eq('group_id', groupId)\n        .eq('user_id', userId);\n\n    return { error };\n};\n\nexport const updateGroupMemberRole = async (groupId: string, userId: string, role: 'admin' | 'member') => {\n    const { error } = await supabase\n        .from('group_members')\n        .update({ role })\n        .eq('group_id', groupId)\n        .eq('user_id', userId);\n\n    return { error };\n};\n\nexport const sendGroupMessage = async (groupId: string, senderId: string, content: string) => {\n    const { error } = await supabase\n        .from('messages')\n        .insert({\n            sender_id: senderId,\n            group_id: groupId,\n            content\n        });\n\n    return { error };\n};\n\nexport const fetchGroupMessages = async (groupId: string) => {\n    const { data, error } = await supabase\n        .from('messages')\n        .select(`\n            *,\n            sender_profile:user_profiles!messages_sender_id_fkey (\n                full_name,\n                avatar_url\n            )\n        `)\n        .eq('group_id', groupId)\n        .order('created_at', { ascending: true });\n\n    if (error) {\n        console.error('Error fetching group messages:', error);\n        return [];\n    }\n\n    return data.map((msg: any) => ({\n        ...msg,\n        senderName: msg.sender_profile?.full_name,\n        senderAvatar: msg.sender_profile?.avatar_url\n    }));\n};\n\nexport const getUserProfile = async (userId: string): Promise<UserProfile | null> => {\n    const { data, error } = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('user_id', userId)\n        .single();\n\n    if (error) {\n        if (error.code !== 'PGRST116') { // Ignore \"no rows found\" error\n            console.error('Error fetching user profile:', error);\n        }\n        return null;\n    }\n\n    return {\n        id: data.id,\n        userId: data.user_id,\n        fullName: data.full_name,\n        avatarUrl: data.avatar_url,\n        role: data.role,\n        profession: data.profession,\n        experience: data.experience,\n        class: data.class,\n        course: data.course,\n        age: data.age,\n        phoneNumber: data.phone_number,\n        username: data.username,\n        createdAt: new Date(data.created_at),\n        updatedAt: new Date(data.updated_at)\n    };\n};\n\nexport const fetchUpcomingSessions = async (userId: string, role: 'student' | 'mentor') => {\n    const { data, error } = await supabase\n        .from('session_requests')\n        .select(`\n            *,\n            mentor_profile:user_profiles!session_requests_mentor_id_fkey (\n                full_name,\n                avatar_url\n            ),\n            student_profile:user_profiles!session_requests_student_id_fkey (\n                full_name,\n                avatar_url\n            )\n        `)\n        .eq(role === 'student' ? 'student_id' : 'mentor_id', userId)\n        .eq('status', 'accepted')\n        .order('preferred_date', { ascending: true });\n\n    if (error) {\n        console.error('Error fetching upcoming sessions:', error);\n        return [];\n    }\n\n    return data.map(session => ({\n        ...session,\n        mentorId: session.mentor_id,\n        studentId: session.student_id,\n        preferredDate: session.preferred_date,\n        preferredTime: session.preferred_time,\n        mentorResponse: session.mentor_response,\n        meetingLink: session.meeting_link,\n        studentMessage: session.student_message,\n        mentorProfile: {\n            fullName: session.mentor_profile?.full_name,\n            avatarUrl: session.mentor_profile?.avatar_url\n        },\n        studentProfile: {\n            fullName: session.student_profile?.full_name,\n            avatarUrl: session.student_profile?.avatar_url\n        }\n    }));\n};\n\nexport const fetchMentorsFromProfiles = async (): Promise<Mentor[]> => {\n    const { data, error } = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('role', 'mentor');\n\n    if (error) {\n        console.error('Error fetching mentors from profiles:', error);\n        return [];\n    }\n\n    return data.map(m => ({\n        id: m.user_id,\n        name: m.full_name || 'Anonymous Mentor',\n        username: m.username,\n        avatarUrl: m.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(m.full_name || 'M')}&background=random`,\n        domain: m.profession ? [m.profession] : [],\n        experienceYears: parseInt(m.experience || '0'),\n        bio: m.experience || '',\n        skills: [],\n        languages: ['English'],\n        rating: 4.5,\n        totalReviews: 0,\n        isVerified: true\n    }));\n};\n\nexport const fetchMentorProfile = async (userId: string): Promise<Mentor | null> => {\n    const { data, error } = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('user_id', userId)\n        .eq('role', 'mentor')\n        .single();\n\n    if (error || !data) {\n        console.error('Error fetching mentor profile:', error);\n        return null;\n    }\n\n    // Fetch aggregated review stats\n    const { data: reviewData } = await supabase\n        .from('mentor_reviews')\n        .select('rating')\n        .eq('mentor_id', userId);\n\n    const reviews = reviewData || [];\n    const totalReviews = reviews.length;\n    const avgRating = totalReviews > 0\n        ? reviews.reduce((sum: number, r: any) => sum + (r.rating || 0), 0) / totalReviews\n        : 0;\n\n    return {\n        id: data.user_id,\n        name: data.full_name || 'Anonymous Mentor',\n        username: data.username,\n        avatarUrl: data.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.full_name || 'M')}&background=random`,\n        domain: data.profession ? [data.profession] : [],\n        experienceYears: parseInt(data.experience || '0'),\n        bio: data.experience || '',\n        skills: [],\n        languages: ['English'],\n        rating: avgRating,\n        totalReviews,\n        isVerified: true\n    };\n};\n\nexport const createMentorOffering = async (offering: any) => {\n    const { data, error } = await supabase\n        .from('mentorship_offerings')\n        .insert(offering)\n        .select()\n        .single();\n\n    return { data, error };\n};\n\nexport const deleteMentorOffering = async (offeringId: string) => {\n    const { error } = await supabase\n        .from('mentorship_offerings')\n        .delete()\n        .eq('id', offeringId);\n\n    if (error) console.error('Error deleting offering:', error);\n};\n\nexport const updateMentorOffering = async (offeringId: string, updates: Record<string, any>) => {\n    const { data, error } = await supabase\n        .from('mentorship_offerings')\n        .update(updates)\n        .eq('id', offeringId)\n        .select()\n        .single();\n\n    if (error) console.error('Error updating offering:', error);\n    return { data, error };\n};\n\nexport const acceptSessionRequest = async (requestId: string, responseText: string, meetingLink: string) => {\n    // Fetch the request first to get student_id and mentor_id for notification\n    const { data: reqData } = await supabase\n        .from('session_requests')\n        .select('student_id, mentor_id, topic')\n        .eq('id', requestId)\n        .single();\n\n    const { error } = await supabase\n        .from('session_requests')\n        .update({\n            status: 'accepted',\n            mentor_response: responseText,\n            meeting_link: meetingLink,\n        })\n        .eq('id', requestId);\n\n    if (error) {\n        console.error('Error accepting session request:', error);\n    } else if (reqData) {\n        // Notify the student that their session was accepted\n        await createNotification(\n            reqData.student_id,\n            reqData.mentor_id,\n            'session_accepted',\n            `Your session request \"${reqData.topic}\" has been accepted!${meetingLink ? ' Meeting link provided.' : ''}`\n        );\n    }\n};\n\nexport const rejectSessionRequest = async (requestId: string, responseText: string) => {\n    const { data: reqData } = await supabase\n        .from('session_requests')\n        .select('student_id, mentor_id, topic')\n        .eq('id', requestId)\n        .single();\n\n    const { error } = await supabase\n        .from('session_requests')\n        .update({\n            status: 'rejected',\n            mentor_response: responseText,\n        })\n        .eq('id', requestId);\n\n    if (error) {\n        console.error('Error rejecting session request:', error);\n    } else if (reqData) {\n        await createNotification(\n            reqData.student_id,\n            reqData.mentor_id,\n            'session_rejected',\n            `Your session request \"${reqData.topic}\" was declined.${responseText ? ' Reason: ' + responseText : ''}`\n        );\n    }\n};\n\nexport const updateSessionMeetingLink = async (requestId: string, meetingLink: string) => {\n    const { error } = await supabase\n        .from('session_requests')\n        .update({ meeting_link: meetingLink })\n        .eq('id', requestId);\n\n    if (error) console.error('Error updating meeting link:', error);\n};\n\nexport const subscribeToMentorReviews = (mentorId: string, callback: (review: any) => void) => {\n    const channel = supabase\n        .channel(`mentor-reviews-${mentorId}-${Date.now()}`)\n        .on('postgres_changes', {\n            event: 'INSERT',\n            schema: 'public',\n            table: 'mentor_reviews',\n            filter: `mentor_id=eq.${mentorId}`,\n        }, (payload: any) => {\n            callback(payload.new);\n        })\n        .subscribe();\n\n    return {\n        unsubscribe: () => {\n            supabase.removeChannel(channel);\n        }\n    };\n};\n\nexport const fetchMentorOfferings = async (mentorId: string): Promise<any[]> => {\n    const { data, error } = await supabase\n        .from('mentorship_offerings')\n        .select('*')\n        .eq('mentor_id', mentorId);\n\n    if (error) {\n        console.error('Error fetching mentor offerings:', error);\n        return [];\n    }\n\n    return data || [];\n};\n\nexport const fetchAllMentorOfferings = async (mentorIds: string[]): Promise<Map<string, any[]>> => {\n    const offeringsMap = new Map<string, any[]>();\n    if (mentorIds.length === 0) return offeringsMap;\n\n    const { data, error } = await supabase\n        .from('mentorship_offerings')\n        .select('*')\n        .in('mentor_id', mentorIds)\n        .eq('is_active', true);\n\n    if (error) {\n        console.error('Error fetching all mentor offerings:', error);\n        return offeringsMap;\n    }\n\n    (data || []).forEach((o: any) => {\n        const mentorOfferings = offeringsMap.get(o.mentor_id) || [];\n        mentorOfferings.push(o);\n        offeringsMap.set(o.mentor_id, mentorOfferings);\n    });\n\n    return offeringsMap;\n};\n\nexport const fetchMentorReviews = async (mentorId: string): Promise<any[]> => {\n    // Try with FK join first, fall back to plain query + manual profile lookup\n    let data: any[] | null = null;\n    let error: any = null;\n\n    const result = await supabase\n        .from('mentor_reviews')\n        .select(`\n            *,\n            student_profile:user_profiles!mentor_reviews_student_id_fkey (\n                full_name,\n                avatar_url,\n                username\n            )\n        `)\n        .eq('mentor_id', mentorId)\n        .order('created_at', { ascending: false });\n\n    data = result.data;\n    error = result.error;\n\n    // If FK join failed, fetch reviews without join then manually fetch student profiles\n    if (error) {\n        console.warn('FK join failed for mentor_reviews, falling back to manual lookup:', error.message);\n        const plainResult = await supabase\n            .from('mentor_reviews')\n            .select('*')\n            .eq('mentor_id', mentorId)\n            .order('created_at', { ascending: false });\n\n        if (plainResult.error) {\n            console.error('Error fetching mentor reviews:', plainResult.error);\n            return [];\n        }\n\n        data = plainResult.data || [];\n\n        // Manually fetch student profiles\n        const studentIds = [...new Set(data.map((r: any) => r.student_id).filter(Boolean))];\n        if (studentIds.length > 0) {\n            const { data: profiles } = await supabase\n                .from('user_profiles')\n                .select('user_id, full_name, avatar_url, username')\n                .in('user_id', studentIds);\n            const profileMap = new Map((profiles || []).map((p: any) => [p.user_id, p]));\n            return data.map((r: any) => {\n                const profile = profileMap.get(r.student_id);\n                return {\n                    ...r,\n                    studentName: profile?.full_name,\n                    studentAvatarUrl: profile?.avatar_url,\n                    studentUsername: profile?.username,\n                };\n            });\n        }\n\n        return data;\n    }\n\n    return (data || []).map(r => ({\n        ...r,\n        studentName: r.student_profile?.full_name,\n        studentAvatarUrl: r.student_profile?.avatar_url,\n        studentUsername: r.student_profile?.username\n    }));\n};\n\nexport const fetchAllMentorReviews = async (mentorIds: string[], limitPerMentor: number = 3) => {\n    const reviewsMap = new Map<string, any[]>();\n    if (mentorIds.length === 0) return reviewsMap;\n\n    // Try FK join first, fall back to manual lookup\n    let data: any[] | null = null;\n    let error: any = null;\n\n    const result = await supabase\n        .from('mentor_reviews')\n        .select(`\n            *,\n            student_profile:user_profiles!mentor_reviews_student_id_fkey (\n                full_name,\n                avatar_url,\n                username\n            )\n        `)\n        .in('mentor_id', mentorIds)\n        .order('created_at', { ascending: false });\n\n    data = result.data;\n    error = result.error;\n\n    if (error) {\n        console.warn('FK join failed for fetchAllMentorReviews, falling back:', error.message);\n        const plainResult = await supabase\n            .from('mentor_reviews')\n            .select('*')\n            .in('mentor_id', mentorIds)\n            .order('created_at', { ascending: false });\n\n        if (plainResult.error) {\n            console.error('Error fetching all mentor reviews:', plainResult.error);\n            return reviewsMap;\n        }\n\n        data = plainResult.data || [];\n\n        // Manual student profile lookup\n        const studentIds = [...new Set(data.map((r: any) => r.student_id).filter(Boolean))];\n        let profileMap = new Map<string, any>();\n        if (studentIds.length > 0) {\n            const { data: profiles } = await supabase\n                .from('user_profiles')\n                .select('user_id, full_name, avatar_url, username')\n                .in('user_id', studentIds);\n            profileMap = new Map((profiles || []).map((p: any) => [p.user_id, p]));\n        }\n\n        data.forEach((r: any) => {\n            const mentorReviews = reviewsMap.get(r.mentor_id) || [];\n            if (mentorReviews.length < limitPerMentor) {\n                const profile = profileMap.get(r.student_id);\n                mentorReviews.push({\n                    ...r,\n                    studentName: profile?.full_name,\n                    studentAvatarUrl: profile?.avatar_url,\n                    studentUsername: profile?.username,\n                });\n                reviewsMap.set(r.mentor_id, mentorReviews);\n            }\n        });\n\n        return reviewsMap;\n    }\n\n    (data || []).forEach(r => {\n        const mentorReviews = reviewsMap.get(r.mentor_id) || [];\n        if (mentorReviews.length < limitPerMentor) {\n            mentorReviews.push({\n                ...r,\n                studentName: r.student_profile?.full_name,\n                studentAvatarUrl: r.student_profile?.avatar_url,\n                studentUsername: r.student_profile?.username\n            });\n            reviewsMap.set(r.mentor_id, mentorReviews);\n        }\n    });\n\n    return reviewsMap;\n};\n\nexport const createSessionRequest = async (request: any) => {\n    const { data, error } = await supabase\n        .from('session_requests')\n        .insert(request)\n        .select()\n        .single();\n\n    if (!error && data) {\n        // Create notification for mentor\n        await createNotification(\n            request.mentor_id,\n            request.student_id,\n            'message', // Reuse message type or add session type\n            `New session request for: ${request.topic}`\n        );\n    }\n\n    return { data, error };\n};\n\nexport const fetchSessionRequests = async (userId: string, role: 'student' | 'mentor'): Promise<any[]> => {\n    // First fetch session requests without profile joins (FK hints can fail if FKs point to auth.users)\n    const { data, error } = await supabase\n        .from('session_requests')\n        .select('*')\n        .eq(role === 'student' ? 'student_id' : 'mentor_id', userId)\n        .order('created_at', { ascending: false });\n\n    if (error) {\n        console.error('Error fetching session requests:', error);\n        return [];\n    }\n\n    if (!data || data.length === 0) return [];\n\n    // Collect unique mentor and student IDs to batch-fetch profiles\n    const mentorIds = [...new Set(data.map(s => s.mentor_id).filter(Boolean))];\n    const studentIds = [...new Set(data.map(s => s.student_id).filter(Boolean))];\n    const allUserIds = [...new Set([...mentorIds, ...studentIds])];\n\n    // Batch fetch all needed profiles\n    const { data: profiles } = await supabase\n        .from('user_profiles')\n        .select('user_id, full_name, avatar_url')\n        .in('user_id', allUserIds);\n\n    const profileMap = new Map<string, { full_name: string; avatar_url: string }>();\n    if (profiles) {\n        profiles.forEach(p => profileMap.set(p.user_id, p));\n    }\n\n    return data.map(s => {\n        const mentorProfile = profileMap.get(s.mentor_id);\n        const studentProfile = profileMap.get(s.student_id);\n        return {\n            ...s,\n            mentorId: s.mentor_id,\n            studentId: s.student_id,\n            preferredDate: s.preferred_date,\n            preferredTime: s.preferred_time,\n            mentorResponse: s.mentor_response,\n            meetingLink: s.meeting_link,\n            studentMessage: s.student_message,\n            mentorProfile: {\n                fullName: mentorProfile?.full_name,\n                avatarUrl: mentorProfile?.avatar_url\n            },\n            studentProfile: {\n                fullName: studentProfile?.full_name,\n                avatarUrl: studentProfile?.avatar_url\n            }\n        };\n    });\n};\n\nexport const subscribeToSessionRequests = (userId: string, role: 'student' | 'mentor', onChange: () => void) => {\n    return supabase\n        .channel(`public:session_requests:${userId}`)\n        .on('postgres_changes', {\n            event: '*',\n            schema: 'public',\n            table: 'session_requests',\n            filter: `${role === 'student' ? 'student_id' : 'mentor_id'}=eq.${userId}`\n        }, () => {\n            onChange();\n        })\n        .subscribe();\n};\n\nexport const completeSessionRequest = async (requestId: string) => {\n    const { data: reqData } = await supabase\n        .from('session_requests')\n        .select('student_id, mentor_id, topic')\n        .eq('id', requestId)\n        .single();\n\n    const { error } = await supabase\n        .from('session_requests')\n        .update({ status: 'completed' })\n        .eq('id', requestId);\n\n    if (!error && reqData) {\n        // Notify the student that their session is completed, prompting a review\n        await createNotification(\n            reqData.student_id,\n            reqData.mentor_id,\n            'session_completed',\n            `Your session \"${reqData.topic}\" is marked as completed. Leave a review!`,\n            { requiresReview: true, mentorId: reqData.mentor_id, sessionId: requestId, topic: reqData.topic }\n        );\n    }\n\n    return { error };\n};\n\nexport const cancelSessionRequest = async (requestId: string) => {\n    const { data: reqData } = await supabase\n        .from('session_requests')\n        .select('student_id, mentor_id, topic')\n        .eq('id', requestId)\n        .single();\n\n    const { error } = await supabase\n        .from('session_requests')\n        .update({ status: 'cancelled' })\n        .eq('id', requestId);\n\n    if (!error && reqData) {\n        // Notify both parties about cancellation\n        await createNotification(\n            reqData.student_id,\n            reqData.mentor_id,\n            'session_cancelled',\n            `Session \"${reqData.topic}\" has been cancelled.`\n        );\n        await createNotification(\n            reqData.mentor_id,\n            reqData.student_id,\n            'session_cancelled',\n            `Session \"${reqData.topic}\" has been cancelled by the student.`\n        );\n    }\n\n    return { error };\n};\n\nexport const deleteSessionRequest = async (requestId: string) => {\n    const { error } = await supabase\n        .from('session_requests')\n        .delete()\n        .eq('id', requestId);\n\n    return { error };\n};\n\nexport const submitMentorReview = async (mentorId: string, studentId: string, requestId: string, rating: number, reviewText: string) => {\n    const { error } = await supabase\n        .from('mentor_reviews')\n        .insert({\n            mentor_id: mentorId,\n            student_id: studentId,\n            session_request_id: requestId,\n            rating,\n            review_text: reviewText\n        });\n\n    if (!error) {\n        // Notify the mentor about the new review\n        await createNotification(\n            mentorId,\n            studentId,\n            'new_review',\n            `You received a new ${rating}-star review! \"${reviewText.length > 60 ? reviewText.substring(0, 60) + '...' : reviewText}\"`\n        );\n    }\n\n    return { error };\n};\n\n// Time utility functions\nexport const getTimeUntilSession = (date: string, time: string): string => {\n    const sessionDate = new Date(`${date}T${time}`);\n    const now = new Date();\n    const diffMs = sessionDate.getTime() - now.getTime();\n\n    if (diffMs < 0) return 'Started';\n\n    const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n\n    if (diffHrs > 0) return `${diffHrs}h ${diffMins}m`;\n    return `${diffMins}m`;\n};\n\nexport const isSessionIn30Minutes = (date: string, time: string): boolean => {\n    const sessionDate = new Date(`${date}T${time}`);\n    const now = new Date();\n    const diffMins = (sessionDate.getTime() - now.getTime()) / (1000 * 60);\n    return diffMins > 0 && diffMins <= 30;\n};\n\nexport const hasSessionStarted = (date: string, time: string): boolean => {\n    const sessionDate = new Date(`${date}T${time}`);\n    const now = new Date();\n    return now >= sessionDate;\n};\n\nexport const isSessionStartingNow = (date: string, time: string): boolean => {\n    const sessionDate = new Date(`${date}T${time}`);\n    const now = new Date();\n    const diffMins = Math.abs((sessionDate.getTime() - now.getTime()) / (1000 * 60));\n    return diffMins <= 5; // Within 5 minutes\n};\n\nexport const fetchCallHistory = async (userId: string, friendId: string) => {\n    const { data, error } = await supabase\n        .from('call_history')\n        .select('*')\n        .or(`and(caller_id.eq.${userId},receiver_id.eq.${friendId}),and(caller_id.eq.${friendId},receiver_id.eq.${userId})`)\n        .order('call_time', { ascending: false });\n\n    if (error) {\n        console.error('Error fetching call history:', error);\n        return [];\n    }\n    return data;\n};\n\nexport const getTotalTalkTime = async (userId: string, friendId: string) => {\n    const { data, error } = await supabase.rpc('get_total_talk_time', {\n        user1_id: userId,\n        user2_id: friendId\n    });\n\n    if (error) {\n        console.error('Error calling get_total_talk_time:', error);\n        // Fallback to manual calculation if RPC fails\n        const history = await fetchCallHistory(userId, friendId);\n        return history.reduce((total: number, call: any) => total + (call.duration_seconds || 0), 0);\n    }\n\n    return data || 0;\n};\n\nexport const clearChatHistory = async (userId: string, friendId: string, isGroup: boolean) => {\n    let query = supabase.from('messages').delete();\n\n    if (isGroup) {\n        query = query.eq('group_id', friendId);\n    } else {\n        query = query.or(`and(sender_id.eq.${userId},receiver_id.eq.${friendId}),and(sender_id.eq.${friendId},receiver_id.eq.${userId})`);\n    }\n\n    const { error } = await query;\n    return { error };\n};\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\utils\\webrtc-signaling.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[161,164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[161,164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[839,842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[839,842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-async-promise-executor","severity":2,"message":"Promise executor functions should not be async.","line":45,"column":40,"nodeType":"Identifier","messageId":"async","endLine":45,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2730,2733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2730,2733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5714,5717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5714,5717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabase';\r\n\r\ntype SignalType = 'offer' | 'answer' | 'ice-candidate';\r\n\r\ninterface SignalPayload {\r\n    type: SignalType;\r\n    data: any;\r\n    senderId: string;\r\n    receiverId: string;\r\n}\r\n\r\nexport interface WebRTCCallbacks {\r\n    onConnectionStateChange?: (state: RTCPeerConnectionState) => void;\r\n    onIceConnectionStateChange?: (state: RTCIceConnectionState) => void;\r\n    onSignalingStatusChange?: (status: string) => void;\r\n    onError?: (error: Error) => void;\r\n}\r\n\r\nexport class WebRTCSignaling {\r\n    private channel: any;\r\n    private callId: string;\r\n    private userId: string;\r\n    private onSignalCallback: ((payload: SignalPayload) => void) | null = null;\r\n    private isConnected: boolean = false;\r\n    private isJoining: boolean = false;\r\n    private pendingSignals: { type: SignalType; data: any; receiverId: string }[] = [];\r\n    private reconnectAttempts: number = 0;\r\n    private maxReconnectAttempts: number = 5;\r\n    private callbacks: WebRTCCallbacks = {};\r\n    private joinPromise: Promise<boolean> | null = null;\r\n\r\n    constructor(callId: string, userId: string, callbacks?: WebRTCCallbacks) {\r\n        this.callId = callId;\r\n        this.userId = userId;\r\n        this.callbacks = callbacks || {};\r\n    }\r\n\r\n    public async join(): Promise<boolean> {\r\n        if (this.isJoining && this.joinPromise) {\r\n            console.log('â³ Join already in progress, waiting...');\r\n            return this.joinPromise;\r\n        }\r\n\r\n        this.isJoining = true;\r\n        this.joinPromise = new Promise(async (resolve) => {\r\n            const timeout = 20000; // 20 seconds\r\n            let resolved = false;\r\n\r\n            const finish = (result: boolean) => {\r\n                if (resolved) return;\r\n                resolved = true;\r\n                this.isJoining = false;\r\n                this.joinPromise = null;\r\n                resolve(result);\r\n            };\r\n\r\n            // Remove any existing channel first\r\n            if (this.channel) {\r\n                console.log('ðŸ§¹ Cleaning up existing channel before join');\r\n                try {\r\n                    await supabase.removeChannel(this.channel);\r\n                } catch (e) {\r\n                    console.warn('Error removing channel:', e);\r\n                }\r\n            }\r\n\r\n            console.log(`ðŸ”Œ Joining signaling channel: call:${this.callId}`);\r\n            this.callbacks.onSignalingStatusChange?.('JOINING');\r\n\r\n            this.channel = supabase.channel(`call:${this.callId}`, {\r\n                config: {\r\n                    broadcast: { self: false, ack: true }\r\n                }\r\n            });\r\n\r\n            this.channel\r\n                .on('broadcast', { event: 'signal' }, (payload: any) => {\r\n                    console.log('ðŸ“¡ Received signal:', payload.payload?.type, 'from:', payload.payload?.senderId);\r\n                    if (payload.payload.receiverId === this.userId) {\r\n                        this.onSignalCallback?.(payload.payload);\r\n                    }\r\n                })\r\n                .subscribe(async (status: string) => {\r\n                    console.log(`ðŸ”Œ Signaling channel status update: ${status}`);\r\n                    this.callbacks.onSignalingStatusChange?.(status);\r\n\r\n                    if (status === 'SUBSCRIBED') {\r\n                        this.isConnected = true;\r\n                        this.reconnectAttempts = 0;\r\n                        this.flushPendingSignals();\r\n                        finish(true);\r\n                    } else if (status === 'CLOSED' || status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') {\r\n                        this.isConnected = false;\r\n                        if (!resolved) {\r\n                            this.handleConnectionError();\r\n                            finish(false);\r\n                        }\r\n                    }\r\n                });\r\n\r\n            // Absolute timeout\r\n            setTimeout(() => {\r\n                if (!resolved) {\r\n                    console.warn('âš ï¸ Signaling join timed out after 20s');\r\n                    this.handleConnectionError();\r\n                    finish(false);\r\n                }\r\n            }, timeout);\r\n        });\r\n\r\n        return this.joinPromise;\r\n    }\r\n\r\n    private handleConnectionError() {\r\n        if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n            this.reconnectAttempts++;\r\n            const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 10000);\r\n            console.log(`ðŸ”„ Signaling error. Attempting reconnect ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${delay}ms...`);\r\n            setTimeout(() => {\r\n                this.join().catch(console.error);\r\n            }, delay);\r\n        } else {\r\n            console.error('âŒ Max signaling reconnection attempts reached');\r\n            this.callbacks.onError?.(new Error('Signaling connection permanently failed. Please check your internet.'));\r\n        }\r\n    }\r\n\r\n    private async flushPendingSignals() {\r\n        console.log(`ðŸ“¤ Flushing ${this.pendingSignals.length} pending signals`);\r\n        while (this.pendingSignals.length > 0) {\r\n            const signal = this.pendingSignals.shift();\r\n            if (signal) {\r\n                await this.sendSignal(signal.type, signal.data, signal.receiverId);\r\n            }\r\n        }\r\n    }\r\n\r\n    public leave() {\r\n        console.log('ðŸ‘‹ Leaving signaling channel');\r\n        if (this.channel) {\r\n            this.isConnected = false;\r\n            supabase.removeChannel(this.channel);\r\n            this.channel = null;\r\n        }\r\n        this.pendingSignals = [];\r\n        this.reconnectAttempts = 0;\r\n    }\r\n\r\n    public async sendSignal(type: SignalType, data: any, receiverId: string) {\r\n        if (!this.channel) {\r\n            console.warn('âš ï¸ No channel available for sending signal');\r\n            return;\r\n        }\r\n\r\n        if (!this.isConnected) {\r\n            console.log('â³ Channel not ready, queueing signal:', type);\r\n            this.pendingSignals.push({ type, data, receiverId });\r\n            return;\r\n        }\r\n\r\n        console.log('ðŸ“¤ Sending signal:', type, 'to:', receiverId);\r\n\r\n        try {\r\n            await this.channel.send({\r\n                type: 'broadcast',\r\n                event: 'signal',\r\n                payload: {\r\n                    type,\r\n                    data,\r\n                    senderId: this.userId,\r\n                    receiverId\r\n                }\r\n            });\r\n        } catch (err) {\r\n            console.error('âŒ Error sending signal:', err);\r\n            this.callbacks.onError?.(err as Error);\r\n            // Queue the signal for retry\r\n            this.pendingSignals.push({ type, data, receiverId });\r\n        }\r\n    }\r\n\r\n    public onSignal(callback: (payload: SignalPayload) => void) {\r\n        this.onSignalCallback = callback;\r\n    }\r\n\r\n    public getConnectionStatus(): boolean {\r\n        return this.isConnected;\r\n    }\r\n\r\n    public getPendingSignalsCount(): number {\r\n        return this.pendingSignals.length;\r\n    }\r\n\r\n    public setCallbacks(callbacks: WebRTCCallbacks) {\r\n        this.callbacks = { ...this.callbacks, ...callbacks };\r\n    }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projects\\StudyPlanner-GrindClock-main\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]